<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Learning</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="private learning">
<meta property="og:type" content="website">
<meta property="og:title" content="Learning">
<meta property="og:url" content="/blog/page/10/index.html">
<meta property="og:site_name" content="Learning">
<meta property="og:description" content="private learning">
<meta property="og:locale" content="zh_CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Learning">
<meta name="twitter:description" content="private learning">
  
    <link rel="alternate" href="/atom.xml" title="Learning" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Learning</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Joe&#39;s Blog</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="/blog"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-loginintercepter" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/28/loginintercepter/" class="article-date">
  <time datetime="2019-09-28T17:30:00.000Z" itemprop="datePublished">2019-09-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/28/loginintercepter/">logininterceptor（mycatdemo里的）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">extends</span> <span class="title">HandlerInterceptorAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"> &amp;nbsp; &amp;nbsp;<span class="comment">//不需要拦截的url集合</span></span><br><span class="line"> &amp;nbsp; &amp;nbsp;<span class="keyword">private</span> List&amp;lt;String&amp;gt; IGNORE_URI;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object <span class="keyword">handler</span>)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//获取URI后缀</span></span><br><span class="line">        String requestUri = request.getServletPath();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(requestUri.equalsIgnoreCase(<span class="string">"/"</span>))    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//过滤不需要拦截的地址</span></span><br><span class="line">        <span class="keyword">for</span> (String uri : IGNORE_URI) &#123;</span><br><span class="line">            <span class="keyword">if</span> (requestUri.startsWith(uri)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        HttpSession session = request.getSession();</span><br><span class="line"> &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;<span class="comment">//session中包含登录状态放行</span></span><br><span class="line"> &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;<span class="keyword">if</span>(session != <span class="keyword">null</span> &amp;amp;&amp;amp; session.getAttribute(<span class="string">"login_status"</span>) != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            response.sendRedirect(<span class="string">"/user/login?timeout=true"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object <span class="keyword">handler</span>, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.postHandle(request, response, <span class="keyword">handler</span>, modelAndView);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&amp;lt;String&amp;gt; getIGNORE_URI() &#123;</span><br><span class="line">        <span class="keyword">return</span> IGNORE_URI;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setIGNORE_URI</span><span class="params">(List&amp;lt;String&amp;gt; IGNORE_URI)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.IGNORE_URI = IGNORE_URI;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/09/28/loginintercepter/" data-id="ckbdc9uuw00at24u2l5srrpjc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/INTERCEPTOR/">INTERCEPTOR</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SPRINGBOOT/">SPRINGBOOT</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-java使用listener" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/28/java使用listener/" class="article-date">
  <time datetime="2019-09-28T11:09:42.000Z" itemprop="datePublished">2019-09-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/28/java使用listener/">java使用listener</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>定义<br>用于监听Web应用的内部事件的实现类。可以监听用户session的开始与结束，用户请求的到达等等，当事件发生时，会回调监听器的内部方法<br>使用Listener步骤<br>通过实现具体接口创建实现类（可实现多个监听器接口）<br>配置实现类成为监听器，有两种配置方式：<br>直接用@WebListener注解修饰实现类<br>通过web.xml方式配置，代码如下：  </p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="keyword">lt</span>;listener&amp;<span class="keyword">gt</span>;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;listener-class&amp;<span class="keyword">gt</span>;com.zrgk.listener.MyListener&amp;<span class="keyword">lt</span>;/lisener-class&amp;<span class="keyword">gt</span>;</span><br><span class="line">&amp;<span class="keyword">lt</span>;/listener&amp;<span class="keyword">gt</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>常用Web事件监听器接口<ul>
<li>ServletContextListener  <ul>
<li>1.该接口用于监听Web应用的启动与关闭  </li>
<li>2.该接口的两个方法：    <ul>
<li>1.contextInitialized(ServletContextEvent event); //   启动web应用时调用  </li>
<li>2.contextDestroyed(ServletContextEvent event); // 关闭web应用时调用  </li>
</ul>
</li>
<li>3.如何获得application对象：<br>ServletContext application = event.getServletContext();</li>
<li>4.示例</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@WebListener</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyServetContextListener</span> <span class="title">implements</span> <span class="title">ServletContextListener</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//web应用关闭时调用该方法</span></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span>(<span class="params">ServletContextEvent <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        ServletContext application = <span class="keyword">event</span>.getServletContext();</span><br><span class="line">        String userName = application.getInitParameter(<span class="string">"userName"</span>); </span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"关闭web应用的用户名字为："</span>+userName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//web应用启动时调用该方法</span></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span>(<span class="params">ServletContextEvent <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        ServletContext application = <span class="keyword">event</span>.getServletContext();</span><br><span class="line">        String userName = application.getInitParameter(<span class="string">"userName"</span>);     </span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"启动web应用的用户名字为："</span>+userName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ServletContextAttributeListener  <ul>
<li>1.该接口用于监听ServletContext范围（application）内属性的改变。  </li>
<li>2.该接口的两个方法：  <ul>
<li>1.attributeAdded(ServletContextAttributeEvent event); // 当把一个属性存进application时触发   </li>
<li>2.attributeRemoved(ServletContextAttributeEvent event); // 当把一个属性从application删除时触发     </li>
<li>3.attributeReplaced(ServletContextAttributeEvent event); // 当替换application内的某个属性值时触发  </li>
</ul>
</li>
<li>3.如何获得application对象：<br>ServletContext application = event.getServletContext();  </li>
<li>4.示例  </li>
</ul>
</li>
</ul>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@WebListener</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyServletContextAttributeListener</span> <span class="title">implements</span> <span class="title">ServletContextAttributeListener</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//向application范围内添加一个属性时触发</span></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeAdded</span>(<span class="params">ServletContextAttributeEvent <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        String name = <span class="keyword">event</span>.getName();<span class="comment">//向application范围添加的属性名</span></span><br><span class="line">        Object val = <span class="keyword">event</span>.getValue();      <span class="comment">//向application添加的属性对应的属性值</span></span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"向application范围内添加了属性名为："</span>+name+<span class="string">"，属性值为："</span>+val+<span class="string">"的属性"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除属性时触发</span></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeRemoved</span>(<span class="params">ServletContextAttributeEvent <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ...      </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//替换属性值时触发</span></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeReplaced</span>(<span class="params">ServletContextAttributeEvent <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ...      </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ServletRequestListener与ServletRequestAttributeListener<ul>
<li>1.ServletRequestListener用于监听用户请求，而ServletRequestAttributeListener用于监听request范围内属性的变化。  </li>
<li>2.ServletRequestListener两个需要实现的方法  <ul>
<li>1.requestInitialized(ServletRequestEvent event); //用户请求到达、被初始化时触发       </li>
<li>2.requestDestroyed(ServletRequestEvent event); // 用户请求结束、被销毁时触发    </li>
</ul>
</li>
<li>3.ServletRequestAttributeListener两个需要实现的方法  <ul>
<li>1.attributeAdded(ServletRequestAttributeEvent event); // 向request范围内添加属性时触发    </li>
<li>2.attributeRemoved(ServletRequestAttributeEvent event); // 从request范围内删除某个属性时触发    </li>
<li>3.attributeReplaced(ServletRequestAttributeEvent event); // 替换request范围内某个属性值时触发    </li>
</ul>
</li>
<li>4.获取reqeust对象<br>HttpServletRequest req = (HttpServletRequest)event.getServletRequest();  </li>
<li>5.代码片  </li>
</ul>
</li>
</ul>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">@WebListener</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyRequestListener</span> <span class="title">implements</span> <span class="title">ServletRequestListener</span>,<span class="title">ServletRequestAttributeListener</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用户请求结束、被销毁时触发</span></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestDestroyed</span>(<span class="params">ServletRequestEvent <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        HttpServletRequest req = (HttpServletRequest) <span class="keyword">event</span>.getServletRequest();</span><br><span class="line">        String ip = req.getRemoteAddr();</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"IP为:"</span>+ip+<span class="string">"的用户发送到"</span>+req.getRequestURI()+<span class="string">"的请求结束"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用户请求到达、被初始化时触发</span></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestInitialized</span>(<span class="params">ServletRequestEvent <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        HttpServletRequest req = (HttpServletRequest) <span class="keyword">event</span>.getServletRequest();</span><br><span class="line">        String ip = req.getRemoteAddr();</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"IP为:"</span>+ip+<span class="string">"的用户发送到"</span>+req.getRequestURI()+<span class="string">"的请求被初始化"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//向request范围内添加属性时触发</span></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeAdded</span>(<span class="params">ServletRequestAttributeEvent <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        String name = <span class="keyword">event</span>.getName();</span><br><span class="line">        Object val = <span class="keyword">event</span>.getValue();</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"向request范围内添加了名为："</span>+name+<span class="string">"，值为："</span>+val+<span class="string">"的属性"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除request范围内某个属性时触发</span></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeRemoved</span>(<span class="params">ServletRequestAttributeEvent <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        <span class="comment">//...       </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//替换request范围内某个属性值时触发</span></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeReplaced</span>(<span class="params">ServletRequestAttributeEvent <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ...      </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>HttpSessionListener与HttpSessionAttributeListener<ul>
<li>1.HttpSessionListener监听用户session的开始与结束，而HttpSessionAttributeListener监听HttpSession范围（session）内的属性的改变。  </li>
<li>2.HttpSessionListener要实现的方法：<ul>
<li>1.sessionCreated(HttpSessionEvent event); // 用户与服务器的会话开始、创建时触发</li>
<li>2.sessionDestroyed(HttpSessionEvent event); // 用户与服务器的会话结束时触发</li>
</ul>
</li>
<li>3.HttpSessionAttributeListener要实现的方法：<ul>
<li>1.attributeAdded(HttpSessionBindingEvent event) ; // 向session范围内添加属性时触发</li>
<li>2.attributeRemoved(HttpSessionBindingEvent event); // 删除session范围内某个属性时触发</li>
<li>3.attributeReplaced(HttpSessionBindingEvent event); // 替换session范围内某个属性值时触发</li>
</ul>
</li>
<li>3.如何得到session对象<br>HttpSession session = event.getSession();</li>
<li>4.代码片</li>
</ul>
</li>
</ul>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">@WebListener</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MySessionListener</span> <span class="title">implements</span> <span class="title">HttpSessionListener</span>,<span class="title">HttpSessionAttributeListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//建立session会话时触发</span></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionCreated</span>(<span class="params">HttpSessionEvent <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        HttpSession session = <span class="keyword">event</span>.getSession();</span><br><span class="line">        String sessionId = session.getId();</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"建立了会话，会话ID为："</span>+sessionId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDestroyed</span>(<span class="params">HttpSessionEvent <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ...      </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//向session范围内添加属性时触发</span></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeAdded</span>(<span class="params">HttpSessionBindingEvent <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        String name = <span class="keyword">event</span>.getName();</span><br><span class="line">        Object val = <span class="keyword">event</span>.getValue();</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"向session范围内添加了名为："</span>+name+<span class="string">",值为："</span>+val+<span class="string">"的属性"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeRemoved</span>(<span class="params">HttpSessionBindingEvent <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ...      </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeReplaced</span>(<span class="params">HttpSessionBindingEvent <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ...      </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/09/28/java使用listener/" data-id="ckbdc9uui009k24u2hie7cdpc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LISTENER/">LISTENER</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Spring-Boot集成FastDFS" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/27/Spring-Boot集成FastDFS/" class="article-date">
  <time datetime="2019-09-27T00:53:00.000Z" itemprop="datePublished">2019-09-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/27/Spring-Boot集成FastDFS/">Spring Boot集成FastDFS</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://blog.csdn.net/qq_756589808/article/details/82882589" target="_blank" rel="noopener">https://blog.csdn.net/qq_756589808/article/details/82882589</a></p>
<p>1、建立一个springboot的工程，下面的是我的目录结构：</p>
<p><img src="/images/pasted-160.png" alt="upload successful"></p>
<p>2、pom文件引入依赖：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="keyword">lt</span>;properties&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;project.build.sourceEncoding&amp;<span class="keyword">gt</span>;UTF-<span class="number">8</span>&amp;<span class="keyword">lt</span>;/project.build.sourceEncoding&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;project.reporting.outputEncoding&amp;<span class="keyword">gt</span>;UTF-<span class="number">8</span>&amp;<span class="keyword">lt</span>;/project.reporting.outputEncoding&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;java.<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">1.8</span>&amp;<span class="keyword">lt</span>;/java.<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;commons-lang3.<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">3.3</span>.<span class="number">2</span>&amp;<span class="keyword">lt</span>;/commons-lang3.<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;/properties&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">    &amp;<span class="keyword">lt</span>;dependencies&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-boot-starter&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.projectlombok&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;lombok&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;optional&amp;<span class="keyword">gt</span>;<span class="literal">true</span>&amp;<span class="keyword">lt</span>;/optional&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-boot-starter-test&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;scope&amp;<span class="keyword">gt</span>;test&amp;<span class="keyword">lt</span>;/scope&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;!-- 支持 @ConfigurationProperties 注解 --&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-boot-configuration-processor&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;optional&amp;<span class="keyword">gt</span>;<span class="literal">true</span>&amp;<span class="keyword">lt</span>;/optional&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-boot-starter-freemarker&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-boot-starter-amqp&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-boot-starter-data-redis&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;!-- <span class="number">1.5</span>的版本默认采用的连接池技术是jedis  <span class="number">2.0</span>以上版本默认连接池是lettuce,</span><br><span class="line">            在这里采用jedis，所以需要排除lettuce的jar --&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;exclusions&amp;<span class="keyword">gt</span>;</span><br><span class="line">                &amp;<span class="keyword">lt</span>;exclusion&amp;<span class="keyword">gt</span>;</span><br><span class="line">                    &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;redis.clients&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">                    &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;jedis&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">                &amp;<span class="keyword">lt</span>;/exclusion&amp;<span class="keyword">gt</span>;</span><br><span class="line">                &amp;<span class="keyword">lt</span>;exclusion&amp;<span class="keyword">gt</span>;</span><br><span class="line">                    &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;io.lettuce&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">                    &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;lettuce-core&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">                &amp;<span class="keyword">lt</span>;/exclusion&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;/exclusions&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-boot-starter-redis&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">1.4</span>.<span class="number">1</span>.RELEASE&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;!-- 添加jedis客户端 --&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;redis.clients&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;jedis&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;!-- https://mvnrepository.com/artifact/ojdbc/ojdbc --&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;com.oracle&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;ojdbc6&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">11.2</span>.<span class="number">0.3</span>&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;!-- http://repo1.maven.org/maven2/com/github/pagehelper/pagehelper/--&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;com.github.pagehelper&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;pagehelper&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">5.1</span>.<span class="number">4</span>&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;!-- Apache工具组件 --&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.apache.commons&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;commons-lang3&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;$&#123;commons-lang3.<span class="keyword">version</span>&#125;&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;!--spring2.<span class="number">0</span>集成redis所需common-pool2--&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;!-- 必须加上，jedis依赖此  --&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.apache.commons&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;commons-pool2&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">2.5</span>.<span class="number">0</span>&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-boot-starter-web&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.mybatis.spring.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;mybatis-spring-boot-starter&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">1.3</span>.<span class="number">2</span>&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-boot-devtools&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;scope&amp;<span class="keyword">gt</span>;runtime&amp;<span class="keyword">lt</span>;/scope&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;mysql&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;mysql-connector-java&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;scope&amp;<span class="keyword">gt</span>;runtime&amp;<span class="keyword">lt</span>;/scope&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;!-- alibaba的druid数据库连接池 --&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;com.alibaba&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;druid-spring-boot-starter&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">1.1</span>.<span class="number">9</span>&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;!-- 集成fastjson--&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;com.alibaba&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;fastjson&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">1.2</span>.<span class="number">47</span>&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;!-- 集成Swagger2形成API文档请求接口--&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;io.springfox&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;springfox-swagger2&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">2.7</span>.<span class="number">0</span>&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;io.springfox&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;springfox-swagger-ui&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">2.7</span>.<span class="number">0</span>&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;!-- 文件服务器--&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;com.github.tobato&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;fastdfs-client&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">1.26</span>.<span class="number">1</span>-RELEASE&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;commons-io&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;commons-io&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">2.4</span>&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;commons-codec&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;commons-codec&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">1.9</span>&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-jdbc&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">4.3</span>.<span class="number">13</span>.RELEASE&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;com.zaxxer&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;HikariCP&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">3.2</span>.<span class="number">0</span>&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-boot-starter-quartz&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-boot-starter-aop&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">        &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;commons-beanutils&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;commons-beanutils-core&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">1.8</span>.<span class="number">3</span>&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">        &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">    &amp;<span class="keyword">lt</span>;/dependencies&amp;<span class="keyword">gt</span>;</span><br></pre></td></tr></table></figure>

<p>这个是方便在yml中自定义参数同过@Value的形式注入</p>
<p><img src="/images/pasted-161.png" alt="upload successful"></p>
<p>这个依赖确保是1.26.1以上的不然SpringBoot2.0集成会报错</p>
<p><img src="/images/pasted-162.png" alt="upload successful"></p>
<p>按照截图创建包以及建立类：</p>
<p><img src="/images/pasted-163.png" alt="upload successful"></p>
<p>3、编写FdfsConfig 类</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.saliai.logsystem.common.conf;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.<span class="keyword">annotation</span>.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Martin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2018/10/12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Modify</span> By:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FdfsConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(<span class="meta-string">"<span class="subst">$&#123;fdfs.res-host&#125;</span>"</span>)</span></span><br><span class="line">    <span class="keyword">private</span> String resHost;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Value(<span class="meta-string">"<span class="subst">$&#123;fdfs.storage-port&#125;</span>"</span>)</span></span><br><span class="line">    <span class="keyword">private</span> String storagePort;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> String getResHost() &#123;</span><br><span class="line">        <span class="keyword">return</span> resHost;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> void setResHost(String resHost) &#123;</span><br><span class="line">        <span class="keyword">this</span>.resHost = resHost;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> String getStoragePort() &#123;</span><br><span class="line">        <span class="keyword">return</span> storagePort;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> void setStoragePort(String storagePort) &#123;</span><br><span class="line">        <span class="keyword">this</span>.storagePort = storagePort;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、编写 FdfsConfiguration 类</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">package</span> <span class="selector-tag">com</span><span class="selector-class">.saliai</span><span class="selector-class">.logsystem</span><span class="selector-class">.common</span><span class="selector-class">.conf</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author: Martin</span></span><br><span class="line"><span class="comment"> * @Date: 2018/10/12</span></span><br><span class="line"><span class="comment"> * @Description:</span></span><br><span class="line"><span class="comment"> * @Modify By:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">com</span><span class="selector-class">.github</span><span class="selector-class">.tobato</span><span class="selector-class">.fastdfs</span><span class="selector-class">.FdfsClientConfig</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.context</span><span class="selector-class">.annotation</span><span class="selector-class">.Configuration</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.context</span><span class="selector-class">.annotation</span><span class="selector-class">.EnableMBeanExport</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.context</span><span class="selector-class">.annotation</span><span class="selector-class">.Import</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.jmx</span><span class="selector-class">.support</span><span class="selector-class">.RegistrationPolicy</span>;</span><br><span class="line"> </span><br><span class="line">@<span class="keyword">Configuration</span></span><br><span class="line">@<span class="keyword">Import</span>(<span class="keyword">FdfsClientConfig</span>.<span class="keyword">class</span>)</span><br><span class="line">@<span class="keyword">EnableMBeanExport</span>(<span class="keyword">registration</span> = RegistrationPolicy.IGNORE_EXISTING)</span><br><span class="line">public class FdfsConfiguration &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5、建立constants包并建立GlobalConstants类</p>
<p><img src="/images/pasted-164.png" alt="upload successful"></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.saliai.logsystem.common.constants;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Martin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2018/10/25</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Modify</span> By:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalConstants</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String HTTP_FILEURL = <span class="string">"http://baihoomall.100healths.cn"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6、创建截图中的FastDFSClientWrapper类：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.saliai.logsystem.common.utils;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Martin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2018/9/28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Modify</span> By:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.github.tobato.fastdfs.domain.StorePath;</span><br><span class="line"><span class="keyword">import</span> com.github.tobato.fastdfs.exception.FdfsUnsupportStorePathException;</span><br><span class="line"><span class="keyword">import</span> com.github.tobato.fastdfs.proto.storage.DownloadByteArray;</span><br><span class="line"><span class="keyword">import</span> com.github.tobato.fastdfs.service.FastFileStorageClient;</span><br><span class="line"><span class="keyword">import</span> com.saliai.logsystem.common.conf.FdfsConfig;</span><br><span class="line"><span class="keyword">import</span> com.saliai.logsystem.common.constants.GlobalConstants;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FilenameUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 功能描述: 文件处理类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Martin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/10/12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FastDFSClientWrapper</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FastFileStorageClient storageClient;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FdfsConfig fdfsConfig;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function">String <span class="title">uploadFile</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        StorePath storePath = storageClient.uploadFile((InputStream) file.getInputStream(), file.getSize(), FilenameUtils.getExtension(file.getOriginalFilename()), <span class="keyword">null</span>);</span><br><span class="line">        log.info(<span class="string">"storePath:"</span> + storePath);</span><br><span class="line">        <span class="function"><span class="keyword">return</span> <span class="title">getResAccessUrl</span><span class="params">(storePath)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 封装文件完整URL地址</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> storePath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function">String <span class="title">getResAccessUrl</span><span class="params">(StorePath storePath)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//GlobalConstants.HTTP_PRODOCOL +</span></span><br><span class="line">        String fileUrl = GlobalConstants.HTTP_FILEURL + <span class="string">":"</span> + fdfsConfig.getStoragePort() + <span class="string">"/"</span> + storePath.getFullPath();</span><br><span class="line">        log.info(<span class="string">"fileUrl:"</span> + fileUrl);</span><br><span class="line">        <span class="keyword">return</span> fileUrl;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能描述: 删除文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileUrl</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Martin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2018/10/12</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">deleteFile</span><span class="params">(String fileUrl)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        log.info(<span class="string">"删除的文件的url:"</span> + fileUrl);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(fileUrl)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            StorePath storePath = StorePath.praseFromUrl(fileUrl);</span><br><span class="line">            log.info(<span class="string">"groupName:"</span>+storePath.getGroup()+<span class="string">"------"</span>+<span class="string">"文件路径path："</span>+storePath.getPath());</span><br><span class="line">            storageClient.deleteFile(storePath.getGroup(), storePath.getPath());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FdfsUnsupportStorePathException e) &#123;</span><br><span class="line">            log.warn(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能描述: 下载文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileUrl</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> java.io.InputStream</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Martin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2018/10/12</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">InputStream <span class="title">downFile</span><span class="params">(String fileUrl)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            StorePath storePath = StorePath.praseFromUrl(fileUrl);</span><br><span class="line">            <span class="keyword">byte</span>[] fileByte = storageClient.downloadFile(storePath.getGroup(), storePath.getPath(), <span class="keyword">new</span> DownloadByteArray());</span><br><span class="line">            InputStream ins = <span class="keyword">new</span> ByteArrayInputStream(fileByte);</span><br><span class="line">            <span class="keyword">return</span> ins;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.<span class="keyword">error</span>(<span class="string">"Non IO Exception: Get File from Fast DFS failed"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>7、接下来编写controller进行测试</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.saliai.logsystem.controller;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.saliai.logsystem.common.utils.FastDFSClientWrapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.<span class="keyword">annotation</span>.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.support.RedirectAttributes;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Martin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2018/9/28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Modify</span> By:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(<span class="meta-string">"/upload"</span>)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FastDFSClientWrapper dfsClient;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@GetMapping(<span class="meta-string">"/"</span>)</span></span><br><span class="line">    <span class="keyword">public</span> String index() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"upload/upload"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@PostMapping(<span class="meta-string">"/fdfs_upload"</span>)</span></span><br><span class="line">    <span class="keyword">public</span> String fdfsUpload(<span class="meta">@RequestParam(<span class="meta-string">"file"</span>)</span> MultipartFile file,</span><br><span class="line">                             RedirectAttributes redirectAttributes) &#123;</span><br><span class="line">        <span class="keyword">if</span> (file.isEmpty()) &#123;</span><br><span class="line">            redirectAttributes.addFlashAttribute(<span class="string">"message"</span>, <span class="string">"Please select a file to upload"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"redirect:/upload/uploadStatus"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String fileUrl = dfsClient.uploadFile(file);</span><br><span class="line">            redirectAttributes.addFlashAttribute(<span class="string">"message"</span>,</span><br><span class="line">                    <span class="string">"You successfully uploaded '"</span> + fileUrl + <span class="string">"'"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:/upload/uploadStatus"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@GetMapping(<span class="meta-string">"/uploadStatus"</span>)</span></span><br><span class="line">    <span class="keyword">public</span> String uploadStatus() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"upload/uploadStatus"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@RequestMapping(<span class="meta-string">"/deleteFile"</span>)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String deleteFile(<span class="meta">@RequestParam(value = <span class="meta-string">"fileUrl"</span>)</span> String fileUrl) &#123;</span><br><span class="line">        dfsClient.deleteFile(fileUrl);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>8、建立页面测试上传功能。这里使用freemarker</p>
<p><img src="/images/pasted-165.png" alt="upload successful"></p>
<p>upload.ftl:</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="literal">lt</span>;!DOCTYPE html&amp;<span class="literal">gt</span>;</span><br><span class="line"> </span><br><span class="line">&amp;<span class="literal">lt</span>;html&amp;<span class="literal">gt</span>;</span><br><span class="line"> </span><br><span class="line">&amp;<span class="literal">lt</span>;body&amp;<span class="literal">gt</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&amp;<span class="literal">lt</span>;h1&amp;<span class="literal">gt</span>;Spring Boot file upload example&amp;<span class="literal">lt</span>;/h1&amp;<span class="literal">gt</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&amp;<span class="literal">lt</span>;form method=<span class="string">"POST"</span> action=<span class="string">"/upload/fdfs_upload"</span> enctype=<span class="string">"multipart/form-data"</span>&amp;<span class="literal">gt</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&amp;<span class="literal">lt</span>;input type=<span class="string">"file"</span><span class="built_in"> name</span>=<span class="string">"file"</span> /&amp;<span class="literal">gt</span>;&amp;<span class="literal">lt</span>;br/&amp;<span class="literal">gt</span>;&amp;<span class="literal">lt</span>;br/&amp;<span class="literal">gt</span>;</span><br><span class="line"> </span><br><span class="line">&amp;<span class="literal">lt</span>;input type=<span class="string">"submit"</span> <span class="keyword">value</span>=<span class="string">"Submit"</span> /&amp;<span class="literal">gt</span>;</span><br><span class="line"> </span><br><span class="line">&amp;<span class="literal">lt</span>;/form&amp;<span class="literal">gt</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&amp;<span class="literal">lt</span>;/body&amp;<span class="literal">gt</span>;</span><br><span class="line"> </span><br><span class="line">&amp;<span class="literal">lt</span>;/html&amp;<span class="literal">gt</span>;</span><br></pre></td></tr></table></figure>

<p>uploadStatus.ftl:</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="keyword">lt</span>;!DOCTYPE html&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">&amp;<span class="keyword">lt</span>;html lang=<span class="string">"en"</span> xmlns:th=<span class="string">"http://www.thymeleaf.org"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">&amp;<span class="keyword">lt</span>;body&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&amp;<span class="keyword">lt</span>;h1&amp;<span class="keyword">gt</span>;Spring Boot - Upload Status&amp;<span class="keyword">lt</span>;/h1&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&amp;<span class="keyword">lt</span>;<span class="built-in">div</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">&amp;<span class="keyword">lt</span>;h1&amp;<span class="keyword">gt</span>;<span class="symbol">$</span>&#123;message&#125;&amp;<span class="keyword">lt</span>;/h1&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">&amp;<span class="keyword">lt</span>;/<span class="built-in">div</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">&amp;<span class="keyword">lt</span>;/body&amp;<span class="keyword">gt</span>;</span><br><span class="line"> </span><br><span class="line">&amp;<span class="keyword">lt</span>;/html&amp;<span class="keyword">gt</span>;</span><br></pre></td></tr></table></figure>

<p>在启动类中加上@EnableAutoConfiguration注解</p>
<p><img src="/images/pasted-167.png" alt="upload successful"></p>
<p>在配置文件中加入这两个截图的东西：</p>
<p><img src="/images/pasted-168.png" alt="upload successful"></p>
<p><img src="/images/pasted-169.png" alt="upload successful"></p>
<p>9、启动项目，进行测试<br><img src="/images/pasted-170.png" alt="upload successful"></p>
<p><img src="/images/pasted-171.png" alt="upload successful"><br>提交，进行文件上传：</p>
<p><img src="/images/pasted-172.png" alt="upload successful"></p>
<p>返回文件的地址，直接拷贝到浏览器访问，看看是否能访问。</p>
<p><img src="/images/pasted-173.png" alt="upload successful"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/09/27/Spring-Boot集成FastDFS/" data-id="ckbdc9v0o00qb24u244tedqry" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SPRINGBOOT/">SPRINGBOOT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/文件服务器/">文件服务器</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Sprong-boot-Mongodb使用GridFs做小型文件服务器" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/26/Sprong-boot-Mongodb使用GridFs做小型文件服务器/" class="article-date">
  <time datetime="2019-09-26T15:00:00.000Z" itemprop="datePublished">2019-09-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/26/Sprong-boot-Mongodb使用GridFs做小型文件服务器/">Sprong-boot Mongodb使用GridFs做小型文件服务器</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>话不多说，直接正题：</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">compile</span>(<span class="string">"org.springframework.boot:spring-boot-starter-data-mongodb"</span>)</span><br><span class="line"><span class="built_in">compile</span> <span class="built_in">group</span>: <span class="string">'commons-codec'</span>, <span class="built_in">name</span>: <span class="string">'commons-codec'</span>, version: <span class="string">'1.10'</span></span><br></pre></td></tr></table></figure>

<p>配置文件：</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">spring:</span></span><br><span class="line"><span class="symbol">  data:</span></span><br><span class="line"><span class="symbol">    mongodb:</span></span><br><span class="line"><span class="symbol">      database:</span> ***</span><br><span class="line"><span class="symbol">      host:</span> ***</span><br><span class="line"><span class="symbol">      username:</span> ***</span><br><span class="line"><span class="symbol">      password:</span> ***</span><br><span class="line"><span class="symbol">      port:</span> ***</span><br></pre></td></tr></table></figure>

<p>上传文件代码：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@PostMapping</span>(value = <span class="string">"/upload/file"</span>)</span><br><span class="line">public <span class="built_in">String</span> uploadSample(<span class="meta">@RequestBody</span> MultipartFile file) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">String</span> md5 = DigestUtils.md5Hex(file.getInputStream());</span><br><span class="line">        QueryBuilder builder = <span class="keyword">new</span> QueryBuilder();</span><br><span class="line">        builder.and(<span class="string">"md5"</span>).<span class="keyword">is</span>(md5);</span><br><span class="line">        GridFSDBFile gridFSDBFile = gridFsTemplate.findOne(<span class="keyword">new</span> BasicQuery(builder.<span class="keyword">get</span>()));</span><br><span class="line">        <span class="keyword">if</span> (gridFSDBFile != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> gridFSDBFile.getId().toString();</span><br><span class="line">        &#125;</span><br><span class="line">        GridFSFile gridFSFile = gridFsTemplate.store(file.getInputStream(), file.getOriginalFilename(), file.getContentType());</span><br><span class="line">        returngridFSFile.getId().toString();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>访问图片代码:</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(value = <span class="string">"/get/file/&#123;id&#125;"</span>)</span><br><span class="line"><span class="keyword">public</span> void <span class="keyword">get</span>(@PathVariable Object id, HttpServletResponse <span class="built_in">response</span>) throws IOException &#123;</span><br><span class="line">    QueryBuilder builder = <span class="keyword">new</span> QueryBuilder();</span><br><span class="line">    builder.<span class="keyword">and</span>(<span class="string">"_id"</span>).<span class="keyword">is</span>(id);</span><br><span class="line">    GridFSDBFile file = gridFsTemplate.findOne(<span class="keyword">new</span> BasicQuery(builder.<span class="keyword">get</span>()));</span><br><span class="line">    <span class="built_in">response</span>.setContentType(file.getContentType());</span><br><span class="line">    file.writeTo(<span class="built_in">response</span>.getOutputStream());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>spring boot中默认配置可以满足基本需求，文件存储可以使用文件md5去重，非常方便，需要注意的是mongodb存储对文件大小的限制，这个具体数值请自行测试。</p>
<p>另一篇参考文档：<br><a href="https://blog.csdn.net/szs860806/article/details/72528618" target="_blank" rel="noopener">https://blog.csdn.net/szs860806/article/details/72528618</a></p>
<p><a href="https://www.songliguo.com/gridfs-mongodb-distributed-file-storage-system.html" target="_blank" rel="noopener">https://www.songliguo.com/gridfs-mongodb-distributed-file-storage-system.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/09/26/Sprong-boot-Mongodb使用GridFs做小型文件服务器/" data-id="ckbdc9usu005t24u2h4dz2ry7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SPRINGBOOT/">SPRINGBOOT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/文件服务器/">文件服务器</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-中间件rabbitMQ" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/26/中间件rabbitMQ/" class="article-date">
  <time datetime="2019-09-26T14:30:00.000Z" itemprop="datePublished">2019-09-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/26/中间件rabbitMQ/">中间件rabbitMQ与activeMQ</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>AMQP<br>jms</p>
<p>springboot 默认集成rabbitMQ<br>高并发性能强 因为用了erlang语言编写</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/09/26/中间件rabbitMQ/" data-id="ckbdc9uws00fn24u2j4wmfuvx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MQ/">MQ</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-事务传播行为种类" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/25/事务传播行为种类/" class="article-date">
  <time datetime="2019-09-25T13:20:00.000Z" itemprop="datePublished">2019-09-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/25/事务传播行为种类/">Transaction事务传播行为种类PROPAGATION_REQUIRED</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>事务传播行为种类</p>
<p>Spring在TransactionDefinition接口中规定了7种类型的事务传播行为，它们规定了事务方法和事务方法发生嵌套调用时事务如何进行传播：</p>
<table>
<thead>
<tr>
<th align="left">事务传播行为类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">PROPAGATION_REQUIRED</td>
<td align="left">如果当前没有事务，就新建一个事务，如果已经存在一个事务中，加入到这个事务中。这是最常见的选择。</td>
</tr>
<tr>
<td align="left">PROPAGATION_SUPPORTS</td>
<td align="left">支持当前事务，如果当前没有事务，就以非事务方式执行。</td>
</tr>
<tr>
<td align="left">PROPAGATION_MANDATORY</td>
<td align="left">使用当前的事务，如果当前没有事务，就抛出异常。</td>
</tr>
<tr>
<td align="left">PROPAGATION_REQUIRES_NEW</td>
<td align="left">新建事务，如果当前存在事务，把当前事务挂起。</td>
</tr>
<tr>
<td align="left">PROPAGATION_NOT_SUPPORTED</td>
<td align="left">以非事务方式执行操作，如果当前存在事务，就把当前事务挂起。</td>
</tr>
<tr>
<td align="left">PROPAGATION_NEVER</td>
<td align="left">以非事务方式执行，如果当前存在事务，则抛出异常。</td>
</tr>
<tr>
<td align="left">PROPAGATION_NESTED</td>
<td align="left">如果当前存在事务，则在嵌套事务内执行。如果当前没有事务，则执行与PROPAGATION_REQUIRED类似的操作。</td>
</tr>
</tbody></table>
<p>例子：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">(Object id)</span> <span class="keyword">throws</span> ServiceException </span>&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">          getDao().delete(id);</span><br><span class="line">      &#125;<span class="keyword">catch</span> (DaoException e)&#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> ServiceException(<span class="string">"ERROR:"</span>,e);</span><br><span class="line">      &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> ServiceException(<span class="string">"ERROR:"</span>,e);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>当使用PROPAGATION_NESTED时，底层的数据源必须基于JDBC 3.0，并且实现者需要支持保存点事务机制。</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="keyword">lt</span>;!--Hibernate事务管理器--&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">&amp;<span class="keyword">lt</span>;bean <span class="attr">id=</span><span class="string">"transactionManager"</span>    </span><br><span class="line"></span><br><span class="line">   <span class="attr">class=</span><span class="string">"org.springframework.orm.hibernate3.HibernateTransactionManager"</span>&amp;<span class="keyword">gt</span>;    </span><br><span class="line"></span><br><span class="line">   &amp;<span class="keyword">lt</span>;<span class="keyword">property</span><span class="title"> </span><span class="attr">name=</span><span class="string">"sessionFactory"</span>&amp;<span class="keyword">gt</span>;     </span><br><span class="line"></span><br><span class="line">     &amp;<span class="keyword">lt</span>;<span class="keyword">ref</span> <span class="attr">bean=</span><span class="string">"sessionFactory"</span> /&amp;<span class="keyword">gt</span>;    </span><br><span class="line"></span><br><span class="line">     &amp;<span class="keyword">lt</span>;/<span class="keyword">property</span><span class="title"></span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">&amp;<span class="keyword">lt</span>;/bean&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">&amp;<span class="keyword">lt</span>;!-- 定义事务拦截器bean--&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">&amp;<span class="keyword">lt</span>;bean <span class="attr">id=</span><span class="string">"transactionInterceptor"</span>    </span><br><span class="line"></span><br><span class="line">     <span class="attr">class=</span><span class="string">"org.springframework.transaction.interceptor.TransactionInterceptor"</span>&amp;<span class="keyword">gt</span>;    </span><br><span class="line"></span><br><span class="line">     &amp;<span class="keyword">lt</span>;!-- 事务拦截器bean需要依赖注入一个事务管理器--&amp;<span class="keyword">gt</span>;    </span><br><span class="line"></span><br><span class="line">     &amp;<span class="keyword">lt</span>;<span class="keyword">property</span><span class="title"> </span><span class="attr">name=</span><span class="string">"transactionManager"</span> <span class="attr">ref=</span><span class="string">"transactionManager"</span> /&amp;<span class="keyword">gt</span>;    </span><br><span class="line"></span><br><span class="line">     &amp;<span class="keyword">lt</span>;<span class="keyword">property</span><span class="title"> </span><span class="attr">name=</span><span class="string">"transactionAttributes"</span>&amp;<span class="keyword">gt</span>;     </span><br><span class="line"></span><br><span class="line">     &amp;<span class="keyword">lt</span>;!-- 下面定义事务传播属性--&amp;<span class="keyword">gt</span>;     </span><br><span class="line"></span><br><span class="line">     &amp;<span class="keyword">lt</span>;props&amp;<span class="keyword">gt</span>;      </span><br><span class="line"></span><br><span class="line">     &amp;<span class="keyword">lt</span>;prop <span class="attr">key=</span><span class="string">"save*"</span>&amp;<span class="keyword">gt</span>;PROPAGATION_REQUIRED&amp;<span class="keyword">lt</span>;/prop&amp;<span class="keyword">gt</span>;      </span><br><span class="line"></span><br><span class="line">     &amp;<span class="keyword">lt</span>;prop <span class="attr">key=</span><span class="string">"find*"</span>&amp;<span class="keyword">gt</span>;PROPAGATION_REQUIRED,readOnly&amp;<span class="keyword">lt</span>;/prop&amp;<span class="keyword">gt</span>;      </span><br><span class="line"></span><br><span class="line">     &amp;<span class="keyword">lt</span>;prop <span class="attr">key=</span><span class="string">"delete*"</span>&amp;<span class="keyword">gt</span>;PROPAGATION_REQUIRED&amp;<span class="keyword">lt</span>;/prop&amp;<span class="keyword">gt</span>;      </span><br><span class="line"></span><br><span class="line">     &amp;<span class="keyword">lt</span>;prop <span class="attr">key=</span><span class="string">"update*"</span>&amp;<span class="keyword">gt</span>;PROPAGATION_REQUIRED&amp;<span class="keyword">lt</span>;/prop&amp;<span class="keyword">gt</span>;      </span><br><span class="line"></span><br><span class="line">     &amp;<span class="keyword">lt</span>;prop <span class="attr">key=</span><span class="string">"*"</span>&amp;<span class="keyword">gt</span>;PROPAGATION_REQUIRED&amp;<span class="keyword">lt</span>;/prop&amp;<span class="keyword">gt</span>;     </span><br><span class="line"></span><br><span class="line">     &amp;<span class="keyword">lt</span>;/props&amp;<span class="keyword">gt</span>;    </span><br><span class="line"></span><br><span class="line">      &amp;<span class="keyword">lt</span>;/<span class="keyword">property</span><span class="title"></span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="keyword">lt</span>;/bean&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   &amp;<span class="keyword">lt</span>;bean <span class="attr">id=</span><span class="string">"managerTemplate"</span> <span class="attr">abstract=</span><span class="string">"true"</span> <span class="attr">lazy-init=</span><span class="string">"true"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">   &amp;<span class="keyword">lt</span>;<span class="keyword">property</span><span class="title"> </span><span class="attr">name=</span><span class="string">"teamDao"</span>&amp;<span class="keyword">gt</span>;    </span><br><span class="line"></span><br><span class="line">       &amp;<span class="keyword">lt</span>;<span class="keyword">ref</span> <span class="attr">bean=</span><span class="string">"teamDao"</span> /&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">   &amp;<span class="keyword">lt</span>;/<span class="keyword">property</span><span class="title"></span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">   &amp;<span class="keyword">lt</span>;<span class="keyword">property</span><span class="title"> </span><span class="attr">name=</span><span class="string">"studentDao"</span>&amp;<span class="keyword">gt</span>;    </span><br><span class="line"></span><br><span class="line">       &amp;<span class="keyword">lt</span>;<span class="keyword">ref</span> <span class="attr">bean=</span><span class="string">"studentDao"</span> /&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">   &amp;<span class="keyword">lt</span>;/<span class="keyword">property</span><span class="title"></span>&amp;<span class="keyword">gt</span>;    </span><br><span class="line"></span><br><span class="line">  &amp;<span class="keyword">lt</span>;/bean&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&amp;<span class="keyword">lt</span>;bean id =<span class="string">"manager"</span> <span class="attr">class=</span><span class="string">"com.zd.service.impl.Manager"</span> <span class="attr">parent=</span><span class="string">"managerTemplate"</span> /&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&amp;<span class="keyword">lt</span>;!-- 定义BeanNameAutoProxyCreator--&amp;<span class="keyword">gt</span>;     </span><br><span class="line"></span><br><span class="line">       &amp;<span class="keyword">lt</span>;bean <span class="attr">class=</span><span class="string">"org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">       &amp;<span class="keyword">lt</span>;!-- 指定对满足哪些bean name的bean自动生成业务代理 --&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">       &amp;<span class="keyword">lt</span>;<span class="keyword">property</span><span class="title"> </span><span class="attr">name=</span><span class="string">"beanNames"</span>&amp;<span class="keyword">gt</span>;            </span><br><span class="line"></span><br><span class="line">              &amp;<span class="keyword">lt</span>;!-- 下面是所有需要自动创建事务代理的bean--&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">              &amp;<span class="keyword">lt</span>;list&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">                &amp;<span class="keyword">lt</span>;value&amp;<span class="keyword">gt</span>;manager&amp;<span class="keyword">lt</span>;/value&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">              &amp;<span class="keyword">lt</span>;/list&amp;<span class="keyword">gt</span>;             </span><br><span class="line"></span><br><span class="line">              &amp;<span class="keyword">lt</span>;!-- 此处可增加其他需要自动创建事务代理的bean--&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">         &amp;<span class="keyword">lt</span>;/<span class="keyword">property</span><span class="title"></span>&amp;<span class="keyword">gt</span>;         </span><br><span class="line"></span><br><span class="line">           &amp;<span class="keyword">lt</span>;!-- 下面定义BeanNameAutoProxyCreator所需的事务拦截器--&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">           &amp;<span class="keyword">lt</span>;<span class="keyword">property</span><span class="title"> </span><span class="attr">name=</span><span class="string">"interceptorNames"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">               &amp;<span class="keyword">lt</span>;list&amp;<span class="keyword">gt</span>;                 </span><br><span class="line"></span><br><span class="line">                   &amp;<span class="keyword">lt</span>;!-- 此处可增加其他新的Interceptor --&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">                   &amp;<span class="keyword">lt</span>;value&amp;<span class="keyword">gt</span>;transactionInterceptor&amp;<span class="keyword">lt</span>;/value&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">               &amp;<span class="keyword">lt</span>;/list&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">           &amp;<span class="keyword">lt</span>;/<span class="keyword">property</span><span class="title"></span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">        &amp;<span class="keyword">lt</span>;/bean&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="keyword">lt</span>;!-- 基本数据库操作 --&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="keyword">lt</span>;bean <span class="attr">id=</span><span class="string">"baseDao"</span> <span class="attr">class=</span><span class="string">"com.zd.service.impl.BaseDao"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">       &amp;<span class="keyword">lt</span>;<span class="keyword">property</span><span class="title"> </span><span class="attr">name=</span><span class="string">"hibernateTemplate"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">      &amp;<span class="keyword">lt</span>;<span class="keyword">ref</span> <span class="attr">bean=</span><span class="string">"hibernateTemplate"</span>/&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="keyword">lt</span>;/<span class="keyword">property</span><span class="title"></span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="keyword">lt</span>;/bean&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="keyword">lt</span>;!-- 班级 --&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="keyword">lt</span>;bean <span class="attr">id=</span><span class="string">"teamDao"</span> <span class="attr">class=</span><span class="string">"com.zd.service.impl.TeamDao"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">      &amp;<span class="keyword">lt</span>;<span class="keyword">property</span><span class="title"> </span><span class="attr">name=</span><span class="string">"baseDao"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">          &amp;<span class="keyword">lt</span>;<span class="keyword">ref</span> <span class="attr">bean=</span><span class="string">"baseDao"</span> /&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">      &amp;<span class="keyword">lt</span>;/<span class="keyword">property</span><span class="title"></span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">   &amp;<span class="keyword">lt</span>;/bean&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">   &amp;<span class="keyword">lt</span>;!-- 学生 --&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">   &amp;<span class="keyword">lt</span>;bean <span class="attr">id=</span><span class="string">"studentDao"</span> <span class="attr">class=</span><span class="string">"com.zd.service.impl.StudentDao"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">        &amp;<span class="keyword">lt</span>;<span class="keyword">property</span><span class="title"> </span><span class="attr">name=</span><span class="string">"baseDao"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">            &amp;<span class="keyword">lt</span>;<span class="keyword">ref</span> <span class="attr">bean=</span><span class="string">"baseDao"</span> /&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">        &amp;<span class="keyword">lt</span>;/<span class="keyword">property</span><span class="title"></span>&amp;<span class="keyword">gt</span>; &amp;<span class="keyword">lt</span>;/bean&amp;<span class="keyword">gt</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public void testSaveTeam() &#123;</span><br><span class="line"></span><br><span class="line">   Team team = new Team()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">   team.setTeamId(DBKeyCreator.getRandomKey(<span class="number">12</span>))<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">   team.setTeamName(<span class="string">"Class CCC"</span>)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">   IManager manager = (IManager) SpringContextUtil.getContext().getBean(<span class="string">"manager"</span>)<span class="comment">;  </span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">   Student student = new Student()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">   student.setStudentId(DBKeyCreator.getRandomKey(<span class="number">13</span>))<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">   student.setSex(Student.SEX_FEMALE)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">   student.setStudentName(<span class="string">"Tom"</span>)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">   student.setTeamId(<span class="string">"60FHDXDIG5JQ"</span>)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">   manager.saveTeamAndStu(team, student)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">   System.out.println(<span class="string">"Save Team and Student Success"</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/09/25/事务传播行为种类/" data-id="ckbdc9uwv00fr24u2ak99m81t" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TRANSECTION/">TRANSECTION</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-HandlerInterceptor的preHandle、postHandle、afterCompletion方法的作用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/24/HandlerInterceptor的preHandle、postHandle、afterCompletion方法的作用/" class="article-date">
  <time datetime="2019-09-24T11:12:00.000Z" itemprop="datePublished">2019-09-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/24/HandlerInterceptor的preHandle、postHandle、afterCompletion方法的作用/">HandlerInterceptor的preHandle、postHandle、afterCompletion方法的作用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="处理器拦截器（HandlerInterceptor）详解"><a href="#处理器拦截器（HandlerInterceptor）详解" class="headerlink" title="处理器拦截器（HandlerInterceptor）详解"></a>处理器拦截器（HandlerInterceptor）详解</h4><p>(1)preHandle方法是进行处理器拦截用的，顾名思义，该方法将在Controller处理之前进行调用。<br>SpringMVC中的Interceptor拦截器是链式的，可以同时存在多个Interceptor，然后SpringMVC会根据声明的前后顺序一个接一个的执行，而且所有的Interceptor中的preHandle方法都会在Controller方法调用之前调用。<br><strong>（SpringMVC的这种Interceptor链式结构也是可以进行中断的，这种中断方式是令preHandle的返回值为false，当preHandle的返回值为false的时候整个请求就结束了。）</strong><br>重写preHandle方法，在请求发生前执行。<br>(2)postHandle是进行处理器拦截用的，这个方法只会在当前这个Interceptor的preHandle方法返回值为true的时候才会执行。它的执行时间是在处理器进行处理之后，也就是在Controller的方法调用之后执行，但是它会在DispatcherServlet进行视图的渲染之前执行，也就是说在这个方法中你可以对ModelAndView进行操作。这个方法的链式结构跟正常访问的方向是相反的，也就是说先声明的Interceptor拦截器该方法反而会后调用。<br>重写postHandle方法，在请求完成后执行。<br>(3)afterCompletion这个方法只会在当前这个Interceptor的preHandle方法返回值为true的时候才会执行。该方法将在整个请求完成之后，也就是DispatcherServlet渲染了视图执行。（如性能监控中我们可以在此记录结束时间并输出消耗时间，还可以进行一些资源清理）</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/09/24/HandlerInterceptor的preHandle、postHandle、afterCompletion方法的作用/" data-id="ckbdc9uq8002a24u2pegrrmj7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/INTERCEPTOR/">INTERCEPTOR</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SPRINGBOOT/">SPRINGBOOT</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-sql" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/24/sql/" class="article-date">
  <time datetime="2019-09-24T00:15:00.000Z" itemprop="datePublished">2019-09-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/24/sql/">Java代码里拼接SQL语句到mybatis的xml</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h5 id="Java代码里拼接SQL语句到mybatis的xml"><a href="#Java代码里拼接SQL语句到mybatis的xml" class="headerlink" title="Java代码里拼接SQL语句到mybatis的xml"></a>Java代码里拼接SQL语句到mybatis的xml</h5><p>关键语句：</p>
<p>StringBuilder whereSql = new StringBuilder();</p>
<p>whereSql.append(“SQL语句”);  //需要注意sql注入的问题</p>
<p>实现类：</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List getList(Map&amp;lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&amp;gt; <span class="built_in">map</span>) &#123;</span><br><span class="line">	List&amp;lt;Map&amp;lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&amp;gt;&amp;gt; rs = <span class="keyword">new</span> ArrayList&amp;lt;Map&amp;lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&amp;gt;&amp;gt;();</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		StringBuilder whereSql = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">map</span>.<span class="built_in">get</span>(<span class="string">"userName"</span>).toString().length()&amp;gt;<span class="number">0</span>) &#123;</span><br><span class="line">			whereSql.<span class="built_in">append</span>(<span class="string">" AND a.userName in ('"</span> + <span class="built_in">map</span>.<span class="built_in">get</span>(<span class="string">"userName"</span>).toString().replaceAll(<span class="string">","</span>, <span class="string">"\',\'"</span>) + <span class="string">"')"</span>);<span class="comment">//不为空时加入查询条件</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">map</span>.<span class="built_in">get</span>(<span class="string">"CURRENTPAGE"</span>).toString().length()&amp;gt;<span class="number">0</span> &amp;amp;&amp;amp; <span class="built_in">map</span>.<span class="built_in">get</span>(<span class="string">"PAGESIZE"</span>).toString().length()&amp;gt;<span class="number">0</span>) &#123;<span class="comment">//前端有传分页参数时就添加分页查询条件</span></span><br><span class="line">			<span class="built_in">int</span> currenpage = Integer.parseInt(<span class="built_in">map</span>.<span class="built_in">get</span>(<span class="string">"CURRENTPAGE"</span>).toString());</span><br><span class="line">			<span class="built_in">int</span> pagesize = Integer.parseInt(<span class="built_in">map</span>.<span class="built_in">get</span>(<span class="string">"PAGESIZE"</span>).toString());</span><br><span class="line">			currenpage = ((currenpage - <span class="number">1</span>) * pagesize);</span><br><span class="line">			whereSql.<span class="built_in">append</span>(<span class="string">" limit "</span> + currenpage + <span class="string">","</span> + pagesize);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		rs = wmTblWorkorderMapper.getList(whereSql.toString());</span><br><span class="line">		<span class="keyword">return</span> rs;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>mapper：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">List</span><span class="selector-tag">&amp;</span><span class="selector-tag">lt</span>;<span class="selector-tag">Map</span><span class="selector-tag">&amp;</span><span class="selector-tag">lt</span>;<span class="selector-tag">String</span>,<span class="selector-tag">Object</span><span class="selector-tag">&amp;</span><span class="selector-tag">gt</span>;<span class="selector-tag">&amp;</span><span class="selector-tag">gt</span>; <span class="selector-tag">getList</span>(<span class="variable">@Param</span>(<span class="string">"whereSql"</span>) String whereSql);</span><br></pre></td></tr></table></figure>

<p>mapper对应的xml：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;lt;select <span class="attribute">id</span>=<span class="string">"getList"</span> <span class="attribute">resultType</span>=<span class="string">"HashMap"</span>&amp;gt;</span><br><span class="line">		SELECT * <span class="keyword">FROM</span><span class="built_in"> user </span>a WHERE <span class="attribute">1</span>=1 <span class="variable">$&#123;whereSql&#125;</span></span><br><span class="line">&amp;lt;/select&amp;gt;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/09/24/sql/" data-id="ckbdc9uwc00e624u24lnhn08h" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MYBATIS/">MYBATIS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MYSQL/">MYSQL</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-SessionAttributes" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/23/SessionAttributes/" class="article-date">
  <time datetime="2019-09-23T18:44:00.000Z" itemprop="datePublished">2019-09-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/23/SessionAttributes/">@SessionAttributes</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="SessionAttributes原理"><a href="#SessionAttributes原理" class="headerlink" title="@SessionAttributes原理"></a>@SessionAttributes原理</h4><p>默认情况下Spring MVC将模型中的数据存储到request域中。&lt;font color=”red”&gt;当一个请求结束后，数据就失效了。如果要跨页面使用。那么需要使用到session。而@SessionAttributes注解就可以使得模型中的数据存储一份到session域中。&lt;/font&gt;</p>
<p>@SessionAttributes参数 </p>
<p>1、names：这是一个字符串数组。里面应写需要存储到session中数据的名称。</p>
<p>2、types：根据指定参数的类型，将模型中对应类型的参数存储到session中</p>
<p>3、value：其实和names是一样的。</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(<span class="string">"/test"</span>)</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">String</span> test(Map&amp;lt;<span class="keyword">String</span>,Object&amp;gt; <span class="built_in">map</span>)&#123;</span><br><span class="line">    <span class="built_in">map</span>.<span class="built_in">put</span>(<span class="string">"names"</span>, Arrays.asList(<span class="string">"caoyc"</span>,<span class="string">"zhh"</span>,<span class="string">"cjx"</span>));</span><br><span class="line">    <span class="built_in">map</span>.<span class="built_in">put</span>(<span class="string">"age"</span>, <span class="number">18</span>);</span><br><span class="line">    <span class="built_in">return</span> <span class="string">"hello"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、request中names:<span class="symbol">$</span>&#123;requestScope.names&#125;&amp;<span class="keyword">lt</span>;br/&amp;<span class="keyword">gt</span>;</span><br><span class="line"><span class="number">2</span>、request中age:<span class="symbol">$</span>&#123;requestScope.age&#125;&amp;<span class="keyword">lt</span>;br/&amp;<span class="keyword">gt</span>;</span><br><span class="line">&amp;<span class="keyword">lt</span>;hr/&amp;<span class="keyword">gt</span>;</span><br><span class="line"><span class="number">3</span>、session中names:<span class="symbol">$</span>&#123;sessionScope.names &#125;&amp;<span class="keyword">lt</span>;br/&amp;<span class="keyword">gt</span>;</span><br><span class="line"><span class="number">4</span>、session中age:<span class="symbol">$</span>&#123;sessionScope.age &#125;&amp;<span class="keyword">lt</span>;br/&amp;<span class="keyword">gt</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/images/pasted-158.png" alt="upload successful"></p>
<p>【总结】:上面代码没有指定@SessionAttributes，所有在session域总无法获取到对应的数据。</p>
<p>下面我们加上@SessionAttributes注解</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SessionAttributes</span>(value=&#123;<span class="string">"names"</span>&#125;,types=&#123;Integer.<span class="keyword">class</span>&#125;)</span><br><span class="line"> <span class="meta">@Controller</span></span><br><span class="line"> public <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">     <span class="meta">@RequestMapping</span>(<span class="string">"/test"</span>)</span><br><span class="line">     public <span class="built_in">String</span> test(<span class="built_in">Map</span>&amp;lt;<span class="built_in">String</span>,<span class="built_in">Object</span>&amp;gt; map)&#123;</span><br><span class="line">         map.put(<span class="string">"names"</span>, Arrays.asList(<span class="string">"caoyc"</span>,<span class="string">"zhh"</span>,<span class="string">"cjx"</span>));</span><br><span class="line">         map.put(<span class="string">"age"</span>, <span class="number">18</span>);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"hello"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p> 再次访问页面：</p>
<p><img src="/images/pasted-159.png" alt="upload successful"></p>
<p>可以看到session域中值已存在</p>
<p>【注意】：@SessionAttributes注解只能在类上使用，不能在方法上使用</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/09/23/SessionAttributes/" data-id="ckbdc9ust005q24u2oc6z6n6n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ANNOTATION/">ANNOTATION</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SESSION/">SESSION</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SPRINGBOOT/">SPRINGBOOT</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mycat" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/23/mycat/" class="article-date">
  <time datetime="2019-09-23T17:28:00.000Z" itemprop="datePublished">2019-09-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/23/mycat/">mycat</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="Mycat前世今生"><a href="#Mycat前世今生" class="headerlink" title="Mycat前世今生"></a>Mycat前世今生</h4><p>2013年阿里的Cobar在社区使用过程中发现存在一些比较严重的问题，及其使用限制，经过Mycat发起人第一次改良，第一代改良版——Mycat诞生。 Mycat开源以后，一些Cobar的用户参与了Mycat的开发，最终Mycat发展成为一个由众多软件公司的实力派架构师和资深开发人员维护的社区型开源软件。</p>
<p>2014年Mycat首次在上海的《中华架构师》大会上对外宣讲，更多的人参与进来，随后越来越多的项目采用了Mycat。</p>
<p>2015年5月，由核心参与者们一起编写的第一本官方权威指南《Mycat权威指南》电子版发布，累计超过500本，成为开源项目中的首创。</p>
<p>2015年10月为止，Mycat项目总共有16个Committer。</p>
<p>截至2015年11月，超过300个项目采用Mycat，涵盖银行、电信、电子商务、物流、移动应用、O2O的众多领域和公司。</p>
<p>截至2015年12月，超过4000名用户加群或研究讨论或测试或使用Mycat。</p>
<p>Mycat是基于开源cobar演变而来，我们对cobar的代码进行了彻底的重构，使用NIO重构了网络模块，并且优化了Buffer内核，增强了聚合，Join等基本特性，同时兼容绝大多数数据库成为通用的数据库中间件。1.4 版本以后 完全的脱离基本cobar内核，结合Mycat集群管理、自动扩容、智能优化，成为高性能的中间件。我们致力于开发高性能数据库中间而努力。永不收费，永不闭源，持续推动开源社区的发展。</p>
<p>Mycat吸引和聚集了一大批业内大数据和云计算方面的资深工程师，Mycat的发展壮大基于开源社区志愿者的持续努力，感谢社区志愿者的努力让Mycat更加强大，同时我们也欢迎社区更多的志愿者，特别是公司能够参与进来，参与Mycat的开发，一起推动社区的发展，为社区提供更好的开源中间件。</p>
<p>Mycat还不够强大，Mycat还有很多不足，欢迎社区志愿者的持续优化改进。</p>
<h4 id="关键特性"><a href="#关键特性" class="headerlink" title="关键特性"></a>关键特性</h4><p>支持SQL92标准</p>
<p>遵守Mysql原生协议，跨语言，跨平台，跨数据库的通用中间件代理。</p>
<p>基于心跳的自动故障切换，支持读写分离，支持MySQL主从，以及galera cluster集群。</p>
<p>支持Galera for MySQL集群，Percona Cluster或者MariaDB cluster</p>
<p>基于Nio实现，有效管理线程，高并发问题。</p>
<p>支持数据的多片自动路由与聚合，支持sum,count,max等常用的聚合函数。</p>
<p>支持单库内部任意join，支持跨库2表join，甚至基于caltlet的多表join。</p>
<p>支持通过全局表，ER关系的分片策略，实现了高效的多表join查询。</p>
<p>支持多租户方案。</p>
<p>支持分布式事务（弱xa）。</p>
<p>支持全局序列号，解决分布式下的主键生成问题。</p>
<p>分片规则丰富，插件化开发，易于扩展。</p>
<p>强大的web，命令行监控。</p>
<p>支持前端作为mysq通用代理，后端JDBC方式支持Oracle、DB2、SQL Server 、 mongodb 、巨杉。</p>
<p>支持密码加密</p>
<p>支持服务降级</p>
<p>支持IP白名单</p>
<p>支持SQL黑名单、sql注入攻击拦截</p>
<p>支持分表（1.6）</p>
<p>集群基于ZooKeeper管理，在线升级，扩容，智能优化，大数据处理（2.0开发版）。</p>
<h3 id="Mycat安装与使用"><a href="#Mycat安装与使用" class="headerlink" title="Mycat安装与使用"></a>Mycat安装与使用</h3><h5 id="下载："><a href="#下载：" class="headerlink" title="下载："></a>下载：</h5><p><a href="https://github.com/MyCATApache/Mycat-download" target="_blank" rel="noopener">https://github.com/MyCATApache/Mycat-download</a> 具体下载哪个版本以发布为准，推荐1.4,1.5.  </p>
<h5 id="安装："><a href="#安装：" class="headerlink" title="安装："></a>安装：</h5><p>下载的文件直接解压即可。</p>
<h4 id="运行："><a href="#运行：" class="headerlink" title="运行："></a>运行：</h4><p>linux：  </p>
<p><code>./mycat start</code> 启动</p>
<p><code>./mycat stop</code> 停止</p>
<p><code>./mycat console</code> 前台运行</p>
<p><code>./mycat install</code> 添加到系统自动启动（暂未实现）</p>
<p><code>./mycat remove</code> 取消随系统自动启动（暂未实现）</p>
<p><code>./mycat restart</code> 重启服务</p>
<p><code>./mycat pause</code> 暂停</p>
<p><code>./mycat status</code> 查看启动状态</p>
<p>win：<br>直接运行startup_nowrap.bat，如果出现闪退，在cmd 命令行运行，查看出错原因。</p>
<h4 id="内存配置："><a href="#内存配置：" class="headerlink" title="内存配置："></a>内存配置：</h4><p>启动前，一般需要修改JVM配置参数，打开conf/wrapper.conf文件，如下行的内容为2G和2048，可根据本机配置情况修改为512M或其它值。 以下配置跟jvm参数完全一致，可以根据自己的jvm参数调整。  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Java Additional Parameters</span><br><span class="line"></span><br><span class="line">wrapper<span class="selector-class">.java</span><span class="selector-class">.additional</span>.<span class="number">1</span>=</span><br><span class="line"></span><br><span class="line">wrapper<span class="selector-class">.java</span><span class="selector-class">.additional</span>.<span class="number">1</span>=-DMYCAT_HOME=.</span><br><span class="line"></span><br><span class="line">wrapper<span class="selector-class">.java</span><span class="selector-class">.additional</span>.<span class="number">2</span>=-server</span><br><span class="line"></span><br><span class="line">wrapper<span class="selector-class">.java</span><span class="selector-class">.additional</span>.<span class="number">3</span>=-XX:MaxPermSize=<span class="number">64</span>M</span><br><span class="line"></span><br><span class="line">wrapper<span class="selector-class">.java</span><span class="selector-class">.additional</span>.<span class="number">4</span>=-XX:+AggressiveOpts</span><br><span class="line"></span><br><span class="line">wrapper<span class="selector-class">.java</span><span class="selector-class">.additional</span>.<span class="number">5</span>=-XX:MaxDirectMemorySize=<span class="number">100</span>m</span><br><span class="line"></span><br><span class="line">wrapper<span class="selector-class">.java</span><span class="selector-class">.additional</span>.<span class="number">6</span>=-Dcom<span class="selector-class">.sun</span><span class="selector-class">.management</span><span class="selector-class">.jmxremote</span></span><br><span class="line"></span><br><span class="line">wrapper<span class="selector-class">.java</span><span class="selector-class">.additional</span>.<span class="number">7</span>=-Dcom<span class="selector-class">.sun</span><span class="selector-class">.management</span><span class="selector-class">.jmxremote</span><span class="selector-class">.port</span>=<span class="number">1984</span></span><br><span class="line"></span><br><span class="line">wrapper<span class="selector-class">.java</span><span class="selector-class">.additional</span>.<span class="number">8</span>=-Dcom<span class="selector-class">.sun</span><span class="selector-class">.management</span><span class="selector-class">.jmxremote</span><span class="selector-class">.authenticate</span>=false</span><br><span class="line"></span><br><span class="line">wrapper<span class="selector-class">.java</span><span class="selector-class">.additional</span>.<span class="number">9</span>=-Dcom<span class="selector-class">.sun</span><span class="selector-class">.management</span><span class="selector-class">.jmxremote</span><span class="selector-class">.ssl</span>=false</span><br><span class="line"></span><br><span class="line">wrapper<span class="selector-class">.java</span><span class="selector-class">.additional</span>.<span class="number">10</span>=-Xmx100m</span><br><span class="line"></span><br><span class="line">wrapper<span class="selector-class">.java</span><span class="selector-class">.additional</span>.<span class="number">11</span>=-Xms100m</span><br><span class="line"></span><br><span class="line">wrapper<span class="selector-class">.java</span><span class="selector-class">.additional</span>.<span class="number">12</span>=-XX:+UseParNewGC</span><br><span class="line"></span><br><span class="line">wrapper<span class="selector-class">.java</span><span class="selector-class">.additional</span>.<span class="number">13</span>=-XX:+UseConcMarkSweepGC</span><br><span class="line"></span><br><span class="line">wrapper<span class="selector-class">.java</span><span class="selector-class">.additional</span>.<span class="number">14</span>=-XX:+UseCMSCompactAtFullCollection</span><br><span class="line"></span><br><span class="line">wrapper<span class="selector-class">.java</span><span class="selector-class">.additional</span>.<span class="number">15</span>=-XX:CMSFullGCsBeforeCompaction=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">wrapper<span class="selector-class">.java</span><span class="selector-class">.additional</span>.<span class="number">16</span>=-XX:CMSInitiatingOccupancyFraction=<span class="number">70</span></span><br><span class="line"></span><br><span class="line">以下配置作废：</span><br><span class="line"></span><br><span class="line">wrapper<span class="selector-class">.java</span><span class="selector-class">.initmemory</span>=<span class="number">3</span></span><br><span class="line"></span><br><span class="line">wrapper<span class="selector-class">.java</span><span class="selector-class">.maxmemory</span>=<span class="number">64</span></span><br></pre></td></tr></table></figure>

<h4 id="Mycat连接测试："><a href="#Mycat连接测试：" class="headerlink" title="Mycat连接测试："></a>Mycat连接测试：</h4><p>测试mycat与测试mysql完全一致，mysql怎么连接，mycat就怎么连接。</p>
<p>推荐先采用命令行测试：  </p>
<p><code>mysql -uroot -proot -P8066 -h127.0.0.1</code> </p>
<p>如果采用工具连接，1.4,1.3目前部分工具无法连接，会提示database not selected，建议采用高版本，navicat测试。1.5已经修复了部分工具连接。    </p>
<h4 id="Mycat配置入门"><a href="#Mycat配置入门" class="headerlink" title="Mycat配置入门"></a>Mycat配置入门</h4><p>配置：</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">--bin 启动目录</span><br><span class="line"></span><br><span class="line">--conf 配置目录存放配置文件：</span><br><span class="line"></span><br><span class="line">--server.xml：是Mycat服务器参数调整和用户授权的配置文件。</span><br><span class="line"></span><br><span class="line">  --schema.xml：是逻辑库定义和表以及分片定义的配置文件。</span><br><span class="line"></span><br><span class="line">  --rule.xml：  是分片规则的配置文件，分片规则的具体一些参数信息单独存放为文件，也在这个目录下，配置文件修改需要重启MyCAT。</span><br><span class="line"></span><br><span class="line">  --log4j.xml： 日志存放在logs/log中，每天一个文件，日志的配置是在conf/log4j.xml中，根据自己的需要可以调整输出级别为debug                           debug级别下，会输出更多的信息，方便排查问题。</span><br><span class="line"></span><br><span class="line">  --autopartition-long.txt,partition-hash-int.txt,sequence_conf.properties， sequence_db_conf.properties 分片相关的id分片规则配置文件</span><br><span class="line"></span><br><span class="line">  --<span class="class"><span class="keyword">lib</span>	    <span class="title">MyCAT</span>自身的<span class="title">jar</span>包或依赖的<span class="title">jar</span>包的存放目录。</span></span><br><span class="line"></span><br><span class="line">  --logs        MyCAT日志的存放目录。日志存放在logs/log中，每天一个文件</span><br></pre></td></tr></table></figure>

<p><img src="/images/pasted-157.png" alt="upload successful"></p>
<h4 id="逻辑库配置："><a href="#逻辑库配置：" class="headerlink" title="逻辑库配置："></a>逻辑库配置：</h4><p>配置server.xml<br>添加两个mycat逻辑库：user,pay<br>system 参数是所有的mycat参数配置，比如添加解析器：defaultSqlParser，其他类推<br>user 是用户参数。  </p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="keyword">lt</span>;system&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">	&amp;<span class="keyword">lt</span>;<span class="keyword">property</span><span class="title"> </span><span class="attr">name=</span><span class="string">"defaultSqlParser"</span>&amp;<span class="keyword">gt</span>;druidparser&amp;<span class="keyword">lt</span>;/<span class="keyword">property</span><span class="title"></span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">&amp;<span class="keyword">lt</span>;/system&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">&amp;<span class="keyword">lt</span>;<span class="keyword">user</span> <span class="title">name</span>=<span class="string">"mycat"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">	&amp;<span class="keyword">lt</span>;<span class="keyword">property</span><span class="title"> </span><span class="attr">name=</span><span class="string">"password"</span>&amp;<span class="keyword">gt</span>;mycat&amp;<span class="keyword">lt</span>;/<span class="keyword">property</span><span class="title"></span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">	&amp;<span class="keyword">lt</span>;<span class="keyword">property</span><span class="title"> </span><span class="attr">name=</span><span class="string">"schemas"</span>&amp;<span class="keyword">gt</span>;user,pay&amp;<span class="keyword">lt</span>;/<span class="keyword">property</span><span class="title"></span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">&amp;<span class="keyword">lt</span>;/user&amp;<span class="keyword">gt</span>;</span><br></pre></td></tr></table></figure>

<p>编辑schema.xml<br>修改dataHost和schema对应的连接信息，user,pay 垂直切分后的配置如下所示：</p>
<p>schema 是实际逻辑库的配置，user，pay分别对应两个逻辑库，多个schema代表多个逻辑库。</p>
<p>dataNode是逻辑库对应的分片，如果配置多个分片只需要多个dataNode即可。</p>
<p>dataHost是实际的物理库配置地址，可以配置多主主从等其他配置，多个dataHost代表分片对应的物理库地址，下面的writeHost、readHost代表该分片是否配置多写，主从，读写分离等高级特性。</p>
<p>以下例子配置了两个writeHost为主从。</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="literal">lt</span>;<span class="keyword">schema</span><span class="built_in"> name</span>=<span class="string">"user"</span> checkSQLschema=<span class="string">"false"</span> sqlMaxLimit=<span class="string">"100"</span> dataNode=<span class="string">"user"</span> /&amp;<span class="literal">gt</span>;</span><br><span class="line">&amp;<span class="literal">lt</span>;<span class="keyword">schema</span><span class="built_in"> name</span>=<span class="string">"pay"</span>  checkSQLschema=<span class="string">"false"</span> sqlMaxLimit=<span class="string">"100"</span> dataNode=<span class="string">"pay"</span> &amp;<span class="literal">gt</span>;</span><br><span class="line">   &amp;<span class="literal">lt</span>;table<span class="built_in"> name</span>=<span class="string">"order"</span> dataNode=<span class="string">"pay1,pay2"</span> rule=<span class="string">"rule1"</span>/&amp;<span class="literal">gt</span>;</span><br><span class="line">&amp;<span class="literal">lt</span>;/<span class="keyword">schema</span>&amp;<span class="literal">gt</span>;</span><br><span class="line"></span><br><span class="line">&amp;<span class="literal">lt</span>;dataNode<span class="built_in"> name</span>=<span class="string">"user"</span> dataHost=<span class="string">"host"</span> database=<span class="string">"user"</span> /&amp;<span class="literal">gt</span>;</span><br><span class="line">&amp;<span class="literal">lt</span>;dataNode<span class="built_in"> name</span>=<span class="string">"pay1"</span> dataHost=<span class="string">"host"</span> database=<span class="string">"pay1"</span> /&amp;<span class="literal">gt</span>;</span><br><span class="line">&amp;<span class="literal">lt</span>;dataNode<span class="built_in"> name</span>=<span class="string">"pay2"</span> dataHost=<span class="string">"host"</span> database=<span class="string">"pay2"</span> /&amp;<span class="literal">gt</span>;</span><br><span class="line"></span><br><span class="line">&amp;<span class="literal">lt</span>;dataHost<span class="built_in"> name</span>=<span class="string">"host"</span> maxCon=<span class="string">"1000"</span> minCon=<span class="string">"10"</span> balance=<span class="string">"0"</span></span><br><span class="line">   writeType=<span class="string">"0"</span> dbType=<span class="string">"mysql"</span> dbDriver=<span class="string">"native"</span>&amp;<span class="literal">gt</span>;</span><br><span class="line">   &amp;<span class="literal">lt</span>;heartbeat&amp;<span class="literal">gt</span>;select <span class="number">1</span>&amp;<span class="literal">lt</span>;/heartbeat&amp;<span class="literal">gt</span>;</span><br><span class="line">   &amp;<span class="literal">lt</span>;!-- can have multi write hosts --&amp;<span class="literal">gt</span>;</span><br><span class="line">   &amp;<span class="literal">lt</span>;writeHost host=<span class="string">"hostM1"</span> url=<span class="string">"192.168.0.2:3306"</span> user=<span class="string">"root"</span> password=<span class="string">"root"</span> /&amp;<span class="literal">gt</span>;</span><br><span class="line">   &amp;<span class="literal">lt</span>;writeHost host=<span class="string">"hostM2"</span> url=<span class="string">"192.168.0.3:3306"</span> user=<span class="string">"root"</span> password=<span class="string">"root"</span> /&amp;<span class="literal">gt</span>;</span><br><span class="line">&amp;<span class="literal">lt</span>;/dataHost&amp;<span class="literal">gt</span>;</span><br></pre></td></tr></table></figure>

<p>Mycat逻辑库、系统参数配置<br>配置Mycat环境参数  </p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="keyword">lt</span>;?<span class="keyword">xml</span> <span class="title">version</span>=<span class="string">"1.0"</span> <span class="attr">encoding=</span><span class="string">"UTF-8"</span> <span class="attr">standalone=</span><span class="string">"no"</span>?&amp;<span class="keyword">gt</span>;</span><br><span class="line">&amp;<span class="keyword">lt</span>;!DOCTYPE mycat:server SYSTEM <span class="string">"server.dtd"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">&amp;<span class="keyword">lt</span>;mycat:server xmlns:<span class="attr">mycat=</span><span class="string">"http://org.opencloudb/"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">   &amp;<span class="keyword">lt</span>;system&amp;<span class="keyword">gt</span>;</span><br><span class="line">	  &amp;<span class="keyword">lt</span>;<span class="keyword">property</span><span class="title"> </span><span class="attr">name=</span><span class="string">"defaultSqlParser"</span>&amp;<span class="keyword">gt</span>;druidparser&amp;<span class="keyword">lt</span>;/<span class="keyword">property</span><span class="title"></span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;/system&amp;<span class="keyword">gt</span>; </span><br><span class="line"> &amp;<span class="keyword">lt</span>;/mycat:server&amp;<span class="keyword">gt</span>;</span><br></pre></td></tr></table></figure>


<p> 如例子中配置的所有的Mycat参数变量都是配置在server.xml 文件中，system标签下配置所有的参数，如果需要配置某个变量添加相应的配置即可，例如添加启动端口8066，默认为8066：</p>
<p>  <code>&amp;lt;property name=&quot;serverPort&quot;&amp;gt;8066&amp;lt;/property&amp;gt;</code><br>  其他所有变量类似。<br>  配置Mycat逻辑库与用户  </p>
  <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  &amp;<span class="keyword">lt</span>;?<span class="keyword">xml</span> <span class="title">version</span>=<span class="string">"1.0"</span> <span class="attr">encoding=</span><span class="string">"UTF-8"</span> <span class="attr">standalone=</span><span class="string">"no"</span>?&amp;<span class="keyword">gt</span>;</span><br><span class="line">&amp;<span class="keyword">lt</span>;!DOCTYPE mycat:server SYSTEM <span class="string">"server.dtd"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">&amp;<span class="keyword">lt</span>;mycat:server xmlns:<span class="attr">mycat=</span><span class="string">"http://org.opencloudb/"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">&amp;<span class="keyword">lt</span>;<span class="keyword">user</span> <span class="title">name</span>=<span class="string">"mycat"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">	&amp;<span class="keyword">lt</span>;<span class="keyword">property</span><span class="title"> </span><span class="attr">name=</span><span class="string">"password"</span>&amp;<span class="keyword">gt</span>;mycat&amp;<span class="keyword">lt</span>;/<span class="keyword">property</span><span class="title"></span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">	&amp;<span class="keyword">lt</span>;<span class="keyword">property</span><span class="title"> </span><span class="attr">name=</span><span class="string">"schemas"</span>&amp;<span class="keyword">gt</span>;TESTDB&amp;<span class="keyword">lt</span>;/<span class="keyword">property</span><span class="title"></span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">&amp;<span class="keyword">lt</span>;/user&amp;<span class="keyword">gt</span>;</span><br><span class="line"> &amp;<span class="keyword">lt</span>;/mycat:server&amp;<span class="keyword">gt</span>;</span><br></pre></td></tr></table></figure>


<p> 如例子中配置的所有的Mycat连接的用户与逻辑库映射都是配置在server.xml 文件中，user标签下配置所有的参数，例如例子中配置了一个mycat用户供应用连接到mycat，同时mycat 在schema.xml中配置后了一个逻辑库TESTDB，配置好逻辑库与用户的映射关系。  </p>
<h4 id="逻辑库、表分片配置"><a href="#逻辑库、表分片配置" class="headerlink" title="逻辑库、表分片配置"></a>逻辑库、表分片配置</h4><h5 id="配置逻辑库（schema）"><a href="#配置逻辑库（schema）" class="headerlink" title="配置逻辑库（schema）"></a>配置逻辑库（schema）</h5><p>Mycat作为一个中间件，实现mysql协议，那么对前端应用连接来说就是一个数据库，也就有数据库的配置，mycat的数据库配置是在schema.xml中配置，配置好后映射到server.xml里面的用户就可以了。  </p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="literal">lt</span>;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&amp;<span class="literal">gt</span>;</span><br><span class="line">&amp;<span class="literal">lt</span>;!DOCTYPE mycat:schema SYSTEM <span class="string">"schema.dtd"</span>&amp;<span class="literal">gt</span>;</span><br><span class="line"></span><br><span class="line">&amp;<span class="literal">lt</span>;mycat:schema  xmlns:mycat=<span class="string">"http://org.opencloudb/"</span>&amp;<span class="literal">gt</span>;</span><br><span class="line">  &amp;<span class="literal">lt</span>;<span class="keyword">schema</span><span class="built_in"> name</span>=<span class="string">"TESTDB"</span> checkSQLschema=<span class="string">"true"</span> sqlMaxLimit=<span class="string">"100"</span> dataNode=<span class="string">"dn1"</span>&amp;<span class="literal">gt</span>;</span><br><span class="line">      &amp;<span class="literal">lt</span>;table<span class="built_in"> name</span>=<span class="string">"t_user"</span> dataNode=<span class="string">"dn1,dn2"</span> rule=<span class="string">"sharding-by-mod2"</span>/&amp;<span class="literal">gt</span>;</span><br><span class="line">      &amp;<span class="literal">lt</span>;table<span class="built_in"> name</span>=<span class="string">"ht_jy_login_log"</span> primaryKey=<span class="string">"ID"</span> dataNode=<span class="string">"dn1,dn2"</span> rule=<span class="string">"sharding-by-date_jylog"</span>/&amp;<span class="literal">gt</span>;</span><br><span class="line">  &amp;<span class="literal">lt</span>;/<span class="keyword">schema</span>&amp;<span class="literal">gt</span>;</span><br><span class="line">  &amp;<span class="literal">lt</span>;dataNode<span class="built_in"> name</span>=<span class="string">"dn1"</span> dataHost=<span class="string">"localhost1"</span> database=<span class="string">"mycat_node1"</span>/&amp;<span class="literal">gt</span>;</span><br><span class="line">  &amp;<span class="literal">lt</span>;dataNode<span class="built_in"> name</span>=<span class="string">"dn2"</span> dataHost=<span class="string">"localhost1"</span> database=<span class="string">"mycat_node2"</span>/&amp;<span class="literal">gt</span>;</span><br><span class="line">  </span><br><span class="line">  &amp;<span class="literal">lt</span>;dataHost<span class="built_in"> name</span>=<span class="string">"localhost1"</span> writeType=<span class="string">"0"</span> switchType=<span class="string">"1"</span> slaveThreshold=<span class="string">"100"</span> balance=<span class="string">"1"</span> dbType=<span class="string">"mysql"</span> maxCon=<span class="string">"10"</span> minCon=<span class="string">"1"</span> dbDriver=<span class="string">"native"</span>&amp;<span class="literal">gt</span>;</span><br><span class="line">    &amp;<span class="literal">lt</span>;heartbeat&amp;<span class="literal">gt</span>;show status like <span class="string">'wsrep%'</span>&amp;<span class="literal">lt</span>;/heartbeat&amp;<span class="literal">gt</span>;</span><br><span class="line">    &amp;<span class="literal">lt</span>;writeHost host=<span class="string">"hostM1"</span> url=<span class="string">"127.0.0.1:3306"</span> user=<span class="string">"root"</span> password=<span class="string">"root"</span> &amp;<span class="literal">gt</span>;</span><br><span class="line">    &amp;<span class="literal">lt</span>;/writeHost&amp;<span class="literal">gt</span>;  </span><br><span class="line">  &amp;<span class="literal">lt</span>;/dataHost&amp;<span class="literal">gt</span>;</span><br><span class="line">&amp;<span class="literal">lt</span>;/mycat:schema &amp;<span class="literal">gt</span>;</span><br></pre></td></tr></table></figure>

<p>上面例子配置了一个逻辑库TESTDB，同时配置了t_user，ht_jy_login_log两个分片表。</p>
<h5 id="逻辑表配置"><a href="#逻辑表配置" class="headerlink" title="逻辑表配置"></a>逻辑表配置</h5><p><code>&amp;lt;table name=&quot;t_user&quot; dataNode=&quot;dn1,dn2&quot; rule=&quot;sharding-by-mod2&quot;/&amp;gt;</code></p>
<p>table 标签 是逻辑表的配置 其中  </p>
<p>name代表表名， </p>
<p>dataNode代表表对应的分片，  </p>
<p>Mycat默认采用分库方式，也就是一个表映射到不同的库上，  </p>
<p>rule代表表要采用的数据切分方式，名称对应到rule.xml中的对应配置，如果要分片必须配置。  </p>
<h5 id="配置分片（dataNode）"><a href="#配置分片（dataNode）" class="headerlink" title="配置分片（dataNode）"></a>配置分片（dataNode）</h5><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&amp;lt;dataNode <span class="attribute">name</span>=<span class="string">"dn1"</span> <span class="attribute">dataHost</span>=<span class="string">"localhost1"</span> <span class="attribute">database</span>=<span class="string">"mycat_node1"</span>/&amp;gt;</span><br><span class="line">&amp;lt;dataNode <span class="attribute">name</span>=<span class="string">"dn2"</span> <span class="attribute">dataHost</span>=<span class="string">"localhost1"</span> <span class="attribute">database</span>=<span class="string">"mycat_node2"</span>/&amp;gt;</span><br></pre></td></tr></table></figure>

<p>表切分后需要配置映射到哪几个数据库中，Mycat的分片实际上就是库的别名，例如上面例子配置了两个分片dn1，dn2 分别对应到物理机映射dataHost localhost1 的两个库上。</p>
<h5 id="配置物理库分片映射（dataHost）"><a href="#配置物理库分片映射（dataHost）" class="headerlink" title="配置物理库分片映射（dataHost）"></a>配置物理库分片映射（dataHost）</h5><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="literal">lt</span>;dataHost<span class="built_in"> name</span>=<span class="string">"localhost1"</span> writeType=<span class="string">"0"</span> switchType=<span class="string">"1"</span> slaveThreshold=<span class="string">"100"</span> balance=<span class="string">"1"</span> dbType=<span class="string">"mysql"</span> maxCon=<span class="string">"10"</span> minCon=<span class="string">"1"</span> dbDriver=<span class="string">"native"</span>&amp;<span class="literal">gt</span>;</span><br><span class="line">    &amp;<span class="literal">lt</span>;heartbeat&amp;<span class="literal">gt</span>;show status like <span class="string">'wsrep%'</span>&amp;<span class="literal">lt</span>;/heartbeat&amp;<span class="literal">gt</span>;</span><br><span class="line">    &amp;<span class="literal">lt</span>;writeHost host=<span class="string">"hostM1"</span> url=<span class="string">"127.0.0.1:3306"</span> user=<span class="string">"root"</span> password=<span class="string">"root"</span> &amp;<span class="literal">gt</span>;</span><br><span class="line">    &amp;<span class="literal">lt</span>;/writeHost&amp;<span class="literal">gt</span>;  </span><br><span class="line">  &amp;<span class="literal">lt</span>;/dataHost&amp;<span class="literal">gt</span>;</span><br></pre></td></tr></table></figure>

<p>Mycat作为数据库代理需要逻辑库，逻辑用户，表切分后需要配置分片，分片也就需要映射到真实的物理主机上，至于是映射到一台还是一台的多个实例上，Mycat并不关心，只需要配置好映射即可，例如例子中：</p>
<p>配置了一个名为localhost1的物理主机（dataHost）映射。</p>
<p>heartbeat 标签代表Mycat需要对物理库心跳检测的语句，正常情况下生产案例可能配置主从，或者多写 或者单库，无论哪种情况Mycat都需要维持到数据库的数据源连接，因此需要定时检查后端连接可以性，心跳语句就是来作为心跳检测。</p>
<p>writeHost 此标签代表 一个逻辑主机（dataHost）对应的后端的物理主机映射，例如例子中写库hostM1 映射到127.0.0.1:3306。如果后端需要做读写分离或者多写 或者主从则通过配置 多个writeHost 或者readHost即可。</p>
<p>dataHost 标签中的 writeType balance 等标签则是不同的策略，具体参考指南。<br>Mycat 表切分规则配置<br>表切分规则  </p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="keyword">lt</span>;?<span class="keyword">xml</span> <span class="title">version</span>=<span class="string">"1.0"</span> <span class="attr">encoding=</span><span class="string">"UTF-8"</span>?&amp;<span class="keyword">gt</span>;</span><br><span class="line">&amp;<span class="keyword">lt</span>;!DOCTYPE mycat:<span class="keyword">rule</span> SYSTEM <span class="string">"rule.dtd"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">&amp;<span class="keyword">lt</span>;mycat:<span class="keyword">rule</span>  xmlns:<span class="attr">mycat=</span><span class="string">"http://org.opencloudb/"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">  &amp;<span class="keyword">lt</span>;tableRule <span class="attr">name=</span><span class="string">"sharding-by-hour"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;<span class="keyword">rule</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">      &amp;<span class="keyword">lt</span>;columns&amp;<span class="keyword">gt</span>;createTime&amp;<span class="keyword">lt</span>;/columns&amp;<span class="keyword">gt</span>;</span><br><span class="line">      &amp;<span class="keyword">lt</span>;algorithm&amp;<span class="keyword">gt</span>;sharding-by-hour&amp;<span class="keyword">lt</span>;/algorithm&amp;<span class="keyword">gt</span>;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;/<span class="keyword">rule</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">  &amp;<span class="keyword">lt</span>;/tableRule&amp;<span class="keyword">gt</span>;</span><br><span class="line">  </span><br><span class="line">  &amp;<span class="keyword">lt</span>;function <span class="attr">name=</span><span class="string">"sharding-by-hour"</span> <span class="attr">class=</span><span class="string">"org.opencloudb.route.function.LatestMonthPartion"</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;<span class="keyword">property</span><span class="title"> </span><span class="attr">name=</span><span class="string">"splitOneDay"</span>&amp;<span class="keyword">gt</span>;<span class="number">24</span>&amp;<span class="keyword">lt</span>;/<span class="keyword">property</span><span class="title"></span>&amp;<span class="keyword">gt</span>;</span><br><span class="line">  &amp;<span class="keyword">lt</span>;/function&amp;<span class="keyword">gt</span>;</span><br><span class="line">   </span><br><span class="line">&amp;<span class="keyword">lt</span>;/mycat:<span class="keyword">rule</span> &amp;<span class="keyword">gt</span>;</span><br></pre></td></tr></table></figure>

<p>数据切分中作为表切分规则中最重要的配置，表的切分方式决定了数据切分后的性能好坏，因此也是最重要的配置。</p>
<p>如上面例子配置了一个切分规则，名为sharding-by-hour 对应的切分方式（function ）是按日期切分，该配置中：</p>
<p>tableRule<br>name 为schema.xml 中table 标签中对应的 rule=”sharding-by-hour” ,也就是配置表的分片规则，</p>
<p>columns 是表的切分字段： createTime 创建日期。</p>
<p>algorithm 是规则对应的切分规则：映射到function 的name。</p>
<p>function<br>function 配置是分片规则的配置。</p>
<p>name 为切分规则的名称，名字任意取，但是需要与tableRule 中匹配。</p>
<p>class 是切分规则对应的切分类，写死，需要哪种规则则配置哪种，例如本例子是按小时分片：org.opencloudb.route.function.LatestMonthPartion</p>
<p>property 标签是切分规则对应的不同属性，不同的切分规则配置不同。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/09/23/mycat/" data-id="ckbdc9uzt00ni24u22milpw82" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MYCAT/">MYCAT</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/9/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/11/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/GIT/">GIT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IT/">IT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVAEE/">JAVAEE</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JAVAEE/MYSQL/">MYSQL</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/OFFICE/">OFFICE</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SYSTEM/">SYSTEM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/VIM/">VIM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/分类1/">分类1</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/电商/">电商</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ANNOTATION/">ANNOTATION</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AOP/">AOP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BAZEL/">BAZEL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BEANUTILS/">BEANUTILS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CENTOS/">CENTOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CI-CD/">CI/CD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CLASSLOADER/">CLASSLOADER</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CRONTAB/">CRONTAB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DEBUG/">DEBUG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DESIGN-PATTERNS/">DESIGN PATTERNS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DNS/">DNS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DOCKER/">DOCKER</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DRUID/">DRUID</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ENLINK/">ENLINK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES/">ES</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EUREKA/">EUREKA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EXCEL/">EXCEL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Eureka/">Eureka</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FASTJSON/">FASTJSON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GIT/">GIT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GITLAB/">GITLAB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GLOBALEXCEPTION/">GLOBALEXCEPTION</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GO/">GO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HEXO/">HEXO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDEA/">IDEA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/INTERCEPTOR/">INTERCEPTOR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IT/">IT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVADOC/">JAVADOC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVASCRIPT/">JAVASCRIPT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVASE/">JAVASE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JETTY/">JETTY</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JPA/">JPA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSONUTILS/">JSONUTILS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KARAF/">KARAF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KEEPALIVED/">KEEPALIVED</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LINUX/">LINUX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LISTENER/">LISTENER</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LOADBALANCED/">LOADBALANCED</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LOG/">LOG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LOGBACK/">LOGBACK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LOGIN/">LOGIN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LOMBOK/">LOMBOK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MAC/">MAC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MARKDOWN/">MARKDOWN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MIME-TYPE/">MIME-TYPE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MQ/">MQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MYBATIS/">MYBATIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MYCAT/">MYCAT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MYSQL/">MYSQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NETWORK/">NETWORK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OAUTH2/">OAUTH2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ONOS/">ONOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OSGI/">OSGI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OSI/">OSI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PAGEHELPER/">PAGEHELPER</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/POSTMAN/">POSTMAN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PYTHON/">PYTHON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RABBITMQ/">RABBITMQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/REDIS/">REDIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/REDISTEMPLATE/">REDISTEMPLATE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/REFLECTION/">REFLECTION</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/REGISTRY-CENTER/">REGISTRY CENTER</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/REPO/">REPO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RESTTEMPLATE/">RESTTEMPLATE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RIBBON/">RIBBON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RPM/">RPM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SECURITY/">SECURITY</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SERIALVERSIONUID/">SERIALVERSIONUID</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SERVLET/">SERVLET</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SESSION/">SESSION</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SHELL/">SHELL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPINTBOOT/">SPINTBOOT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPRING/">SPRING</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPRING-MVC/">SPRING MVC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPRING-STREAM/">SPRING STREAM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPRINGBBOT/">SPRINGBBOT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPRINGBOOT/">SPRINGBOOT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPRINGQUARTZ/">SPRINGQUARTZ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPRINGTASK/">SPRINGTASK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPRINGTBOOT/">SPRINGTBOOT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPTING/">SPTING</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/">SQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQLAlert/">SQLAlert</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSO/">SSO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/STRINGREDISTEMPLATE/">STRINGREDISTEMPLATE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SWAGGER/">SWAGGER</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SYSTEM/">SYSTEM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/">TCP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP-IP/">TCP/IP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TERMUX/">TERMUX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TK-MYBATIS/">TK.MYBATIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TRANSECTION/">TRANSECTION</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UBUNTU/">UBUNTU</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UDP/">UDP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WEBClIENT/">WEBClIENT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/YAML/">YAML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rabbitMq/">rabbitMq</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式/">分布式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/抖音/">抖音</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文件服务器/">文件服务器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/时间转化/">时间转化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/标签1/">标签1</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/淘宝/">淘宝</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/高可用/">高可用</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ANNOTATION/" style="font-size: 14.62px;">ANNOTATION</a> <a href="/tags/AOP/" style="font-size: 10.77px;">AOP</a> <a href="/tags/BAZEL/" style="font-size: 10px;">BAZEL</a> <a href="/tags/BEANUTILS/" style="font-size: 10px;">BEANUTILS</a> <a href="/tags/CENTOS/" style="font-size: 10px;">CENTOS</a> <a href="/tags/CI-CD/" style="font-size: 10px;">CI/CD</a> <a href="/tags/CLASSLOADER/" style="font-size: 10px;">CLASSLOADER</a> <a href="/tags/CRONTAB/" style="font-size: 10.77px;">CRONTAB</a> <a href="/tags/DEBUG/" style="font-size: 10px;">DEBUG</a> <a href="/tags/DESIGN-PATTERNS/" style="font-size: 10px;">DESIGN PATTERNS</a> <a href="/tags/DNS/" style="font-size: 10px;">DNS</a> <a href="/tags/DOCKER/" style="font-size: 11.54px;">DOCKER</a> <a href="/tags/DRUID/" style="font-size: 10px;">DRUID</a> <a href="/tags/ENLINK/" style="font-size: 10px;">ENLINK</a> <a href="/tags/ES/" style="font-size: 16.15px;">ES</a> <a href="/tags/EUREKA/" style="font-size: 10px;">EUREKA</a> <a href="/tags/EXCEL/" style="font-size: 10px;">EXCEL</a> <a href="/tags/Eureka/" style="font-size: 10px;">Eureka</a> <a href="/tags/FASTJSON/" style="font-size: 10px;">FASTJSON</a> <a href="/tags/GIT/" style="font-size: 10px;">GIT</a> <a href="/tags/GITLAB/" style="font-size: 10px;">GITLAB</a> <a href="/tags/GLOBALEXCEPTION/" style="font-size: 10px;">GLOBALEXCEPTION</a> <a href="/tags/GO/" style="font-size: 10.77px;">GO</a> <a href="/tags/HEXO/" style="font-size: 12.31px;">HEXO</a> <a href="/tags/IDEA/" style="font-size: 12.31px;">IDEA</a> <a href="/tags/INTERCEPTOR/" style="font-size: 11.54px;">INTERCEPTOR</a> <a href="/tags/IT/" style="font-size: 11.54px;">IT</a> <a href="/tags/JAVADOC/" style="font-size: 10px;">JAVADOC</a> <a href="/tags/JAVAEE/" style="font-size: 20px;">JAVAEE</a> <a href="/tags/JAVASCRIPT/" style="font-size: 11.54px;">JAVASCRIPT</a> <a href="/tags/JAVASE/" style="font-size: 10.77px;">JAVASE</a> <a href="/tags/JETTY/" style="font-size: 10px;">JETTY</a> <a href="/tags/JPA/" style="font-size: 10.77px;">JPA</a> <a href="/tags/JSONUTILS/" style="font-size: 10px;">JSONUTILS</a> <a href="/tags/KARAF/" style="font-size: 11.54px;">KARAF</a> <a href="/tags/KEEPALIVED/" style="font-size: 10px;">KEEPALIVED</a> <a href="/tags/LINUX/" style="font-size: 16.92px;">LINUX</a> <a href="/tags/LISTENER/" style="font-size: 10px;">LISTENER</a> <a href="/tags/LOADBALANCED/" style="font-size: 10px;">LOADBALANCED</a> <a href="/tags/LOG/" style="font-size: 10px;">LOG</a> <a href="/tags/LOGBACK/" style="font-size: 10px;">LOGBACK</a> <a href="/tags/LOGIN/" style="font-size: 10px;">LOGIN</a> <a href="/tags/LOMBOK/" style="font-size: 11.54px;">LOMBOK</a> <a href="/tags/MAC/" style="font-size: 15.38px;">MAC</a> <a href="/tags/MARKDOWN/" style="font-size: 11.54px;">MARKDOWN</a> <a href="/tags/MIME-TYPE/" style="font-size: 10px;">MIME-TYPE</a> <a href="/tags/MQ/" style="font-size: 12.31px;">MQ</a> <a href="/tags/MYBATIS/" style="font-size: 17.69px;">MYBATIS</a> <a href="/tags/MYCAT/" style="font-size: 10.77px;">MYCAT</a> <a href="/tags/MYSQL/" style="font-size: 16.15px;">MYSQL</a> <a href="/tags/NETWORK/" style="font-size: 10px;">NETWORK</a> <a href="/tags/OAUTH2/" style="font-size: 10.77px;">OAUTH2</a> <a href="/tags/ONOS/" style="font-size: 14.62px;">ONOS</a> <a href="/tags/OSGI/" style="font-size: 13.85px;">OSGI</a> <a href="/tags/OSI/" style="font-size: 10px;">OSI</a> <a href="/tags/PAGEHELPER/" style="font-size: 10px;">PAGEHELPER</a> <a href="/tags/POSTMAN/" style="font-size: 10px;">POSTMAN</a> <a href="/tags/PYTHON/" style="font-size: 13.08px;">PYTHON</a> <a href="/tags/RABBITMQ/" style="font-size: 10.77px;">RABBITMQ</a> <a href="/tags/REDIS/" style="font-size: 11.54px;">REDIS</a> <a href="/tags/REDISTEMPLATE/" style="font-size: 10px;">REDISTEMPLATE</a> <a href="/tags/REFLECTION/" style="font-size: 11.54px;">REFLECTION</a> <a href="/tags/REGISTRY-CENTER/" style="font-size: 10px;">REGISTRY CENTER</a> <a href="/tags/REPO/" style="font-size: 10px;">REPO</a> <a href="/tags/RESTTEMPLATE/" style="font-size: 10px;">RESTTEMPLATE</a> <a href="/tags/RIBBON/" style="font-size: 10.77px;">RIBBON</a> <a href="/tags/RPM/" style="font-size: 10px;">RPM</a> <a href="/tags/SECURITY/" style="font-size: 12.31px;">SECURITY</a> <a href="/tags/SERIALVERSIONUID/" style="font-size: 10px;">SERIALVERSIONUID</a> <a href="/tags/SERVLET/" style="font-size: 10.77px;">SERVLET</a> <a href="/tags/SESSION/" style="font-size: 12.31px;">SESSION</a> <a href="/tags/SHELL/" style="font-size: 14.62px;">SHELL</a> <a href="/tags/SPINTBOOT/" style="font-size: 10px;">SPINTBOOT</a> <a href="/tags/SPRING/" style="font-size: 13.08px;">SPRING</a> <a href="/tags/SPRING-MVC/" style="font-size: 10px;">SPRING MVC</a> <a href="/tags/SPRING-STREAM/" style="font-size: 10px;">SPRING STREAM</a> <a href="/tags/SPRINGBBOT/" style="font-size: 10px;">SPRINGBBOT</a> <a href="/tags/SPRINGBOOT/" style="font-size: 19.23px;">SPRINGBOOT</a> <a href="/tags/SPRINGQUARTZ/" style="font-size: 10px;">SPRINGQUARTZ</a> <a href="/tags/SPRINGTASK/" style="font-size: 12.31px;">SPRINGTASK</a> <a href="/tags/SPRINGTBOOT/" style="font-size: 10px;">SPRINGTBOOT</a> <a href="/tags/SPTING/" style="font-size: 10px;">SPTING</a> <a href="/tags/SQL/" style="font-size: 12.31px;">SQL</a> <a href="/tags/SQLAlert/" style="font-size: 18.46px;">SQLAlert</a> <a href="/tags/SSO/" style="font-size: 10px;">SSO</a> <a href="/tags/STRINGREDISTEMPLATE/" style="font-size: 10px;">STRINGREDISTEMPLATE</a> <a href="/tags/SWAGGER/" style="font-size: 10px;">SWAGGER</a> <a href="/tags/SYSTEM/" style="font-size: 10px;">SYSTEM</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/TCP-IP/" style="font-size: 11.54px;">TCP/IP</a> <a href="/tags/TERMUX/" style="font-size: 10.77px;">TERMUX</a> <a href="/tags/TK-MYBATIS/" style="font-size: 10px;">TK.MYBATIS</a> <a href="/tags/TRANSECTION/" style="font-size: 10px;">TRANSECTION</a> <a href="/tags/UBUNTU/" style="font-size: 10px;">UBUNTU</a> <a href="/tags/UDP/" style="font-size: 10px;">UDP</a> <a href="/tags/WEBClIENT/" style="font-size: 10px;">WEBClIENT</a> <a href="/tags/YAML/" style="font-size: 10.77px;">YAML</a> <a href="/tags/rabbitMq/" style="font-size: 10px;">rabbitMq</a> <a href="/tags/分布式/" style="font-size: 10px;">分布式</a> <a href="/tags/抖音/" style="font-size: 10px;">抖音</a> <a href="/tags/文件服务器/" style="font-size: 10.77px;">文件服务器</a> <a href="/tags/时间转化/" style="font-size: 10px;">时间转化</a> <a href="/tags/标签1/" style="font-size: 10px;">标签1</a> <a href="/tags/淘宝/" style="font-size: 10px;">淘宝</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a> <a href="/tags/高可用/" style="font-size: 10px;">高可用</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/06/13/可视化面板/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/06/13/邮箱找回密码与二次认证/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/06/13/特权用户访问策略控制/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/06/13/md列表/">markdown任务列表语法checkbox</a>
          </li>
        
          <li>
            <a href="/2020/06/13/CS应用配置/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Joe Tong<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>