<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Learning</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="private learning">
<meta property="og:type" content="website">
<meta property="og:title" content="Learning">
<meta property="og:url" content="/blog/page/19/index.html">
<meta property="og:site_name" content="Learning">
<meta property="og:description" content="private learning">
<meta property="og:locale" content="zh_CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Learning">
<meta name="twitter:description" content="private learning">
  
    <link rel="alternate" href="/atom.xml" title="Learning" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Learning</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Joe&#39;s Blog</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="/blog"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-spring-task-scheduled" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/16/spring-task-scheduled/" class="article-date">
  <time datetime="2019-07-16T18:50:00.000Z" itemprop="datePublished">2019-07-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/16/spring-task-scheduled/">spring task @scheduled</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Spring 4.x Task 和 Schedule 概述<br>摘要<br>在很多业务场景中，系统都需要用到任务调度系统。例如定期地清理Redis 缓存，周期性地检索某一条件并更新系统的资源等。在现代的应用系统中，快速地响应用户的请求，是用户体验最主要的因素之一。因此在Web 系统中异步地执行任务，也会在很多场景中经常涉及到。本文对任务调度和异步执行的Java 实现进行了总结，主要讲述一下内容：<br>Java 对异步执行和任务调度的支持<br>Spring 4.X 的异步执行和任务调度实现<br>Java 对异步执行和任务调度的支持<br>异步执行和任务调度底层的语言支撑都是Java 的多线程技术。线程是系统进行独立运行和调度的基本单位。拥有了多线程，系统就拥有了同时处理多项任务的能力。<br>Java 实现异步调用<br>在Java 中要实现多线程有实现Runnable 接口和扩展Thread 类两种方式。只要将需要异步执行的任务放在run() 方法中，在主线程中启动要执行任务的子线程就可以实现任务的异步执行。如果需要实现基于时间点触发的任务调度，就需要在子线程中循环的检查系统当前的时间跟触发条件是否一致，然后触发任务的执行。该内容属于Java 多线程的基础知识，此处略过不讲。<br>Java Timer 和 TimeTask 实现任务调度<br>为了便于开发者快速地实现任务调度，Java JDK 对任务调度的功能进行了封装，实现了Timer 和TimerTask 两个工具类。<br>TimerTask 类<br>由上图，我们可以看出TimeTask 抽象类在实现Runnable 接口的基础上增加了任务cancel() 和任务scheduledExecuttionTime() 两个方法。<br>Timer 类<br>上图为调度类Timer 的实现。从Timer类的源码，可以看到其采用TaskQueue 来实现对多个TimeTask 的管理。TimerThread 集成自Thread 类，其mainLoop() 用来对任务进行调度。而Timer 类提供了四种重载的schedule() 方法和重载了两种sheduleAtFixedRate() 方法来实现几种基本的任务调度类型。下面的代码是采用Timer 实现的定时系统时间打印程序。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">PrintTimeTask</span> <span class="keyword">extends</span> <span class="title">TimerTask</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">        public void run() &#123;</span><br><span class="line">            <span class="type">System</span>.out.println(<span class="keyword">new</span> <span class="type">Date</span>().toString());</span><br><span class="line">        &#125;</span><br><span class="line">                    </span><br><span class="line">    public static void main(<span class="type">String</span>[] args) &#123;</span><br><span class="line">        <span class="type">Timer</span> timer = <span class="keyword">new</span> <span class="type">Timer</span>(<span class="string">"hello"</span>);</span><br><span class="line">        timer.schedule(<span class="keyword">new</span> <span class="type">PrintTimeTask</span>(), <span class="number">1000</span>L, <span class="number">2000</span>L);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring 4.x 中的异步执行和任务调度<br>Spring 4.x 中的异步执行<br>Spring 作为一站式框架，为开发者提供了异步执行和任务调度的抽象接口TaskExecutor 和TaskScheduler。Spring 对这些接口的实现类支持线程池(Thread Pool) 和代理。<br>Spring 提供了对JDK 中Timer和开源的流行任务调度框架Quartz的支持。Spring 通过将关联的Schedule 转化为FactoryBean 来实现。通过Spring 调度框架，开发者可以快速地通过MethodInvokingFactoryBean 来实现将POJO 类的方法转化为任务。<br>Spring TaskExecutor<br>TaskExecutor 接口扩展自java.util.concurrent.Executor 接口。TaskExecutor 被创建来为其他组件提供线程池调用的抽象。<br>ThreadPoolTaskExecutor 是TaskExecutor 的最主要实现类之一。该类的核心继承关系如下图所示。<br>ThreadPooltaskexecutor 类<br>ThreadPoolTaskExecutor 接口扩展了重多的接口，让其具备了更多的能力。要实现异步需要标注@Async 注解：<br>AsyncTaskExecutor 增加了返回结果为Future 的submit() 方法，该方法的参数为Callable 接口。相比Runnable 接口，多了将执行结果返回的功能。<br>AsyncListenableTaskExecutor 接口允许返回拥有回调功能的ListenableFuture 接口，这样在结果执行完毕是，能够直接回调处理。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListenableTask</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> ListenableFuture&amp;lt;Integer&amp;gt; compute(<span class="keyword">int</span> n) &#123;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &amp;lt; n; i++) &#123;</span><br><span class="line">            sum += i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AsyncResult&amp;lt;&amp;gt;(sum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CallBackImpl</span> <span class="keyword">implements</span> </span></span><br><span class="line"><span class="class">        <span class="title">ListenableFutureCallback</span>&amp;<span class="title">lt</span></span>;Integer&amp;gt; &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Throwable ex)</span> </span>&#123;</span><br><span class="line">            System.out.println(ex.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(Integer result)</span> </span>&#123;</span><br><span class="line">            System.out.println(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ListenableTask listenableTask = <span class="keyword">new</span> ListenableTask();</span><br><span class="line">        ListenableFuture&amp;lt;Integer&amp;gt; listenableFuture = </span><br><span class="line">            listenableTask.compute(<span class="number">10</span>);</span><br><span class="line">        listenableFuture.addCallback(<span class="keyword">new</span> CallBackImpl());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ThreadFactory 定义了创建线程的工厂方法，可以扩展该方法实现对Thread 的改造。<br>基于Java Config<br>基于注解 当采用基于Java Config 注解配置时，只需要在主配置添加@EnableAsync 注解，Spring 会自动的创建基于ThreadPoolTaskExecutor 实例注入到上下文中。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Configuration</span></span><br><span class="line"><span class="variable">@EnableAsync</span></span><br><span class="line">public class AppConfig &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>基于AsyncConfigurer接口自定义 开发者可以自定义Executor 的类型，并且注册异常处理器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskConfig</span> <span class="keyword">implements</span> <span class="title">AsyncConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Executor <span class="title">getAsyncExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ThreadPoolTaskExecutor executor = <span class="keyword">new</span> ThreadPoolTaskExecutor();</span><br><span class="line">        executor.setMaxPoolSize(<span class="number">100</span>);</span><br><span class="line">        executor.setCorePoolSize(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">return</span> executor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AsyncUncaughtExceptionHandler <span class="title">getAsyncUncaughtExceptionHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AsyncUncaughtExceptionHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleUncaughtException</span><span class="params">(Throwable ex, </span></span></span><br><span class="line"><span class="function"><span class="params">                                                Method method, Object... params)</span> </span>&#123;</span><br><span class="line">                System.out.println(ex.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>基于XML Config<br>基于传统XML的配置 基于XML 的形式，采用传统的Java Bean的形式配置ThreadPoolTaskExecutor。然后采用自动注入(autowire, resource,name)的可以直接在Spring Component 中注入Executor。以编程的形式实现异步任务。</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="literal">lt</span>;bean<span class="built_in"> id</span>=<span class="string">"taskExecutor"</span> class=<span class="string">"org.springframework.scheduling.concurrent.</span></span><br><span class="line"><span class="string">    ThreadPoolTaskExecutor"</span>&amp;<span class="literal">gt</span>;</span><br><span class="line">    &amp;<span class="literal">lt</span>;property<span class="built_in"> name</span>=<span class="string">"corePoolSize"</span> <span class="keyword">value</span>=<span class="string">"5"</span> /&amp;<span class="literal">gt</span>;</span><br><span class="line">    &amp;<span class="literal">lt</span>;property<span class="built_in"> name</span>=<span class="string">"maxPoolSize"</span> <span class="keyword">value</span>=<span class="string">"10"</span> /&amp;<span class="literal">gt</span>;</span><br><span class="line">    &amp;<span class="literal">lt</span>;property<span class="built_in"> name</span>=<span class="string">"queueCapacity"</span> <span class="keyword">value</span>=<span class="string">"25"</span> /&amp;<span class="literal">gt</span>;</span><br><span class="line">&amp;<span class="literal">lt</span>;/bean&amp;<span class="literal">gt</span>;</span><br></pre></td></tr></table></figure>

<p>基于task 命名空间的配置 Spring 为任务的执行提供了便利的task 命名空间。当采用基于XML 配置时Spring 会自动地为开发者创建Executor。同时可以在annotation-driven 标签上注册实现了AsyncUncaughtExceptionHandler 接口的异常处理器。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;lt;!--<span class="built_in"> config </span>exception handler  --&amp;gt;</span><br><span class="line">&amp;lt;bean <span class="attribute">id</span>=<span class="string">"taskAsyncExceptionHandler"</span> <span class="attribute">class</span>=<span class="string">"org.zzy.spring4.application.schedulie.TaskAsyncExceptionHandler"</span>/&amp;gt;</span><br><span class="line">&amp;lt;task:annotation-driven <span class="attribute">exception-handler</span>=<span class="string">"taskAsyncExceptionHandler"</span> <span class="attribute">scheduler</span>=<span class="string">"scheduler"</span> <span class="attribute">executor</span>=<span class="string">"executor"</span>/&amp;gt;</span><br></pre></td></tr></table></figure>

<p>异步执行的异常处理<br>除了上文提到的两种异常处理方式，Spring 还提供了基于SimpleApplicationEventMulticaster 类的异常处理方式。</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">SimpleApplicationEventMulticaster <span class="title">eventMulticaster</span><span class="params">(TaskExecutor taskExecutor)</span> </span>&#123;</span><br><span class="line">    SimpleApplicationEventMulticaster eventMulticaster = <span class="keyword">new</span> SimpleApplicationEventMulticaster();</span><br><span class="line">    eventMulticaster.setTaskExecutor(taskExecutor);</span><br><span class="line">    eventMulticaster.setErrorHandler(<span class="keyword">new</span> ErrorHandler() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">handleError</span><span class="params">(Throwable t)</span> </span>&#123;</span><br><span class="line">            System.out.println(t.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> eventMulticaster;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring 4.x 中任务调度实现<br>Spring 的任务调度主要基于TaskScheduler 接口。ThreadPoolTaskScheduler 是Spring 任务调度的核心实现类。该类提供了大量的重载方法进行任务调度。Trigger 定义了任务被执行的触发条件。Spring 提供了基于Corn 表达式的CornTrigger实现。TaskScheduler 如下图所示。</p>
<p>ThreadPoolTaskExecutor 类<br>实现TaskScheduler 接口的ThreadPoolTaskExecutor 继承关系。</p>
<p>ThreadPoolTaskExecutor 类<br>基于Java Config<br>基于注解的配置 当采用基于Java Config 注解配置时，只需要在主配置添加@EnableScheduling 注解，Spring 会自动的创建基于ThreadPoolTaskExecutor 实例注入到上下文中。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Configuration</span></span><br><span class="line"><span class="variable">@EnableScheduling</span></span><br><span class="line">public class AppConfig &#123;</span><br><span class="line">&#125;</span><br><span class="line">基于SchedulingConfigurer接口自定义</span><br><span class="line"><span class="variable">@Configuration</span></span><br><span class="line">public class ScheduleConfig implements SchedulingConfigurer &#123;</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void configureTasks(ScheduledTaskRegistrar taskRegistrar) &#123;</span><br><span class="line">        <span class="selector-tag">taskRegistrar</span><span class="selector-class">.setTaskScheduler</span>(new ThreadPoolTaskScheduler());</span><br><span class="line">        <span class="selector-tag">taskRegistrar</span><span class="selector-class">.getScheduler</span>()<span class="selector-class">.schedule</span>(new Runnable() &#123;</span><br><span class="line">            <span class="variable">@Override</span></span><br><span class="line">            public void run() &#123;</span><br><span class="line">                <span class="selector-tag">System</span><span class="selector-class">.out</span><span class="selector-class">.println</span>(<span class="string">"hello"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="selector-tag">new</span> <span class="selector-tag">CronTrigger</span>(<span class="string">"0 15 9-17 * * MON-FRI"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>基于XML Config<br>&lt;task:annotation-driven scheduler=”myScheduler”/&gt;<br>&lt;task:scheduler id=”myScheduler” pool-size=”10”/&gt;<br>@Scheduled 注解的使用<br>当某个Bean 由Spring 管理生命周期时，就可以方便的使用@Shcheduled 注解将该Bean 的方法准换为基于任务调度的策略。</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Scheduled(initialDelay=1000, fixedRate=5000)</span><br><span class="line">public void doSomething() &#123;</span><br><span class="line">    // something that should<span class="built_in"> execute </span>periodically</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Scheduled(cron=<span class="string">"*/5 * * * * MON-FRI"</span>)</span><br><span class="line">public void doSomething() &#123;</span><br><span class="line">    // something that should<span class="built_in"> execute </span>on weekdays only</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>task 命名空间中的task:scheduled-tasks<br>该元素能够实现快速地将一个普通Bean 的方法转换为Scheduled 任务的途径。具体如下：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&amp;lt;task:scheduled-tasks <span class="attribute">scheduler</span>=<span class="string">"myScheduler"</span>&amp;gt;</span><br><span class="line">    &amp;lt;task:scheduled <span class="attribute">ref</span>=<span class="string">"beanA"</span> <span class="attribute">method</span>=<span class="string">"methodA"</span> <span class="attribute">fixed-delay</span>=<span class="string">"5000"</span> <span class="attribute">initial-delay</span>=<span class="string">"1000"</span>/&amp;gt;</span><br><span class="line">    &amp;lt;task:scheduled <span class="attribute">ref</span>=<span class="string">"beanB"</span> <span class="attribute">method</span>=<span class="string">"methodB"</span> <span class="attribute">fixed-rate</span>=<span class="string">"5000"</span>/&amp;gt;</span><br><span class="line">    &amp;lt;task:scheduled <span class="attribute">ref</span>=<span class="string">"beanC"</span> <span class="attribute">method</span>=<span class="string">"methodC"</span> <span class="attribute">cron</span>=<span class="string">"*/5 * * * * MON-FRI"</span>/&amp;gt;</span><br><span class="line">&amp;lt;/task:scheduled-tasks&amp;gt;</span><br><span class="line">&amp;lt;task:scheduler <span class="attribute">id</span>=<span class="string">"myScheduler"</span> <span class="attribute">pool-size</span>=<span class="string">"10"</span>/&amp;gt;</span><br></pre></td></tr></table></figure>

<p>总结<br>本文着重介绍了JDK 为任务调度提供的基础类Timer。并在此基础上详细介绍了Spring 4.x 的异步执行和任务调度的底层接口设计。并针对常用的模式进行了讲解，并附带了源代码。第三方开源的Quartz 实现了更为强大的任务调度系统，Spring 也对集成Quartz 提供了转换。之后会择机再详细的介绍Quartz 的应用和设计原理。同时，Servlet 3.x 为Web 的异步调用提供了AsyncContext，对基于Web 的异步调用提供了原生的支持，后续的文章也会对此有相应的介绍。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/07/16/spring-task-scheduled/" data-id="ckbdc9v0200o724u2k1liy7g9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SPRINGTASK/">SPRINGTASK</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-spring-task" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/16/spring-task/" class="article-date">
  <time datetime="2019-07-16T18:39:00.000Z" itemprop="datePublished">2019-07-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/16/spring-task/">spring task</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>基于Spring Task的定时任务调度器实现<br>在很多时候，我们会需要执行一些定时任务 ，Spring团队提供了Spring Task模块对定时任务的调度提供了支持，基于注解式的任务使用也非常方便。<br>只要跟需要定时执行的方法加上类似 @Scheduled(cron = “0 1 * *  *  *”) 的注解就可以实现方法的定时执行。<br>cron 是一种周期的表达式，六位从右至左分别对应的是年、月、日、时、分、秒，数字配合各种通配符可以表达种类丰富的定时执行周期。  </p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* Cron Example patterns:</span><br><span class="line">* &amp;<span class="literal">lt</span>;li&amp;<span class="literal">gt</span>;<span class="string">"0 0 * * * *"</span> = the top <span class="keyword">of</span> <span class="keyword">every</span> hour <span class="keyword">of</span> <span class="keyword">every</span> day.&amp;<span class="literal">lt</span>;/li&amp;<span class="literal">gt</span>;</span><br><span class="line">* &amp;<span class="literal">lt</span>;li&amp;<span class="literal">gt</span>;<span class="string">"0 0 8-10 * * *"</span> = <span class="number">8</span>, <span class="number">9</span> <span class="keyword">and</span> <span class="number">10</span> o<span class="string">'clock of every day.&amp;lt;/li&amp;gt;</span></span><br><span class="line"><span class="string">* &amp;lt;li&amp;gt;"0 0/30 8-10 * * *" = 8:00, 8:30, 9:00, 9:30 and 10 o'</span>clock <span class="keyword">every</span> day.&amp;<span class="literal">lt</span>;/li&amp;<span class="literal">gt</span>;</span><br><span class="line">* &amp;<span class="literal">lt</span>;li&amp;<span class="literal">gt</span>;<span class="string">"0 0 9-17 * * MON-FRI"</span> = on the hour nine-to-five weekdays&amp;<span class="literal">lt</span>;/li&amp;<span class="literal">gt</span>;</span><br><span class="line">* &amp;<span class="literal">lt</span>;li&amp;<span class="literal">gt</span>;<span class="string">"0 0 0 25 12 ?"</span> = <span class="keyword">every</span> Christmas Day <span class="keyword">at</span> midnight&amp;<span class="literal">lt</span>;/li&amp;<span class="literal">gt</span>;</span><br><span class="line">*/</span><br><span class="line">基于注解的使用案列：</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component; </span><br><span class="line">   </span><br><span class="line">@Component(“task”) </span><br><span class="line">public class Task &#123; </span><br><span class="line">    @Scheduled(cron = <span class="string">"0 1 * * * *"</span>)  // 每分钟执行一次</span><br><span class="line">    public void job1() &#123; </span><br><span class="line">        System.out.println(“任务进行中。。。”); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>基于注解方式的定时任务，启动会依赖于系统的启动。如果需要通过代码或前台操作触发定时任务，就需要进行包装了。<br>下面是一个可以直接提供业务代码调用的定时任务调度器。调用 schedule(Runnable task, String cron) 传入要执行的任务<br>task和定时周期cron就可以了。注：基于注解方式需要在注解扫描范围内。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">package com.louis.merak.schedule;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.<span class="keyword">factory</span>.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.support.CronTrigger;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MerakTaskScheduler</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    private ThreadPoolTaskScheduler threadPoolTaskScheduler;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    public ThreadPoolTaskScheduler threadPoolTaskScheduler()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolTaskScheduler();</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Cron Example patterns:</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>&amp;lt;li&amp;gt;"0 0 <span class="bullet">* *</span> <span class="bullet">* *</span>" = </span>the<span class="markdown"> top of every hour of every day.&amp;lt;/li&amp;gt;</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>&amp;lt;li&amp;gt;"0 0 8-10 <span class="bullet">* *</span> *" = 8, 9 and 10 o'clock of every day.&amp;lt;/li&amp;gt;</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>&amp;lt;li&amp;gt;"0 0/30 8-10 <span class="bullet">* *</span> *" = 8:00, 8:30, 9:00, 9:30 and 10 o'clock every day.&amp;lt;/li&amp;gt;</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>&amp;lt;li&amp;gt;"0 0 9-17 <span class="bullet">* *</span> MON-FRI" = on </span>the<span class="markdown"> hour nine-to-five weekdays&amp;lt;/li&amp;gt;</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>&amp;lt;li&amp;gt;"0 0 0 25 12 ?" = every Christmas Day at midnight&amp;lt;/li&amp;gt;</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">void</span> schedule(Runnable task, <span class="built_in">String</span> cron)&#123;</span><br><span class="line">        <span class="keyword">if</span>(cron == <span class="keyword">null</span> || <span class="string">""</span>.equals(cron)) &#123;</span><br><span class="line">            cron = <span class="string">"0 * * * * *"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        threadPoolTaskScheduler.schedule(task, <span class="keyword">new</span> CronTrigger(cron));</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>shutdown and init</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param task</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param cron</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">void</span> reset()&#123;</span><br><span class="line">        threadPoolTaskScheduler.shutdown();</span><br><span class="line">        threadPoolTaskScheduler.initialize();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>shutdown before </span>a<span class="markdown"> new schedule operation</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param task</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param cron</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">void</span> resetSchedule(Runnable task, <span class="built_in">String</span> cron)&#123;</span><br><span class="line">        shutdown();</span><br><span class="line">        threadPoolTaskScheduler.initialize();</span><br><span class="line">        schedule(task, cron);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>shutdown</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">void</span> shutdown()&#123;</span><br><span class="line">        threadPoolTaskScheduler.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>如果是需要通过前台操作调用RESTful执行定时任务的调度，使用以下Controller即可。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.louis.merak.common.schedule;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.<span class="keyword">annotation</span>.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MerakTaskSchedulerController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MerakTaskScheduler taskScheduler;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(<span class="meta-string">"/schedule"</span>)</span></span><br><span class="line">    <span class="keyword">public</span> String schedule(<span class="meta">@RequestParam</span> String cron) &#123;</span><br><span class="line">　　　　 <span class="keyword">if</span>(cron == <span class="literal">null</span>) &#123;</span><br><span class="line">　　　　　　 cron = <span class="string">"0/5 * * * * *"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Runnable runnable = new Runnable() &#123;</span><br><span class="line">            <span class="keyword">public</span> void run() &#123;</span><br><span class="line">                String time = new SimpleDateFormat(<span class="string">"yy-MM-dd HH:mm:ss"</span>).format(new Date());</span><br><span class="line">                System.<span class="keyword">out</span>.println(<span class="string">"Test GETaskScheduler Success at "</span>  + time);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        taskScheduler.schedule(runnable, cron);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Test TaskScheduler Interface."</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/07/16/spring-task/" data-id="ckbdc9uvm00cx24u2vt7lafb8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SPRINGTASK/">SPRINGTASK</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-push-existing-folder-to-git" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/16/push-existing-folder-to-git/" class="article-date">
  <time datetime="2019-07-16T18:22:00.000Z" itemprop="datePublished">2019-07-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/16/push-existing-folder-to-git/">push existing folder to git</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Command line instructions    </p>
<p>You can also upload existing files from your computer using the instructions below.</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Git global setup  </span><br><span class="line">git<span class="built_in"> config </span>--global user.name <span class="string">"Tong"</span>  </span><br><span class="line">git<span class="built_in"> config </span>--global user.email <span class="string">"joetonghao@126.com"</span></span><br></pre></td></tr></table></figure>

<p>Create a new repository  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git clone http:<span class="comment">//tong.lab.com/Joe/springboot-login.git  </span></span><br><span class="line">cd springboot-login  </span><br><span class="line">touch README<span class="selector-class">.md</span>  </span><br><span class="line">git add README<span class="selector-class">.md</span>  </span><br><span class="line">git commit -m <span class="string">"add README"</span>  </span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>

<p>Push an existing folder </p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd existing_folder  </span><br><span class="line">git init  </span><br><span class="line">git remote <span class="keyword">add</span><span class="bash"> origin http://tong.lab.com/Joe/springboot-login.git  </span></span><br><span class="line">git <span class="keyword">add</span><span class="bash"> .</span></span><br><span class="line">git commit -m <span class="string">"Initial commit"</span>  </span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>

<p>Push an existing Git repository  </p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd existing_repo  </span><br><span class="line">git remote <span class="built_in">rename</span> <span class="built_in">origin</span> old-<span class="built_in">origin</span>  </span><br><span class="line">git remote add <span class="built_in">origin</span> http://tong.lab.com/Joe/springboot-login.git  </span><br><span class="line">git <span class="built_in">push</span> -u <span class="built_in">origin</span> --all  </span><br><span class="line">git <span class="built_in">push</span> -u <span class="built_in">origin</span> --tags</span><br></pre></td></tr></table></figure>

<p>git - 查看远程仓库信息</p>
<p><code>git remote show origin</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/07/16/push-existing-folder-to-git/" data-id="ckbdc9uv600br24u2slabfzru" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GIT/">GIT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-docker-gitlab" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/16/docker-gitlab/" class="article-date">
  <time datetime="2019-07-16T17:54:00.000Z" itemprop="datePublished">2019-07-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/16/docker-gitlab/">docker gitlab</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>使用docker搭建gitlab初体验+数据备份</p>
<p>一. 背景<br>作为程序员，像GitHub这种好工具是必须得十分了解的，但是有时GitHub并不能满足我们所有的需求，就如作者所在的公司，我们的代码都是商业性的产品，不可能放到GitHub的开放仓库中的，而申请GitHub私人仓库需要钱。这就陷入了尴尬的局面，那有没有一种既能具有GitHub一样的功能，又能保护隐私免费的管理工具呢？答案是肯定的，感谢程序员伟大的开源精神，我们有了GitLab!!!今天笔者在这里就跟大家分享一下自己使用docker搭建GitLab的过程吧，这其中踩了一些坑，希望看过这篇文章的人不用在踩我踩过的坑了！<br>二. 环境介绍<br>服务器信息：<br>CPU : 2<br>DISK : 30G<br>RAM : 4G<br>OS : Linux centos7-0 3.10.0-229.el7.x86_64<br>这里笔者使用的是自己公司的服务器，也可以使用虚拟机进行搭建<br>三. 搭建过程  </p>
<ol>
<li>安装docker<br>因为我们是使用docker搭建的，所以需要先安装docker，docker支持不同的OS，具体的安装信息这里不做详细介绍，可以自己的操作系统，参考官方的安装指南进行安装。  <a href="http://www.docker.io" target="_blank" rel="noopener">http://www.docker.io</a>  </li>
<li>安装GitLab及相关组件<br>GitLab需要用到数据库来存储相关数据，所以需要在安装GitLab的同时安装数据库，这里使用的是postgresql和redis。我在查找相关的镜像，之后发现有很多现成的镜像，这里我使用的sameersbn镜像。但是有一点我认为不是很好的是：这个镜像没有把redis、postgresql集成到gitlab的容器里面，需要先单独pull这两个镜像run一下，然后再pull gitlab的镜像进行安装。<br>使用如下命令分别拉取最新的镜像：<br>docker pull sameersbn/redis<br>docker pull sameersbn/postgresql<br>docker pull sameersbn/gitlab<br>这里有第一个坑：因为我们默认都是从docker的官方仓库中拉去镜像，但是由于国内访问国外的网站有墙，而且速度也是十分的慢，所以需要代理。这里推荐Daocloud加速器 <a href="https://www.daocloud.io/" target="_blank" rel="noopener">https://www.daocloud.io/</a> 免费使用，但是需要先注册，登录成功后，找到加速器执行相关命令即可。笔者亲测速度明显快很多！<br>使用如下命令运行postgresql镜像：  <figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run --name postgresql -d \  </span><br><span class="line">-e <span class="string">'DB_NAME=gitlabhq_production'</span> \  </span><br><span class="line">-e <span class="string">'DB_USER=gitlab'</span> \</span><br><span class="line">-e <span class="string">'DB_PASS=password'</span> \  </span><br><span class="line">-e <span class="string">'DB_EXTENSION=pg_trgm'</span> \  </span><br><span class="line">-v /home/root/opt/postgresql/<span class="symbol">data:</span>/var/<span class="class"><span class="keyword">lib</span>/<span class="title">postgresql</span> \  </span></span><br><span class="line">sameersbn/postgresql</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>这里需要解释的是：<br>(1). 以上是一条命令，反斜杠是为了在命令内换行方便阅读，如果不喜欢，也可以写在一行。<br>(2). -e后面跟的都是容器的环境参数，都是在制作镜像的时候指定好的，所以不要去改动。<br>(3). -v后面是添加数据卷，这样在容器退出的时候数据就不会丢失，其中 /home/root/opt/postgresql/data是作者自己创建的文件夹，读者可以自己自定义，后面的部分是容器内的文件路径，需要保持不变。<br>(4). 命令执行成功之后会在控制台显示一串容器的编号，可以使用命令docker ps查看刚刚启动的容器。  </p>
<p>使用如下命令运行redis镜像：  </p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run --name redis -d \  </span><br><span class="line">-v /home/root/opt/redis/<span class="symbol">data:</span>/var/<span class="class"><span class="keyword">lib</span>/<span class="title">redis</span> \  </span></span><br><span class="line">sameersbn/redis</span><br></pre></td></tr></table></figure>

<p>这里跟启动postgresql一样。<br>使用如下命令运行GitLab镜像：</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">docker run --name gitlab -d <span class="string">\</span></span><br><span class="line">--link postgresql:postgresql --link redis:redisio <span class="string">\</span></span><br><span class="line">-p <span class="number">10022</span>:<span class="number">22</span> -p <span class="number">10080</span>:<span class="number">80</span> <span class="string">\</span></span><br><span class="line">-e <span class="string">'GITLAB_PORT=10080'</span> <span class="string">\</span></span><br><span class="line">-e <span class="string">'GITLAB_SSH_PORT=10022'</span> <span class="string">\</span></span><br><span class="line">-e <span class="string">'GITLAB_SECRETS_DB_KEY_BASE=long-and-random-alpha-numeric-string'</span><span class="string">\</span></span><br><span class="line">-e <span class="string">'GITLAB_SECRETS_SECRET_KEY_BASE=long-and-random-alpha-numeric-string'</span> <span class="string">\</span></span><br><span class="line">-e <span class="string">'GITLAB_SECRETS_OTP_KEY_BASE=long-and-random-alpha-numeric-string'</span><span class="string">\</span></span><br><span class="line">-e <span class="string">'GITLAB_HOST=服务器地址'</span> <span class="string">\</span></span><br><span class="line">-e <span class="string">'GITLAB_EMAIL=邮箱地址'</span> <span class="string">\</span></span><br><span class="line">-e <span class="string">'SMTP_ENABLED=true'</span> <span class="string">\</span></span><br><span class="line">-e <span class="string">'SMTP_DOMAIN=www.sina.com'</span> <span class="string">\</span></span><br><span class="line">-e <span class="string">'SMTP_HOST=smtp.sina.com'</span> <span class="string">\</span> </span><br><span class="line">-e <span class="string">'SMTP_STARTTLS=false'</span>  <span class="string">\</span></span><br><span class="line">-e <span class="string">'SMTP_USER=邮箱地址'</span> <span class="string">\</span></span><br><span class="line">-e <span class="string">'SMTP_PASS=邮箱密码'</span> <span class="string">\</span></span><br><span class="line">-e <span class="string">'SMTP_AUTHENTICATION=login'</span> <span class="string">\</span></span><br><span class="line">-e <span class="string">'GITLAB_BACKUP_SCHEDULE=daily'</span> <span class="string">\</span></span><br><span class="line">-e <span class="string">'GITLAB_BACKUP_TIME=10:30'</span> <span class="string">\</span></span><br><span class="line">-v /home/root/opt/gitlab/data:/home/git/data <span class="string">\</span></span><br><span class="line">sameersbn/gitlab</span><br></pre></td></tr></table></figure>

<p>这里需要解释的是：<br>(1). 网上又很多教程讲关于使用docker安装GitLab，但是讲的不全面，至少我按照他们的方法安装时不能正常运行，这里是第三个坑：一定要加上如下环境参数：</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-e 'GITLAB_SECRETS_DB_KEY_BASE=long-<span class="keyword">and</span>-<span class="built_in">random</span>-alpha-numeric-<span class="built_in">string</span>'\</span><br><span class="line">-e 'GITLAB_SECRETS_SECRET_KEY_BASE=long-<span class="keyword">and</span>-<span class="built_in">random</span>-alpha-numeric-<span class="built_in">string</span>' \</span><br><span class="line">-e 'GITLAB_SECRETS_OTP_KEY_BASE=long-<span class="keyword">and</span>-<span class="built_in">random</span>-alpha-numeric-<span class="built_in">string</span>'\</span><br></pre></td></tr></table></figure>

<p>有关于这三个环境参数的含义：</p>
<p>官方的解释 </p>
<p>我个人的理解是用来进行加密的key。<br>(2). 上面有关SMTP的环境参数是配置邮箱的，需要填上对应的邮箱信息，我使用的是新浪邮箱，读者可以根据自己的邮箱进行填写。<br>(3). 使用GitLab需要两个端口，一个是web端口，一个是SSH端口用于push代码的所以一下代码进行端口映射和指定：</p>
<p>-p 10022:22 -p 10080:80 <br>-e ‘GITLAB_PORT=10080’ <br>-e ‘GITLAB_SSH_PORT=10022’ <br>(4). GitLab有自带的备份，这里可以通过如下进行配置：<br>-e ‘GITLAB_BACKUP_SCHEDULE=daily’ <br>-e ‘GITLAB_BACKUP_TIME=10:30’ <br>指定的是每天10:30进行备份。<br>说到这里基本上GitLab就搭建好了，这里还有一个小坑就是：运行这些容器的时候可以把代码写进shell脚本中，然后通过脚本进行运行，不然直接在终端打的话很麻烦。<br>一下就是笔者安装完后的截图，直接访问：http://服务器地址:10080 即可，首次访问可能会出现错误页面，刷新几下页面就可以了然后在修改密码默认用户名：root 之后就可以正常使用。</p>
<p>登录界面 </p>
<p>group </p>
<p>admin area<br>四. 备份<br>我们可以使用GitLab自带的备份功能，在启动容器的时候就进行设置，然后再使用GitLab的 app:rake gitlab:backup:restore命令进行恢复，这里网上的教程都有说明可以参考以下网站：<br>sameersbn的GitHub wiki：<br><a href="https://github.com/sameersbn/docker-gitlab#automated-backups" target="_blank" rel="noopener">https://github.com/sameersbn/docker-gitlab#automated-backups</a><br>这个是官方的所以比较全面，里面还有关于各种环境参数的介绍。<br>这里作者使用的是如下的备份方法：<br>因为我们在运行postgresql、redis和GitLab的时候都使用了本地的文件夹进行了数据的持久化，而且我们实际需要备份的数据都在本地了，那么其实就可以直接使用rsync命令备份本地的这些卷（刚刚的文件夹）即可，无需再去深入到GitLab内部。如果搭建的GitLab崩溃了，或者服务器崩溃了，直接再使用docker再搭一个，在把刚刚的卷跟对应的postgresql、redis和GitLab内的数据文件夹进行映射即可。这是也不需要修改之前的启动命令，十分的方便而且作者自己测试过，发现能够达到要求，原先的仓库、用户的SSH信息等都在。</p>
<p>修改100.230 /data/gitlab_875/config/gitlab.rb (docker gitlab875 /etc/gitlab/gitlab.rb)<br>增加:  </p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">gitlab_rails[<span class="string">'smtp_enable'</span>] = true</span><br><span class="line">#gitlab_rails[<span class="string">'smtp_address'</span>] = <span class="string">"smtp.domain.cn"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_address'</span>] = <span class="string">"12.34.56.78"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_port'</span>] = <span class="number">25</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_user_name'</span>] = <span class="string">"gitlabadmin@domain.cn"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_password'</span>] = <span class="string">"yourpassword"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_domain'</span>] = <span class="string">"smtp.domain.cn"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_authentication'</span>] = <span class="string">"login"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_enable_starttls_auto'</span>] = true</span><br><span class="line">gitlab_rails[<span class="string">'smtp_tls'</span>] = false</span><br><span class="line">gitlab_rails[<span class="string">'smtp_openssl_verify_mode'</span>] = <span class="string">'none'</span></span><br><span class="line"></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_enabled'</span>] = true</span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_from'</span>] = <span class="string">'gitlabadmin@domain.cn'</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_display_name'</span>] = <span class="string">'gitlabadmin'</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_reply_to'</span>] = <span class="string">'gitlabadmin@domain.cn'</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_subject_suffix'</span>] = <span class="string">''</span></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/07/16/docker-gitlab/" data-id="ckbdc9utr007c24u244judvgo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DOCKER/">DOCKER</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GITLAB/">GITLAB</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-springboot-login" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/16/springboot-login/" class="article-date">
  <time datetime="2019-07-16T16:27:00.000Z" itemprop="datePublished">2019-07-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/16/springboot-login/">springboot login</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>springboot系列（一）：初次使用与登录验证实现</p>
<p>听说过很多springboot如何流行，以及如何简化了我们的应用开发，却没有真正使用过springboot，现在终于要动手了！打算自己动手的这个项目，结果不会是促成某个真正的项目，学习为主，把学习过程分享出来。开篇探索以以下两个方面为主：<br>1、从mvc经典框架到springboot<br>2、最原始的方式实现登录验证<br>一、建一个使用springboot的项目<br>springboot是建立在的spring生态的基础上的，以前看spring的时候，有两大概念是纠结了很久的，IOC（控制反转）以及AOP（面向切面的编程）。其实控制反转就是依赖注入，spring提供了一个IOC容器来初始化对象，解决对象间依赖管理和对象的使用，如@Bean、@Autowired等可以实现依赖注入，AOP目前理解是在一些日志框架场景中用到。<br>平时我们常见的web项目开发，使用的mvc框架、maven管理在springboot依然使用到，springboot最明显的好处是简化了新建一个项目时的各种配置过程，就连tomcat都不用配置了。可以看到我新建一个maven项目大目录结构是这样的</p>
<p>跟着上图目录结构，我们来看看springboot是如何完成一个普通的web项目所需要做的事的<br>a.web容器：springboot内嵌了Tomcat,我们不需要手动配置tomcat以及以war包形式部署项目，启动入口为目录中App.java中的main函数，直接运行即可。</p>
<p>@SpringBootApplication<br>public class App {<br>public static void main(String[] args) {<br>SpringApplication.run(App.class,args);<br>}
}</p>
<p>b.依赖管理:spring提供了一系列的starter pom来简化Maven的依赖加载，如一个web项目pom.xm部分配置如下：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="keyword">lt</span>;parent&amp;<span class="keyword">gt</span>;</span><br><span class="line">     &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">     &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-boot-starter-parent&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">     &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">1.4</span>.<span class="number">3</span>.RELEASE&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;</span><br><span class="line"> &amp;<span class="keyword">lt</span>;/parent&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line"> &amp;<span class="keyword">lt</span>;dependencies&amp;<span class="keyword">gt</span>;</span><br><span class="line">     &amp;<span class="keyword">lt</span>;!--Spring Boot的核心启动器，包含了自动配置、日志和YAML--&amp;<span class="keyword">gt</span>;</span><br><span class="line">     &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">            &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-boot-starter&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">     &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line">     &amp;<span class="keyword">lt</span>;!--支持全栈式Web开发，包括Tomcat和spring-webmvc--&amp;<span class="keyword">gt</span>;</span><br><span class="line">     &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line">         &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">         &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-boot-starter-web&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;</span><br><span class="line">     &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;</span><br><span class="line"></span><br><span class="line"> &amp;<span class="keyword">lt</span>;/dependencies&amp;<span class="keyword">gt</span>;</span><br></pre></td></tr></table></figure>

<p>c.配置管理：目录中src/main/resource/application.properties为配置文件，springboot可以自动读取，或者使用java配置可以看到没有web.xml，没有spring相关的配置文件，整个项目看起来非常的简洁。</p>
<p>#数据库配置<br>spring.datasource.url=jdbc:mysql://localhost:3306/world?characterEncoding=UTF-8&amp;useUnicode=true<br>spring.datasource.username=darren<br>spring.datasource.password=darren123<br>spring.datasource.driver-class-name=com.mysql.jdbc.Driver<br>spring.jpa.properties.hibernate.hbm2ddl.auto=update<br>一个springboot web项目大概就包含这些 </p>
<p>二、原始方式实现登录验证<br>流程为：登录页面发起请求–&gt;拦截器拦截匹配的url判断session–&gt;后台验证/设置session–&gt;返回<br>a、这里主要通过自定义拦截器的方式，继承WebMvcConfigurerAdapter和HandlerInterceptorAdapter来实现拦截器对登录请求进行拦截和session的判断，我这里都写在WebSecurityConfig.java中<br>其中WebMvcConfigurerAdapter是Spring提供的基础类，可以通过重写 addInterceptors 方法添加注册拦截器来组成一个拦截链，以及用于添加拦截规则和排除不用的拦截，如下：</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public void  addInterceptors(InterceptorRegistry registry)&#123;</span><br><span class="line">    InterceptorRegistration addInterceptor = registry.addInterceptor(getSecurityInterceptor())<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">    addInterceptor.excludePathPatterns(<span class="string">"/error"</span>)<span class="comment">;</span></span><br><span class="line">    addInterceptor.excludePathPatterns(<span class="string">"/login**"</span>)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">    addInterceptor.addPathPatterns(<span class="string">"/**"</span>)<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中HandlerInterceptorAdapter是spring mvc提供的适配器，继承此类，可以非常方便的实现自己的拦截器，它有三个方法：preHandle、postHandle、afterCompletion。preHandle在业务处理器处理请求之前被调用。预处理，可以进行编码、安全控制等处理；postHandle在业务处理器处理请求执行完成后，生成视图之前执行。afterCompletion在DispatcherServlet完全处理完请求后被调用，可用于清理资源等。我项目中只重写了preHandle,对请求进行session判断和跳转到自定义的页面，如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityInterceptor</span> <span class="keyword">extends</span> <span class="title">HandlerInterceptorAdapter</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        public boolean preHandle(<span class="type">HttpServletRequest</span> request, <span class="type">HttpServletResponse</span> response,<span class="type">Object</span> handler) <span class="keyword">throws</span> <span class="type">IOException</span> &#123;</span><br><span class="line">            <span class="type">HttpSession</span> session = request.getSession();</span><br><span class="line">            </span><br><span class="line"><span class="comment">//            判断是否已有该用户登录的session</span></span><br><span class="line">            <span class="keyword">if</span>(session.getAttribute(<span class="type">SESSION_KEY</span>) != <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//            跳转到登录页</span></span><br><span class="line">            <span class="type">String</span> url = <span class="string">"/login"</span>;</span><br><span class="line">            response.sendRedirect(url);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>b.controller中对登录请求进行验证以及页面的跳转，如下 </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoginService loginService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(<span class="meta-string">"/"</span>)</span></span><br><span class="line">    <span class="keyword">public</span> String index(<span class="meta">@SessionAttribute(WebSecurityConfig.SESSION_KEY)</span>String account,Model model)&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(<span class="meta-string">"/login"</span>)</span></span><br><span class="line">    <span class="keyword">public</span> String login()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(<span class="meta-string">"/loginVerify"</span>)</span></span><br><span class="line">    <span class="keyword">public</span> String loginVerify(String username,String password,HttpSession session)&#123;</span><br><span class="line">        User user = new User();</span><br><span class="line">        user.setUsername(username);</span><br><span class="line">        user.setPassword(password);</span><br><span class="line"></span><br><span class="line">        boolean verify = loginService.verifyLogin(user);</span><br><span class="line">        <span class="keyword">if</span> (verify) &#123;</span><br><span class="line">            session.setAttribute(WebSecurityConfig.SESSION_KEY, username);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"redirect:/login"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(<span class="meta-string">"/logout"</span>)</span></span><br><span class="line">    <span class="keyword">public</span> String logout(HttpSession session)&#123;</span><br><span class="line">        session.removeAttribute(WebSecurityConfig.SESSION_KEY);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:/login"</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>controller代码解释：loginVerify是对登录请求到数据库中进行验证用户名和密码，验证通过以后设置session，否则跳转到登录页面。@GetMapping是一个组合注解，是@RequestMapping(method = RequestMethod.GET)的缩写,@PostMapping同理。 </p>
<p>ps:实际项目登录验证会使用登录验证框架：spring security 、shiro等，以及登录过程密码加密传输保存等，这里仅仅用于了解。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/07/16/springboot-login/" data-id="ckbdc9uvs00d824u2o9p5c0r5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LOGIN/">LOGIN</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SPRINGBOOT/">SPRINGBOOT</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-idea-springboot-autowired-show-redunderline" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/16/idea-springboot-autowired-show-redunderline/" class="article-date">
  <time datetime="2019-07-16T02:30:00.000Z" itemprop="datePublished">2019-07-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/16/idea-springboot-autowired-show-redunderline/">idea springboot autowired hide red underline</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>SpringBoot：Dao层mapper注入报红问题</p>
<p>在mapper接口上加上</p>
<p>@Component注解<br>例如:</p>
<pre><code>import com.example.sptingboot_mybatis.model.User;
import org.apache.ibatis.annotations.Mapper;
import org.springframework.stereotype.Component;

import java.util.List;

@Mapper
@Component(&quot;IUser&quot;)
public interface IUser {
   List&amp;lt;User&amp;gt; findAll();
}</code></pre><p>就可以解决问题</p>
<p>原文链接：<a href="https://blog.csdn.net/Sir_He/article/details/81879854" target="_blank" rel="noopener">https://blog.csdn.net/Sir_He/article/details/81879854</a> </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/07/16/idea-springboot-autowired-show-redunderline/" data-id="ckbdc9uuf009924u2bgzishpn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IDEA/">IDEA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MYBATIS/">MYBATIS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-auto" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/16/auto/" class="article-date">
  <time datetime="2019-07-16T01:44:00.000Z" itemprop="datePublished">2019-07-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/16/auto/">@Autowired @Resource @Qualifier的区别</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>@Autowired @Resource @Qualifier的区别<br>spring不但支持自己定义的@Autowired注解，还支持几个由JSR-250规范定义的注解，它们分别是@Resource、@PostConstruct以及@PreDestroy。  </p>
<p>@Resource的作用相当于@Autowired，只不过@Autowired按byType自动注入，而@Resource默认按 byName自动注入罢了。@Resource有两个属性是比较重要的，分是name和type，Spring将@Resource注解的name属性解析为bean的名字，而type属性则解析为bean的类型。所以如果使用name属性，则使用byName的自动注入策略，而使用type属性时则使用byType自动注入策略。如果既不指定name也不指定type属性，这时将通过反射机制使用byName自动注入策略。  </p>
<p>@Resource装配顺序<br>　　1. 如果同时指定了name和type，则从Spring上下文中找到唯一匹配的bean进行装配，找不到则抛出异常<br>　　2. 如果指定了name，则从上下文中查找名称（id）匹配的bean进行装配，找不到则抛出异常<br>　　3. 如果指定了type，则从上下文中找到类型匹配的唯一bean进行装配，找不到或者找到多个，都会抛出异常<br>　　4. 如果既没有指定name，又没有指定type，则自动按照byName方式进行装配；如果没有匹配，则回退为一个原始类型进行匹配，如果匹配则自动装配；  </p>
<p>@Autowired 与@Resource的区别：  </p>
<ul>
<li><p>1、 @Autowired与@Resource都可以用来装配bean. 都可以写在字段上,或写在setter方法上。</p>
</li>
<li><p>2、 @Autowired默认按类型装配（这个注解是属业spring的），默认情况下必须要求依赖对象必须存在，如果要允许null值，可以设置它的required属性为false，如：@Autowired(required=false) ，如果我们想使用名称装配可以结合@Qualifier注解进行使用，如下：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Autowired</span>()</span><br><span class="line"><span class="variable">@Qualifier</span>(<span class="string">"baseDao"</span>)</span><br><span class="line">privateBaseDao baseDao;</span><br></pre></td></tr></table></figure>
</li>
<li><p>3、@Resource（这个注解属于J2EE的），默认按照名称进行装配，名称可以通过name属性进行指定，如果没有指定name属性，当注解写在字段上时，默认取字段名进行安装名称查找，如果注解写在setter方法上默认取属性名进行装配。当找不到与名称匹配的bean时才按照类型进行装配。但是需要注意的是，如果name属性一旦指定，就只会按照名称进行装配。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">Resource</span>(<span class="keyword">name</span>="<span class="keyword">baseDao</span>")</span><br><span class="line"><span class="keyword">privateBaseDao</span> baseDao;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>推荐使用：@Resource注解在字段上，这样就不用写setter方法了，并且这个注解是属于J2EE的，减少了与spring的耦合。这样代码看起就比较优雅。</p>
<p>spring @Qualifier注解</p>
<p>@Autowired是根据类型进行自动装配的。如果当Spring上下文中存在不止一个UserDao类型的bean时，就会抛出BeanCreationException异常;如果Spring上下文中不存在UserDao类型的bean，也会抛出BeanCreationException异常。我们可以使用@Qualifier配合@Autowired来解决这些问题。如下：<br>①可能存在多个UserDao实例<br> <figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Autowired</span>   </span><br><span class="line"><span class="variable">@Qualifier</span>(<span class="string">"userServiceImpl"</span>)   </span><br><span class="line">public IUserService userService;</span><br></pre></td></tr></table></figure></p>
<p>或者</p>
 <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span>   </span><br><span class="line"><span class="keyword">public</span> void setUserDao(<span class="meta">@Qualifier(<span class="meta-string">"userDao"</span>)</span> UserDao userDao) &#123;   </span><br><span class="line">    <span class="keyword">this</span>.userDao = userDao;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样Spring会找到id为userServiceImpl和userDao的bean进行装配。</p>
<p>②可能不存在UserDao实例<br>  <figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span>(required = <span class="keyword">false</span>)   </span><br><span class="line"><span class="keyword">public</span> IUserService userService</span><br></pre></td></tr></table></figure></p>
<table>
<thead>
<tr>
<th align="left">个人总结：</th>
</tr>
</thead>
<tbody><tr>
<td align="left">@Autowired//默认按type注入</td>
</tr>
<tr>
<td align="left">@Qualifier(“cusInfoService”)//一般作为@Autowired()的修饰用</td>
</tr>
<tr>
<td align="left">@Resource(name=”cusInfoService”)//默认按name注入，可以通过name和type属性进行选择性注入不属于spring</td>
</tr>
<tr>
<td align="left">一般@Autowired和@Qualifier一起用，@Resource单独用。</td>
</tr>
<tr>
<td align="left">当然没有冲突的话@Autowired也可以单独用</td>
</tr>
</tbody></table>
<h5 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h5><p>–定义Bean的注解</p>
<p>@Controller<br>@Controller(“Bean的名称”)<br>定义控制层Bean,如Action  </p>
<p>@Service<br>@Service(“Bean的名称”)<br>定义业务层Bean  </p>
<p>@Repository<br>@Repository(“Bean的名称”)<br>定义DAO层Bean  </p>
<p>@Component<br>定义Bean, 不好归类时使用.  </p>
<p>–自动装配Bean （选用一种注解就可以）<br>@Autowired  (Srping提供的)<br>默认按类型匹配,自动装配(Srping提供的)，可以写在成员属性上,或写在setter方法上  </p>
<p>@Autowired(required=true)<br>一定要找到匹配的Bean，否则抛异常。 默认值就是true   </p>
<p>@Autowired<br>@Qualifier(“bean的名字”)<br>按名称装配Bean,与@Autowired组合使用，解决按类型匹配找到多个Bean问题。  </p>
<p>@Resource   JSR-250提供的<br>默认按名称装配,当找不到名称匹配的bean再按类型装配.<br>可以写在成员属性上,或写在setter方法上<br>可以通过@Resource(name=”beanName”) 指定被注入的bean的名称, 要是未指定name属性, 默认使用成员属性的变量名,一般不用写name属性.<br>@Resource(name=”beanName”)指定了name属性,按名称注入但没找到bean, 就不会再按类型装配了.  </p>
<p>@Inject   是JSR-330提供的<br>按类型装配，功能比@Autowired少，没有使用的必要。  </p>
<p>–定义Bean的作用域和生命过程<br>@Scope(“prototype”)<br>值有:singleton,prototype,session,request,session,globalSession  </p>
<p>@PostConstruct<br>相当于init-method,使用在方法上，当Bean初始化时执行。  </p>
<p>@PreDestroy<br>相当于destory-method，使用在方法上，当Bean销毁时执行。  </p>
<p>–声明式事务<br>@Transactional<br>@Autowired @Resource @Qualifier的区别<br>实用理解：@Autowired @Resource 二选其一，看中哪个就用哪个。  </p>
<p>简单理解：<br>@Autowired 根据类型注入，<br>@Resource 默认根据名字注入，其次按照类型搜索<br>@Autowired @Qualifie(“userService”) 两个结合起来可以根据名字和类型注入  </p>
<p>复杂理解：<br>比如你有这么一个Bean<br>@Service(“UserService”)<br>public Class UserServiceImpl implements UserService｛｝;<br>现在你想在UserController 里面使用这个UserServiceImpl<br>public Class UserController ｛<br>@AutoWired   //当使用这个注入的时候上面的 UserServiceImpl 只需要这样写 @Service，这样就会自动找到UserService这个类型以及他的子类型。UserServiceImpl 实现了UserService，所以能够找到它。不过这样有一个缺点，就是当UserService实现类有两个以上的时候，这个时候会找哪一个呢，这就造成了冲突，所以要用@AutoWire注入的时候要确保UserService只有一个实现类。<br>@Resource 默认情况下是按照名称进行匹配，如果没有找到相同名称的Bean，则会按照类型进行匹配，有人可能会想了，这下好了，用这个是万能的了，不用管名字了，也不用管类型了，但这里还是有缺点。首先，根据这个注解的匹配效果可以看出，它进行了两次匹配，也就是说，如果你在UserService这个类上面这样写注解，@Service,它会怎么找呢，首先是找相同名字的，如果没有找到，再找相同类型的，而这里的@Service没有写名字，这个时候就进行了两次搜索，显然，速度就下降了许多。也许你还会问，这里的@Service本来就没有名字，肯定是直接进行类型搜索啊。其实不是这样的，UserServiceImpl 上面如果有@Service默认的名字 是这个userServiceImpl，注意看，就是把类名前面的大写变成小写，就是默认的Bean的名字了。 @Resource根据名字搜索是这样写@Resource(“userService”)，如果你写了这个名字叫userService，那么UserServiceImpl上面必须也是这个名字，不然还是会报错。  </p>
<p>@Autowired @Qualifie(“userService”) 是直接按照名字进行搜索，也就是说，对于UserServiceImpl 上面@Service注解必须写名字，不写就会报错，而且名字必须是@Autowired @Qualifie(“userService”) 保持一致。如果@Service上面写了名字，而@Autowired @Qualifie() ，一样会报错。</p>
<p>private UserService userService;</p>
<p>｝  
说了这么多，可能你有些说晕了，那么怎么用这三个呢，要实际的工作是根据实际情况来使用的，通常使用AutoWire和@Resource多一些，bean的名字不用写，而UserServiceImpl上面能会这样写 @Service(“userService”)。这里的实际工作情况，到底是什么情况呢？说白了就是整个项目设计时候考虑的情况，<br>如果你的架构设计师考虑的比较精细，要求比较严格，要求项目上线后的访问速度比较好，通常是考虑速度了。这个时候@AutoWire没有@Resource好用，因为@Resource可以根据名字来搜索，是这样写的@Resource(“userService”)。这个@Autowired @Qualifie(“userService”) 也可以用名字啊，为什么不用呢，原因很简单，这个有点长，不喜欢，增加工作量。因为根据名字搜索是最快的，就好像查数据库一样，根据Id查找最快。因为这里的名字与数据库里面的ID是一样的作用。这个时候，就要求你多写几个名字，工作量自然就增加了。而如果你不用注解，用xml文件的时候，对于注入Bean的时候要求写一个Id，xml文件时候的id就相当于这里的名字。</p>
<p>说了那么多没用，你能做的就是简单直接，什么最方便就用什么，<br>你就直接用@Resource得了，如果你喜欢用@AutoWired也行，不用写名字。</p>
<p>通常情况一个Bean的注解写错了，会报下面这些错误，最为常见，<br>No bean named ‘user’ is defined，这个表示没有找到被命名为user的Bean，通俗的说，就是名字为user的类型，以及它的子类型，出现这个错误的原因就是注入时候的类型名字为user，而搜索的时候找不到，也就是说可能那个搜索的类型，并没有命令为user，解决办法就是找到这个类型，去命令为user，</p>
<p>下面这个错误也常见，<br>No qualifying bean of type [com.service.UserService] found for dependency:<br>这个错误的原因就是类型上面没有加@Service这个注入，不仅仅是@Service，如果是其他层也会出现这个错误，这里我是以Service为例子说明，如果是DAO层就是没有加@Repository，Controller层，则是没有加@Controller。<br>还有，如果你还是想再简单点，无论是DAO,Controller，Service三个层，都可以用这个注解，@Component，这个注解通用所有的Bean，这个时候你可能会说了，有通常的为什么用的人少呢，那是因为MVC这个分层的设计原则，用@Repository,@Service，@Controller，这个可以区别MVC原则中的DAO,Service，Controller。便于识别。</p>
<p>博客2：<br>springautowiredqualifierbytypebyname<br>　在使用Spring框架中@Autowired标签时默认情况下使用<br>Java代码<br>@Autowired<br> @Autowired<br>注释进行自动注入时，Spring 容器中匹配的候选 Bean 数目必须有且仅有一个。当找不到一个匹配的 Bean 时，Spring 容器将抛出 BeanCreationException 异常，并指出必须至少拥有一个匹配的 Bean。<br>@Autowired 默认是按照byType进行注入的，如果发现找到多个bean，则，又按照byName方式比对，如果还有多个，则报出异常。<br>例子：<br>@Autowired<br>private ExamUserMapper examUserMapper;  - ExamUserMapper是一个接口</p>
<ol>
<li>spring先找类型为ExamUserMapper的bean</li>
<li>如果存在且唯一，则OK；</li>
<li>如果不唯一，在结果集里，寻找name为examUserMapper的bean。因为bean的name有唯一性，所以，到这里应该能确定是否存在满足要求的bean了</li>
</ol>
<p>@Autowired也可以手动指定按照byName方式注入，使用@Qualifier标签，例如：<br>@Autowired () @Qualifier ( “baseDao” )</p>
<p>　　Spring 允许我们通过<br>Java代码<br>@Qualifier<br>@Qualifier<br>注释指定注入 Bean 的名称，这样歧义就消除了，可以通过下面的方法解决异常。 </p>
<p>　　<br>Java代码<br>@Qualifier(“XXX”)<br>@Qualifier(“XXX”)<br>中的 XX是 Bean 的名称，所以 @Autowired 和 @Qualifier 结合使用时，自动注入的策略就从 byType 转变成 byName 了。 </p>
<p>　　@Autowired 可以对成员变量、方法以及构造函数进行注释，而 @Qualifier 的标注对象是成员变量、方法入参、构造函数入参。 </p>
<pre><code>Spring不但支持自己定义的@Autowired注解，还支持几个由JSR-250规范定义的注解，它们分别是@Resource、@PostConstruct以及@PreDestroy。 </code></pre><p>　　<br>Java代码<br>@Resource<br>@Resource<br>的作用相当于@Autowired，只不过@Autowired按byType自动注入，而@Resource默认按 byName自动注入罢了。@Resource有两个属性是比较重要的，分是name和type，Spring将@Resource注解的name属性解析为bean的名字，而type属性则解析为bean的类型。所以如果使用name属性，则使用byName的自动注入策略，而使用type属性时则使用byType自动注入策略。如果既不指定name也不指定type属性，这时将通过反射机制使用byName自动注入策略。 </p>
<p>　　@Resource装配顺序<br>　　1. 如果同时指定了name和type，则从Spring上下文中找到唯一匹配的bean进行装配，找不到则抛出异常<br>　　2. 如果指定了name，则从上下文中查找名称（id）匹配的bean进行装配，找不到则抛出异常<br>　　3. 如果指定了type，则从上下文中找到类型匹配的唯一bean进行装配，找不到或者找到多个，都会抛出异常<br>　　4. 如果既没有指定name，又没有指定type，则自动按照byName方式进行装配；如果没有匹配，则回退为一个原始类型进行匹配，如果匹配则自动装配 </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/07/16/auto/" data-id="ckbdc9uzj00mv24u2cqlbuo9v" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ANNOTATION/">ANNOTATION</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SPRINGBOOT/">SPRINGBOOT</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hexo-show-imgs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/16/hexo-show-imgs/" class="article-date">
  <time datetime="2019-07-16T00:39:00.000Z" itemprop="datePublished">2019-07-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/16/hexo-show-imgs/">hexo show imgs</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Hexo快速发布博文及插入图片  </p>
<p>md文件放在hexo网站所在位置下的source_posts目录，这个目录下存储了很多个md文件，每个文件对应着一篇博客。<br>在博客站点文件夹输入：hexo g，生成静态页面，<br>再输入：hexo server，到localhost:4000预览博客效果，<br>最后输入：hexo d，部署；<br>第四步可简单输入命令：hexo d -g<br>解决利用csdn发布博客图片不显示的问题<br>1、 将主页配置文件_config.yml 里的post_asset_folder:这个选项设置为true；<br>2、在hexo目录下执行npm install hexo-asset-image –save，这是下载安装一个可以上传本地图片的插件；<br>3、稍等片刻，再运行hexo n “xxxx”来生成md博文时，/source/_posts文件夹内除了xxxx.md文件还有一个同名的文件夹<br>4、 在xxxx.md中想引入图片时，先把图片复制到xxxx这个文件夹中，然后只需要在xxxx.md中按照markdown的格式引入图片：<br><code>![这里输入图片描述](/xxxx/图片名.jpg)</code></p>
<p><strong>注意： 此处xxxx代表的是新建博文md文件的名字，也是同名文件夹的名字</strong>  </p>
<p><img src="/images/sf.png" alt><br>如下图： &nbsp;<br>具体引入路径如下：<br>/Hexo快速发布博文及插入图片/图片显示问题.png</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/07/16/hexo-show-imgs/" data-id="ckbdc9uuc009224u2mjkpz7oo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HEXO/">HEXO</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-custom-annotation" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/15/custom-annotation/" class="article-date">
  <time datetime="2019-07-15T23:37:00.000Z" itemprop="datePublished">2019-07-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/15/custom-annotation/">custom annotation</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>自定义注解详细介绍  </p>
<p>1 注解的概念 &nbsp;<br>1.1 注解的官方定义 </p>
<p>首先看看官方对注解的描述： </p>
<p>An annotation is a form of metadata, that can be added to Java source code. Classes, methods, variables, parameters and packages may be annotated. Annotations have no direct effect on the operation of the code they annotate.</p>
<p>翻译：  </p>
<p>注解是一种能被添加到java代码中的元数据，类、方法、变量、参数和包都可以用注解来修饰。注解对于它所修饰的代码并没有直接的影响。</p>
<p>通过官方描述得出以下结论：</p>
<p>注解是一种元数据形式。即注解是属于java的一种数据类型，和类、接口、数组、枚举类似。<br>注解用来修饰，类、方法、变量、参数、包。<br>注解不会对所修饰的代码产生直接的影响。</p>
<p>1.2 注解的使用范围<br>继续看看官方对它的使用范围的描述：</p>
<p>Annotations have a number of uses, among them:Information for the complier - Annotations can be used by the compiler to detect errors or suppress warnings.Compiler-time and deployment-time processing - Software tools can process annotation information to generate code, XML files, and so forth.Runtime processing - Some annotations are available to be examined at runtime.</p>
<p>翻译：</p>
<p>注解又许多用法，其中有：为编译器提供信息 - 注解能被编译器检测到错误或抑制警告。编译时和部署时的处理 - 软件工具能处理注解信息从而生成代码，XML文件等等。运行时的处理 - 有些注解在运行时能被检测到。</p>
<p>2 如何自定义注解<br>基于上一节，已对注解有了一个基本的认识：注解其实就是一种标记，可以在程序代码中的关键节点（类、方法、变量、参数、包）上打上这些标记，然后程序在编译时或运行时可以检测到这些标记从而执行一些特殊操作。因此可以得出自定义注解使用的基本流程：</p>
<p>第一步，定义注解——相当于定义标记；<br>第二步，配置注解——把标记打在需要用到的程序代码中；<br>第三步，解析注解——在编译期或运行时检测到标记，并进行特殊操作。  </p>
<p>2.1 基本语法<br>注解类型的声明部分：<br>注解在Java中，与类、接口、枚举类似，因此其声明语法基本一致，只是所使用的关键字有所不同@interface。在底层实现上，所有定义的注解都会自动继承  </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">java</span><span class="selector-class">.lang</span><span class="selector-class">.annotation</span><span class="selector-class">.Annotation</span>接口。</span><br><span class="line"><span class="selector-tag">public</span> @<span class="keyword">interface</span> CherryAnnotation &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注解类型的实现部分：<br>根据我们在自定义类的经验，在类的实现部分无非就是书写构造、属性或方法。但是，在自定义注解中，其实现部分只能定义一个东西：注解类型元素（annotation type element）。咱们来看看其语法：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> @<span class="keyword">interface</span> <span class="title">CherryAnnotation</span> &#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">name</span>(<span class="params"></span>)</span>;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">age</span>(<span class="params"></span>)</span>;</span><br><span class="line">	<span class="function"><span class="keyword">int</span>[] <span class="title">array</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也许你会认为这不就是接口中定义抽象方法的语法嘛？别着急，咱们看看下面这个：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> @<span class="keyword">interface</span> <span class="title">CherryAnnotation</span> &#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">name</span>(<span class="params"></span>)</span>;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">age</span>(<span class="params"></span>) <span class="keyword">default</span> 18</span>;</span><br><span class="line">	<span class="function"><span class="keyword">int</span>[] <span class="title">array</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看到关键字default了吗？还觉得是抽象方法吗？<br>注解里面定义的是：注解类型元素！<br>定义注解类型元素时需要注意如下几点：</p>
<p>访问修饰符必须为public，不写默认为public；<br>该元素的类型只能是基本数据类型、String、Class、枚举类型、注解类型（体现了注解的嵌套效果）以及上述类型的一位数组；<br>该元素的名称一般定义为名词，如果注解中只有一个元素，请把名字起为value（后面使用会带来便利操作）；<br>()不是定义方法参数的地方，也不能在括号中定义任何参数，仅仅只是一个特殊的语法；<br>default代表默认值，值必须和第2点定义的类型一致；<br>如果没有默认值，代表后续使用注解时必须给该类型元素赋值。  </p>
<p>可以看出，注解类型元素的语法非常奇怪，即又有属性的特征（可以赋值）,又有方法的特征（打上了一对括号）。但是这么设计是有道理的，我们在后面的章节中可以看到：注解在定义好了以后，使用的时候操作元素类型像在操作属性，解析的时候操作元素类型像在操作方法。<br>2.2 常用的元注解<br>一个最最基本的注解定义就只包括了上面的两部分内容：1、注解的名字；2、注解包含的类型元素。但是，我们在使用JDK自带注解的时候发现，有些注解只能写在方法上面（比如@Override）；有些却可以写在类的上面（比如@Deprecated）。当然除此以外还有很多细节性的定义，那么这些定义该如何做呢？接下来就该元注解出场了！<br>元注解：专门修饰注解的注解。它们都是为了更好的设计自定义注解的细节而专门设计的。我们为大家一个个来做介绍。<br>2.2.1 @Target<br>@Target注解，是专门用来限定某个自定义注解能够被应用在哪些Java元素上面的。它使用一个枚举类型定义如下：  </p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">enum</span> <span class="title">ElementType</span> &#123;</span></span><br><span class="line">    /** 类，接口（包括注解类型）或枚举的声明 *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">    TYPE,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    /</span>** 属性的声明 *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">    FIELD,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    /</span>** 方法的声明 *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">    METHOD,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    /</span>** 方法形式参数声明 *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">    PARAMETER,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    /</span>** 构造方法的声明 *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">    CONSTRUCTOR,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    /</span>** 局部变量声明 *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">    LOCAL_VARIABLE,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    /</span>** 注解类型声明 *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">    ANNOTATION_TYPE,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    /</span>** 包的声明 *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">    PACKAGE</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@CherryAnnotation被限定只能使用在类、接口或方法上面</span></span><br><span class="line"><span class="variable">@Target</span>(value = &#123;ElementType.TYPE,ElementType.METHOD&#125;)</span><br><span class="line">public <span class="variable">@interface</span> CherryAnnotation &#123;</span><br><span class="line">    <span class="selector-tag">String</span> <span class="selector-tag">name</span>();</span><br><span class="line">    <span class="selector-tag">int</span> <span class="selector-tag">age</span>() <span class="selector-tag">default</span> <span class="selector-tag">18</span>;</span><br><span class="line">    <span class="selector-tag">int</span><span class="selector-attr">[]</span> <span class="selector-tag">array</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.2.2 @Retention<br>@Retention注解，翻译为持久力、保持力。即用来修饰自定义注解的生命力。<br>注解的生命周期有三个阶段：1、Java源文件阶段；2、编译到class文件阶段；3、运行期阶段。同样使用了RetentionPolicy枚举类型定义了三个阶段：  </p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public enum RetentionPolicy &#123;</span><br><span class="line">    /**</span><br><span class="line">     * Annotations are <span class="keyword">to</span> be discarded <span class="keyword">by</span> <span class="keyword">the</span> compiler.</span><br><span class="line">     * （注解将被编译器忽略掉）</span><br><span class="line">     */</span><br><span class="line">    SOURCE,</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Annotations are <span class="keyword">to</span> be recorded <span class="keyword">in</span> <span class="keyword">the</span> <span class="built_in">class</span> <span class="built_in">file</span> <span class="keyword">by</span> <span class="keyword">the</span> compiler</span><br><span class="line">     * <span class="keyword">but</span> need <span class="keyword">not</span> be retained <span class="keyword">by</span> <span class="keyword">the</span> VM <span class="keyword">at</span> <span class="built_in">run</span> <span class="built_in">time</span>.  This <span class="keyword">is</span> <span class="keyword">the</span> default</span><br><span class="line">     * behavior.</span><br><span class="line">     * （注解将被编译器记录在<span class="built_in">class</span>文件中，但在运行时不会被虚拟机保留，这是一个默认的行为）</span><br><span class="line">     */</span><br><span class="line">    CLASS,</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Annotations are <span class="keyword">to</span> be recorded <span class="keyword">in</span> <span class="keyword">the</span> <span class="built_in">class</span> <span class="built_in">file</span> <span class="keyword">by</span> <span class="keyword">the</span> compiler <span class="keyword">and</span></span><br><span class="line">     * retained <span class="keyword">by</span> <span class="keyword">the</span> VM <span class="keyword">at</span> <span class="built_in">run</span> <span class="built_in">time</span>, so they may be <span class="built_in">read</span> reflectively.</span><br><span class="line">     * （注解将被编译器记录在<span class="built_in">class</span>文件中，而且在运行时会被虚拟机保留，因此它们能通过反射被读取到）</span><br><span class="line">     * @see java.lang.reflect.AnnotatedElement</span><br><span class="line">     */</span><br><span class="line">    RUNTIME</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们再详解一下：  </p>
<p>如果一个注解被定义为RetentionPolicy.SOURCE，则它将被限定在Java源文件中，那么这个注解即不会参与编译也不会在运行期起任何作用，这个注解就和一个注释是一样的效果，只能被阅读Java文件的人看到；<br>如果一个注解被定义为RetentionPolicy.CLASS，则它将被编译到Class文件中，那么编译器可以在编译时根据注解做一些处理动作，但是运行时JVM（Java虚拟机）会忽略它，我们在运行期也不能读取到；<br>如果一个注解被定义为RetentionPolicy.RUNTIME，那么这个注解可以在运行期的加载阶段被加载到Class对象中。那么在程序运行阶段，我们可以通过反射得到这个注解，并通过判断是否有这个注解或这个注解中属性的值，从而执行不同的程序代码段。我们实际开发中的自定义注解几乎都是使用的RetentionPolicy.RUNTIME；<br>在默认的情况下，自定义注解是使用的RetentionPolicy.CLASS。  </p>
<p>2.2.3 @Documented<br>@Documented注解，是被用来指定自定义注解是否能随着被定义的java文件生成到JavaDoc文档当中。<br>2.2.4 @Inherited<br>@Inherited注解，是指定某个自定义注解如果写在了父类的声明部分，那么子类的声明部分也能自动拥有该注解。@Inherited注解只对那些@Target被定义为ElementType.TYPE的自定义注解起作用。<br>3 自定义注解的配置使用<br>回顾一下注解的使用流程：</p>
<p>第一步，定义注解——相当于定义标记；<br>第二步，配置注解——把标记打在需要用到的程序代码中；<br>第三步，解析注解——在编译期或运行时检测到标记，并进行特殊操作。    </p>
<p>到目前为止我们只是完成了第一步，接下来我们就来学习第二步，配置注解，如何在另一个类当中配置它。<br>3.1 在具体的Java类上使用注解<br>首先，定义一个注解、和一个供注解修饰的简单Java类   </p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="variable">@Target</span>(value = &#123;ElementType.METHOD&#125;)</span><br><span class="line"><span class="variable">@Documented</span></span><br><span class="line">public <span class="variable">@interface</span> CherryAnnotation &#123;</span><br><span class="line">    <span class="selector-tag">String</span> <span class="selector-tag">name</span>();</span><br><span class="line">    <span class="selector-tag">int</span> <span class="selector-tag">age</span>() <span class="selector-tag">default</span> <span class="selector-tag">18</span>;</span><br><span class="line">    <span class="selector-tag">int</span><span class="selector-attr">[]</span> <span class="selector-tag">score</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">12345678</span></span><br><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">class</span> <span class="selector-tag">Student</span>&#123;</span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">void</span> <span class="selector-tag">study</span>(int times)&#123;</span><br><span class="line">        <span class="selector-tag">for</span>(int i = <span class="number">0</span>; i &amp;lt; times; i++)&#123;</span><br><span class="line">            <span class="selector-tag">System</span><span class="selector-class">.out</span><span class="selector-class">.println</span>(<span class="string">"Good Good Study, Day Day Up!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简单分析下：  </p>
<p>CherryAnnotation的@Target定义为ElementType.METHOD，那么它书写的位置应该在方法定义的上方，即：public void study(int times)之上；<br>由于我们在CherryAnnotation中定义的有注解类型元素，而且有些元素是没有默认值的，这要求我们在使用的时候必须在标记名后面打上()，并且在()内以“元素名=元素值“的形式挨个填上所有没有默认值的注解类型元素（有默认值的也可以填上重新赋值），中间用“,”号分割；  </p>
<p>所以最终书写形式如下：  </p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Student</span> &#123;</span><br><span class="line">    @CherryAnnotation(name = <span class="string">"cherry-peng"</span>,age = <span class="number">23</span>,score = &#123;<span class="number">99</span>,<span class="number">66</span>,<span class="number">77</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">study</span>(<span class="params"><span class="keyword">int</span> times</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &amp;lt; times; i++)&#123;</span><br><span class="line">            System.<span class="keyword">out</span>.println(<span class="string">"Good Good Study, Day Day Up!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.2 特殊语法<br>特殊语法一：<br>如果注解本身没有注解类型元素，那么在使用注解的时候可以省略()，直接写为：@注解名，它和标准语法@注解名()等效！  </p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="variable">@Target</span>(value = &#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="variable">@Documented</span></span><br><span class="line">public <span class="variable">@interface</span> FirstAnnotation &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">12345</span></span><br><span class="line"><span class="comment">//等效于@FirstAnnotation()</span></span><br><span class="line"><span class="variable">@FirstAnnotation</span></span><br><span class="line">public class JavaBean&#123;</span><br><span class="line">	<span class="comment">//省略实现部分</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>特殊语法二：<br>如果注解本本身只有一个注解类型元素，而且命名为value，那么在使用注解的时候可以直接使用：@注解名(注解值)，其等效于：@注解名(value = 注解值)  </p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="variable">@Target</span>(value = &#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="variable">@Documented</span></span><br><span class="line">public <span class="variable">@interface</span> SecondAnnotation &#123;</span><br><span class="line">	<span class="selector-tag">String</span> <span class="selector-tag">value</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//等效于@ SecondAnnotation(value = "this is second annotation")</span></span><br><span class="line"><span class="meta">@SecondAnnotation(<span class="meta-string">"this is annotation"</span>)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaBean</span></span>&#123;</span><br><span class="line">	<span class="comment">//省略实现部分</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>特殊用法三：<br>如果注解中的某个注解类型元素是一个数组类型，在使用时又出现只需要填入一个值的情况，那么在使用注解时可以直接写为：@注解名(类型名 = 类型值)，它和标准写法：@注解名(类型名 = {类型值})等效！  </p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="variable">@Target</span>(value = &#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="variable">@Documented</span></span><br><span class="line">public <span class="variable">@interface</span> ThirdAnnotation &#123;</span><br><span class="line">	<span class="selector-tag">String</span><span class="selector-attr">[]</span> <span class="selector-tag">name</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//等效于@ ThirdAnnotation(name = &#123;"this is third annotation"&#125;)</span></span><br><span class="line">@ ThirdAnnotation(name = <span class="string">"this is third annotation"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaBean</span></span>&#123;</span><br><span class="line">	<span class="comment">//省略实现部分</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>特殊用法四：<br>如果一个注解的@Target是定义为Element.PACKAGE，那么这个注解是配置在package-info.java中的，而不能直接在某个类的package代码上面配置。<br>4 自定义注解的运行时解析<br>这一章是使用注解的核心，读完此章即可明白，如何在程序运行时检测到注解，并进行一系列特殊操作！<br>4.1 回顾注解的保持力<br>首先回顾一下，之前自定义的注解@CherryAnnotation，并把它配置在了类Student上，代码如下：  </p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="variable">@Target</span>(value = &#123;ElementType.METHOD&#125;)</span><br><span class="line"><span class="variable">@Documented</span></span><br><span class="line">public <span class="variable">@interface</span> CherryAnnotation &#123;</span><br><span class="line">    <span class="selector-tag">String</span> <span class="selector-tag">name</span>();</span><br><span class="line">    <span class="selector-tag">int</span> <span class="selector-tag">age</span>() <span class="selector-tag">default</span> <span class="selector-tag">18</span>;</span><br><span class="line">    <span class="selector-tag">int</span><span class="selector-attr">[]</span> <span class="selector-tag">score</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> pojos;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> Student &#123;</span><br><span class="line">    @CherryAnnotation(name = <span class="string">"cherry-peng"</span>,age = <span class="number">23</span>,score = &#123;<span class="number">99</span>,<span class="number">66</span>,<span class="number">77</span>&#125;)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> study(<span class="keyword">int</span> <span class="keyword">times</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &amp;lt; <span class="keyword">times</span>; i++)&#123;</span><br><span class="line">            System.out.<span class="keyword">println</span>(<span class="string">"Good Good Study, Day Day Up!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注解保持力的三个阶段：  </p>
<p>Java源文件阶段；<br>编译到class文件阶段；<br>运行期阶段。  </p>
<p>只有当注解的保持力处于运行阶段，即使用@Retention(RetentionPolicy.RUNTIME)修饰注解时，才能在JVM运行时，检测到注解，并进行一系列特殊操作。<br>4.2 反射操作获取注解<br>因此，明确我们的目标：在运行期探究和使用编译期的内容（编译期配置的注解），要用到Java中的灵魂技术——反射！  </p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> TestAnnotation &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args)&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获取Student的Class对象</span></span><br><span class="line">            <span class="keyword">Class</span> stuClass = <span class="keyword">Class</span>.forName(<span class="string">"pojos.Student"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//说明一下，这里形参不能写成Integer.class，应写为int.class</span></span><br><span class="line">            Method stuMethod = stuClass.getMethod(<span class="string">"study"</span>,<span class="keyword">int</span>.<span class="keyword">class</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(stuMethod.isAnnotationPresent(CherryAnnotation.<span class="keyword">class</span>))&#123;</span><br><span class="line">                System.out.<span class="keyword">println</span>(<span class="string">"Student类上配置了CherryAnnotation注解！"</span>);</span><br><span class="line">                <span class="comment">//获取该元素上指定类型的注解</span></span><br><span class="line">                CherryAnnotation cherryAnnotation = stuMethod.getAnnotation(CherryAnnotation.<span class="keyword">class</span>);</span><br><span class="line">                System.out.<span class="keyword">println</span>(<span class="string">"name: "</span> + cherryAnnotation.name() + <span class="string">", age: "</span> + cherryAnnotation.age()</span><br><span class="line">                    + <span class="string">", score: "</span> + cherryAnnotation.score()[<span class="number">0</span>]);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.<span class="keyword">println</span>(<span class="string">"Student类上没有配置CherryAnnotation注解！"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解释一下：  </p>
<p>如果我们要获得的注解是配置在方法上的，那么我们要从Method对象上获取；如果是配置在属性上，就需要从该属性对应的Field对象上去获取，如果是配置在类型上，需要从Class对象上去获取。总之在谁身上，就从谁身上去获取！<br>isAnnotationPresent(Class&lt;? extends Annotation&gt; annotationClass)方法是专门判断该元素上是否配置有某个指定的注解；<br>getAnnotation(Class&lt;A&gt; annotationClass)方法是获取该元素上指定的注解。之后再调用该注解的注解类型元素方法就可以获得配置时的值数据；<br>反射对象上还有一个方法getAnnotations()，该方法可以获得该对象身上配置的所有的注解。它会返回给我们一个注解数组，需要注意的是该数组的类型是Annotation类型，这个Annotation是一个来自于java.lang.annotation包的接口。  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/07/15/custom-annotation/" data-id="ckbdc9uzn00n424u2499qvkk2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ANNOTATION/">ANNOTATION</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SPRINGTBOOT/">SPRINGTBOOT</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-redis-share-session" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/15/redis-share-session/" class="article-date">
  <time datetime="2019-07-15T18:46:00.000Z" itemprop="datePublished">2019-07-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT/">IT</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/15/redis-share-session/">redis share session</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>redis解决session共享问题<br>@EnableRedisHttpSession<br>pom.xml  </p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="keyword">lt</span>;parent&amp;<span class="keyword">gt</span>;            </span><br><span class="line">  &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;            </span><br><span class="line">  &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-boot-starter-parent&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>; </span><br><span class="line">  &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">1.5</span>.<span class="number">2</span>.RELEASE&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;        </span><br><span class="line">&amp;<span class="keyword">lt</span>;/parent&amp;<span class="keyword">gt</span>;  	</span><br><span class="line">&amp;<span class="keyword">lt</span>;dependencies&amp;<span class="keyword">gt</span>;	    </span><br><span class="line">  &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;	        </span><br><span class="line">    &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;	        </span><br><span class="line">    &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-boot-starter-web&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;	       </span><br><span class="line">    &amp;<span class="keyword">lt</span>;!--  &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;$&#123;spring_versin&#125;&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>; --&amp;<span class="keyword">gt</span>; 	        </span><br><span class="line">    &amp;<span class="keyword">lt</span>;exclusions&amp;<span class="keyword">gt</span>;                </span><br><span class="line">      &amp;<span class="keyword">lt</span>;exclusion&amp;<span class="keyword">gt</span>;</span><br><span class="line">      &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;</span><br><span class="line">      &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-boot-starter-tomcat&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>; </span><br><span class="line">      &amp;<span class="keyword">lt</span>;/exclusion&amp;<span class="keyword">gt</span>;            </span><br><span class="line">    &amp;<span class="keyword">lt</span>;/exclusions&amp;<span class="keyword">gt</span>;  	    </span><br><span class="line">  &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;	    </span><br><span class="line">  &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;        	</span><br><span class="line">    &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;       	 	</span><br><span class="line">    &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-boot-starter-tomcat&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;       	    </span><br><span class="line">    &amp;<span class="keyword">lt</span>;!-- &amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;$&#123;spring_versin&#125;&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>; --&amp;<span class="keyword">gt</span>;</span><br><span class="line">    &amp;<span class="keyword">lt</span>;scope&amp;<span class="keyword">gt</span>;provided&amp;<span class="keyword">lt</span>;/scope&amp;<span class="keyword">gt</span>;		</span><br><span class="line">  &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;			</span><br><span class="line">  &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;    		</span><br><span class="line">    &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.boot&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;    		</span><br><span class="line">    &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-boot-starter-redis&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;    	 	&amp;<span class="keyword">lt</span>;<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;<span class="number">1.4</span>.<span class="number">6</span>.RELEASE&amp;<span class="keyword">lt</span>;/<span class="keyword">version</span>&amp;<span class="keyword">gt</span>;		</span><br><span class="line">  &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>;		       </span><br><span class="line">  &amp;<span class="keyword">lt</span>;dependency&amp;<span class="keyword">gt</span>;    	</span><br><span class="line">    &amp;<span class="keyword">lt</span>;groupId&amp;<span class="keyword">gt</span>;org.springframework.session&amp;<span class="keyword">lt</span>;/groupId&amp;<span class="keyword">gt</span>;    	</span><br><span class="line">    &amp;<span class="keyword">lt</span>;artifactId&amp;<span class="keyword">gt</span>;spring-session-data-redis&amp;<span class="keyword">lt</span>;/artifactId&amp;<span class="keyword">gt</span>;    		</span><br><span class="line">  &amp;<span class="keyword">lt</span>;/dependency&amp;<span class="keyword">gt</span>; 		</span><br><span class="line">&amp;<span class="keyword">lt</span>;/dependencies&amp;<span class="keyword">gt</span>;</span><br></pre></td></tr></table></figure>

<p>application.yml的配置</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">logging</span>:</span><br><span class="line">  <span class="attribute">config</span>: <span class="attribute">classpath</span>:logback.xml</span><br><span class="line">  <span class="attribute">path</span>: <span class="attribute">d</span>:/logs</span><br><span class="line"><span class="attribute">server</span>:</span><br><span class="line">  <span class="attribute">port</span>: <span class="number">8080</span></span><br><span class="line">  <span class="attribute">session-timeout</span>: <span class="number">60</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">spring</span>:</span><br><span class="line">    <span class="attribute">redis</span>:</span><br><span class="line">       <span class="attribute">database</span>: <span class="number">0</span></span><br><span class="line">       <span class="attribute">host</span>: <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">       <span class="attribute">port</span>: <span class="number">6379</span></span><br><span class="line">       <span class="attribute">password</span>:</span><br><span class="line">       <span class="attribute">timeout</span>: <span class="number">0</span></span><br><span class="line">       <span class="attribute">pool</span>:</span><br><span class="line">           <span class="attribute">max-active</span>: <span class="number">8</span></span><br><span class="line">           <span class="attribute">max-wait</span>: -<span class="number">1</span></span><br><span class="line">           <span class="attribute">max-idle</span>: <span class="number">8</span></span><br><span class="line">           <span class="attribute">min-idle</span>: <span class="number">0</span></span><br><span class="line">    <span class="attribute">session</span>:</span><br><span class="line">      <span class="attribute">store-type</span>: none</span><br></pre></td></tr></table></figure>

<p>RedisSessionConfig.java<br>package com.fei.springboot.config;<br>import org.springframework.context.annotation.Configuration;<br>import  org.springframework.session.data.redis.config.annotation.web.http.EnableRedisHttpSession;</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@Configuration<span class="regexp">//m</span>axInactiveIntervalInSeconds 默认是<span class="number">1800</span>秒过期，这里测试修改为<span class="number">60</span>秒@EnableRedisHttpSession(maxInactiveIntervalInSeconds=<span class="number">60</span>)public <span class="class"><span class="keyword">class</span> <span class="title">RedisSessionConfig</span>&#123; &#125;</span></span><br></pre></td></tr></table></figure>

<p> 如果不需要做特殊处理，只需直接使用注解<br> @EnableRedisHttpSession即可，打开@EnableRedisHttpSession源码，发现maxInactiveIntervalInSeconds  session的过期时间默认是1800秒即30分钟，如果需要修改，注解时进行修改即可。如果想对redisSession做一些特殊处理。看@EnableRedisHttpSession源码，头部的注释，也给出了一些方案。</p>
<p>注解@interface EnableRedisHttpSession的源码</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* * Copyright 2014-2016 the original author or authors. * * Licensed under the Apache License, Version 2.0 (the "License"); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * *      http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">package</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.session</span><span class="selector-class">.data</span><span class="selector-class">.redis</span><span class="selector-class">.config</span><span class="selector-class">.annotation</span><span class="selector-class">.web</span><span class="selector-class">.http</span>; </span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">java</span><span class="selector-class">.lang</span><span class="selector-class">.annotation</span><span class="selector-class">.Documented</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">java</span><span class="selector-class">.lang</span><span class="selector-class">.annotation</span><span class="selector-class">.Retention</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">java</span><span class="selector-class">.lang</span><span class="selector-class">.annotation</span><span class="selector-class">.Target</span>; </span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.context</span><span class="selector-class">.annotation</span><span class="selector-class">.Configuration</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.context</span><span class="selector-class">.annotation</span><span class="selector-class">.Import</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.data</span><span class="selector-class">.redis</span><span class="selector-class">.connection</span><span class="selector-class">.RedisConnectionFactory</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.session</span><span class="selector-class">.SessionRepository</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.session</span><span class="selector-class">.config</span><span class="selector-class">.annotation</span><span class="selector-class">.web</span><span class="selector-class">.http</span><span class="selector-class">.EnableSpringHttpSession</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.session</span><span class="selector-class">.data</span><span class="selector-class">.redis</span><span class="selector-class">.RedisFlushMode</span>;</span><br><span class="line"><span class="comment">/** * Add this annotation to an &#123;@code @Configuration&#125; class to expose the * SessionRepositoryFilter as a bean named "springSessionRepositoryFilter" and backed by * Redis. In order to leverage the annotation, a single &#123;@link RedisConnectionFactory&#125; * must be provided. For example: &amp;lt;pre&amp;gt; * &amp;lt;code&amp;gt; * &#123;@literal @Configuration&#125; * &#123;@literal @EnableRedisHttpSession&#125; * public class RedisHttpSessionConfig &#123; * *     &#123;@literal @Bean&#125; *     public JedisConnectionFactory connectionFactory() throws Exception &#123; *         return new JedisConnectionFactory(); *     &#125; * * &#125; * &amp;lt;/code&amp;gt; &amp;lt;/pre&amp;gt; * * More advanced configurations can extend &#123;@link RedisHttpSessionConfiguration&#125; instead. * * @author Rob Winch * @since 1.0 * @see EnableSpringHttpSession */</span></span><br><span class="line">@<span class="keyword">Retention</span>(<span class="keyword">java</span>.<span class="keyword">lang</span>.<span class="keyword">annotation</span>.<span class="keyword">RetentionPolicy</span>.<span class="keyword">RUNTIME</span>)</span><br><span class="line">@<span class="keyword">Target</span>(&#123; <span class="selector-tag">java</span><span class="selector-class">.lang</span><span class="selector-class">.annotation</span><span class="selector-class">.ElementType</span><span class="selector-class">.TYPE</span> &#125;)</span><br><span class="line">@<span class="keyword">Documented</span></span><br><span class="line">@<span class="keyword">Import</span>(<span class="keyword">RedisHttpSessionConfiguration</span>.<span class="keyword">class</span>)</span><br><span class="line">@<span class="keyword">Configurationpublic</span> </span><br><span class="line">@interface EnableRedisHttpSession &#123;	</span><br><span class="line">   <span class="selector-tag">int</span> <span class="selector-tag">maxInactiveIntervalInSeconds</span>() <span class="selector-tag">default</span> 1800; 	</span><br><span class="line">       <span class="comment">/**	</span></span><br><span class="line"><span class="comment">       * &amp;lt;p&amp;gt;	</span></span><br><span class="line"><span class="comment">         * Defines a unique namespace for keys. The value is used to isolate sessions by	 </span></span><br><span class="line"><span class="comment">         * changing the prefix from "spring:session:" to	 </span></span><br><span class="line"><span class="comment">         * "spring:session:&amp;lt;redisNamespace&amp;gt;:". The default is "" such that all Redis	    * keys begin with "spring:session".	 </span></span><br><span class="line"><span class="comment">       * &amp;lt;/p&amp;gt;	 *	 </span></span><br><span class="line"><span class="comment">       * &amp;lt;p&amp;gt;	 </span></span><br><span class="line"><span class="comment">         * For example, if you had an application named "Application A" that needed to keep	 </span></span><br><span class="line"><span class="comment">         * the sessions isolated from "Application B" you could set two different values for	 </span></span><br><span class="line"><span class="comment">         * the applications and they could function within the same Redis instance.	 </span></span><br><span class="line"><span class="comment">       * &amp;lt;/p&amp;gt;	 </span></span><br><span class="line"><span class="comment">       *	 </span></span><br><span class="line"><span class="comment">       * @return the unique namespace for keys	 </span></span><br><span class="line"><span class="comment">       */</span>	</span><br><span class="line">   <span class="selector-tag">String</span> <span class="selector-tag">redisNamespace</span>() <span class="selector-tag">default</span> ""; 	</span><br><span class="line">       <span class="comment">/**	 </span></span><br><span class="line"><span class="comment">       * &amp;lt;p&amp;gt;	 </span></span><br><span class="line"><span class="comment">         * Sets the flush mode for the Redis sessions. The default is ON_SAVE which only	 </span></span><br><span class="line"><span class="comment">         * updates the backing Redis when	 </span></span><br><span class="line"><span class="comment">         * &#123;@link SessionRepository#save(org.springframework.session.Session)&#125; is invoked. In	 </span></span><br><span class="line"><span class="comment">         * a web environment this happens just before the HTTP response is committed.	</span></span><br><span class="line"><span class="comment">       * &amp;lt;/p&amp;gt;	 </span></span><br><span class="line"><span class="comment">       * &amp;lt;p&amp;gt;	 </span></span><br><span class="line"><span class="comment">         * Setting the value to IMMEDIATE will ensure that the any updates to the Session are	 </span></span><br><span class="line"><span class="comment">         * immediately written to the Redis instance.	</span></span><br><span class="line"><span class="comment">       * &amp;lt;/p&amp;gt;	 *	 </span></span><br><span class="line"><span class="comment">       * @return the &#123;@link RedisFlushMode&#125; to use	 </span></span><br><span class="line"><span class="comment">       * @since 1.1	 </span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">   <span class="selector-tag">RedisFlushMode</span> <span class="selector-tag">redisFlushMode</span>() <span class="selector-tag">default</span> <span class="selector-tag">RedisFlushMode</span><span class="selector-class">.ON_SAVE</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>spring boot中的session redis配置就如此简单。</p>
<p>写个controller测试下</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fei.springboot.controller; </span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller; </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.RequestMapping; </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(<span class="meta-string">"/"</span>)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123; 	</span><br><span class="line">    <span class="meta">@RequestMapping(value=<span class="meta-string">"/getSessionId"</span>)</span> 	</span><br><span class="line">    <span class="meta">@ResponseBody</span>	</span><br><span class="line">    <span class="keyword">public</span> String getSessionId(HttpServletRequest request)&#123; 				</span><br><span class="line">          Object o = request.getSession().getAttribute(<span class="string">"springboot"</span>); </span><br><span class="line">          <span class="keyword">if</span>(o == <span class="literal">null</span>)&#123;			</span><br><span class="line">            o = <span class="string">"spring boot 牛逼了!!!有端口"</span>+request.getLocalPort()+<span class="string">"生成"</span>;  			   request.getSession().setAttribute(<span class="string">"springboot"</span>, o);		</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> <span class="string">"端口="</span> + request.getLocalPort() +  <span class="string">" sessionId="</span> + request.getSession().getId() +<span class="string">"&amp;lt;br/&amp;gt;"</span>+o;</span><br><span class="line">          &#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写个启动类</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fei.springboot;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.<span class="type">SpringApplication</span>;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.<span class="type">EnableAutoConfiguration</span>;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.<span class="type">SpringBootApplication</span>;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.builder.<span class="type">SpringApplicationBuilder</span>;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.embedded.<span class="type">ConfigurableEmbeddedServletContainer</span>;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.embedded.<span class="type">EmbeddedServletContainerCustomizer</span>;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.support.<span class="type">SpringBootServletInitializer</span>;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.<span class="type">ComponentScan</span>; </span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages=&#123;<span class="string">"com.fei.springboot"</span>&#125;)</span><br><span class="line"><span class="meta">@SpringBootApplicationpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> <span class="title">implements</span> <span class="title">EmbeddedServletContainerCustomizer</span></span>&#123;  </span><br><span class="line">    <span class="meta">@Override</span>     </span><br><span class="line">    <span class="keyword">protected</span> <span class="type">SpringApplicationBuilder</span> configure(<span class="type">SpringApplicationBuilder</span> application) &#123;          </span><br><span class="line">    <span class="keyword">return</span> application.sources(<span class="type">Application</span>.<span class="keyword">class</span>);     </span><br><span class="line">    &#125;   	 	 </span><br><span class="line">    public static void main(<span class="type">String</span>[] args) <span class="keyword">throws</span> <span class="type">Exception</span> &#123;	        <span class="type">SpringApplication</span>.run(<span class="type">Application</span>.<span class="keyword">class</span>, args);	   </span><br><span class="line">    &#125; 	</span><br><span class="line">    public void customize(<span class="type">ConfigurableEmbeddedServletContainer</span> configurableEmbeddedServletContainer) &#123;	<span class="comment">//	configurableEmbeddedServletContainer.setPort(9090);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改application.yml中的server.port的端口为80,执行启动类，然后修改为8080，再次执行启动类。</p>
<p>浏览器测试<br><a href="http://127.0.0.1/getSessionId" target="_blank" rel="noopener">http://127.0.0.1/getSessionId</a><br>得得的结果是</p>
<p>端口=80 sessionId=3312d8db-a8dc-4df3-bc3a-628c311c0b4a<br>spring boot 牛逼了!!!有端口80生成</p>
<p><a href="http://127.0.0.1:8080/getSessionId" target="_blank" rel="noopener">http://127.0.0.1:8080/getSessionId</a><br>得到的结果是</p>
<p>端口=8080 sessionId=3312d8db-a8dc-4df3-bc3a-628c311c0b4a<br>spring boot 牛逼了!!!有端口80生成<br>使用redis-client,查看</p>
<p>注意事项：<br>如果启动时发现报错：<br>ERR Unsupported CONFIG parameter: notify-keyspace-events; nested exception is redis.clients.jedis.exceptions.JedisDataException</p>
<p>这是因为redis服务器版本和jar包版本不一致造成的。</p>
<p>比如说，我这用的spring-session-data-redis版本是1.3.0，到maven 仓库中查询<a href="http://mvnrepository.com/" target="_blank" rel="noopener">http://mvnrepository.com/</a></p>
<p>发现redis是2.8.1，看了下我用的服务器是2.6的，我立刻下载了个最新版的3.x，我是本地测试的，用window的。更换redis服务器后，不再报错了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="/blog/2019/07/15/redis-share-session/" data-id="ckbdc9uzv00np24u27j09uyjz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/REDIS/">REDIS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SPRINGBOOT/">SPRINGBOOT</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/18/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="page-number" href="/page/18/">18</a><span class="page-number current">19</span><a class="page-number" href="/page/20/">20</a><a class="page-number" href="/page/21/">21</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/20/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/GIT/">GIT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IT/">IT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVAEE/">JAVAEE</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JAVAEE/MYSQL/">MYSQL</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/OFFICE/">OFFICE</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SYSTEM/">SYSTEM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/VIM/">VIM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/分类1/">分类1</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/电商/">电商</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ANNOTATION/">ANNOTATION</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AOP/">AOP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BAZEL/">BAZEL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BEANUTILS/">BEANUTILS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CENTOS/">CENTOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CI-CD/">CI/CD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CLASSLOADER/">CLASSLOADER</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CRONTAB/">CRONTAB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DEBUG/">DEBUG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DESIGN-PATTERNS/">DESIGN PATTERNS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DNS/">DNS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DOCKER/">DOCKER</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DRUID/">DRUID</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ENLINK/">ENLINK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES/">ES</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EUREKA/">EUREKA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EXCEL/">EXCEL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Eureka/">Eureka</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FASTJSON/">FASTJSON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GIT/">GIT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GITLAB/">GITLAB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GLOBALEXCEPTION/">GLOBALEXCEPTION</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GO/">GO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HEXO/">HEXO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDEA/">IDEA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/INTERCEPTOR/">INTERCEPTOR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IT/">IT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVADOC/">JAVADOC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVAEE/">JAVAEE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVASCRIPT/">JAVASCRIPT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVASE/">JAVASE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JETTY/">JETTY</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JPA/">JPA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSONUTILS/">JSONUTILS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KARAF/">KARAF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KEEPALIVED/">KEEPALIVED</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LINUX/">LINUX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LISTENER/">LISTENER</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LOADBALANCED/">LOADBALANCED</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LOG/">LOG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LOGBACK/">LOGBACK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LOGIN/">LOGIN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LOMBOK/">LOMBOK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MAC/">MAC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MARKDOWN/">MARKDOWN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MIME-TYPE/">MIME-TYPE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MQ/">MQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MYBATIS/">MYBATIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MYCAT/">MYCAT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MYSQL/">MYSQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NETWORK/">NETWORK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OAUTH2/">OAUTH2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ONOS/">ONOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OSGI/">OSGI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OSI/">OSI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PAGEHELPER/">PAGEHELPER</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/POSTMAN/">POSTMAN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PYTHON/">PYTHON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RABBITMQ/">RABBITMQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/REDIS/">REDIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/REDISTEMPLATE/">REDISTEMPLATE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/REFLECTION/">REFLECTION</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/REGISTRY-CENTER/">REGISTRY CENTER</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/REPO/">REPO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RESTTEMPLATE/">RESTTEMPLATE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RIBBON/">RIBBON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RPM/">RPM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SECURITY/">SECURITY</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SERIALVERSIONUID/">SERIALVERSIONUID</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SERVLET/">SERVLET</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SESSION/">SESSION</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SHELL/">SHELL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPINTBOOT/">SPINTBOOT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPRING/">SPRING</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPRING-MVC/">SPRING MVC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPRING-STREAM/">SPRING STREAM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPRINGBBOT/">SPRINGBBOT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPRINGBOOT/">SPRINGBOOT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPRINGQUARTZ/">SPRINGQUARTZ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPRINGTASK/">SPRINGTASK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPRINGTBOOT/">SPRINGTBOOT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPTING/">SPTING</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/">SQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQLAlert/">SQLAlert</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSO/">SSO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/STRINGREDISTEMPLATE/">STRINGREDISTEMPLATE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SWAGGER/">SWAGGER</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SYSTEM/">SYSTEM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/">TCP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP-IP/">TCP/IP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TERMUX/">TERMUX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TK-MYBATIS/">TK.MYBATIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TRANSECTION/">TRANSECTION</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UBUNTU/">UBUNTU</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UDP/">UDP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WEBClIENT/">WEBClIENT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/YAML/">YAML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rabbitMq/">rabbitMq</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式/">分布式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/抖音/">抖音</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文件服务器/">文件服务器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/时间转化/">时间转化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/标签1/">标签1</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/淘宝/">淘宝</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/高可用/">高可用</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ANNOTATION/" style="font-size: 14.62px;">ANNOTATION</a> <a href="/tags/AOP/" style="font-size: 10.77px;">AOP</a> <a href="/tags/BAZEL/" style="font-size: 10px;">BAZEL</a> <a href="/tags/BEANUTILS/" style="font-size: 10px;">BEANUTILS</a> <a href="/tags/CENTOS/" style="font-size: 10px;">CENTOS</a> <a href="/tags/CI-CD/" style="font-size: 10px;">CI/CD</a> <a href="/tags/CLASSLOADER/" style="font-size: 10px;">CLASSLOADER</a> <a href="/tags/CRONTAB/" style="font-size: 10.77px;">CRONTAB</a> <a href="/tags/DEBUG/" style="font-size: 10px;">DEBUG</a> <a href="/tags/DESIGN-PATTERNS/" style="font-size: 10px;">DESIGN PATTERNS</a> <a href="/tags/DNS/" style="font-size: 10px;">DNS</a> <a href="/tags/DOCKER/" style="font-size: 11.54px;">DOCKER</a> <a href="/tags/DRUID/" style="font-size: 10px;">DRUID</a> <a href="/tags/ENLINK/" style="font-size: 10px;">ENLINK</a> <a href="/tags/ES/" style="font-size: 16.15px;">ES</a> <a href="/tags/EUREKA/" style="font-size: 10px;">EUREKA</a> <a href="/tags/EXCEL/" style="font-size: 10px;">EXCEL</a> <a href="/tags/Eureka/" style="font-size: 10px;">Eureka</a> <a href="/tags/FASTJSON/" style="font-size: 10px;">FASTJSON</a> <a href="/tags/GIT/" style="font-size: 10px;">GIT</a> <a href="/tags/GITLAB/" style="font-size: 10px;">GITLAB</a> <a href="/tags/GLOBALEXCEPTION/" style="font-size: 10px;">GLOBALEXCEPTION</a> <a href="/tags/GO/" style="font-size: 10.77px;">GO</a> <a href="/tags/HEXO/" style="font-size: 12.31px;">HEXO</a> <a href="/tags/IDEA/" style="font-size: 12.31px;">IDEA</a> <a href="/tags/INTERCEPTOR/" style="font-size: 11.54px;">INTERCEPTOR</a> <a href="/tags/IT/" style="font-size: 11.54px;">IT</a> <a href="/tags/JAVADOC/" style="font-size: 10px;">JAVADOC</a> <a href="/tags/JAVAEE/" style="font-size: 20px;">JAVAEE</a> <a href="/tags/JAVASCRIPT/" style="font-size: 11.54px;">JAVASCRIPT</a> <a href="/tags/JAVASE/" style="font-size: 10.77px;">JAVASE</a> <a href="/tags/JETTY/" style="font-size: 10px;">JETTY</a> <a href="/tags/JPA/" style="font-size: 10.77px;">JPA</a> <a href="/tags/JSONUTILS/" style="font-size: 10px;">JSONUTILS</a> <a href="/tags/KARAF/" style="font-size: 11.54px;">KARAF</a> <a href="/tags/KEEPALIVED/" style="font-size: 10px;">KEEPALIVED</a> <a href="/tags/LINUX/" style="font-size: 16.92px;">LINUX</a> <a href="/tags/LISTENER/" style="font-size: 10px;">LISTENER</a> <a href="/tags/LOADBALANCED/" style="font-size: 10px;">LOADBALANCED</a> <a href="/tags/LOG/" style="font-size: 10px;">LOG</a> <a href="/tags/LOGBACK/" style="font-size: 10px;">LOGBACK</a> <a href="/tags/LOGIN/" style="font-size: 10px;">LOGIN</a> <a href="/tags/LOMBOK/" style="font-size: 11.54px;">LOMBOK</a> <a href="/tags/MAC/" style="font-size: 15.38px;">MAC</a> <a href="/tags/MARKDOWN/" style="font-size: 11.54px;">MARKDOWN</a> <a href="/tags/MIME-TYPE/" style="font-size: 10px;">MIME-TYPE</a> <a href="/tags/MQ/" style="font-size: 12.31px;">MQ</a> <a href="/tags/MYBATIS/" style="font-size: 17.69px;">MYBATIS</a> <a href="/tags/MYCAT/" style="font-size: 10.77px;">MYCAT</a> <a href="/tags/MYSQL/" style="font-size: 16.15px;">MYSQL</a> <a href="/tags/NETWORK/" style="font-size: 10px;">NETWORK</a> <a href="/tags/OAUTH2/" style="font-size: 10.77px;">OAUTH2</a> <a href="/tags/ONOS/" style="font-size: 14.62px;">ONOS</a> <a href="/tags/OSGI/" style="font-size: 13.85px;">OSGI</a> <a href="/tags/OSI/" style="font-size: 10px;">OSI</a> <a href="/tags/PAGEHELPER/" style="font-size: 10px;">PAGEHELPER</a> <a href="/tags/POSTMAN/" style="font-size: 10px;">POSTMAN</a> <a href="/tags/PYTHON/" style="font-size: 13.08px;">PYTHON</a> <a href="/tags/RABBITMQ/" style="font-size: 10.77px;">RABBITMQ</a> <a href="/tags/REDIS/" style="font-size: 11.54px;">REDIS</a> <a href="/tags/REDISTEMPLATE/" style="font-size: 10px;">REDISTEMPLATE</a> <a href="/tags/REFLECTION/" style="font-size: 11.54px;">REFLECTION</a> <a href="/tags/REGISTRY-CENTER/" style="font-size: 10px;">REGISTRY CENTER</a> <a href="/tags/REPO/" style="font-size: 10px;">REPO</a> <a href="/tags/RESTTEMPLATE/" style="font-size: 10px;">RESTTEMPLATE</a> <a href="/tags/RIBBON/" style="font-size: 10.77px;">RIBBON</a> <a href="/tags/RPM/" style="font-size: 10px;">RPM</a> <a href="/tags/SECURITY/" style="font-size: 12.31px;">SECURITY</a> <a href="/tags/SERIALVERSIONUID/" style="font-size: 10px;">SERIALVERSIONUID</a> <a href="/tags/SERVLET/" style="font-size: 10.77px;">SERVLET</a> <a href="/tags/SESSION/" style="font-size: 12.31px;">SESSION</a> <a href="/tags/SHELL/" style="font-size: 14.62px;">SHELL</a> <a href="/tags/SPINTBOOT/" style="font-size: 10px;">SPINTBOOT</a> <a href="/tags/SPRING/" style="font-size: 13.08px;">SPRING</a> <a href="/tags/SPRING-MVC/" style="font-size: 10px;">SPRING MVC</a> <a href="/tags/SPRING-STREAM/" style="font-size: 10px;">SPRING STREAM</a> <a href="/tags/SPRINGBBOT/" style="font-size: 10px;">SPRINGBBOT</a> <a href="/tags/SPRINGBOOT/" style="font-size: 19.23px;">SPRINGBOOT</a> <a href="/tags/SPRINGQUARTZ/" style="font-size: 10px;">SPRINGQUARTZ</a> <a href="/tags/SPRINGTASK/" style="font-size: 12.31px;">SPRINGTASK</a> <a href="/tags/SPRINGTBOOT/" style="font-size: 10px;">SPRINGTBOOT</a> <a href="/tags/SPTING/" style="font-size: 10px;">SPTING</a> <a href="/tags/SQL/" style="font-size: 12.31px;">SQL</a> <a href="/tags/SQLAlert/" style="font-size: 18.46px;">SQLAlert</a> <a href="/tags/SSO/" style="font-size: 10px;">SSO</a> <a href="/tags/STRINGREDISTEMPLATE/" style="font-size: 10px;">STRINGREDISTEMPLATE</a> <a href="/tags/SWAGGER/" style="font-size: 10px;">SWAGGER</a> <a href="/tags/SYSTEM/" style="font-size: 10px;">SYSTEM</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/TCP-IP/" style="font-size: 11.54px;">TCP/IP</a> <a href="/tags/TERMUX/" style="font-size: 10.77px;">TERMUX</a> <a href="/tags/TK-MYBATIS/" style="font-size: 10px;">TK.MYBATIS</a> <a href="/tags/TRANSECTION/" style="font-size: 10px;">TRANSECTION</a> <a href="/tags/UBUNTU/" style="font-size: 10px;">UBUNTU</a> <a href="/tags/UDP/" style="font-size: 10px;">UDP</a> <a href="/tags/WEBClIENT/" style="font-size: 10px;">WEBClIENT</a> <a href="/tags/YAML/" style="font-size: 10.77px;">YAML</a> <a href="/tags/rabbitMq/" style="font-size: 10px;">rabbitMq</a> <a href="/tags/分布式/" style="font-size: 10px;">分布式</a> <a href="/tags/抖音/" style="font-size: 10px;">抖音</a> <a href="/tags/文件服务器/" style="font-size: 10.77px;">文件服务器</a> <a href="/tags/时间转化/" style="font-size: 10px;">时间转化</a> <a href="/tags/标签1/" style="font-size: 10px;">标签1</a> <a href="/tags/淘宝/" style="font-size: 10px;">淘宝</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a> <a href="/tags/高可用/" style="font-size: 10px;">高可用</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/06/13/可视化面板/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/06/13/邮箱找回密码与二次认证/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/06/13/特权用户访问策略控制/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/06/13/md列表/">markdown任务列表语法checkbox</a>
          </li>
        
          <li>
            <a href="/2020/06/13/CS应用配置/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Joe Tong<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>