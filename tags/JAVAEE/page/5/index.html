<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 3.9.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>Tag: JAVAEE - Learning</title>


    <meta name="description" content="private learning">
<meta property="og:type" content="website">
<meta property="og:title" content="Learning">
<meta property="og:url" content="http://yoursite.com/tags/JAVAEE/page/5/index.html">
<meta property="og:site_name" content="Learning">
<meta property="og:description" content="private learning">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/images/og_image.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Learning">
<meta name="twitter:description" content="private learning">
<meta name="twitter:image" content="http://yoursite.com/images/og_image.png">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="Learning" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
                <a class="navbar-item"
                href="/">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card">
    <div class="card-content">
        <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="/tags">Tags</a></li>
            <li class="is-active"><a href="#" aria-current="page">JAVAEE</a></li>
        </ul>
        </nav>
    </div>
</div>

    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-08-08T15:02:00.000Z">2019-08-08</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    29 分钟 read (About 4276 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/08/08/jetty-servlet-开发/">jetty servlet 开发</a>
            
        </h1>
        <div class="content">
            <p>Jetty开发指导：Jetty Websocket API<br>Jetty WebSocket API使用<br>Jetty提供了功能更强的WebSocket API，使用一个公共的核心API供WebSockets的服务端和客户端使用。<br>他是一个基于WebSocket消息的事件驱动的API。</p>
<p>WebSocket事件<br>每个WebSocket都能接收多种事件：</p>
<p>On Connect Event</p>
<p>表示WebSocket升级成功，WebSocket现在打开。<br>你将收到一个org.eclipse.jetty.websocket.api.Session对象，对应这个Open事件的session。<br>为通常的WebSocket，应该紧紧抓住这个Session，并使用它与Remote Endpoint进行交流。<br>如果为无状态（Stateless）WebSockets，这个Session将被传递到它出现的每一个事件，允许你使用一个WebSocket的1个实例为多个Remote Endpoint提供服务。</p>
<p>On Close Event</p>
<p>表示WebSocket已经关闭。<br>每个Close事件将有一个状态码（Status Code）（和一个可选的Closure Reason Message）。<br>一个通常的WebSocket终止将经历一个关闭握手，Local Endpoint和Remote Endpoint都会发送一个Close帧表示连接被关闭。<br>本地WebSocket可以通过发送一个Close帧到Remote Endpoint表示希望关闭，但是Remote Endpoint能继续发送信息直到它送一个Close帧为止。这被称之为半开（Half-Open）连接，注意一旦Local Endpoint发送了Close帧后，它将不能再发送任何WebSocket信息。<br>在一个异常的终止中，例如一个连接断开或者超时，底层连接将不经历Close Handshake就被终止，这也将导致一个On Close Event（和可能伴随一个On Error Event）。</p>
<p>On Error Event</p>
<p>如果一个错误出现，在实现期间，WebSocket将通过这个事件被通知。</p>
<p>On Message Event</p>
<p>表示一个完整的信息被收到，准备被你的WebSocket处理。<br>这能是一个（UTF8）TEXT信息或者一个原始的BINARY信息。</p>
<p>WebSocket Session<br>Session对象能被用于：</p>
<p>获取WebSocket的状态<br>连接状态（打开或者关闭）</p>
<figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-title">if</span><span class="hljs-params">(session.isOpen()</span></span>) &#123;</span><br><span class="line">  <span class="hljs-comment">// send message</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>连接是安全的吗。</p>
<figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-title">if</span><span class="hljs-params">(session.isSecure()</span></span>) &#123;</span><br><span class="line">  <span class="hljs-comment">// connection is using 'wss://'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在升级请求和响应中的是什么。</p>
<figure class="highlight ebnf hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-attribute">UpgradeRequest req</span> = session.getUpgradeRequest();</span><br><span class="line"><span class="hljs-attribute">String channelName</span> = req.getParameterMap().get(<span class="hljs-string">"channelName"</span>);</span><br><span class="line"> </span><br><span class="line"><span class="hljs-attribute">UpgradeRespons resp</span> = session.getUpgradeResponse();</span><br><span class="line"><span class="hljs-attribute">String subprotocol</span> = resp.getAcceptedSubProtocol();</span><br></pre></td></tr></table></figure>

<p>本地和远端地址是什么。</p>
<p><code>InetSocketAddress remoteAddr = session.getRemoteAddress();</code></p>
<p>配置策略<br>获取和设置空闲超时时间。</p>
<p><code>session.setIdleTimeout(2000); // 2 second timeout</code></p>
<p>获取和设置最大信息长度。</p>
<p><code>session.setMaximumMessageSize(64*1024); // accept messages up to 64k, fail if larger</code></p>
<p>发送信息到Remote Endpoint</p>
<p>Session的最重要的特征是获取org.eclipse.jetty.websocket.api.RemoteEndpoint。</p>
<p>使用RemoteEndpoint，你能选择发送TEXT或者BINARY Websocket信息，或者WebSocket PING和PONG控制帧。</p>
<figure class="highlight armasm hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">实例<span class="hljs-number">1</span> 发送二进制信息（阻塞）</span><br><span class="line"><span class="hljs-symbol">RemoteEndpoint</span> remote = session.getRemote()<span class="hljs-comment">;</span></span><br><span class="line"> </span><br><span class="line">// <span class="hljs-keyword">Blocking </span>Send of a <span class="hljs-keyword">BINARY </span>message to remote endpoint</span><br><span class="line"><span class="hljs-keyword">ByteBuffer </span><span class="hljs-keyword">buf </span>= <span class="hljs-keyword">ByteBuffer.wrap(new </span><span class="hljs-keyword">byte[] </span>&#123; <span class="hljs-number">0x11</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x44</span> &#125;)<span class="hljs-comment">;</span></span><br><span class="line"><span class="hljs-symbol">try</span></span><br><span class="line">&#123;</span><br><span class="line">    remote.sendBytes(<span class="hljs-keyword">buf);</span></span><br><span class="line"><span class="hljs-keyword">&#125;</span></span><br><span class="line"><span class="hljs-keyword">catch </span>(IOException e)</span><br><span class="line">&#123;</span><br><span class="line">    e.printStackTrace(System<span class="hljs-meta">.err</span>)<span class="hljs-comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>怎么使用RemoteEndpoint送一个简单的二进制信息。这将阻塞直到信息被发送完成，如果不能发送信息可能将抛出一个IOException。</p>
<figure class="highlight arduino hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">实例<span class="hljs-number">2</span> 发送文本信息（阻塞）</span><br><span class="line">RemoteEndpoint remote = session.getRemote();</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">// Blocking Send of a TEXT message to remote endpoint</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-built_in">try</span></span><br><span class="line">&#123;</span><br><span class="line">    remote.<span class="hljs-built_in">sendString</span>(<span class="hljs-string">"Hello World"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-built_in">catch</span> (IOException e)</span><br><span class="line">&#123;</span><br><span class="line">    e.printStackTrace(System.err);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>怎么使用RemoteEndpoint发送文本信息。这将阻塞直到信息发送，如果不能发送信息可能将抛出一个IOException。</p>
<p>发送部分信息<br>如果你有一个大的信息需要被发送，并且想分多次发送，每次一部分，你能使用RemoteEndpoint发送部分信息的方法。仅需要确保你最后发送一个完成发送的信息（isLast == true）</p>
<figure class="highlight armasm hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">实例<span class="hljs-number">3</span> 发送部分二进制信息（阻塞）</span><br><span class="line"><span class="hljs-symbol">RemoteEndpoint</span> remote = session.getRemote()<span class="hljs-comment">;</span></span><br><span class="line"> </span><br><span class="line">// <span class="hljs-keyword">Blocking </span>Send of a <span class="hljs-keyword">BINARY </span>message to remote endpoint</span><br><span class="line">// Part <span class="hljs-number">1</span></span><br><span class="line"><span class="hljs-keyword">ByteBuffer </span><span class="hljs-keyword">buf1 </span>= <span class="hljs-keyword">ByteBuffer.wrap(new </span><span class="hljs-keyword">byte[] </span>&#123; <span class="hljs-number">0x11</span>, <span class="hljs-number">0x22</span> &#125;)<span class="hljs-comment">;</span></span><br><span class="line">// Part <span class="hljs-number">2</span> (last part)</span><br><span class="line"><span class="hljs-keyword">ByteBuffer </span><span class="hljs-keyword">buf2 </span>= <span class="hljs-keyword">ByteBuffer.wrap(new </span><span class="hljs-keyword">byte[] </span>&#123; <span class="hljs-number">0x33</span>, <span class="hljs-number">0x44</span> &#125;)<span class="hljs-comment">;</span></span><br><span class="line"><span class="hljs-symbol">try</span></span><br><span class="line">&#123;</span><br><span class="line">    remote.sendPartialBytes(<span class="hljs-keyword">buf1,false);</span></span><br><span class="line"><span class="hljs-keyword"> </span>   remote.sendPartialBytes(<span class="hljs-keyword">buf2,true); </span>// isLast is true</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-symbol">catch</span> (IOException e)</span><br><span class="line">&#123;</span><br><span class="line">    e.printStackTrace(System<span class="hljs-meta">.err</span>)<span class="hljs-comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>怎么分两次发送一个二进制信息，使用在RemoteEndpoint中的部分信息支持方法。这将阻塞直到每次信息发送完成，如果不能发送信息可能抛出一个IOException。</p>
<figure class="highlight dart hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">实例<span class="hljs-number">4</span> 发送部分文本信息（阻塞）</span><br><span class="line">RemoteEndpoint remote = session.getRemote();</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">// Blocking Send of a TEXT message to remote endpoint</span></span><br><span class="line"><span class="hljs-built_in">String</span> part1 = <span class="hljs-string">"Hello"</span>;</span><br><span class="line"><span class="hljs-built_in">String</span> part2 = <span class="hljs-string">" World"</span>;</span><br><span class="line"><span class="hljs-keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    remote.sendPartialString(part1,<span class="hljs-keyword">false</span>);</span><br><span class="line">    remote.sendPartialString(part2,<span class="hljs-keyword">true</span>); <span class="hljs-comment">// last part</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">catch</span> (IOException e)</span><br><span class="line">&#123;</span><br><span class="line">    e.printStackTrace(System.err);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>怎么通过两次发送一个文本信息，使用在RemoteEndpoint中的部分信息支持方法。这将阻塞直到每次信息发送完成，如果不能发送信息可能抛出一个IOException。</p>
<p>发送Ping/Pong控制帧<br>你也能使用RemoteEndpoint发送Ping和Pong控制帧。</p>
<figure class="highlight armasm hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">实例<span class="hljs-number">5</span> 发送Ping控制帧（阻塞）</span><br><span class="line"><span class="hljs-symbol">RemoteEndpoint</span> remote = session.getRemote()<span class="hljs-comment">;</span></span><br><span class="line"> </span><br><span class="line">// <span class="hljs-keyword">Blocking </span>Send of a PING to remote endpoint</span><br><span class="line"><span class="hljs-keyword">String </span><span class="hljs-meta">data</span> = <span class="hljs-string">"You There?"</span><span class="hljs-comment">;</span></span><br><span class="line"><span class="hljs-keyword">ByteBuffer </span>payload = <span class="hljs-keyword">ByteBuffer.wrap(data.getBytes());</span></span><br><span class="line"><span class="hljs-keyword">try</span></span><br><span class="line"><span class="hljs-keyword">&#123;</span></span><br><span class="line"><span class="hljs-keyword"> </span>   remote.sendPing(payload)<span class="hljs-comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-symbol">catch</span> (IOException e)</span><br><span class="line">&#123;</span><br><span class="line">    e.printStackTrace(System<span class="hljs-meta">.err</span>)<span class="hljs-comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>怎么发送一个Ping控制帧，附带一个负载“You There?”（作为一个字节数组负载到达Remote Endpoint）。这将阻塞直到信息发送完成，如果不能发送Ping帧，可能抛出一个IOException。</p>
<figure class="highlight armasm hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">实例<span class="hljs-number">6</span> 送Pong控制帧（阻塞）</span><br><span class="line"><span class="hljs-symbol">RemoteEndpoint</span> remote = session.getRemote()<span class="hljs-comment">;</span></span><br><span class="line"> </span><br><span class="line">// <span class="hljs-keyword">Blocking </span>Send of a PONG to remote endpoint</span><br><span class="line"><span class="hljs-keyword">String </span><span class="hljs-meta">data</span> = <span class="hljs-string">"Yup, I'm here"</span><span class="hljs-comment">;</span></span><br><span class="line"><span class="hljs-keyword">ByteBuffer </span>payload = <span class="hljs-keyword">ByteBuffer.wrap(data.getBytes());</span></span><br><span class="line"><span class="hljs-keyword">try</span></span><br><span class="line"><span class="hljs-keyword">&#123;</span></span><br><span class="line"><span class="hljs-keyword"> </span>   remote.sendPong(payload)<span class="hljs-comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-symbol">catch</span> (IOException e)</span><br><span class="line">&#123;</span><br><span class="line">    e.printStackTrace(System<span class="hljs-meta">.err</span>)<span class="hljs-comment">;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>怎么发送一个Pong控制帧，附带一个”Yup I’m here”负载（作为一个字节数组负载到达Remote Endpoint）。这将阻塞直到信息被发送，如果不能发送Pong帧，可能抛出一个IOException。<br>为了正确的使用Pong帧，你应该返回你在Ping帧中收到的同样的字节数组数据。</p>
<p>异步发送信息<br>也存在来年改革异步发送信息的方法可用：<br>1）RemoteEndpoint.sendBytesByFuture（字节信息）<br>2）RemoteEndpoint.sendStringByFuture（字符串信息）<br>两个方法都返回一个Future<void>，使用标准java.util.concurrent.Future行为，能被用于测试信息发送的成功和失败。</void></p>
<figure class="highlight lsl hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">实例<span class="hljs-number">7</span> 送二进制信息（异步）</span><br><span class="line">RemoteEndpoint remote = session.getRemote();</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">// Async Send of a BINARY message to remote endpoint</span></span><br><span class="line">ByteBuffer buf = ByteBuffer.wrap(new byte[] &#123; <span class="hljs-number">0x11</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x44</span> &#125;);</span><br><span class="line">remote.sendBytesByFuture(buf);</span><br></pre></td></tr></table></figure>

<p>怎么使用RemoteEndpoint发送一个简单的二进制信息。这个信息将被放入发送队列，你将不知道发送成功或者失败。</p>
<figure class="highlight haxe hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">实例<span class="hljs-number">8</span> 发送二进制信息（异步，等待直到成功）</span><br><span class="line">RemoteEndpoint remote = session.getRemote();</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">// Async Send of a BINARY message to remote endpoint</span></span><br><span class="line">ByteBuffer buf = ByteBuffer.wrap(<span class="hljs-keyword">new</span> <span class="hljs-type">byte</span>[] &#123; <span class="hljs-number">0x11</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x44</span> &#125;);</span><br><span class="line"><span class="hljs-keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    Future&lt;<span class="hljs-keyword">Void</span>&gt; fut = remote.sendBytesByFuture(buf);</span><br><span class="line">    <span class="hljs-comment">// wait for completion (forever)</span></span><br><span class="line">    fut.<span class="hljs-keyword">get</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">catch</span> (ExecutionException | InterruptedException e)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-comment">// Send failed</span></span><br><span class="line">    e.printStackTrace();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>怎么使用RemoteEndpoint发送一个简单的二进制信息，追踪Future<void>以确定发送成功还是失败。</void></p>
<figure class="highlight haxe hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">实例<span class="hljs-number">9</span> 送二进制信息（异步，发送超时）</span><br><span class="line">RemoteEndpoint remote = session.getRemote();</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">// Async Send of a BINARY message to remote endpoint</span></span><br><span class="line">ByteBuffer buf = ByteBuffer.wrap(<span class="hljs-keyword">new</span> <span class="hljs-type">byte</span>[] &#123; <span class="hljs-number">0x11</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x44</span> &#125;);</span><br><span class="line">Future&lt;<span class="hljs-keyword">Void</span>&gt; fut = <span class="hljs-literal">null</span>;</span><br><span class="line"><span class="hljs-keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    fut = remote.sendBytesByFuture(buf);</span><br><span class="line">    <span class="hljs-comment">// wait for completion (timeout)</span></span><br><span class="line">    fut.<span class="hljs-keyword">get</span>(<span class="hljs-number">2</span>,TimeUnit.SECONDS);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">catch</span> (ExecutionException | InterruptedException e)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-comment">// Send failed</span></span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">catch</span> (TimeoutException e)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-comment">// timeout</span></span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="hljs-keyword">if</span> (fut != <span class="hljs-literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-comment">// cancel the message</span></span><br><span class="line">        fut.cancel(<span class="hljs-literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>怎么使用RemoteEndpoint发送一个简单的二进制信息，追踪Future<void>并等待一个有限的时间，如果时间超限则取消该信息。</void></p>
<figure class="highlight haxe hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">实例<span class="hljs-number">10</span> 发送文本信息（异步）</span><br><span class="line">RemoteEndpoint remote = session.getRemote();</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">// Async Send of a TEXT message to remote endpoint</span></span><br><span class="line">remote.sendStringByFuture(<span class="hljs-string">"Hello World"</span>);</span><br><span class="line"> </span><br><span class="line">怎么使用RemoteEndpoint发送一个简单的文本信息。这个信息将被放到输出队列中，但是你将不知道发送成功还是失败。</span><br><span class="line"> </span><br><span class="line">实例<span class="hljs-number">11</span> 发送文本信息（异步，等待直到成功）</span><br><span class="line">RemoteEndpoint remote = session.getRemote();</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">// Async Send of a TEXT message to remote endpoint</span></span><br><span class="line"><span class="hljs-keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    Future&lt;<span class="hljs-keyword">Void</span>&gt; fut = remote.sendStringByFuture(<span class="hljs-string">"Hello World"</span>);</span><br><span class="line">    <span class="hljs-comment">// wait for completion (forever)</span></span><br><span class="line">    fut.<span class="hljs-keyword">get</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">catch</span> (ExecutionException | InterruptedException e)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-comment">// Send failed</span></span><br><span class="line">    e.printStackTrace();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>怎么使用RemoteEndpoint发送一个简单的二进制信息，追踪Future<void>以直到发送成功还是失败。</void></p>
<figure class="highlight haxe hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">实例<span class="hljs-number">12</span> 发送文本信息（异步，发送超时）</span><br><span class="line">RemoteEndpoint remote = session.getRemote();</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">// Async Send of a TEXT message to remote endpoint</span></span><br><span class="line">Future&lt;<span class="hljs-keyword">Void</span>&gt; fut = <span class="hljs-literal">null</span>;</span><br><span class="line"><span class="hljs-keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    fut = remote.sendStringByFuture(<span class="hljs-string">"Hello World"</span>);</span><br><span class="line">    <span class="hljs-comment">// wait for completion (timeout)</span></span><br><span class="line">    fut.<span class="hljs-keyword">get</span>(<span class="hljs-number">2</span>,TimeUnit.SECONDS);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">catch</span> (ExecutionException | InterruptedException e)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-comment">// Send failed</span></span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">catch</span> (TimeoutException e)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-comment">// timeout</span></span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="hljs-keyword">if</span> (fut != <span class="hljs-literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-comment">// cancel the message</span></span><br><span class="line">        fut.cancel(<span class="hljs-literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>怎么使用RemoteEndpoint发送一个简单的二进制信息，追踪Future<void>并等待有限的时间，如果超时则取消。<br>使用WebSocket注释<br>WebSocket的最基本的形式是一个被Jetty WebSocket API提供的用注释标记的POJO。</void></p>
<figure class="highlight d hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">实例<span class="hljs-number">13</span> AnnotatedEchoSocket.java</span><br><span class="line"><span class="hljs-keyword">package</span> examples.echo;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.api.Session;</span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.api.annotations.OnWebSocketMessage;</span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.api.annotations.WebSocket;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Example EchoSocket using Annotations.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-keyword">@WebSocket</span>(maxTextMessageSize = <span class="hljs-number">64</span> * <span class="hljs-number">1024</span>)</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> AnnotatedEchoSocket &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-keyword">@OnWebSocketMessage</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> onText(Session session, String message) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (session.isOpen()) &#123;</span><br><span class="line">            System.<span class="hljs-keyword">out</span>.printf(<span class="hljs-string">"Echoing back message [%s]%n"</span>, message);</span><br><span class="line">            session.getRemote().sendString(message, <span class="hljs-literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的例子是一个简单的WebSocket回送端点，将回送所有它收到的文本信息。<br>这个实现使用了一个无状态的方法，因此对每个出现的事件Session都会被传递到Message处理方法中。这将允许你在同多个端口交互时可以重用AnnotatedEchoSocket的单实例。<br>你可用的注释如下：</p>
<p>@WebSocket  </p>
<p>一个必须的类级别的注释。<br>标记这个POJO作为一个WebSocket。<br>类必须不是abstract，且是public。  </p>
<p>@OnWebSocketConnect  </p>
<p>一个可选的方法级别的注释。<br>标记一个在类中的方法作为On Connect事件的接收者。<br>方法必须是public，且不是abstract，返回void，并且有且仅有一个Session参数。  </p>
<p>@OnWebSocketClose<br>一个可选的方法级的注释。<br>标记一个在类中的方法作为On Close事件的接收者。<br>方法标签必须是public，不是abstract，并且返回void。<br>方法的参数包括：<br>1）Session（可选）<br>2）int closeCode（必须）<br>3）String closeReason（必须）  </p>
<p>@OnWebSocketMessage<br>一个可选的方法级注释。<br>标记在类中的2个方法作为接收On Message事件的接收者。<br>方法标签必须是public，不是abstract，并且返回void。<br>为文本信息的方法参数包括：<br>1）Session（可选）<br>2）String text（必须）<br>为二进制信息的方法参数包括：<br>1）Session（可选）<br>2）byte buf[]（必须）<br>3）int offset（必须）<br>4）int length（必须）  </p>
<p>@OnWebSocketError<br>一个可选的方法级注释。<br>标记一个类中的方法作为Error事件的接收者。<br>方法标签必须是public，不是abstract，并且返回void。<br>方法参数包括：<br>1）Session（可选）<br>2）Throwable cause（必须）  </p>
<p>@OnWebSocketFrame<br>一个可选的方法级注释。<br>标记一个类中的方法作为Frame事件的接收者。<br>方法标签必须是public，不是abstract，并且返回void。<br>方法参数包括：<br>1）Session（可选）<br>2）Frame（必须）<br>收到的Frame将在这个方法上被通知，然后被Jetty处理，可能导致另一个事件，例如On Close，或者On Message。对Frame的改变将不被Jetty看到。</p>
<p>用WebSocketListener<br>一个WebSocket的基本形式是使用org.eclipse.jetty.websocket.api.WebSocketListener处理收到的事件。  </p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">实例<span class="hljs-number">14</span> ListenerEchoSocket.java</span><br><span class="line"><span class="hljs-keyword">package</span> examples.echo;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.api.Session;</span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.api.WebSocketListener;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Example EchoSocket using Listener.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ListenerEchoSocket</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebSocketListener</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-keyword">private</span> Session outbound;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onWebSocketBinary</span><span class="hljs-params">(<span class="hljs-keyword">byte</span>[] payload, <span class="hljs-keyword">int</span> offset, <span class="hljs-keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onWebSocketClose</span><span class="hljs-params">(<span class="hljs-keyword">int</span> statusCode, String reason)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.outbound = <span class="hljs-keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onWebSocketConnect</span><span class="hljs-params">(Session session)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.outbound = session;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onWebSocketError</span><span class="hljs-params">(Throwable cause)</span> </span>&#123;</span><br><span class="line">        cause.printStackTrace(System.err);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onWebSocketText</span><span class="hljs-params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> ((outbound != <span class="hljs-keyword">null</span>) &amp;&amp; (outbound.isOpen())) &#123;</span><br><span class="line">            System.out.printf(<span class="hljs-string">"Echoing back message [%s]%n"</span>, message);</span><br><span class="line">            outbound.getRemote().sendString(message, <span class="hljs-keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果listener做了太多的工作，你能使用WebSocketAdapter代替。<br>使用WebSocketAdapter<br>WebSocketListener的适配器。</p>
<figure class="highlight scala hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">实例<span class="hljs-number">15</span> <span class="hljs-type">AdapterEchoSocket</span>.java</span><br><span class="line"><span class="hljs-keyword">package</span> examples.echo;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> java.io.<span class="hljs-type">IOException</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.api.<span class="hljs-type">WebSocketAdapter</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Example EchoSocket using Adapter.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdapterEchoSocket</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSocketAdapter</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    public void onWebSocketText(<span class="hljs-type">String</span> message) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (isConnected()) &#123;</span><br><span class="line">            <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                <span class="hljs-type">System</span>.out.printf(<span class="hljs-string">"Echoing back message [%s]%n"</span>, message);</span><br><span class="line">                getRemote().sendString(message);</span><br><span class="line">            &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-type">IOException</span> e) &#123;</span><br><span class="line">                e.printStackTrace(<span class="hljs-type">System</span>.err);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个类比WebSocketListener跟为便利，并提供了有用的方法检查Session的状态。</p>
<p>Jetty WebSocket Server API<br>Jetty通过WebSocketServlet和servlet桥接的使用，提供了将WebSocket端点到Servlet路径的对应。<br>内在地，Jetty管理HTTP升级到WebSocket，并且从一个HTTP连接移植到一个WebSocket连接。<br>这只有当运行在Jetty容器内部时才工作。</p>
<p>Jetty WebSocketServlet<br>为了通过WebSocketServlet对应你的WebSocket到一个指定的路径，你将需要扩展org.eclipse.jetty.websocket.servlet.WebSocketServlet并指定什么WebSocket对象应该被创建。</p>
<figure class="highlight scala hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">实例<span class="hljs-number">16</span> <span class="hljs-type">MyEchoServlet</span>.java</span><br><span class="line"><span class="hljs-keyword">package</span> examples;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> javax.servlet.annotation.<span class="hljs-type">WebServlet</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.servlet.<span class="hljs-type">WebSocketServlet</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.servlet.<span class="hljs-type">WebSocketServletFactory</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">"serial"</span>)</span><br><span class="line"><span class="hljs-meta">@WebServlet</span>(name = <span class="hljs-string">"MyEcho WebSocket Servlet"</span>, urlPatterns = &#123; <span class="hljs-string">"/echo"</span> &#125;)</span><br><span class="line">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyEchoServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSocketServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    public void configure(<span class="hljs-type">WebSocketServletFactory</span> factory) &#123;</span><br><span class="line">        factory.getPolicy().setIdleTimeout(<span class="hljs-number">10000</span>);</span><br><span class="line">        factory.register(<span class="hljs-type">MyEchoSocket</span>.<span class="hljs-keyword">class</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个例子将创建一个Sevlet，通过@WebServlet注解匹配到Servlet路径”/echo”（或者你能在你的web应用的WEB-INF/web.xml中手动的配置），当收到HTTP升级请求时将创建MyEchoSocket实例。<br>WebSocketServlet.configure(WebSocketServletFactory factory)是为你的WebSocket指定配置的地方。在这个例子中，我们指定一个10s的空闲超时，并注册MyEchoSocket，即当收到请求时我们想创建的WebSocket类，使用默认的WebSocketCreator创建。</p>
<p>使用WebSocketCreator<br>所有WebSocket都是通过你注册到WebSocketServletFactory的WebSocketCreator创建的。<br>默认，WebSocketServletFactory是一个简单的WebSocketCreator，能创建一个单例的WebSocket对象。 使用WebSocketCreator.register(Class&lt;?&gt; websocket)告诉WebSocketServletFactory应该实例化哪个类（确保它有一个默认的构造器）。<br>如果你有更复杂的创建场景，你可以提供你自己的WebSocketCreator，基于在UpgradeRequest对象中出现的信息创建的WebSocket。</p>
<figure class="highlight haxe hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">实例<span class="hljs-number">17</span> MyAdvancedEchoCreator.java</span><br><span class="line"><span class="hljs-keyword">package</span> examples;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.servlet.ServletUpgradeRequest;</span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.servlet.ServletUpgradeResponse;</span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.servlet.WebSocketCreator;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAdvancedEchoCreator</span> <span class="hljs-keyword"><span class="hljs-keyword">implements</span> <span class="hljs-type">WebSocketCreator</span></span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-keyword">private</span> MyBinaryEchoSocket binaryEcho;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-keyword">private</span> MyEchoSocket textEcho;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-keyword">public</span> MyAdvancedEchoCreator() &#123;</span><br><span class="line">        <span class="hljs-built_in">this</span>.binaryEcho = <span class="hljs-keyword">new</span> <span class="hljs-type">MyBinaryEchoSocket</span>();</span><br><span class="line">        <span class="hljs-built_in">this</span>.textEcho = <span class="hljs-keyword">new</span> <span class="hljs-type">MyEchoSocket</span>();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    <span class="hljs-keyword">public</span> Object createWebSocket(ServletUpgradeRequest req, ServletUpgradeResponse resp) &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">String</span> subprotocol : <span class="hljs-type">req</span>.getSubProtocols()) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (<span class="hljs-string">"binary"</span>.equals(subprotocol)) &#123;</span><br><span class="line">                resp.setAcceptedSubProtocol(subprotocol);</span><br><span class="line">                <span class="hljs-keyword">return</span> binaryEcho;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">if</span> (<span class="hljs-string">"text"</span>.equals(subprotocol)) &#123;</span><br><span class="line">                resp.setAcceptedSubProtocol(subprotocol);</span><br><span class="line">                <span class="hljs-keyword">return</span> textEcho;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这儿我们展示了一个WebSocketCreator，将利用来自请求的WebSocket子协议信息决定什么类型的WebSocket应该被创建。</p>
<figure class="highlight scala hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">实例<span class="hljs-number">18</span> <span class="hljs-type">MyAdvancedEchoServlet</span>.java</span><br><span class="line"><span class="hljs-keyword">package</span> examples;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> javax.servlet.annotation.<span class="hljs-type">WebServlet</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.servlet.<span class="hljs-type">WebSocketServlet</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.servlet.<span class="hljs-type">WebSocketServletFactory</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">"serial"</span>)</span><br><span class="line"><span class="hljs-meta">@WebServlet</span>(name = <span class="hljs-string">"MyAdvanced Echo WebSocket Servlet"</span>, urlPatterns = &#123; <span class="hljs-string">"/advecho"</span> &#125;)</span><br><span class="line">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAdvancedEchoServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSocketServlet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    public void configure(<span class="hljs-type">WebSocketServletFactory</span> factory) &#123;</span><br><span class="line">        factory.getPolicy().setIdleTimeout(<span class="hljs-number">10000</span>);</span><br><span class="line">        factory.setCreator(<span class="hljs-keyword">new</span> <span class="hljs-type">MyAdvancedEchoCreator</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当你想要一个定制的WebSocketCreator时，使用WebSocketServletFactory.setCreator(WebSocketCreator creator)，然后WebSocketServletFactory将为所有在这个servlet上收到的Upgrade请求用你的创造器。<br>一个WebSocketCreator还可以用于：<br>1）控制WebSocket子协议的选择；<br>2）履行任何你认为重要的WebSocket源；<br>3）从输入的请求获取HTTP头；<br>4）获取Servlet HttpSession对象（如果它存在）；<br>5）指定一个响应状态码和原因；<br>如果你不想接收这个请求，简单的从WebSocketCreator.createWebSocket(UpgradeRequest req, UpgradeResponse resp)返回null。</p>
<p>Jetty WebSocket Client API<br>Jetty也提供了一个Jetty WebSocket Client库，为了更容易的与WebSocket服务端交互。<br>为了在你自己的Java项目上使用Jetty WebSocket Client，你将需要下面的maven配置：</p>
<figure class="highlight dust hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.eclipse.jetty.websocket<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>websocket-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;project.version&#125;</span><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>WebSocketClient<br>为了使用WebSocketClient，你将需要连接一个WebSocket对象实例到一个指定的目标WebSocket URI。</p>
<figure class="highlight haxe hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">实例<span class="hljs-number">19</span> SimpleEchoClient.java</span><br><span class="line"><span class="hljs-keyword">package</span> examples;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> java.net.URI;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.client.ClientUpgradeRequest;</span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.client.WebSocketClient;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Example of a simple Echo Client.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleEchoClient</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> void main(<span class="hljs-keyword">String</span>[] args) &#123;</span><br><span class="line">        <span class="hljs-keyword">String</span> destUri = <span class="hljs-string">"ws://echo.websocket.org"</span>;</span><br><span class="line">        <span class="hljs-keyword">if</span> (args.length &gt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">            destUri = args[<span class="hljs-number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        WebSocketClient client = <span class="hljs-keyword">new</span> <span class="hljs-type">WebSocketClient</span>();</span><br><span class="line">        SimpleEchoSocket socket = <span class="hljs-keyword">new</span> <span class="hljs-type">SimpleEchoSocket</span>();</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            client.start();</span><br><span class="line">            URI echoUri = <span class="hljs-keyword">new</span> <span class="hljs-type">URI</span>(destUri);</span><br><span class="line">            ClientUpgradeRequest request = <span class="hljs-keyword">new</span> <span class="hljs-type">ClientUpgradeRequest</span>();</span><br><span class="line">            client.connect(socket, echoUri, request);</span><br><span class="line">            System.out.printf(<span class="hljs-string">"Connecting to : %s%n"</span>, echoUri);</span><br><span class="line">            socket.awaitClose(<span class="hljs-number">5</span>, TimeUnit.SECONDS);</span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            t.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                client.stop();</span><br><span class="line">            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的例子连接到一个远端WebSocket服务端，并且连接后使用一个SimpleEchoSocket履行在websocket上的处理逻辑，等待socket关闭。</p>
<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">实例<span class="hljs-number">20</span> SimpleEchoSocket.java</span><br><span class="line"><span class="hljs-keyword">package</span> examples;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.concurrent.Future;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.api.Session;</span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.api.StatusCode;</span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.api.annotations.OnWebSocketClose;</span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.api.annotations.OnWebSocketConnect;</span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.api.annotations.OnWebSocketMessage;</span><br><span class="line"><span class="hljs-keyword">import</span> org.eclipse.jetty.websocket.api.annotations.WebSocket;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Basic Echo Client Socket</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-meta">@WebSocket(maxTextMessageSize = 64 * 1024)</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleEchoSocket</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CountDownLatch closeLatch;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-meta">@SuppressWarnings(<span class="hljs-meta-string">"unused"</span>)</span></span><br><span class="line">    <span class="hljs-keyword">private</span> Session session;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-keyword">public</span> SimpleEchoSocket() &#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.closeLatch = new CountDownLatch(<span class="hljs-number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-keyword">public</span> boolean awaitClose(int duration, TimeUnit unit) throws InterruptedException &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.closeLatch.await(duration, unit);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-meta">@OnWebSocketClose</span></span><br><span class="line">    <span class="hljs-keyword">public</span> void onClose(int statusCode, String reason) &#123;</span><br><span class="line">        System.<span class="hljs-keyword">out</span>.printf(<span class="hljs-string">"Connection closed: %d - %s%n"</span>, statusCode, reason);</span><br><span class="line">        <span class="hljs-keyword">this</span>.session = <span class="hljs-literal">null</span>;</span><br><span class="line">        <span class="hljs-keyword">this</span>.closeLatch.countDown();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-meta">@OnWebSocketConnect</span></span><br><span class="line">    <span class="hljs-keyword">public</span> void onConnect(Session session) &#123;</span><br><span class="line">        System.<span class="hljs-keyword">out</span>.printf(<span class="hljs-string">"Got connect: %s%n"</span>, session);</span><br><span class="line">        <span class="hljs-keyword">this</span>.session = session;</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            Future&lt;<span class="hljs-built_in">Void</span>&gt; fut;</span><br><span class="line">            fut = session.getRemote().sendStringByFuture(<span class="hljs-string">"Hello"</span>);</span><br><span class="line">            fut.<span class="hljs-keyword">get</span>(<span class="hljs-number">2</span>, TimeUnit.SECONDS);</span><br><span class="line">            fut = session.getRemote().sendStringByFuture(<span class="hljs-string">"Thanks for the conversation."</span>);</span><br><span class="line">            fut.<span class="hljs-keyword">get</span>(<span class="hljs-number">2</span>, TimeUnit.SECONDS);</span><br><span class="line">            session.close(StatusCode.NORMAL, <span class="hljs-string">"I'm done"</span>);</span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            t.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-meta">@OnWebSocketMessage</span></span><br><span class="line">    <span class="hljs-keyword">public</span> void onMessage(String msg) &#123;</span><br><span class="line">        System.<span class="hljs-keyword">out</span>.printf(<span class="hljs-string">"Got msg: %s%n"</span>, msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当SimpleEchoSocket连接成功后，它发送2个文本信息，然后关闭socket。<br>onMessage(String msg)收到来自远端WebSocket的响应，并输出他们到控制台。</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-30T09:30:00.000Z">2019-07-30</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    16 分钟 read (About 2369 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/30/ONOS-开发指南/">ONOS 开发指南</a>
            
        </h1>
        <div class="content">
            <h3 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h3><p>可以用官方提供的虚拟机<br>viturebox <a href="https://www.virtualbox.org/" target="_blank" rel="noopener">https://www.virtualbox.org/</a><br>ONOS tutorial OVA <a href="https://drive.google.com/open?id=1JcGUJJDTtbHNnbFzC7SUK52RmMDBVUry" target="_blank" rel="noopener">https://drive.google.com/open?id=1JcGUJJDTtbHNnbFzC7SUK52RmMDBVUry</a>  </p>
<h3 id="重要命令的提示"><a href="#重要命令的提示" class="headerlink" title="重要命令的提示"></a>重要命令的提示</h3><p>onos&gt; //表示你现在在onos的命令行<br>mininet&gt; //表示现在的位置是在mininet下</p>
<h3 id="设置集群"><a href="#设置集群" class="headerlink" title="设置集群"></a>设置集群</h3><p>点击桌面 Setup ONOS Cluster 图标</p>
<h3 id="Launch-ONOS-GUI"><a href="#Launch-ONOS-GUI" class="headerlink" title="Launch ONOS GUI"></a>Launch ONOS GUI</h3><p>点击提供的ONOS GUI 图标<br>ip:8181/onos/ui</p>
<p>username: onos<br>password：rocks</p>
<h3 id="CLI-AND-SERVICE"><a href="#CLI-AND-SERVICE" class="headerlink" title="CLI AND SERVICE"></a>CLI AND SERVICE</h3><p>如果我们像提供服务给其他接口，我们需要先定义服务接口然后让其他模块实现接口<br>1.定义一个接口官方案例写在了core工程下net里</p>
<figure class="highlight dart hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package org.onosproject.net.apps;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> java.util.<span class="hljs-built_in">Map</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.HostId;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown">/**</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet"> * </span>A demonstrative service for </span>the<span class="hljs-markdown"> intent reactive forwarding application to</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet"> * </span>export.</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"> */</span></span></span><br><span class="line">public <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ForwardingMapService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment"><span class="hljs-markdown">/**</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">     * </span>Get </span>the<span class="hljs-markdown"> endpoints of </span>the<span class="hljs-markdown"> host-to-host intents that were installed.</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-code">     *</span></span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">     * </span>@return maps of source to destination</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-code">     */</span></span></span></span><br><span class="line">    public <span class="hljs-built_in">Map</span>&lt;HostId, HostId&gt; getEndPoints();</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.实现接口<br>@Component(immediate = true)  启动时加载为组件<br>@Service                      注册为服务 有了这个注解别的服务就可以通过<br>@Reference(cardinality = ReferenceCardinality.MANDATORY_UNARY) 这个注解来引用了</p>
<figure class="highlight swift hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">package org.onosproject.ifwd;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.Map;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.concurrent.ConcurrentMap;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> org.apache.felix.scr.annotations.Activate;</span><br><span class="line"><span class="hljs-keyword">import</span> org.apache.felix.scr.annotations.Component;</span><br><span class="line"><span class="hljs-keyword">import</span> org.apache.felix.scr.annotations.Deactivate;</span><br><span class="line"><span class="hljs-keyword">import</span> org.apache.felix.scr.annotations.Reference;</span><br><span class="line"><span class="hljs-keyword">import</span> org.apache.felix.scr.annotations.ReferenceCardinality;</span><br><span class="line"><span class="hljs-keyword">import</span> org.apache.felix.scr.annotations.Service;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.core.ApplicationId;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.core.CoreService;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.Host;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.HostId;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.PortNumber;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.apps.ForwardingMapService;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.flow.DefaultTrafficSelector;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.flow.DefaultTrafficTreatment;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.flow.TrafficSelector;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.flow.TrafficTreatment;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.host.HostService;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.intent.HostToHostIntent;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.intent.IntentService;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.packet.DefaultOutboundPacket;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.packet.InboundPacket;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.packet.OutboundPacket;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.packet.PacketContext;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.packet.PacketProcessor;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.packet.PacketService;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.topology.TopologyService;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onlab.packet.Ethernet;</span><br><span class="line"><span class="hljs-keyword">import</span> org.slf4j.Logger;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> static org.slf4j.LoggerFactory.getLogger;</span><br><span class="line"> </span><br><span class="line">@<span class="hljs-type">Component</span>(immediate = <span class="hljs-literal">true</span>)</span><br><span class="line">@<span class="hljs-type">Service</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IntentReactiveForwarding</span> <span class="hljs-title">implements</span> <span class="hljs-title">ForwardingMapService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> log = getLogger(getClass());</span><br><span class="line"> </span><br><span class="line">    @<span class="hljs-type">Reference</span>(cardinality = <span class="hljs-type">ReferenceCardinality</span>.<span class="hljs-type">MANDATORY_UNARY</span>)</span><br><span class="line">    protected <span class="hljs-type">CoreService</span> coreService;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">// ...&lt;snip&gt;...</span></span><br><span class="line">  </span><br><span class="line">    <span class="hljs-comment">// Install a rule forwarding the packet to the specified port.</span></span><br><span class="line">    <span class="hljs-keyword">private</span> void setUpConnectivity(<span class="hljs-type">PacketContext</span> context, <span class="hljs-type">HostId</span> srcId, <span class="hljs-type">HostId</span> dstId) &#123;</span><br><span class="line">        <span class="hljs-type">TrafficSelector</span> selector = <span class="hljs-type">DefaultTrafficSelector</span>.builder().build();</span><br><span class="line">        <span class="hljs-type">TrafficTreatment</span> treatment = <span class="hljs-type">DefaultTrafficTreatment</span>.builder().build();</span><br><span class="line">        <span class="hljs-type">HostToHostIntent</span> intent = new <span class="hljs-type">HostToHostIntent</span>(appId, srcId, dstId,</span><br><span class="line">                                                       selector, treatment);</span><br><span class="line">        intentService.submit(intent);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="hljs-comment">// the new service method, to be filled out</span></span><br><span class="line">    @<span class="hljs-type">Override</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-type">Map</span>&lt;<span class="hljs-type">HostId</span>, <span class="hljs-type">HostId</span>&gt; getEndPoints() &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现这个服务</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Component</span>(immediate = <span class="hljs-keyword">true</span>)</span><br><span class="line"><span class="hljs-meta">@Service</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IntentReactiveForwarding</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ForwardingMapService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">// ...&lt;snip&gt;...</span></span><br><span class="line">    <span class="hljs-keyword">private</span> ApplicationId appId;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">// Map for storing found endpoints, for our service. It is protected</span></span><br><span class="line">    <span class="hljs-comment">// so that process() can access it.</span></span><br><span class="line">    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> ConcurrentMap&lt;HostId, HostId&gt; endPoints = <span class="hljs-keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">// ...&lt;snip&gt;...</span></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Packet processor responsible for forwarding packets along their paths.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReactivePacketProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">PacketProcessor</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="hljs-meta">@Override</span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">process</span><span class="hljs-params">(PacketContext context)</span> </span>&#123;</span><br><span class="line">            <span class="hljs-comment">// Stop processing if the packet has been handled, since we</span></span><br><span class="line">            <span class="hljs-comment">// can't do any more to it.</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (context.isHandled()) &#123;</span><br><span class="line">             </span><br><span class="line">            <span class="hljs-comment">// ...&lt;snip&gt;...</span></span><br><span class="line">             </span><br><span class="line">            <span class="hljs-keyword">if</span> (dst == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                flood(context);</span><br><span class="line">                <span class="hljs-keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-comment">// Add found endpoints to map.</span></span><br><span class="line">            endPoints.put(srcId, dstId);</span><br><span class="line"> </span><br><span class="line">            <span class="hljs-comment">// Otherwise forward and be done with it.</span></span><br><span class="line">            setUpConnectivity(context, srcId, dstId);</span><br><span class="line">            forwardPacketToDst(context, dst);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">// ...&lt;snip&gt;...</span></span><br><span class="line"> </span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;HostId, HostId&gt; <span class="hljs-title">getEndPoints</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-comment">// Return our map as a read-only structure.</span></span><br><span class="line">        <span class="hljs-keyword">return</span> Collections.unmodifiableMap(endPoints);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建命令"><a href="#创建命令" class="headerlink" title="创建命令"></a>创建命令</h3><p>一般命令定义在${ONOS_ROOT}/cli/下命令分为两种：<br>1系统配置和监控相关<br>2网络配置和监控相关  </p>
<p>@Command<br>@Argument<br>@Option  </p>
<figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.onosproject</span><span class="hljs-selector-class">.cli</span><span class="hljs-selector-class">.net</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.karaf</span><span class="hljs-selector-class">.shell</span><span class="hljs-selector-class">.commands</span><span class="hljs-selector-class">.Argument</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.karaf</span><span class="hljs-selector-class">.shell</span><span class="hljs-selector-class">.commands</span><span class="hljs-selector-class">.Command</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.onosproject</span><span class="hljs-selector-class">.cli</span><span class="hljs-selector-class">.AbstractShellCommand</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.onosproject</span><span class="hljs-selector-class">.net</span><span class="hljs-selector-class">.HostId</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.onosproject</span><span class="hljs-selector-class">.net</span><span class="hljs-selector-class">.apps</span><span class="hljs-selector-class">.ForwardingMapService</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * A demo service that lists the endpoints for which intents are installed.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line">@<span class="hljs-keyword">Command</span>(<span class="hljs-keyword">scope</span> = <span class="hljs-string">"onos"</span>, name = <span class="hljs-string">"fwdmap"</span>,</span><br><span class="line">        description = <span class="hljs-string">"Lists the endpoints for which intents are installed"</span>)</span><br><span class="line">public class ForwardingMapCommand extends AbstractShellCommand &#123;</span><br><span class="line">  </span><br><span class="line">    @<span class="hljs-keyword">Argument</span>(<span class="hljs-keyword">index</span> = <span class="hljs-number">0</span>, name = <span class="hljs-string">"hostId"</span>, description = <span class="hljs-string">"Host ID of source"</span>,</span><br><span class="line">            required = false, multiValued = false)</span><br><span class="line">    private HostId hostId = null;</span><br><span class="line"> </span><br><span class="line">    @<span class="hljs-keyword">Override</span></span><br><span class="line">    protected void execute() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>合并新服务</p>
<figure class="highlight scala hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> org.onosproject.cli.net;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> java.util.<span class="hljs-type">Map</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> org.apache.karaf.shell.commands.<span class="hljs-type">Argument</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> org.apache.karaf.shell.commands.<span class="hljs-type">Command</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.cli.<span class="hljs-type">AbstractShellCommand</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.<span class="hljs-type">HostId</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> org.onosproject.net.apps.<span class="hljs-type">ForwardingMapService</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * A demo service that lists the endpoints for which intents are installed.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-meta">@Command</span>(scope = <span class="hljs-string">"onos"</span>, name = <span class="hljs-string">"fwdmap"</span>,</span><br><span class="line">        description = <span class="hljs-string">"Lists the endpoints for which intents are installed"</span>)</span><br><span class="line">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ForwardingMapCommand</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractShellCommand</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="hljs-comment">// formatted string for output to CLI</span></span><br><span class="line">    <span class="hljs-keyword">private</span> static <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-type">FMT</span> = <span class="hljs-string">"src=%s, dst=%s"</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">// the String to hold the optional argument</span></span><br><span class="line">    <span class="hljs-meta">@Argument</span>(index = <span class="hljs-number">0</span>, name = <span class="hljs-string">"hostId"</span>, description = <span class="hljs-string">"Host ID of source"</span>,</span><br><span class="line">            required = <span class="hljs-literal">false</span>, multiValued = <span class="hljs-literal">false</span>)</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> hostId = <span class="hljs-literal">null</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">// reference to our service</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-type">ForwardingMapService</span> service;</span><br><span class="line">    <span class="hljs-comment">// to hold the service's response</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-type">Map</span>&lt;<span class="hljs-type">HostId</span>, <span class="hljs-type">HostId</span>&gt; hmap;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-keyword">protected</span> void execute() &#123;</span><br><span class="line">        <span class="hljs-comment">// get a reference to our service</span></span><br><span class="line">        service = get(<span class="hljs-type">ForwardingMapService</span>.<span class="hljs-keyword">class</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">         * getEndPoints() returns an empty map even if it contains nothing, so</span></span><br><span class="line"><span class="hljs-comment">         * we don't need to check for null hmap here.</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">        hmap = service.getEndPoints();</span><br><span class="line"> </span><br><span class="line">        <span class="hljs-comment">// check for an argument, then display information accordingly</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (hostId != <span class="hljs-literal">null</span>) &#123;</span><br><span class="line">            <span class="hljs-comment">// we were given a hostId to filter on, print only those that match</span></span><br><span class="line">            <span class="hljs-type">HostId</span> host = <span class="hljs-type">HostId</span>.hostId(hostId);</span><br><span class="line">            <span class="hljs-keyword">for</span> (<span class="hljs-type">Map</span>.<span class="hljs-type">Entry</span>&lt;<span class="hljs-type">HostId</span>, <span class="hljs-type">HostId</span>&gt; el : hmap.entrySet()) &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (el.getKey().equals(hostId)) &#123;</span><br><span class="line">                    print(<span class="hljs-type">FMT</span>, el.getKey(), el.getValue());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            <span class="hljs-comment">// print everything we have</span></span><br><span class="line">            <span class="hljs-keyword">for</span> (<span class="hljs-type">Map</span>.<span class="hljs-type">Entry</span>&lt;<span class="hljs-type">HostId</span>, <span class="hljs-type">HostId</span>&gt; el : hmap.entrySet()) &#123;</span><br><span class="line">                print(<span class="hljs-type">FMT</span>, el.getKey(), el.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注册命令到karaf<br>${ONOS_ROOT}/cli/src/main/resources/OSGI-INF/blueprint/  shell-config.xml中  </p>
<figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">command</span>&gt;</span></span><br><span class="line">    <span class="hljs-comment">&lt;!--Our command implementation's FQDN--&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.onosproject.cli.net.ForwardingMapCommand"</span>/&gt;</span></span><br><span class="line">    <span class="hljs-comment">&lt;!--A command completer for Host IDs--&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">completers</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">component-id</span>=<span class="hljs-string">"hostIdCompleter"</span>/&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">null</span>/&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">completers</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">command</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>重新编译启动ONOS</p>
<figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">$</span><span class="hljs-bash"> <span class="hljs-built_in">cd</span> <span class="hljs-variable">$&#123;ONOS_ROOT&#125;</span></span></span><br><span class="line"><span class="hljs-meta">$</span><span class="hljs-bash"> mvn clean install</span></span><br><span class="line"><span class="hljs-meta">$</span><span class="hljs-bash"> karaf clean</span></span><br></pre></td></tr></table></figure>

<p>测试</p>
<h3 id="应用模板教程"><a href="#应用模板教程" class="headerlink" title="应用模板教程"></a>应用模板教程</h3><p>onos-create-app工具<br>可以创建基础应用、命令、REST API 和GUI<br>1选 ONOS 版本<br><code>export ONOS_POM_VERSION=2.0.0</code></p>
<p>2创建工程<br> 1） 创建基础工程<br>    <code>onos-create-app app org.foo foo-app 1.0-SNAPSHOT org.foo.app</code><br>    编译安装激活<br>    <figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">$</span><span class="hljs-bash"> <span class="hljs-built_in">cd</span> foo-app</span></span><br><span class="line"><span class="hljs-meta">$</span><span class="hljs-bash"> mvn clean install</span></span><br><span class="line"><span class="hljs-meta">$</span><span class="hljs-bash"> onos-app localhost install! target/foo-app-1.0-SNAPSHOT.oar</span></span><br></pre></td></tr></table></figure></p>
<p> 2) 创建带命令的工程<br>    <code>onos-create-app cli org.foo foo-app 1.0-SNAPSHOT org.foo.app</code><br>    重新编译安装<br>    <figure class="highlight cmake hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mvn clean <span class="hljs-keyword">install</span></span><br><span class="line">$ onos-app localhost reinstall! <span class="hljs-keyword">target</span>/foo-app-<span class="hljs-number">1.0</span>-SNAPSHOT.oar</span><br></pre></td></tr></table></figure></p>
<p> 3) 创建REST API 工程<br>   <code>onos-create-app rest org.foo foo-app 1.0-SNAPSHOT org.foo.app</code><br>   重新编译安装<br>   <figure class="highlight cmake hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mvn clean <span class="hljs-keyword">install</span></span><br><span class="line">$ onos-app localhost reinstall! <span class="hljs-keyword">target</span>/foo-app-<span class="hljs-number">1.0</span>-SNAPSHOT.oar</span><br></pre></td></tr></table></figure></p>
<p>   打包完会自动创建 swagger ui <a href="http://localhost:8181/v1/docs/" target="_blank" rel="noopener">http://localhost:8181/v1/docs/</a></p>
<p> 4）创建ui工程<br>    <code>onos-create-app ui org.foo foo-app 1.0-SNAPSHOT org.foo.app</code><br>    带表格视图<br>    <code>onos-create-app uitab org.foo foo-app 1.0-SNAPSHOT org.foo.app</code><br>    带拓扑图<br>    <code>onos-create-app uitopo org.foo foo-app 1.0-SNAPSHOT org.foo.app</code><br>    重新编译安装<br>    <figure class="highlight stata hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mvn clean install</span><br><span class="line">onos-<span class="hljs-keyword">app</span> localhost reinstall! org.foo.<span class="hljs-keyword">app</span> target/foo-<span class="hljs-keyword">app</span>-1.0-SNAPSHOT.oar</span><br></pre></td></tr></table></figure></p>
<p>发布到本地仓库<br><code>onos-publish -l</code> </p>
<p>CoreService 类</p>
<figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//核心应用名</span></span><br><span class="line">String CORE_APP_NAME = <span class="hljs-string">"org.onosproject.core"</span>;</span><br><span class="line"><span class="hljs-comment">//核心“提供者”的标识符。 </span></span><br><span class="line">ProviderId CORE_PROVIDER_ID = <span class="hljs-keyword">new</span> ProviderId(<span class="hljs-string">"core"</span>, CORE_APP_NAME);</span><br><span class="line"><span class="hljs-comment">//返回产品版本 </span></span><br><span class="line"><span class="hljs-function">Version <span class="hljs-title">version</span>(<span class="hljs-params"></span>)</span>;</span><br><span class="line"><span class="hljs-comment">//返回当前注册的应用程序标识符集。 </span></span><br><span class="line"><span class="hljs-function">Set&lt;ApplicationId&gt; <span class="hljs-title">getAppIds</span>(<span class="hljs-params"></span>)</span>;</span><br><span class="line"><span class="hljs-comment">//从给定的ID返回现有的应用程序ID。</span></span><br><span class="line"><span class="hljs-function">ApplicationId <span class="hljs-title">getAppId</span>(<span class="hljs-params">Short id</span>)</span>;</span><br><span class="line"><span class="hljs-comment">//从给定的ID返回现有的应用程序ID。</span></span><br><span class="line"><span class="hljs-function">ApplicationId <span class="hljs-title">getAppId</span>(<span class="hljs-params">String name</span>)</span>;</span><br><span class="line"><span class="hljs-comment">//根据名字注册一个新应用</span></span><br><span class="line"><span class="hljs-function">ApplicationId <span class="hljs-title">registerApplication</span>(<span class="hljs-params">String name, Runnable preDeactivate</span>)</span>;</span><br><span class="line"><span class="hljs-comment">//返回给定主题的ID生成器。</span></span><br><span class="line"><span class="hljs-function">IdGenerator <span class="hljs-title">getIdGenerator</span>(<span class="hljs-params">String topic</span>)</span>;</span><br></pre></td></tr></table></figure>

<p><font color="red"> 注意 </font><br>如何获得一个AppId<br><code>appId = coreService.registerApplication(PROVIDER_ID);</code><br>根据PROVIDER_ID产生再从coreService的registerApplication方法中得到appId<br>PROVIDER_ID<br><code>static final String PROVIDER_ID = &quot;org.onosproject.provider.bgp.cfg&quot;;</code></p>
<h3 id="如何设置配置文件"><a href="#如何设置配置文件" class="headerlink" title="如何设置配置文件"></a>如何设置配置文件</h3><p>首先自定义好配置类<br>引入组件配置服务  </p>
<figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@<span class="hljs-keyword">Reference</span>(<span class="hljs-keyword">cardinality</span> = ReferenceCardinality.MANDATORY)</span><br><span class="line">protected ComponentConfigService componentConfigService;</span><br></pre></td></tr></table></figure>

<p>组件配置服务注册配置文件  </p>
<figure class="highlight abnf hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">componentConfigService.registerProperties(getClass())<span class="hljs-comment">;</span></span><br></pre></td></tr></table></figure>

<hr>
首先需要建立配置文件类
然后需要添加配置监听  
`private final NetworkConfigListener configListener = new InternalConfigListener();`
`configService.addListener(configListener);`  

<p>通过配置工厂ConfigFactory configFactory<br>需要三个参数SubjectFactories.APP_SUBJECT_FACTORY, 配置类的字节码文件, key  </p>
<figure class="highlight aspectj hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConfigFactory configFactory =</span><br><span class="line">            <span class="hljs-keyword">new</span> ConfigFactory(SubjectFactories.APP_SUBJECT_FACTORY, BgpAppConfig.class, <span class="hljs-string">"bgpapp"</span>) &#123;</span><br><span class="line">                <span class="hljs-meta">@Override</span></span><br><span class="line">                <span class="hljs-keyword">public</span> <span class="hljs-function">BgpAppConfig <span class="hljs-title">createConfig</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BgpAppConfig();</span><br><span class="line">                &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>注册配置工厂<br><code>configRegistry.registerConfigFactory(configFactory);</code><br>读取配置<br><code>readConfiguration();</code><br><font color="red"> 注意 </font><br>以上方法需要在bundle初始化的时候执行即在activate（也有叫start）方法中执行：</p>
<figure class="highlight mipsasm hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Activate</span><br><span class="line">public void activate(ComponentContext <span class="hljs-built_in">context</span>) &#123;</span><br><span class="line">    appId = coreService.registerApplication(PROVIDER_ID)<span class="hljs-comment">;</span></span><br><span class="line">    configService.<span class="hljs-keyword">addListener(configListener);</span></span><br><span class="line"><span class="hljs-keyword"> </span>   configRegistry.registerConfigFactory(configFactory)<span class="hljs-comment">;</span></span><br><span class="line">    readConfiguration()<span class="hljs-comment">;//内部自己定义</span></span><br><span class="line">    log.info(<span class="hljs-string">"BGP cfg provider started"</span>)<span class="hljs-comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当bundle关闭不再需要的时候可以在deactivate（也有叫stop）方法中取消注册  </p>
<figure class="highlight aspectj hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Deactivate</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deactivate</span><span class="hljs-params">(ComponentContext context)</span> </span>&#123;</span><br><span class="line">    configRegistry.unregisterConfigFactory(configFactory);</span><br><span class="line">    configService.removeListener(configListener);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.net config<br>配置类继承Config<string><br>在组件中引入服务</string></p>
<figure class="highlight aspectj hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Reference</span></span><br><span class="line"><span class="hljs-keyword">protected</span> NetworkConfigRegistry configRegistry;</span><br></pre></td></tr></table></figure>

<figure class="highlight aspectj hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConfigFactory configFactory = </span><br><span class="line">  <span class="hljs-keyword">new</span> configFactory(SubjectFactories.APP_SUBJECT_FACTORY,配置类名,起个名字作为key)&#123;</span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-keyword">public</span> 配置类 create配置类()&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> 配置类();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>activate 方法里注册配置文件</p>
<figure class="highlight abnf hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configRegistry.registerConfigFactory(configFactory)<span class="hljs-comment">;</span></span><br></pre></td></tr></table></figure>

<hr>

<h3 id="onos中的日志"><a href="#onos中的日志" class="headerlink" title="onos中的日志"></a>onos中的日志</h3><p>onos通过slf4j 来记录日志  </p>
<p><code>private static final Logger log = getLogger(本类的字节码);</code></p>
<hr>

<h3 id="onos命令行开发"><a href="#onos命令行开发" class="headerlink" title="onos命令行开发"></a>onos命令行开发</h3><p>主要用到几个注解 </p>
<table>
<thead>
<tr>
<th align="left">类上的</th>
</tr>
</thead>
<tbody><tr>
<td align="left">@Service</td>
</tr>
<tr>
<td align="left">@Component</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">方法上</th>
</tr>
</thead>
<tbody><tr>
<td align="left">@Option</td>
</tr>
<tr>
<td align="left">@Argument</td>
</tr>
</tbody></table>
<p>scop 作用域一般为应用名<br>name 命令名<br>description 命令的描述<br>detaileddescription 细节描述  </p>
<hr>

<p>onos 的WEB 开发<br>onos基于JAX-RS 做的<br>传统的servlet rest 开发方式<br>需要配置web.xml<br>需配置servlet 和 servlet-mapping</p>
<p>一：配置web.xml </p>
<p>`</p>
<?xml version="1.0" encoding="UTF-8"?>

<!--
  ~ Copyright 2016-present Open Networking Foundation
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<p><web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://java.sun.com/xml/ns/javaee" xmlns:web="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" xsi:schemalocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" id="ONOS" version="2.5"><br>    <display-name>Visual App REST API v1.0</display-name></web-app></p>
<pre><code>&lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
        &lt;web-resource-name&gt;Secured&lt;/web-resource-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
        &lt;role-name&gt;admin&lt;/role-name&gt;

    &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;

&lt;security-role&gt;
    &lt;role-name&gt;admin&lt;/role-name&gt;

&lt;/security-role&gt;

&lt;login-config&gt;
    &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
    &lt;realm-name&gt;karaf&lt;/realm-name&gt;
&lt;/login-config&gt;

&lt;servlet&gt;
    &lt;servlet-name&gt;JAX-RS Service&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.glassfish.jersey.servlet.ServletContainer&lt;/servlet-class&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;javax.ws.rs.Application&lt;/param-name&gt;
        &lt;!--&lt;param-name&gt;jersey.config.server.provider.classnames&lt;/param-name&gt;--&gt;
        &lt;param-value&gt;org.onosproject.visual.rest.VisualWebApplication&lt;/param-value&gt;
    &lt;/init-param&gt;

    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;JAX-RS Service&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</code></pre>

<p>`</p>
<p>2.BUILD文件里</p>
<figure class="highlight nix hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">osgi_jar_with_tests(</span><br><span class="line">    <span class="hljs-attr">api_description</span> = <span class="hljs-string">"REST API for Visual"</span>,</span><br><span class="line">    <span class="hljs-attr">api_package</span> = <span class="hljs-string">"org.onosproject.visual.rest"</span>,</span><br><span class="line">    <span class="hljs-attr">api_title</span> = <span class="hljs-string">"Visual Management"</span>,</span><br><span class="line">    <span class="hljs-attr">api_version</span> = <span class="hljs-string">"1.0"</span>,</span><br><span class="line">    <span class="hljs-attr">web_context</span> = <span class="hljs-string">"/ensbrain/visual"</span>,</span><br><span class="line">    <span class="hljs-attr">karaf_command_packages</span> = [<span class="hljs-string">"org.onosproject.visual"</span>],</span><br><span class="line">    <span class="hljs-attr">deps</span> = COMPILE_DEPS,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">```  </span><br><span class="line">必须要有的是web_context此值相当于访问路径的根  </span><br><span class="line"></span><br><span class="line"><span class="hljs-number">3</span>.必须要有一个Application类并继承AbstractWebApplication</span><br><span class="line">例如访问类叫VisualWebResource</span><br><span class="line">那么</span><br><span class="line">VisualWebApplication：</span><br></pre></td></tr></table></figure>

<p>public class VisualWebApplication extends AbstractWebApplication {<br>    @Override<br>    public Set&lt;Class&lt;?&gt;&gt; getClasses() {<br>        return getClasses(VisualWebResource.class);<br>    }<br>}</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>@Path(“query”)<br>public class VisualWebResource extends AbstractWebResource{</p>
<p>//    private VisualServerConfig esAgentConfig;</p>
<pre><code>@GET
@Path(&quot;hello&quot;)
@Produces(MediaType.APPLICATION_JSON)
public Response getHistogram() {
    String result = &quot;hello welcome to enlink sdp visual of users&apos; behaviour &quot;;
    ObjectNode node = mapper().createObjectNode().put(&quot;response&quot;, result);
    return ok(node).build();
}</code></pre><figure class="highlight lsl hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">如果要传递对象到前台需要通过转成json字符串</span><br><span class="line">需要   </span><br><span class="line"><span class="hljs-number">1.</span>实现JsonCodec&lt;dto类&gt;  </span><br><span class="line">```  </span><br><span class="line"><span class="hljs-number">1.</span>dto类  </span><br><span class="line"><span class="hljs-number">2.</span>dto类的json转码类要继承JsonCodec&lt;dto类&gt;  </span><br><span class="line"><span class="hljs-number">3.</span>重写里面的转码方法其实就是把属性都拿出来重新放到objectNode类中</span><br><span class="line">返回的就是objectNode  </span><br><span class="line"><span class="hljs-number">4.</span>如果是多个对象就转成ArrayNode json数组返回arrayNode  </span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"><span class="hljs-number">2.</span>注册</span><br><span class="line">在激活时将实体类与json转换类形成映射关系  </span><br><span class="line">例如：</span><br></pre></td></tr></table></figure>

<p>@Component(immediate = true,service = VisualRegistryService.class)<br>public class VisualRegistryService {</p>
<pre><code>private static final Logger log = getLogger(VisualRegistryService.class);

@Reference(cardinality = ReferenceCardinality.MANDATORY)
protected CoreService coreService;

@Reference(cardinality = ReferenceCardinality.MANDATORY)
protected CodecService codecService;

private ApplicationId appId;

@Activate
public void active(){
    appId = coreService.getAppId(&quot;org.onosproject.visual&quot;);
    codecService.registerCodec(SearchSQLDto.class,new SearchSQLDtoJsonCodec());
    log.info(&quot;visual started&quot;);
}

@Deactivate
public void deactive(){
    log.info(&quot;Stopped&quot;);
}</code></pre><p>}</p>
<pre><code>
</code></pre>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-30T08:24:00.000Z">2019-07-30</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    32 分钟 read (About 4864 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/30/OSGI-开发实例/">OSGI 开发实例</a>
            
        </h1>
        <div class="content">
            <p>OSGI(Open Services Gateway Initiative)，或者通俗点说JAVA动态模块系统，定义了一套模块应用开发的框架。OSGI容器实现方案如Knopflerfish, Equinox, and Apache Felix允许你把你的应用分成多个功能模块，这样通过依赖管理这些功能会更加方便。</p>
<p>和Servlet和EJB规范类似，OSGI规范包含两大块：一个OSGI容器需要实现的服务集合；一种OSGI容器和应用之间通信的机制。开发OSGI平台意味着你需要使用OSGI API编写你的应用，然后将其部署到OSGI容器中。从开发者的视角来看，OSGI提供以下优势：</p>
<pre><code>你可以动态地安装、卸载、启动、停止不同的应用模块，而不需要重启容器。
你的应用可以在同一时刻跑多个同一个模块的实例。
OSGI在SOA领域提供成熟的解决方案，包括嵌入式，移动设备和富客户端应用等。</code></pre><p>OK，你已经有个Servlet容器来做web 应用，有了EJB容器来做事务处理，你可能在想为什么你还需要一个新的容器？简单点说，OSGI容器被设计专门用来开发可分解为功能模块的复杂的Java应用。</p>
<p>企业应用领域的OSGI</p>
<p>OSGI规范最初是由OSGI联盟在1999年3月发起。它的主要目的是成为向网络设备传输服务管理的开放规范。核心思想是一旦你向网络设备中添加了一个OSGI服务平台，你可以在网络中的任意位置管理该设备上的服务组件。这些服务组件可以任意安装，更新或移除而不会对设备产生影响。</p>
<p>多年来，OSGI技术只出现在嵌入式系统和网络设备市场。现在，Eclipse使OSGI在企业开发领域焕发出新的光彩。</p>
<p>OSGI受到越来越广泛的支持</p>
<p>2003年，Eclipse开发团队开始寻找一种使eclipse成为一种功能更动态、工具更模块化的富客户端平台。最终，他们的目光锁定在OSGI框架上。Eclipse3.0，2004年6月发布，是基于OSGI技术搭建的首个Eclipse版本。</p>
<p>几乎所有企业应用服务提供商支持或计划支持OSGI。Spring框架同样支持OSGI，通过Spring DM（Spring Dynamic Modules for OSGI Service Platforms）项目，可以让我们在Spring上更方便的应用OSGI。</p>
<p>开源OSGI容器</p>
<p>从企业应用开发者的角度看，OSGI容器侵入性非常小，你可以方便地将其嵌入一个企业应用。举个例子来说，假设你在开发一个复杂的web应用。你希望将这个应用分解成多个功能模块。一个View层模块，一个Model层模块，一个DAO模块。使用嵌入式OSGI容器来跨依赖地管理这些模块可以让你随时更新你的DAO模块却不需要重启你的服务器。</p>
<p>只要你的应用完全符合OSGI规范，它就可以在所有符合OSGI规范的容器内运行。现在，有三种流行的开源OSGI容器：</p>
<pre><code>Equinox是OSGI Service Platform Release 4的一个实现。是Eclipse 模块化运行时的核心。
Knopflerfish另一个选择。
Apache Felix是Apache软件基金会赞助的一个OSGI容器</code></pre><p>在这篇文章里我们使用Equinox作为我们的OSGI容器。</p>
<p>尝试开发一个Hello World bundle</p>
<p>在OSGI的领域，发布的软件是以bundle的形式出现。bundle由java class类和资源文件组成，向设备所有者提供功能，同时可以为其他的bundles提供服务。Eclipse对开发bundles提供了强大的支持。Eclipse不仅仅提供创建bundles的功能，它还集成了Equinox这个OSGI容器，你可以在其上开发和调试OSGI组件。其实所有的Eclipse插件都是使用Eclipse规范代码写的OSGI bundle。接下来，你将可以学到如何使用Eclipse IDE开发一个Hello world osgi bundle。</p>
<p>开始开发bundle</p>
<p>我们一步步的开始：</p>
<pre><code>启动Eclipse，依次点 File --&gt; New --&gt; Project。
选择Plug-in Project，next。
输入Project Name项目名称，比如com.howard.sample.HelloWorld,Target Platform(目标平台)里的an OSGI framework，选择standard。
剩下的保持默认，next。
下个对话框也默认，next。
然后选择Hello OSGI Bundle作为模版。Finish。</code></pre><p>Eclipse会飞快的为你创建Hello world bundle的模版代码。主要包含两个文件：Activator.java和MANIFEST.MF。</p>
<p>Activator.java的代码如下所示：</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> org.osgi.framework.BundleActivator;</span><br><span class="line"><span class="hljs-keyword">import</span> org.osgi.framework.BundleContext;</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Activator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BundleActivator</span> </span>&#123;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">start</span><span class="hljs-params">(BundleContext context)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="hljs-string">"Hello world"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stop</span><span class="hljs-params">(BundleContext context)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="hljs-string">"Goodbye World"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果你的bundle在启动和关闭的时候需要被通知，你可以考虑实现BundleActivator接口。以下是定义Activator的一些注意点：</p>
<pre><code>你的Activator类需要一个公有的无参数构造函数。OSGI框架会通过类反射的方式来实例化一个Activator类。
容器启动bundle过程中负责调用你的Activator类的start方法。bundle可以在此初始化资源比如说初始化数据库连接。start方法需要一个参数，BundleContext对象。这个对象允许bundles以取得OSGI容器相关信息的方式和框架交互。如果某一个bundle有异常抛出，容器将对该bundle标记为stopped并不将其纳入service列表。
容器关闭的时候会调用你的Activator类方法stop(),你可以利用这个机会做一些清理的操作。</code></pre><p>MANIFEST.MF</p>
<p>这个文件是你的bundle的部署描述文件。格式和Jar里的MANIFEST.MF是一样的。包含的不少名值对，就像如下：</p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Manifest-<span class="hljs-string">Version:</span> <span class="hljs-number">1.0</span></span><br><span class="line">Bundle-<span class="hljs-string">ManifestVersion:</span> <span class="hljs-number">2</span></span><br><span class="line">Bundle-<span class="hljs-string">Name:</span> HelloWorld Plug-<span class="hljs-keyword">in</span></span><br><span class="line">Bundle-<span class="hljs-string">SymbolicName:</span> com.howard.sample.HelloWorld</span><br><span class="line">Bundle-<span class="hljs-string">Version:</span> <span class="hljs-number">1.0</span><span class="hljs-number">.0</span></span><br><span class="line">Bundle-<span class="hljs-string">Activator:</span> com.howard.sample.helloworld.Activator</span><br><span class="line">Bundle-<span class="hljs-string">Vendor:</span> HOWARD</span><br><span class="line">Bundle-<span class="hljs-string">RequiredExecutionEnvironment:</span> JavaSE<span class="hljs-number">-1.6</span></span><br><span class="line">Import-<span class="hljs-string">Package:</span> org.osgi.framework;version=<span class="hljs-string">"1.3.0"</span></span><br></pre></td></tr></table></figure>

<p>分别来看下：<br>Bundle-ManifestVersion</p>
<p>数值为2意味着本bundle支持OSGI规范第四版；如果是1那就是支持OSGI规范第三版。</p>
<p>Bundle-Name</p>
<p>给bundle定义一个短名，方便人员阅读</p>
<p>Bundle-SymbolicName</p>
<p>给bundle定义一个唯一的非局部名。方便分辨。</p>
<p>Bundle-Activator</p>
<p>声明在start和stop事件发生时会被通知的监听类的名字。</p>
<p>Import-Package</p>
<p>定义bundle的导入包。</p>
<p>Hello World bundle完成了，接下来我们运行一下。<br>执行bundle  </p>
<pre><code>点击Run --&gt; Run Configuration
在左边的OSGI Framework选项里右键 new ，创建一个新的OSGI Run Configuration
名字随便取好了，我们取个OSGi hello world。
你会注意到中间的窗口里Workspace项目里有一子项 com.howard.sample.HelloWorld,将其勾选上，其他的不用管。这时的状态应该如下图。
点击Run按钮。在控制台你应该可以看见点东西了。那是叫做OSGI控制台的东东。与子相伴，还有一个&quot;Hello world&quot;。  
OSGI控制台</code></pre><p>OSGI控制台是一个OSGI容器的命令行界面。你可以利用它做些诸如启动，关闭，安装bundles，更新和删除bundles等操作。现在，点击OSGI控制台所在的位置，回车，你就会发现可以输入命令了。这时的OSGI控制台应该如下图：<br>下面列出一些常用的OSGI命令，你可以试着和OSGI容器交互。</p>
<p>ss 显示已安装的bundles的状态信息，信息包括bundle ID，短名，状态等等。</p>
<p>start 启动一个bundle</p>
<p>stop  关闭一个bundle</p>
<p>update  载入一个新的JAR文件更新一个bundle</p>
<p>install  安装一个新的bundle到容器中</p>
<p>uninstall  卸载一个已在容器中的bundle</p>
<p>依赖管理</p>
<p>OSGI规范允许你把你的应用分解成多个模块然后管理各个模块间的依赖关系。</p>
<p>这需要通过bundle scope来完成。默认情况下，一个bundle内的class对其他bundle来说是不可见的。那么，如果要让一个bundle访问另一个bundle里的class要怎么做？解决的方案就是从源bundle导出包，然后在目标bundle里导入。</p>
<p>接下来我们对此做一个例子。</p>
<p>首先，我们需要先创建一个com.howard.sample.HelloService bundle,我们将通过它导出一个包。</p>
<p>然后，我们在com.howard.sample.HelloWorld 这个bundle里导入包。  </p>
<p>导出包</p>
<p>1、创建名为com.howard.sample.HelloService的bundle，创建步骤和前面一样。</p>
<p>2、在这个bundle内，添加一个com.howard.sample.service.HelloService.java 接口，代码如下：  </p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public<span class="hljs-built_in"> interface </span>HelloService &#123;</span><br><span class="line">    public String sayHello();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  创建一个com.howard.sample.service.impl.HelloServiceImpl.java类实现刚才的接口：<br>  <figure class="highlight haxe hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloServiceImpl</span> <span class="hljs-keyword"><span class="hljs-keyword">implements</span> <span class="hljs-type">HelloService</span></span></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">String</span> sayHello() &#123;</span><br><span class="line">        System.out.println(<span class="hljs-string">"Inside HelloServiceImple.sayHello()"</span>);</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-string">"Say Hello"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>4、打开MANIFEST.MF,选择Runtime标签项，在Exported Packages选项栏，点击Add并且选择com.howard.sample.service这个包。然后MANIFEST.MF的代码应该如下：  </p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Manifest-<span class="hljs-string">Version:</span> <span class="hljs-number">1.0</span></span><br><span class="line">Bundle-<span class="hljs-string">ManifestVersion:</span> <span class="hljs-number">2</span></span><br><span class="line">Bundle-<span class="hljs-string">Name:</span> HelloService Plug-<span class="hljs-keyword">in</span></span><br><span class="line">Bundle-<span class="hljs-string">SymbolicName:</span> com.howard.sample.HelloService</span><br><span class="line">Bundle-<span class="hljs-string">Version:</span> <span class="hljs-number">1.0</span><span class="hljs-number">.0</span></span><br><span class="line">Bundle-<span class="hljs-string">Activator:</span> com.howard.sample.helloservice.Activator</span><br><span class="line">Bundle-<span class="hljs-string">Vendor:</span> HOWARD</span><br><span class="line">Bundle-<span class="hljs-string">RequiredExecutionEnvironment:</span> JavaSE<span class="hljs-number">-1.6</span></span><br><span class="line">Import-<span class="hljs-string">Package:</span> org.osgi.framework;version=<span class="hljs-string">"1.3.0"</span></span><br><span class="line">Export-<span class="hljs-string">Package:</span> com.howard.sample.service</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">你可以看到，MANIFEST.MF文件和刚才的HelloWorld的那份很类似。唯一的区别就是这个多了Export-Package这个标记，对应的值就是我们刚才选择的com.howard.sample.service。</span><br><span class="line"></span><br><span class="line">Export-Package标记告诉OSGI容器在com.howard.sample.service包内的classes可以被外部访问。</span><br><span class="line"></span><br><span class="line">注意，我们仅仅暴露了HelloService接口，而不是直接暴露HelloServiceImpl实现。  </span><br><span class="line"></span><br><span class="line">导入包</span><br><span class="line"></span><br><span class="line">接下来我们要更新原来的HelloWorld bundle以导入com.howard.sample.service包。步骤如下：</span><br><span class="line"></span><br><span class="line"><span class="hljs-number">1</span>、进入HelloWorld bundle，打开MANIFEST.MF，进入Dependencies标签页，在Imported Packages里添加com.howard.sample.service。MANIFEST.MF文件应该如下所示：</span><br></pre></td></tr></table></figure>

<p>Manifest-Version: 1.0<br>Bundle-ManifestVersion: 2<br>Bundle-Name: HelloWorld Plug-in<br>Bundle-SymbolicName: com.howard.sample.HelloWorld<br>Bundle-Version: 1.0.0<br>Bundle-Activator: com.howard.sample.helloworld.Activator<br>Bundle-Vendor: HOWARD<br>Bundle-RequiredExecutionEnvironment: JavaSE-1.6<br>Import-Package: com.howard.sample.service,<br> org.osgi.framework;version=”1.3.0”</p>
<figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">没错，Import-package标记的值也就是导入的包名之间是用逗号隔开的。在这里导入了两个包om<span class="hljs-selector-class">.howard</span><span class="hljs-selector-class">.sample</span><span class="hljs-selector-class">.service</span>和org<span class="hljs-selector-class">.osgi</span><span class="hljs-selector-class">.framework</span>。后者是使用Activator类时必须导入的包。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="hljs-number">2</span>、接下来，打开HelloWorld项目下的Activator.java文件，这时候你会发现可以使用HelloService这个接口了。但还是不能使用HelloServiceImpl实现类。Eclipse会告诉你：Access restriction（立入禁止）。</span><br><span class="line"></span><br><span class="line">Class级别可见域</span><br><span class="line">为什么OSGI容器可以做到让jar包中的一些classes可见而另一些又不可见呢。</span><br><span class="line"></span><br><span class="line">答案其实就是OSGI容器自定义了java class loader来有选择的加载类。OSGI容器为每一个bundle都创建了不同的class loader。因此，bundle可以访问的classes包括</span><br><span class="line"> </span><br><span class="line">    Boot classpath：所有的java基础类。</span><br><span class="line">    Framework classpath：OSGI框架级别的classloader加载的类</span><br><span class="line">    Bundle classpath：Bundle本身引用的关系紧密的JAR的路径</span><br><span class="line">    Imported packages：就是在MANIFEST.MF里声明的导入包，一旦声明，在bundle内就可见了。  </span><br><span class="line">bundle级别的可见域允许你可以随时放心的更改HelloServiceImpl实现类而不需要去担心依赖关系会被破坏。  </span><br><span class="line">OSGI服务</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">OSGI框架是实现SOA的绝佳土壤。通过它可以实现bundles暴露服务接口给其他bundles消费而不需要让细节暴露。消费bundles甚至可以完全不知道提供服务的bundles。凭着可以良好的隐藏具体实现的能力，OSGI当之无愧是SOA的一种较完美的实现方案。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">OSGI中，提供服务的bundle在OSGI容器上将一个POJO注册成一个service。消费者bundle请求OSGI容器中基于某个特殊接口的注册service。一旦找到，消费者bundle就会绑定它，然后就可以调用service中的方法了。举个例子会更容易说明。  </span><br><span class="line">导出services</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="hljs-number">1</span>、确保com<span class="hljs-selector-class">.howard</span><span class="hljs-selector-class">.sample</span><span class="hljs-selector-class">.HelloService</span>里的MANIFEST.MF导入org<span class="hljs-selector-class">.osgi</span><span class="hljs-selector-class">.framework</span>包</span><br><span class="line"></span><br><span class="line"><span class="hljs-number">2</span>、创建com<span class="hljs-selector-class">.howard</span><span class="hljs-selector-class">.sample</span><span class="hljs-selector-class">.service</span><span class="hljs-selector-class">.impl</span><span class="hljs-selector-class">.HelloServiceActivator</span><span class="hljs-selector-class">.java</span>,代码如下：</span><br></pre></td></tr></table></figure>

<pre><code>public class HelloServiceActivator implements BundleActivator {
    ServiceRegistration helloServiceRegistration;
    @Override
    public void start(BundleContext context) throws Exception {
        HelloService helloService = new HelloServiceImpl();
        helloServiceRegistration = context.registerService(HelloService.class
                .getName(), helloService, null);
    }

    @Override
    public void stop(BundleContext context) throws Exception {
        helloServiceRegistration.unregister();
    }

}</code></pre><figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">OK，我们就是用BundleContext的registerService方法注册service的。这个方法需要三个参数。  </span><br><span class="line">service的接口名。如果service实现了多个接口，那样你需要传入一个包含所有接口名的String数组。在这里我们传入的是HelloService这个接口。  </span><br><span class="line">    真正的service实现。在例子中我们传了一个HelloServiceImpl实现。  </span><br><span class="line">    service属性。这个参数可以在有多个service实现同一个接口的情况下，消费者用来区分真正感兴趣的service。  </span><br><span class="line"></span><br><span class="line"><span class="hljs-number">3</span>、最后一步就是修改HelloService的MANIFEST.MF文件，将Bundle-Activator改成com<span class="hljs-selector-class">.howard</span><span class="hljs-selector-class">.sample</span><span class="hljs-selector-class">.service</span><span class="hljs-selector-class">.impl</span><span class="hljs-selector-class">.HelloServiceActivator</span>  </span><br><span class="line">现在HelloService bundle已经随时准备将HelloServiceImpl服务发布了。OSGI容器启动HelloServie bundle的时候会让HelloServiceActivator运作，在那个时候将HelloServiceImpl注册到容器中，接下来就是创建消费者的问题了。    </span><br><span class="line">导入service  </span><br><span class="line">我们的消费者就是HelloWorld bundle，主要修改的就是其中的Activator<span class="hljs-selector-class">.java</span>,修改代码如下：</span><br></pre></td></tr></table></figure>

<pre><code>public class Activator implements BundleActivator {
ServiceReference helloServiceReference;
    public void start(BundleContext context) throws Exception {
        System.out.println(&quot;Hello World!!&quot;);
        helloServiceReference=context.getServiceReference(HelloService.class.getName());
        HelloService helloService=(HelloService)context.getService(helloServiceReference);
        System.out.println(helloService.sayHello());
    }
    public void stop(BundleContext context) throws Exception {
        System.out.println(&quot;Goodbye World!!&quot;);
        context.ungetService(helloServiceReference);
    }
}</code></pre><figure class="highlight lsl hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">代码很简单，就不多说了。</span><br><span class="line"></span><br><span class="line">在运行之前我们在Run--&gt;Run Configurations对话框里，把HelloWorld和HelloService这两个bundle前面的钩都打上。然后运行时你会发现HelloServiceImpl.sayHello()方法已经被调用了。</span><br><span class="line">在OSGI控制台输入ss并回车，所有容器内的bundle状态一目了然。其中id为<span class="hljs-number">0</span>的bundle是OSGI框架基础bundle，另两个就是HelloService和HelloWorld了，它俩的id是随机的，状态是<span class="hljs-literal">ACTIVE</span>也就是已启动状态。假设HelloService的id为<span class="hljs-number">7</span>，HelloWorld为<span class="hljs-number">8</span>。</span><br><span class="line">输入stop <span class="hljs-number">8</span>就可以暂停bundle的运行，容器内这个bundle还是存在的，只是状态变成了RESOLVED。再次启动使用start <span class="hljs-number">8</span>，然后就会看见HelloWorld bundle消费了HelloService的服务。</span><br><span class="line"></span><br><span class="line">创建服务工厂  </span><br><span class="line">刚才例子所示，我们会在HelloService bundle启动时初始化并注册service。然后不管存不存在消费端，这个service都会存在，而且消费端取得的service 实例其实都是同一个。OK，某些servie是比较耗费资源的主，我们不希望它一直占用资源，最好是在真正用它的时候创建不用的时候销毁就最好了。  </span><br><span class="line">解决如上问题的方案就是使用ServiceFactory接口的实现来代替原先service具体的实现到OSGI容器去注册。这样，以后只有当其他bundle请求该服务时，才会由ServiceFactory实现类来处理请求并返回一个新的service实例。  </span><br><span class="line">实例步骤如下：</span><br><span class="line"></span><br><span class="line"><span class="hljs-number">1</span>、在HelloService bundle创建一个实现ServiceFactory接口的类HelloServiceFactory类，代码如下：</span><br></pre></td></tr></table></figure>

<p>public class HelloServiceFactory implements ServiceFactory {<br>    private int usageCounter = 0;<br>    @Override<br>    public Object getService(Bundle bundle, ServiceRegistration registration) {<br>        System.out.println(“Create object of HelloService for “ + bundle.getSymbolicName());<br>        usageCounter++;<br>        System.out.println(“Number of bundles using service “ + usageCounter);<br>        HelloService helloService = new HelloServiceImpl();<br>        return helloService;<br>    }<br>    @Override<br>    public void ungetService(Bundle bundle, ServiceRegistration registration, Object service) {<br>        System.out.println(“Release object of HelloService for “ + bundle.getSymbolicName());<br>        usageCounter–;<br>        System.out.println(“Number of bundles using service “ + usageCounter);<br>    }<br>}</p>
<figure class="highlight armasm hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-symbol">ServiceFactory</span>接口定义了两个方法：  </span><br><span class="line">    getService方法：特定的<span class="hljs-keyword">bundle在第一次调用BundleContext的getService方法时由OSGI框架调用，在实例代码中，我们用这个方法来返回一个新的HelloService的实现。OSGI框架会缓存这个返回的对象，如果同一个bundle在未来再次调用BundleContext的getService方法的话，会直接返回这个缓存中的对象。 </span> </span><br><span class="line">    ungetService方法：<span class="hljs-keyword">bundle释放service的时候由OSGI容器调用。 </span> </span><br><span class="line"><span class="hljs-number">2</span>、修改HelloServiceActivator.java的start方法，将ServiceFactory作为服务注册，代码如下：</span><br></pre></td></tr></table></figure>

<pre><code>public class HelloServiceActivator implements BundleActivator {
    ServiceRegistration helloServiceRegistration;
    @Override
    public void start(BundleContext context) throws Exception {
        HelloServiceFactory helloServiceFactory = new HelloServiceFactory();
        helloServiceRegistration = context.registerService(HelloService.class
                .getName(), helloServiceFactory, null);
    }

    @Override
    public void stop(BundleContext context) throws Exception {
        helloServiceRegistration.unregister();
    }
}</code></pre><figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">现在运行下试试看，你会发现HelloWorld bundle启动时才会初始化HelloService，控制台会打印出<span class="hljs-string">"Number of bundles using service 1"</span>，当HelloWorld bundle暂停时会打印出<span class="hljs-string">"Number of bundles using service 0"</span>。  </span><br><span class="line"></span><br><span class="line">services跟踪  </span><br><span class="line">某种情形下，我们可能需要在某个特殊的接口有新的服务注册或取消注册时通知消费端。这时我们可以使用ServiceTracker类。如下步骤所示：  </span><br><span class="line"><span class="hljs-number">1</span>、在HelloWorld bundle里的MANIFEST.MF导入org<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.tracker</span>包。 </span><br><span class="line"></span><br><span class="line"><span class="hljs-number">2</span>、创建HelloServiceTracker类，代码如下：</span><br></pre></td></tr></table></figure>

<pre><code>public class HelloServiceTracker extends ServiceTracker {
    public HelloServiceTracker(BundleContext context) {
        super(context, HelloService.class.getName(),null);
    }
    public Object addingService(ServiceReference reference) {
        System.out.println(&quot;Inside HelloServiceTracker.addingService &quot; + reference.getBundle());
        return super.addingService(reference);
    }
    public void removedService(ServiceReference reference, Object service) {
        System.out.println(&quot;Inside HelloServiceTracker.removedService &quot; + reference.getBundle());
        super.removedService(reference, service);
    }
}</code></pre> <figure class="highlight armasm hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> 我们在HelloServiceTracker的构造函数里将HelloService接口名传进去，ServiceTracker会跟踪实现这个接口的所有的注册services。ServiceTracker主要有两个重要方法：</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">addingService方法：bundle注册一个基于给定接口的service时调用。</span></span><br><span class="line"><span class="hljs-keyword"> </span>   removeService方法：<span class="hljs-keyword">bundle取消注册一个基于给定接口的service时调用。</span></span><br><span class="line"><span class="hljs-keyword"></span></span><br><span class="line"><span class="hljs-keyword"> </span></span><br><span class="line"></span><br><span class="line"><span class="hljs-number">3</span>、修改Activator类，使用刚刚创建的HelloServiceTracker来获取service：</span><br></pre></td></tr></table></figure>

<pre><code>public class Activator implements BundleActivator {
    HelloServiceTracker helloServiceTracker;
    public void start(BundleContext context) throws Exception {
        System.out.println(&quot;Hello World!!&quot;);
        helloServiceTracker= new HelloServiceTracker(context);
        helloServiceTracker.open();
        HelloService helloService=(HelloService)helloServiceTracker.getService();
        System.out.println(helloService.sayHello());
    }

    public void stop(BundleContext context) throws Exception {
        System.out.println(&quot;Goodbye World!!&quot;);
        helloServiceTracker.close();
    }
}</code></pre><pre><code>
现在运行一下，可以发现只要HelloService bundle启动或是暂停都会导致HelloServiceTracker的对addingService或removedService方法的调用。



ServiceTracker不仅仅能跟踪Service的动向，它还能通过getService方法取得Service实例并返回。但是如果同一个接口下有多个service注册，这时返回哪个service呢？这时候就需要看service的等级哪个高了。这个等级是service注册时的property属性里的一项：SERVICE_RANKING。谁的SERVICE_RANKING高，就返回谁。

如果有两个一样高的呢？这时再看这两个service谁的PID更低了。



如果对OSGI的ClassLoader机制有疑问，可以看看这篇解释ClassLoader机制和自定义ClassLoader相关的文章：

http://longdick.iteye.com/blog/442213



OSGI的基本原理和入门开发就到这里了。希望同学们能对OSGI开发有个简单而清晰的认识。



参考资料：Hello, OSGi, Part 1: Bundles for beginners </code></pre>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-30T01:20:00.000Z">2019-07-30</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 小时 read (About 14971 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/30/BUILD/">BUILD</a>
            
        </h1>
        <div class="content">
            <p>bazel笔记：<br>bazel的编译是基于工作区，也就是项目的根目录  </p>
<ol>
<li>workspace文件：制定当前文件夹就是一个bazel工作区。  </li>
<li>一个或多个build文件，如果工作区中的一个目录包含build文件，那么他就是一个package.<br>因此，要制定一个目录为bazel的工作区，就只要在该目录下创建一个空的workspace即可。<br><font color="red">//: 该符号标识根目录下的文件  </font><br>target：<br>cc_binary (name)<br>cc_libary<br>cc_test  </li>
</ol>
<p>bazel有两个关键元素，一个是package，另一个是target<br>package是可独立编译的project包，由workspace文件（可为空）标识；<br>target是BUILD文件中的关键元素，也就是编译的目标，目标可以是二进制文件（cc_binary), 可以是libary(cc_libary)</p>
<figure class="highlight markdown hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">visiblity: [<span class="hljs-string">"//visibility:public"</span>],[<span class="hljs-string">'//visibility:private'</span>](<span class="hljs-link">私有</span>)，[<span class="hljs-string">'//some/package:__pkg__'</span>](<span class="hljs-link">注意冒号</span>)  </span><br><span class="line">ex: package(default_visibility = ["//visibility:public"])</span><br></pre></td></tr></table></figure>

<p>Dependencies：</p>
<p> 在构建或者执行时，目标A依赖于目标B，这种依赖关系产生一个有向无环图，我们将这种有向无环图称为依赖图，<br> 一个目标的直接依赖关系指的是在依赖图中可以以1步到达依赖对象的关系，<br> 二传递依赖关系指的是需要经过数步才能到达依赖对象的关系。</p>
<p>事实上在构建的上下文中，有两种依赖关系，<font color="red">实际依赖关系和声明依赖关系</font>。两者差别极小。实际依赖关系指的是构建或者执行的时候A需要B，而声名依赖关系仅仅是在包A中有从A到B的一条依赖线。</p>
<p>为了确保构建的正确性，实际依赖关系A必须是声名依赖关系的子图，也就是说，每一个在A中的直接依赖关系对x—&gt;y，必须也是D中的直接依赖关系对。</p>
<p>在a、b、c三个个字包含了BUILD文件的三个包中，a依赖b，b依赖c，比如下图：  </p>
<p>其中的声明依赖关系为：deps：a–&gt;b;b–&gt;c;  </p>
<p>实际依赖关系为：各自srcs的目标文件中的import 及相应的函数的表征：a–&gt;b；b–&gt;c;  </p>
<p>三种常见的构建规则的依赖关系类型：  </p>
<p>1、srcs依赖：也就是BUILD文件中规则的属性Srcs的值，他表示构建该规则时使用的程序代码；  </p>
<p>2、deps依赖：也就是规则中的deps属性的值，表示构建规则时所需要的头文件等；  </p>
<p>3、data依赖：它不是代码，只是构建规则时需要的数据；  </p>
<p>构建系统在一个独立的目录中进行测试，该目录中仅仅只有命名为data的文件可视，因此，需要测试时，需要声明数据为data文件；  </p>
<p><font color="red">注：您不应将目录指定为构建系统的输入，而应明确或使用该<code>glob()</code>函数枚举其中包含的文件集 用于强制递归。</font></p>
<p>java_binary<br>java_binary（name，deps，srcs，data，resources，args，classpath_resources，compatible_with，<br>create_executable，deploy_env，deploy_manifest_lines，deprecation，distribs，exec_compatible_with，<br>features，javacopts，jvm_flags，launcher，licenses，main_class，output_licenses，plugins，resource_jars，<br>resource_strip_prefix，restricted_to，runtime_deps，stamp，tags，testonly，toolchains，use_testrunner，visibility）  </p>
<p>构建Java归档文件（“jar文件”），以及与规则同名的包装器shell脚本。包装器shell脚本使用一个类路径，<br>其中包括二进制所依赖的每个库的jar文件。  </p>
<p>包装器脚本接受几个唯一标志。请参阅 //src/main/java/com/google/devtools/build/lib/bazel/rules/java/java_stub_template.txt<br>包装器接受的可配置标志和环境变量的列表。</p>
<p>建个target<br>可视化项目的依赖项<br>将项目拆分为多个目标和包<br>控制包之间的目标可见性<br>通过标签引用目标<br>部署目标</p>
<p>设置工作区<br>理解BUILD文件<br>构建项目<br>查看依赖关系图<br>完善bazel 构建<br>指定多个生成目标<br>使用多个包<br>使用标签引用目标<br>打包部署的Java目标<br>进一步读</p>
<p>构建一个项目前需要先建个工作区<br>工作区是保存项目源文件和bazel的目录。<br>工作区文件，将目录及其内容标识为bazel工程<br>位于项目目录结构的根目录<br>构建文件包含几种不同类型的bazel指令<br>最重要的类型是构建规则<br>告诉Bazel如何构建所需的输出<br>例如可执行的二进制文件或库<br>生成文件中生成规则的每个实例都称为目标<br>指向一组特定的源文件和依赖项<br>目标也可以指向其他目标<br>projectrunner目标实例化bazel的内置Java_二进制规则<br>目标中的属性显式地声明其依赖项和选项<br>规则告诉bazel构建一个.jar文件和一个包装shell脚本<br>虽然name属性是必需的，许多是可选的<br>例如，在ProjectRunner规则目标中，name是目标的名称<br>srcs指定bazel用于构建目标的源文件<br>main_类指定包含main方法的类<br>注意目标标签//部分是构建文件rela的位置<br>ProjectRunner是我们在构建文件中命名的目标<br>Bazel的产出与以下类似 </p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">INFO:</span> Found <span class="hljs-number">1</span> target...</span><br><span class="line">Target <span class="hljs-comment">//:ProjectRunner up-to-date:</span></span><br><span class="line">  bazel-bin/ProjectRunner.jar</span><br><span class="line">  bazel-bin/ProjectRunner</span><br><span class="line"><span class="hljs-string">INFO:</span> Elapsed <span class="hljs-string">time:</span> <span class="hljs-number">1.021</span>s, Critical <span class="hljs-string">Path:</span> <span class="hljs-number">0.83</span>s</span><br></pre></td></tr></table></figure>

<p>bazel将构建输出放在工作目录下的bazel bin目录中<br>浏览其内容以了解Bazel的输出结构<br>Bazel要求在生成文件中显式声明生成依赖项<br>Bazel使用这些语句创建项目的依赖关系图从而实现精确的增量构建<br>让我们可视化示例项目的依赖关系。<br>首先，生成依赖关系图的文本表示形式 在工作区根目录下运行命令<br><code>bazel query  --nohost_deps --noimplicit_deps &quot;deps(//:ProjectRunner)&quot; --output graph</code><br>上面的命令告诉bazel查找目标的所有依赖项<br>//:ProjectRunner<br>然后，将文本粘贴到graphviz中<br>如您所见，该项目有一个构建两个源文件的目标<br>现在您已经设置了工作区，构建了项目，并检查了它。<br>完善构建</p>
<p>当一个目标就足以满足小型项目的需求 ，您可能希望将较大的项目拆分为多个目标和包允许快速增量生成<br>只重建已更改的内容 通过同时构建项目的多个部分来加速构建 </p>
<p>指定多个生成目标<br>让我们将示例项目构建分为两个目标。替换内容 </p>
<figure class="highlight nix hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">java_binary(</span><br><span class="line">    <span class="hljs-attr">name</span> = <span class="hljs-string">"ProjectRunner"</span>,</span><br><span class="line">    <span class="hljs-attr">srcs</span> = [<span class="hljs-string">"src/main/java/com/example/ProjectRunner.java"</span>],</span><br><span class="line">    <span class="hljs-attr">main_class</span> = <span class="hljs-string">"com.example.ProjectRunner"</span>,</span><br><span class="line">    <span class="hljs-attr">deps</span> = [<span class="hljs-string">":greeter"</span>],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">java_library(</span><br><span class="line">    <span class="hljs-attr">name</span> = <span class="hljs-string">"greeter"</span>,</span><br><span class="line">    <span class="hljs-attr">srcs</span> = [<span class="hljs-string">"src/main/java/com/example/Greeting.java"</span>],</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>通过这种配置，Bazel首先构建了Greeter库。<br>然后是projectrunner二进制文件<br>java_二进制文件中的deps属性告诉bazel，需要Greeter库来构建ProjectRunner二进制文件<br>让我们构建这个新版本的项目。运行以下命令<br><code>bazel build //:ProjectRunner</code></p>
<p>Bazel的输出与以下类似 </p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">INFO:</span> Found <span class="hljs-number">1</span> target...</span><br><span class="line">Target <span class="hljs-comment">//:ProjectRunner up-to-date:</span></span><br><span class="line">  bazel-bin/ProjectRunner.jar</span><br><span class="line">  bazel-bin/ProjectRunner</span><br><span class="line"><span class="hljs-string">INFO:</span> Elapsed <span class="hljs-string">time:</span> <span class="hljs-number">2.454</span>s, Critical <span class="hljs-string">Path:</span> <span class="hljs-number">1.58</span>s</span><br></pre></td></tr></table></figure>

<p>现在测试新构建的二进制文件 </p>
<p><code>bazel-bin/ProjectRunner</code><br>如果现在修改projectrunner.java并重新生成项目，则bazel仅重新编译该文件<br>查看依赖关系图，您可以看到ProjectRunner 依赖于与以前相同的输入，但构建的结构不同<br>现在您已经用两个目标构建了项目。<br>ProjectRunner目标生成两个源文件并依赖于另一个目标:greeter它会生成一个附加的源文件 </p>
<p>现在让我们把这个项目分成多个包<br>你现在看下src/main/java/com/example/cmdline这个文件夹<br>您可以看到它还包含一个生成文件 BUILD<br>加上一些源文件 因此，对于Bazel，工作区现在包含两个包 </p>
<p><code>//src/main/java/com/example/cmdline 和 //</code></p>
<p>因为在工作区的根目录下有一个生成文件<br>看一下 src/main/java/com/example/cmdline/BUILD 文件</p>
<figure class="highlight nix hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">java_binary(</span><br><span class="line">    <span class="hljs-attr">name</span> = <span class="hljs-string">"runner"</span>,</span><br><span class="line">    <span class="hljs-attr">srcs</span> = [<span class="hljs-string">"Runner.java"</span>],</span><br><span class="line">    <span class="hljs-attr">main_class</span> = <span class="hljs-string">"com.example.cmdline.Runner"</span>,</span><br><span class="line">    <span class="hljs-attr">deps</span> = [<span class="hljs-string">"//:greeter"</span>]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>运行目标依赖greeter目标 在// 包下<br>因此，目标标签 //:greeter<br>bazel 通过deps属性知道这一点<br>看看依赖关系图<br>但是，要使构建成功，必须在//src/main/java/com/example/cmdline/BUILD 文件中明确地给出运行者目标<br>目标可见性在//BUILD中使用visibility属性这是因为默认情况下，目标仅对同一个build 文件中的其他目标可见<br>Bazel使用目标可见性来防止诸如包含泄漏到公共API中的实现细节的库<br>为此，将可见性属性添加到java-tutorial/BUILD中的greeter对象中。 </p>
<p><code>bazel build //src/main/java/com/example/cmdline:runner</code></p>
<figure class="highlight nix hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java_library(</span><br><span class="line">    <span class="hljs-attr">name</span> = <span class="hljs-string">"greeter"</span>,</span><br><span class="line">    <span class="hljs-attr">srcs</span> = [<span class="hljs-string">"src/main/java/com/example/Greeting.java"</span>],</span><br><span class="line">    <span class="hljs-attr">visibility</span> = [<span class="hljs-string">"//src/main/java/com/example/cmdline:__pkg__"</span>],</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>现在我们来构建新的包。在t的根目录下运行以下命令<br>bazel的输出大概如下</p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">INFO:</span> Found <span class="hljs-number">1</span> target...</span><br><span class="line">Target <span class="hljs-comment">//src/main/java/com/example/cmdline:runner up-to-date:</span></span><br><span class="line">  bazel-bin<span class="hljs-regexp">/src/</span>main<span class="hljs-regexp">/java/</span>com<span class="hljs-regexp">/example/</span>cmdline/runner.jar</span><br><span class="line">  bazel-bin<span class="hljs-regexp">/src/</span>main<span class="hljs-regexp">/java/</span>com<span class="hljs-regexp">/example/</span>cmdline/runner</span><br><span class="line"><span class="hljs-symbol">  INFO:</span> Elapsed <span class="hljs-string">time:</span> <span class="hljs-number">1.576</span>s, Critical <span class="hljs-string">Path:</span> <span class="hljs-number">0.81</span>s</span><br></pre></td></tr></table></figure>

<p>现在测试新构建的二进制文件 </p>
<p><code>./bazel-bin/src/main/java/com/example/cmdline/runner</code></p>
<p>现在，您已经将项目修改为两个包，每个包含一个目标，并了解它们之间的依赖关系<br>使用标签引用目标<br>在构建文件和命令行中，bazel使用目标标签进行引用<br>//:ProjectRunner或//src/main/java/com/example/cmdline:runner 他们的语法如下：</p>
<p><code>//path/to/package:target-name</code></p>
<p>如果目标是规则目标 则path/to/package是包含BUILD生成文件的目录的路径<br>目标名称是您在构建文件中为目标命名的名称，如果目标是个文件目标则<br>path/to/package 是指向包根目录的路径目标名称是目标文件的名称，包括其完整路径。</p>
<p>引用同一包中的目标时 您可以跳过包路径 就用 //:target-name<br>引用同一生成文件中的目标时甚至可以跳过工作区根标识符  就用:target-name<br>例如在java-tutorial/BUILD目标文件您不必指定包路径<br>因为工作区根本身就是一个包 (//)你的两个目标标签很简单<br>//:ProjectRunner 和 //:greeter.<br>然而目标在 //src/main/java/com/example/cmdline/BUILD 文件您必须指定全包路径你的目标标签是<br>//src/main/java/com/example/cmdline:runner<br>打包部署一个Java目标<br>现在我们通过构建二进制文件来打包部署Java目标。<br>正如您所记得的，java_二进制构建规则生成一个.jar包和包装shell脚本<br>看下runner.jar的内容使用如下命令</p>
<p><code>jar tf bazel-bin/src/main/java/com/example/cmdline/runner.jar</code></p>
<p>内容如下：</p>
<figure class="highlight avrasm hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">META-INF/</span><br><span class="line">META-INF/MANIFEST.MF</span><br><span class="line"><span class="hljs-keyword">com</span>/</span><br><span class="line"><span class="hljs-keyword">com</span>/example/</span><br><span class="line"><span class="hljs-keyword">com</span>/example/cmdline/</span><br><span class="line"><span class="hljs-keyword">com</span>/example/cmdline/Runner.class</span><br></pre></td></tr></table></figure>

<p>如你所见runner.jar包含Runner.class但不是它的依赖性 Greeting.class<br>runner脚本 bazel生成的runner脚本将greeter.jar添加到类路径中 ，所以如果你像这样放着，<br>他将会在本地运行，但它不会在另一台机器上独立运行 幸运的是，<br>java_二进制规则允许您构建一个自包含的depl<br>要构建它，请在构建runner时向文件名添加_deploy.jar后缀</p>
<p><code>bazel build //src/main/java/com/example/cmdline:runner_deploy.jar</code><br> Bazel输出与以下类似 </p>
 <figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-symbol"> INFO:</span> Found <span class="hljs-number">1</span> target...</span><br><span class="line">Target <span class="hljs-comment">//src/main/java/com/example/cmdline:runner_deploy.jar up-to-date:</span></span><br><span class="line">  bazel-bin<span class="hljs-regexp">/src/</span>main<span class="hljs-regexp">/java/</span>com<span class="hljs-regexp">/example/</span>cmdline/runner_deploy.jar</span><br><span class="line"><span class="hljs-string">INFO:</span> Elapsed <span class="hljs-string">time:</span> <span class="hljs-number">1.700</span>s, Critical <span class="hljs-string">Path:</span> <span class="hljs-number">0.23</span>s</span><br></pre></td></tr></table></figure>

<p> 你刚刚建立了一个runner_deploy.jar<br>它可以独立运行在开发环境之外因为它包含所需的运行时依赖项。 </p>
<p>隐含的输出目标<br>name.jar：Java归档文件，包含与二进制文件直接依赖项对应的类文件和其他资源。<br>name-src.jar：包含源（“源jar”）的存档。<br>name_deploy.jar：适合部署的Java归档文件（仅在明确请求时构建）。<br>构建规则的目标会创建一个自包含的jar文件，其中包含一个清单，允许使用命令或包装器脚本的 选项运行它 。<br>使用包装器脚本是首选，因为它还传递JVM标志和加载本机库的选项。 <name>_deploy.jarjava -jar–singlejarjava -jar</name></p>
<p>部署jar包含类加载器可以找到的所有类，这些类从头到尾从二进制文件的包装器脚本中搜索类路径。它还包含依赖项所需的本机库。<br>它们在运行时自动加载到JVM中。</p>
<p>如果您的目标指定了一个启动器 属性，那么_deploy.jar将是一个原生二进制文件，而不是一个普通的JAR文件。<br>这将包含启动程序以及规则的任何本机（C ++）依赖项，所有这些都链接到静态二进制文件。<br>实际的jar文件的字节将附加到该本机二进制文件，创建一个包含可执行文件和Java代码的二进制blob。<br>您可以直接执行生成的jar文件，就像执行任何本机二进制文件一样。</p>
<p>name_deploy-src.jar：包含从目标的传递闭包收集的源的存档。这些将匹配 deploy.jar除了jar没有匹配的源jar的类。<br>deps没有java_binary规则的规则中 不允许 使用属性srcs; 这样的规则要求 main_class提供者 runtime_deps。</p>
<p>以下代码段说明了一个常见错误：</p>
<figure class="highlight nix hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">java_binary（</span><br><span class="line">    <span class="hljs-attr">name</span> =“DontDoThis”，</span><br><span class="line">    <span class="hljs-attr">srcs</span> = [</span><br><span class="line">        ... ,,</span><br><span class="line">         <span class="hljs-string">"GeneratedJavaFile.java"</span>＃生成的.java文件</span><br><span class="line">    ]</span><br><span class="line">    <span class="hljs-attr">deps</span> = [ <span class="hljs-string">":generating_rule"</span>,]，＃生成该文件的规则</span><br><span class="line">）</span><br></pre></td></tr></table></figure>

<p>改为：</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java_binary（</span><br><span class="line">    name =“DoThisInstead”，</span><br><span class="line">    srcs = [</span><br><span class="line">        <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span>，</span><br><span class="line">        “：generating_rule”</span><br><span class="line">    ]</span><br><span class="line">）</span><br></pre></td></tr></table></figure>

<p>参数<br>属性<br>name<br>Name; required</p>
<p>此目标的唯一名称。</p>
<p>最好使用作为应用程序主入口点的源文件的名称（减去扩展名）。<br>例如，如果您的入口点被调用 Main.java，那么您的名字可能就是Main。<br>deps<br>List of labels; optional</p>
<p>要链接到目标的其他库的列表。看到一般的评论deps在 共同所有的生成规则属性 。<br>srcs<br>List of labels; optional</p>
<p>处理以创建目标的源文件列表。几乎总是需要此属性; 看下面的例外。<br>.java编译 类型的源文件。在生成.java文件的情况下， 通常建议在此处放置生成规则的名称，而不是文件本身的名称。<br>这不仅提高了可读性，而且使规则对未来的更改更具弹性：如果生成规则将来生成不同的文件，您只需要修复一个地方：outs生成规则。<br>您不应该列出生成规则，deps 因为它是无操作。</p>
<p>类型的源文件.srcjar被解压缩和编译。（如果您需要生成一组.java带有genrule 的文件，这非常有用。）</p>
<p>规则：如果规则（通常genrule或filegroup）生成上面列出的任何文件，它们将以与源文件所述相同的方式使用。</p>
<p>除非main_class属性指定运行时类路径上的类或指定runtime_deps参数，否则几乎总是需要 此参数。</p>
<p>resources<br>List of labels; optional</p>
<p>要包含在Java jar中的数据文件列表。<br>如果指定了资源，它们将与.class编译生成的常用文件一起捆绑在jar中 。jar文件中资源的位置由项目结构决定。<br>Bazel首先查找Maven的 标准目录布局，（“src”目录后跟“资源”目录孙子）。<br>如果找不到，那么Bazel会查找名为“java”或“javatests”的最顶层目录<br>（例如，如果资源处于<workspace root>/x/java/y/java/z，则资源的路径将是y/java/z。此启发式扫描不能被覆盖。</workspace></p>
<p>资源可以是源文件或生成的文件。</p>
<p>classpath_resources<br>List of labels; optional</p>
<p>除非没有其他方式，否则不要使用此选项）<br>必须位于Java树根目录的资源列表。此属性的唯一目的是支持第三方库，这些库要求在类路径上找到它们的资源”myconfig.xml”。<br>由于名称空间冲突的危险，它只允许在二进制文件而不是库中。</p>
<p>create_executable<br>Boolean; optional; nonconfigurable; default is True</p>
<p>二进制文件是否可执行。不可执行的二进制文件将传递的运行时Java依赖项收集到部署jar中，但不能直接执行。<br>如果设置了此属性，则不会创建包装器脚本。如果设置了launcher或main_class属性，则将此值设置为0是错误的。<br>deploy_env<br>List of labels; optional</p>
<p>java_binary表示此二进制文件的部署环境 的其他目标的列表。在构建将由另一个加载的插件时设置此属性 java_binary。<br>设置此属性将排除此二进制文件的运行时类路径（和部署jar）中的所有依赖项，这些依赖项在此二进制文件和指定的目标之间共享deploy_env。<br>deploy_manifest_lines<br>List of strings; optional</p>
<p>要添加到META-INF/manifest.mf为*_deploy.jar目标生成的文件 的行列表。此属性的内容不符合“使变量”替换。<br>javacopts<br>List of strings; optional</p>
<p>此库的额外编译器选项。受“Make变量”替换和 Bourne shell标记化的约束。<br>这些编译器选项在全局编译器选项之后传递给javac。</p>
<p>jvm_flags<br>List of strings; optional</p>
<p>要在运行此二进制文件时生成的包装器脚本中嵌入的标志列表。受$（位置）和 “Make变量”替换，以及 Bourne shell标记化。<br>Java二进制文件的包装器脚本包括一个CLASSPATH定义（用于查找所有相关的jar）并调用正确的Java解释器。<br>包装器脚本生成的命令行包含主类的名称，后跟a，”$@”因此您可以在类名后传递其他参数。<br>但是，必须在命令行上的类名之前指定用于由JVM进行解析的参数。在jvm_flags列出类名之前，将内容添加到包装脚本中。</p>
<p>请注意，此属性对 输出没有影响*_deploy.jar。</p>
<p>launcher<br>Label; optional</p>
<p>指定将用于运行Java程序的二进制文件，而不是bin/javaJDK附带的普通程序。<br>目标必须是a cc_binary。任何cc_binary实现 Java Invocation API的都可以指定为此属性的值。<br>默认情况下，Bazel将使用普通的JDK启动程序（bin / java或java.exe）。</p>
<p>相关的 –java_launcherBazel标志仅影响未指定属性的那些 java_binary和java_test目标 。launcher</p>
<p>请注意，根据您使用的是JDK启动程序还是其他启动程序，您的本机（C ++，SWIG，JNI）依赖项的构建方式会有所不同：</p>
<p>如果您使用的是普通的JDK启动程序（默认），则将本机依赖项构建为名为的共享库{name}_nativedeps.so，其中 {name}是name此java_binary规则的属性。<br>在此配置中，链接器不会删除未使用的代码。<br>如果您正在使用任何其他启动程序，则本机（C ++）依赖项将静态链接到名为的二进制文件{name}_nativedeps，其中此java_binary规则{name} 的name属性。<br>在这种情况下，链接器将从生成的二进制文件中删除它认为未使用的任何代码，这意味着除非该cc_library目标指定，否则任何仅通过JNI访问的C ++代码都可能无法链接alwayslink = 1。<br>使用除默认JDK启动程序以外的任何启动程序时，*_deploy.jar输出的格式会更改。有关详细信息，请参阅主 java_binary文档。</p>
<p>main_class<br>String; optional</p>
<p>具有main()用作入口点的方法的类的名称。如果规则使用此选项，则不需要srcs=[…]列表。因此，使用此属性，可以从已包含一个或多个main()方法的Java库生成可执行文件。<br>此属性的值是类名，而不是源文件。该类必须在运行时可用：它可以由此规则（从srcs）编译，或由直接或传递依赖（通过runtime_deps或 deps）提供。如果该类不可用，则二进制文件将在运行时失败; 没有构建时间检查。</p>
<p>plugins<br>List of labels; optional</p>
<p>Java编译器插件在编译时运行。java_plugin无论何时构建此规则，都将运行此属性中指定的每个属性。库也可以从使用的依赖项继承插件 exported_plugins。插件生成的资源将包含在此规则的结果jar中。<br>resource_jars<br>List of labels; optional</p>
<p>包含Java资源的档案集。<br>如果指定，这些jar的内容将合并到输出jar中。</p>
<p>resource_strip_prefix<br>String; optional</p>
<p>从Java资源中剥离的路径前缀。<br>如果指定，则从resources 属性中的每个文件中剥离此路径前缀。资源文件不在此目录下是错误的。如果未指定（默认值），则根据与源文件的Java包相同的逻辑确定资源文件的路径。例如，源文件 stuff/java/foo/bar/a.txt位于foo/bar/a.txt。</p>
<p>runtime_deps<br>List of labels; optional</p>
<p>库可用于最终二进制文件或仅在运行时测试。与普通类似deps，这些将出现在运行时类路径中，但与它们不同，不在编译时类路径上。应在此处列出仅在运行时所需的依赖关系。依赖性分析工具应该忽略出现在两个目标 runtime_deps和deps。<br>stamp<br>Integer; optional; default is -1</p>
<p>启用链接标记。是否将构建信息编码为二进制文件。可能的值：<br>stamp = 1：将构建信息标记到二进制文件中。只有在依赖项发生变化时才会重建标记的二进制文件。如果存在依赖于构建信息的测试，请使用此选项。<br>stamp = 0：始终使用常量值替换构建信息。这提供了良好的构建结果缓存。<br>stamp = -1：嵌入构建信息由 - [no]戳标志控制。<br>toolchains<br>List of labels; optional</p>
<p>提供“Make variables”的工具链集 ，该目标可以在其某些属性中使用。一些规则具有工具链，其默认情况下可以使用Make变量。<br>use_testrunner<br>Boolean; optional; default is False</p>
<p>使用测试运行器（默认情况下 com.google.testing.junit.runner.BazelTestRunner）类作为Java程序的主入口点，并将测试类作为bazel.test_suite 系统属性的值提供给测试运行器。您可以使用它来覆盖默认行为，即使用测试运行器获取 java_test规则，而不是将其用于java_binary规则。你不太可能想要这样做。一种用途是用于AllTest 由另一个规则调用的规则（例如，在运行测试之前设置数据库）。该AllTest 规则必须被声明为java_binary，但仍应使用测试运行器作为其主要入口点。可以使用main_classattribute 覆盖测试运行器类的名称。<br>java_import<br>java_import（name，deps，data，compatible_with，constraints，deprecation，distribs，exec_compatible_with，exports，features，jars，licenses，neverlink，proguard_specs，restricted_to，runtime_deps，srcjar，tags，testonly，visibility）<br>此规则允许将预编译.jar文件用作库java_library和 java_binary规则。</p>
<p>例子</p>
<figure class="highlight lsl hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">java_import（</span><br><span class="line">    name =“maven_model”，</span><br><span class="line">    jars = [</span><br><span class="line">        “maven_model / Maven的以太网提供商<span class="hljs-number">-3.2</span><span class="hljs-number">.3</span>.jar”，</span><br><span class="line">        “maven_model / Maven的模型<span class="hljs-number">3.2</span><span class="hljs-number">.3</span>.jar”，</span><br><span class="line">        “maven_model / Maven的模型建设者<span class="hljs-number">-3.2</span><span class="hljs-number">.3</span>.jar”，</span><br><span class="line">    ]</span><br><span class="line">）</span><br></pre></td></tr></table></figure>

<p>参数</p>
<p>属性<br>name<br>Name; required</p>
<p>此目标的唯一名称。</p>
<p>deps<br>List of labels; optional</p>
<p>要链接到目标的其他库的列表。请参阅java_library.deps。<br>constraints<br>List of strings; optional; nonconfigurable</p>
<p>作为Java库对此规则施加额外约束。<br>exports<br>List of labels; optional</p>
<p>目标可供此规则的用户使用。请参阅java_library.exports。<br>jars<br>List of labels; required</p>
<p>提供给依赖于此目标的Java目标的JAR文件列表。<br>neverlink<br>Boolean; optional; default is False</p>
<p>仅使用此库进行编译，而不是在运行时使用。如果库将在执行期间由运行时环境提供，则很有用。<br>像这样的库的示例是用于IDE插件的IDE API或tools.jar用于在标准JDK上运行的任何内容。<br>proguard_specs<br>List of labels; optional</p>
<p>用作Proguard规范的文件。这些将描述Proguard使用的规范集。如果指定，它们将android_binary根据此库添加到任何目标。<br>此处包含的文件必须只有幂等规则，即-dontnote，-dontwarn，assumenosideeffects和以-keep开头的规则。<br>其他选项只能出现在 android_binaryproguard_specs中，以确保非重言式合并。<br>runtime_deps<br>List of labels; optional</p>
<p>库可用于最终二进制文件或仅在运行时测试。请参阅java_library.runtime_deps。<br>srcjar<br>Label; optional</p>
<p>包含已编译JAR文件的源代码的JAR文件。</p>
<figure class="highlight mipsasm hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">java_library </span></span><br><span class="line"><span class="hljs-keyword">java_library（name，deps，srcs，data，resources，compatible_with，deprecation，</span></span><br><span class="line"><span class="hljs-keyword">distribs，exec_compatible_with，exported_plugins，exports，features，javacopts，</span></span><br><span class="line"><span class="hljs-keyword">licenses，neverlink，plugins，proguard_specs，resource_jars，resource_strip_prefix，</span></span><br><span class="line"><span class="hljs-keyword">restricted_to，runtime_deps，tags，testonly，能见度）</span></span><br></pre></td></tr></table></figure>

<p>此规则编译源并将源链接到.jar文件中。</p>
<p>隐含的输出目标<br>libname.jar：包含类文件的Java归档文件。<br>libname-src.jar：包含源（“源jar”）的存档。<br>参数<br>属性<br>name<br>Name; required</p>
<p>此目标的唯一名称。</p>
<p>deps<br>List of labels; optional</p>
<p>要链接到此库的库列表。看到一般的评论deps在 共同所有的生成规则属性 。<br>由java_library列出的规则构建的jar deps将位于此规则的编译时类路径中。<br>此外，它们的传递闭包 deps，runtime_deps并将exports在运行时类路径上。</p>
<p>相比之下，data属性中的目标包含在运行文件中，但既不包含在编译时也不包含在运行时类路径中。</p>
<p>srcs<br>List of labels; optional</p>
<p>处理以创建目标的源文件列表。几乎总是需要此属性; 看下面的例外。<br>.java编译 类型的源文件。在生成.java文件的情况下， 通常建议在此处放置生成规则的名称，而不是文件本身的名称。<br>这不仅提高了可读性，而且使规则对未来的更改更具弹性：如果生成规则将来生成不同的文件，您只需要修复一个地方：outs生成规则。<br>您不应该列出生成规则，deps 因为它是无操作。</p>
<p>类型的源文件.srcjar被解压缩和编译。（如果您需要生成一组.java带有genrule 的文件，这非常有用。）</p>
<p>规则：如果规则（通常genrule或filegroup）生成上面列出的任何文件，它们将以与源文件所述相同的方式使用。</p>
<p>除非main_class属性指定运行时类路径上的类或指定runtime_deps参数，否则几乎总是需要 此参数。</p>
<p>data<br>List of labels; optional</p>
<p>此库在运行时所需的文件列表。看到一般的评论data在 共同所有的生成规则属性 。<br>在构建时java_library，Bazel不会将这些文件放在任何地方; 如果 data文件是生成文件，那么Bazel会生成它们。<br>构建依赖于此java_libraryBazel 的测试时，data会将文件复制或链接 到runfiles区域。</p>
<p>resources<br>List of labels; optional</p>
<p>要包含在Java jar中的数据文件列表。<br>如果指定了资源，它们将与.class编译生成的常用文件一起捆绑在jar中 。jar文件中资源的位置由项目结构决定。<br>Bazel首先查找Maven的 标准目录布局，（“src”目录后跟“资源”目录孙子）。<br>如果找不到，那么Bazel会查找名为“java”或“javatests”的最顶层目录（例如，如果资源处于<workspace root>/x/java/y/java/z，则资源的路径将是y/java/z。<br>此启发式扫描不能被覆盖。</workspace></p>
<p>资源可以是源文件或生成的文件。</p>
<p>exported_plugins<br>List of labels; optional</p>
<p>java_plugin要导出到直接依赖于此库的库 的s（例如注释处理器）列表。<br>指定的java_plugins 列表将应用于任何直接依赖于此库的库，就像该库已明确声明这些标签一样plugins。</p>
<p>exports<br>List of labels; optional</p>
<p>导出的图书馆。<br>此处的列表规则将使它们可用于父规则，就像父项明确依赖于这些规则一样。对于常规（非导出），情况并非如此deps。</p>
<p>简介：规则X可以访问Y中的代码，如果它们之间存在依赖路径，该路径以deps边缘开始，后跟零个或多个 exports边缘。让我们看一些例子来说明这一点。</p>
<p>假设甲取决于乙和乙取决于Ç。在这种情况下，C是A 的传递依赖，因此更改C的源并重建A将正确地重建所有内容。然而，A将无法使用C中的类。<br>为了允许这种情况，要么A必须在其中声明C deps，要么B可以通过在其（B）中声明C来使A（以及可能依赖于A的任何东西）变得更容易。exports 属性。</p>
<p>所有直接父规则都可以使用导出库的闭包。举一个稍微不同的例子：A依赖于B，B依赖于C和D，并且还导出C而不是D.现在A可以访问C但不能访问D.现在，如果C和D导出了一些库，C’和D’，A只能访问C’但不能访问D’。</p>
<p>重要提示：导出的规则不是常规依赖项。坚持前面的例子，如果B导出C并且想要也使用C，它也必须自己列出它 deps。</p>
<p>javacopts<br>List of strings; optional</p>
<p>此库的额外编译器选项。受“Make变量”替换和 Bourne shell标记化的约束。<br>这些编译器选项在全局编译器选项之后传递给javac。</p>
<p>neverlink<br>Boolean; optional; default is False</p>
<p>此库是仅应用于编译而不是用于运行时。如果库将在执行期间由运行时环境提供，则很有用。此类库的示例是IDE插件的IDE API或tools.jar标准JDK上运行的任何内容。<br>请注意，neverlink = 1这不会阻止编译器将此库中的材料内联到依赖于它的编译目标中，如Java语言规范所允许的那样（例如， 原始类型的static final常量String或常量类型的常量）。因此，当运行时库与编译库相同时，首选用例是。</p>
<p>如果运行时库与编译库不同，则必须确保它仅在JLS禁止编译器内联的位置（并且必须适用于JLS的所有未来版本）中有所不同。</p>
<p>plugins<br>List of labels; optional</p>
<p>Java编译器插件在编译时运行。java_plugin无论何时构建此规则，都将运行此属性中指定的每个属性。库也可以从使用的依赖项继承插件 exported_plugins。插件生成的资源将包含在此规则的结果jar中。<br>proguard_specs<br>List of labels; optional</p>
<p>用作Proguard规范的文件。这些将描述Proguard使用的规范集。如果指定，它们将android_binary根据此库添加到任何目标。此处包含的文件必须只有幂等规则，即-dontnote，-dontwarn，assumenosideeffects和以-keep开头的规则。其他选项只能出现在 android_binaryproguard_specs中，以确保非重言式合并。<br>resource_jars<br>List of labels; optional</p>
<p>包含Java资源的档案集。<br>如果指定，这些jar的内容将合并到输出jar中。</p>
<p>resource_strip_prefix<br>String; optional</p>
<p>从Java资源中剥离的路径前缀。<br>如果指定，则从resources 属性中的每个文件中剥离此路径前缀。资源文件不在此目录下是错误的。如果未指定（默认值），则根据与源文件的Java包相同的逻辑确定资源文件的路径。例如，源文件 stuff/java/foo/bar/a.txt位于foo/bar/a.txt。</p>
<p>runtime_deps<br>List of labels; optional</p>
<p>库可用于最终二进制文件或仅在运行时测试。与普通类似deps，这些将出现在运行时类路径中，但与它们不同，不在编译时类路径上。应在此处列出仅在运行时所需的依赖关系。依赖性分析工具应该忽略出现在两个目标 runtime_deps和deps。</p>
<figure class="highlight autohotkey hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jav<span class="hljs-built_in">a_lite</span>_proto_library </span><br><span class="line">jav<span class="hljs-built_in">a_lite</span>_proto_library（name，deps，data，compatible_with，deprecation，distribs，exec_compatible_with，features，licenses，restricted_to，tags，testonly，visibility）</span><br><span class="line">jav<span class="hljs-built_in">a_lite</span>_proto_library从.proto文件生成Java代码。</span><br></pre></td></tr></table></figure>

<p>deps必须指出proto_library 规则。</p>
<p>例：</p>
<figure class="highlight crystal hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">java_library（</span><br><span class="line">    name =“<span class="hljs-class"><span class="hljs-keyword">lib</span>”，</span></span><br><span class="line">    deps = [“：foo”]，</span><br><span class="line">）</span><br><span class="line"></span><br><span class="line">java_lite_proto_library（</span><br><span class="line">    name =“foo”，</span><br><span class="line">    deps = [“：bar”]，</span><br><span class="line">）</span><br><span class="line"></span><br><span class="line">proto_library（</span><br><span class="line">    name =“bar”，</span><br><span class="line">）</span><br></pre></td></tr></table></figure>

<p>参数<br>属性<br>name<br>Name; required</p>
<p>此目标的唯一名称。</p>
<p>deps<br>List of labels; optional</p>
<p>proto_library 生成Java代码 的规则列表。</p>
<figure class="highlight autohotkey hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jav<span class="hljs-built_in">a_proto</span>_library </span><br><span class="line">jav<span class="hljs-built_in">a_proto</span>_library（name，deps，data，compatible_with，deprecation，distribs，exec_compatible_with，features，licenses，restricted_to，tags，testonly，visibility）</span><br><span class="line">jav<span class="hljs-built_in">a_proto</span>_library从.proto文件生成Java代码。</span><br></pre></td></tr></table></figure>

<p>deps必须指出proto_library 规则。</p>
<p>例：</p>
<figure class="highlight crystal hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">java_library（</span><br><span class="line">    name =“<span class="hljs-class"><span class="hljs-keyword">lib</span>”，</span></span><br><span class="line">    deps = [“：foo_java_proto”]，</span><br><span class="line">）</span><br><span class="line"></span><br><span class="line">java_proto_library（</span><br><span class="line">    name =“foo_java_proto”，</span><br><span class="line">    deps = [“：foo_proto”]，</span><br><span class="line">）</span><br><span class="line"></span><br><span class="line">proto_library（</span><br><span class="line">    name =“foo_proto”，</span><br><span class="line">）</span><br></pre></td></tr></table></figure>

<p>属性<br>name<br>Name; required</p>
<p>此目标的唯一名称。</p>
<p>deps<br>List of labels; optional</p>
<p>proto_library 生成Java代码 的规则列表。</p>
<p>java_test<br>java_test（名称，DEPS，索马里红新月会，数据，资源，ARGS，classpath_resources，compatible_with，create_executable，deploy_manifest_lines，折旧，发行商，exec_compatible_with，功能，片状，javacopts，jvm_flags，发射器，牌照，地方，MAIN_CLASS，插件，resource_jars，resource_strip_prefix，restricted_to，runtime_deps，shard_count，size，stamp，tags，test_class，testonly，timeout，toolchains，use_testrunner，visibility）<br>一个java_test()规则编译一个Java测试。测试是围绕测试代码的二进制包装器。调用测试运行器的main方法而不是正在编译的主类。</p>
<p>隐含的输出目标<br>name.jar：Java存档。<br>name_deploy.jar：适合部署的Java归档文件。（仅在显式请求时才构建。）有关详细信息，请参阅 java_binaryname_deploy.jar输出的 说明。<br>请参阅有关java_binary（）参数的部分。此规则还支持所有测试规则（* _test）共有的所有属性。</p>
<p>例子</p>
<figure class="highlight nix hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">java_library（</span><br><span class="line">    <span class="hljs-attr">name</span> =“tests”，</span><br><span class="line">    <span class="hljs-attr">srcs</span> = glob（[“*。java”]），</span><br><span class="line">    <span class="hljs-attr">deps</span> = [</span><br><span class="line">        “// java的/ COM /富/碱：testResources”，</span><br><span class="line">        “//的Java / COM /富/测试/ UTIL”，</span><br><span class="line">    ]</span><br><span class="line">）</span><br><span class="line"></span><br><span class="line">java_test（</span><br><span class="line">    <span class="hljs-attr">name</span> =“AllTests”，</span><br><span class="line">    <span class="hljs-attr">size</span> =“small”，</span><br><span class="line">    <span class="hljs-attr">runtime_deps</span> = [</span><br><span class="line">        “：测试”，</span><br><span class="line">        “// UTIL / MySQL的”，</span><br><span class="line">    ]</span><br><span class="line">）</span><br></pre></td></tr></table></figure>

<p>参数<br>属性<br>name<br>Name; required</p>
<p>此目标的唯一名称。</p>
<p>deps<br>List of labels; optional</p>
<p>要链接到目标的其他库的列表。看到一般的评论deps在 共同所有的生成规则属性 。<br>srcs<br>List of labels; optional</p>
<p>处理以创建目标的源文件列表。几乎总是需要此属性; 看下面的例外。<br>.java编译 类型的源文件。在生成.java文件的情况下， 通常建议在此处放置生成规则的名称，而不是文件本身的名称。这不仅提高了可读性，而且使规则对未来的更改更具弹性：如果生成规则将来生成不同的文件，您只需要修复一个地方：outs生成规则。您不应该列出生成规则，deps 因为它是无操作。</p>
<p>类型的源文件.srcjar被解压缩和编译。（如果您需要生成一组.java带有genrule 的文件，这非常有用。）</p>
<p>规则：如果规则（通常genrule或filegroup）生成上面列出的任何文件，它们将以与源文件所述相同的方式使用。</p>
<p>除非main_class属性指定运行时类路径上的类或指定runtime_deps参数，否则几乎总是需要 此参数。</p>
<p>resources<br>List of labels; optional</p>
<p>要包含在Java jar中的数据文件列表。<br>如果指定了资源，它们将与.class编译生成的常用文件一起捆绑在jar中 。jar文件中资源的位置由项目结构决定。Bazel首先查找Maven的 标准目录布局，（“src”目录后跟“资源”目录孙子）。如果找不到，那么Bazel会查找名为“java”或“javatests”的最顶层目录（例如，如果资源处于<workspace root>/x/java/y/java/z，则资源的路径将是y/java/z。此启发式扫描不能被覆盖。</workspace></p>
<p>资源可以是源文件或生成的文件。</p>
<p>classpath_resources<br>List of labels; optional</p>
<p>除非没有其他方式，否则不要使用此选项）<br>必须位于Java树根目录的资源列表。此属性的唯一目的是支持第三方库，这些库要求在类路径上找到它们的资源”myconfig.xml”。由于名称空间冲突的危险，它只允许在二进制文件而不是库中。</p>
<p>create_executable<br>Boolean; optional; nonconfigurable; default is True</p>
<p>二进制文件是否可执行。不可执行的二进制文件将传递的运行时Java依赖项收集到部署jar中，但不能直接执行。如果设置了此属性，则不会创建包装器脚本。如果设置了launcher或main_class属性，则将此值设置为0是错误的。<br>deploy_manifest_lines<br>List of strings; optional</p>
<p>要添加到META-INF/manifest.mf为*_deploy.jar目标生成的文件 的行列表。此属性的内容不符合“使变量”替换。<br>javacopts<br>List of strings; optional</p>
<p>此库的额外编译器选项。受“Make变量”替换和 Bourne shell标记化的约束。<br>这些编译器选项在全局编译器选项之后传递给javac。</p>
<p>jvm_flags<br>List of strings; optional</p>
<p>要在运行此二进制文件时生成的包装器脚本中嵌入的标志列表。受$（位置）和 “Make变量”替换，以及 Bourne shell标记化。<br>Java二进制文件的包装器脚本包括一个CLASSPATH定义（用于查找所有相关的jar）并调用正确的Java解释器。包装器脚本生成的命令行包含主类的名称，后跟a，”$@”因此您可以在类名后传递其他参数。但是，必须在命令行上的类名之前指定用于由JVM进行解析的参数。在jvm_flags列出类名之前，将内容添加到包装脚本中。</p>
<p>请注意，此属性对 输出没有影响*_deploy.jar。</p>
<p>launcher<br>Label; optional</p>
<p>指定将用于运行Java程序的二进制文件，而不是bin/javaJDK附带的普通程序。目标必须是a cc_binary。任何cc_binary实现 Java Invocation API的都可以指定为此属性的值。<br>默认情况下，Bazel将使用普通的JDK启动程序（bin / java或java.exe）。</p>
<p>相关的 –java_launcherBazel标志仅影响未指定属性的那些 java_binary和java_test目标 。launcher</p>
<p>请注意，根据您使用的是JDK启动程序还是其他启动程序，您的本机（C ++，SWIG，JNI）依赖项的构建方式会有所不同：</p>
<p>如果您使用的是普通的JDK启动程序（默认），则将本机依赖项构建为名为的共享库{name}_nativedeps.so，其中 {name}是name此java_binary规则的属性。在此配置中，链接器不会删除未使用的代码。<br>如果您正在使用任何其他启动程序，则本机（C ++）依赖项将静态链接到名为的二进制文件{name}_nativedeps，其中此java_binary规则{name} 的name属性。在这种情况下，链接器将从生成的二进制文件中删除它认为未使用的任何代码，这意味着除非该cc_library目标指定，否则任何仅通过JNI访问的C ++代码都可能无法链接alwayslink = 1。<br>使用除默认JDK启动程序以外的任何启动程序时，*_deploy.jar输出的格式会更改。有关详细信息，请参阅主 java_binary文档。</p>
<p>main_class<br>String; optional</p>
<p>具有main()用作入口点的方法的类的名称。如果规则使用此选项，则不需要srcs=[…]列表。因此，使用此属性，可以从已包含一个或多个main()方法的Java库生成可执行文件。<br>此属性的值是类名，而不是源文件。该类必须在运行时可用：它可以由此规则（从srcs）编译，或由直接或传递依赖（通过runtime_deps或 deps）提供。如果该类不可用，则二进制文件将在运行时失败; 没有构建时间检查。</p>
<p>plugins<br>List of labels; optional</p>
<p>Java编译器插件在编译时运行。java_plugin无论何时构建此规则，都将运行此属性中指定的每个属性。库也可以从使用的依赖项继承插件 exported_plugins。插件生成的资源将包含在此规则的结果jar中。<br>resource_jars<br>List of labels; optional</p>
<p>包含Java资源的档案集。<br>如果指定，这些jar的内容将合并到输出jar中。</p>
<p>resource_strip_prefix<br>String; optional</p>
<p>从Java资源中剥离的路径前缀。<br>如果指定，则从resources 属性中的每个文件中剥离此路径前缀。资源文件不在此目录下是错误的。如果未指定（默认值），则根据与源文件的Java包相同的逻辑确定资源文件的路径。例如，源文件 stuff/java/foo/bar/a.txt位于foo/bar/a.txt。</p>
<p>runtime_deps<br>List of labels; optional</p>
<p>库可用于最终二进制文件或仅在运行时测试。与普通类似deps，这些将出现在运行时类路径中，但与它们不同，不在编译时类路径上。应在此处列出仅在运行时所需的依赖关系。依赖性分析工具应该忽略出现在两个目标 runtime_deps和deps。<br>stamp<br>Integer; optional; default is 0</p>
<p>启用链接标记。是否将构建信息编码为二进制文件。可能的值：<br>stamp = 1：将构建信息标记到二进制文件中。只有在依赖项发生变化时才会重建标记的二进制文件。如果存在依赖于构建信息的测试，请使用此选项。<br>stamp = 0：始终使用常量值替换构建信息。这提供了良好的构建结果缓存。<br>stamp = -1：嵌入构建信息由 - [no]戳标志控制。<br>test_class<br>String; optional</p>
<p>由测试运行器加载的Java类。<br>默认情况下，如果未定义此参数，则使用传统模式并使用测试参数。将–nolegacy_bazel_java_test标志设置为不在第一个参数上回退。</p>
<p>此属性指定此测试要运行的Java类的名称。很少需要设置它。如果省略此参数，则将使用目标name及其source-root-relative路径推断出该参数。如果测试位于已知源根目录之外，则Bazel将报告错误（如果test_class 未设置）。</p>
<p>对于JUnit3，测试类需要是子类， junit.framework.TestCase或者需要有一个suite()返回junit.framework.Test（或子类Test）的公共静态方法 。对于JUnit4，该类需要注释 org.junit.runner.RunWith。</p>
<p>此属性允许多个java_test规则共享相同的Test （TestCase，TestSuite，…）。通常将附加信息传递给它（例如通过jvm_flags=[‘-Dkey=value’]），以便其行为在每种情况下都不同，例如运行不同的测试子集。此属性还允许在javatests树外使用Java测试。</p>
<p>toolchains<br>List of labels; optional</p>
<p>提供“Make variables”的工具链集 ，该目标可以在其某些属性中使用。一些规则具有工具链，其默认情况下可以使用Make变量。<br>use_testrunner<br>Boolean; optional; default is True</p>
<p>使用测试运行器（默认情况下 com.google.testing.junit.runner.BazelTestRunner）类作为Java程序的主入口点，并将测试类作为bazel.test_suite 系统属性的值提供给测试运行器。您可以使用它来覆盖默认行为，即使用测试运行器获取 java_test规则，而不是将其用于java_binary规则。你不太可能想要这样做。一种用途是用于AllTest 由另一个规则调用的规则（例如，在运行测试之前设置数据库）。该AllTest 规则必须被声明为java_binary，但仍应使用测试运行器作为其主要入口点。可以使用main_classattribute 覆盖测试运行器类的名称。</p>
<p>java_package_configuration<br>java_package_configuration（name，data，compatible_with，deprecation，distribs，features，javacopts，licenses，packages，restricted_to，tags，testonly，visibility）<br>要应用于一组包的配置。配置可以添加到 java_toolchain.javacoptss。</p>
<p>例：</p>
<figure class="highlight jboss-cli hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">java_package_configuration（</span><br><span class="line">    name =“my_configuration”，</span><br><span class="line">    packages = [“：my_packages”]，</span><br><span class="line">    javacopts = [“ -  Werror”]，</span><br><span class="line">）</span><br><span class="line"></span><br><span class="line">package_group（</span><br><span class="line">    name =“my_packages”，</span><br><span class="line">    包裹= [</span><br><span class="line">        “<span class="hljs-string">//</span> COM /我/项目/ <span class="hljs-string">...</span>”</span><br><span class="line">        “ -  <span class="hljs-string">//</span> COM /我/项目/测试/ <span class="hljs-string">...</span>”</span><br><span class="line">    ]</span><br><span class="line">）</span><br><span class="line"></span><br><span class="line">java_toolchain（</span><br><span class="line">    <span class="hljs-string">...</span></span><br><span class="line">    package_configuration = [</span><br><span class="line">        “：my_configuration”</span><br><span class="line">    ]</span><br><span class="line">）</span><br></pre></td></tr></table></figure>

<p>参数<br>属性<br>name<br>Name; required</p>
<p>此目标的唯一名称。</p>
<p>data<br>List of labels; optional</p>
<p>此配置在运行时所需的文件列表。<br>javacopts<br>List of strings; optional</p>
<p>Java编译器标志。<br>packages<br>List of labels; optional</p>
<p>package_group应该应用配置 集。</p>
<p>java_plugin<br>java_plugin（name，deps，srcs，data，resources，compatible_with，deprecation，distribs，exec_compatible_with，features，generate_api，javacopts，licenses，neverlink，output_licenses，plugins，processor_class，proguard_specs，resource_jars，resource_strip_prefix，restricted_to，tags，testonly，能见度）<br>java_plugin为Bazel运行的Java编译器定义插件。目前，唯一受支持的插件类型是注释处理器。A java_library或 java_binary规则可以通过plugins 属性依赖于它们来运行插件。A java_library还可以自动将插件导出到直接依赖它的库 exported_plugins。</p>
<p>隐含的输出目标<br>libname.jar：Java存档。<br>java_library除了添加processor_class参数外， 参数与之相同。</p>
<p>参数<br>属性<br>name<br>Name; required</p>
<p>此目标的唯一名称。</p>
<p>deps<br>List of labels; optional</p>
<p>要链接到此库的库列表。看到一般的评论deps在 共同所有的生成规则属性 。<br>由java_library列出的规则构建的jar deps将位于此规则的编译时类路径中。此外，它们的传递闭包 deps，runtime_deps并将exports在运行时类路径上。</p>
<p>相比之下，data属性中的目标包含在运行文件中，但既不包含在编译时也不包含在运行时类路径中。</p>
<p>srcs<br>List of labels; optional</p>
<p>处理以创建目标的源文件列表。几乎总是需要此属性; 看下面的例外。<br>.java编译 类型的源文件。在生成.java文件的情况下， 通常建议在此处放置生成规则的名称，而不是文件本身的名称。这不仅提高了可读性，而且使规则对未来的更改更具弹性：如果生成规则将来生成不同的文件，您只需要修复一个地方：outs生成规则。您不应该列出生成规则，deps 因为它是无操作。</p>
<p>类型的源文件.srcjar被解压缩和编译。（如果您需要生成一组.java带有genrule 的文件，这非常有用。）</p>
<p>规则：如果规则（通常genrule或filegroup）生成上面列出的任何文件，它们将以与源文件所述相同的方式使用。</p>
<p>除非main_class属性指定运行时类路径上的类或指定runtime_deps参数，否则几乎总是需要 此参数。</p>
<p>data<br>List of labels; optional</p>
<p>此库在运行时所需的文件列表。看到一般的评论data在 共同所有的生成规则属性 。<br>在构建时java_library，Bazel不会将这些文件放在任何地方; 如果 data文件是生成文件，那么Bazel会生成它们。构建依赖于此java_libraryBazel 的测试时，data会将文件复制或链接 到runfiles区域。</p>
<p>resources<br>List of labels; optional</p>
<p>要包含在Java jar中的数据文件列表。<br>如果指定了资源，它们将与.class编译生成的常用文件一起捆绑在jar中 。jar文件中资源的位置由项目结构决定。Bazel首先查找Maven的 标准目录布局，（“src”目录后跟“资源”目录孙子）。如果找不到，那么Bazel会查找名为“java”或“javatests”的最顶层目录（例如，如果资源处于<workspace root>/x/java/y/java/z，则资源的路径将是y/java/z。此启发式扫描不能被覆盖。</workspace></p>
<p>资源可以是源文件或生成的文件。</p>
<p>generates_api<br>Boolean; optional; default is False</p>
<p>此属性标记生成API代码的注释处理器。<br>如果规则使用API 生成注释处理器，则只有在生成规则之后调度其编译操作时，依赖于它的其他规则才能引用生成的代码。当启用了–java_header_compilation时，此属性指示Bazel引入调度约束。</p>
<p>警告：此属性会影响构建性能，仅在必要时使用它。</p>
<p>javacopts<br>List of strings; optional</p>
<p>此库的额外编译器选项。受“Make变量”替换和 Bourne shell标记化的约束。<br>这些编译器选项在全局编译器选项之后传递给javac。</p>
<p>neverlink<br>Boolean; optional; default is False</p>
<p>此库是仅应用于编译而不是用于运行时。如果库将在执行期间由运行时环境提供，则很有用。此类库的示例是IDE插件的IDE API或tools.jar标准JDK上运行的任何内容。<br>请注意，neverlink = 1这不会阻止编译器将此库中的材料内联到依赖于它的编译目标中，如Java语言规范所允许的那样（例如， 原始类型的static final常量String或常量类型的常量）。因此，当运行时库与编译库相同时，首选用例是。</p>
<p>如果运行时库与编译库不同，则必须确保它仅在JLS禁止编译器内联的位置（并且必须适用于JLS的所有未来版本）中有所不同。</p>
<p>output_licenses<br>Licence type; optional</p>
<p>看到 common attributes<br>plugins<br>List of labels; optional</p>
<p>Java编译器插件在编译时运行。java_plugin无论何时构建此规则，都将运行此属性中指定的每个属性。库也可以从使用的依赖项继承插件 exported_plugins。插件生成的资源将包含在此规则的结果jar中。<br>processor_class<br>String; optional</p>
<p>处理器类是Java编译器应该用作注释处理器入口点的类的完全限定类型。如果未指定，此规则将不会为Java编译器的注释处理提供注释处理器，但其运行时类路径仍将包含在编译器的注释处理器路径中。（这主要供 Error Prone插件使用，它使用 java.util.ServiceLoader从注释处理器路径加载 。）<br>proguard_specs<br>List of labels; optional</p>
<p>用作Proguard规范的文件。这些将描述Proguard使用的规范集。如果指定，它们将android_binary根据此库添加到任何目标。此处包含的文件必须只有幂等规则，即-dontnote，-dontwarn，assumenosideeffects和以-keep开头的规则。其他选项只能出现在 android_binaryproguard_specs中，以确保非重言式合并。<br>resource_jars<br>List of labels; optional</p>
<p>包含Java资源的档案集。<br>如果指定，这些jar的内容将合并到输出jar中。</p>
<p>resource_strip_prefix<br>String; optional</p>
<p>从Java资源中剥离的路径前缀。<br>如果指定，则从resources 属性中的每个文件中剥离此路径前缀。资源文件不在此目录下是错误的。如果未指定（默认值），则根据与源文件的Java包相同的逻辑确定资源文件的路径。例如，源文件 stuff/java/foo/bar/a.txt位于foo/bar/a.txt。<br>java_runtime<br>java_runtime（name，srcs，compatible_with，deprecation，distribs，features，java，java_home，licenses，restricted_to，tags，testonly，visibility）<br>指定Java运行时的配置。</p>
<p>例：</p>
<figure class="highlight lsl hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java_runtime（</span><br><span class="line">    name =“jdk<span class="hljs-number">-9</span>-ea + <span class="hljs-number">153</span>”，</span><br><span class="line">    srcs = glob（[“jdk9-ea + <span class="hljs-number">153</span> / **”]），</span><br><span class="line">    java_home =“jdk9-ea + <span class="hljs-number">153</span>”，</span><br><span class="line">）</span><br></pre></td></tr></table></figure>

<p>参数<br>属性<br>name<br>Name; required</p>
<p>此目标的唯一名称。</p>
<p>srcs<br>List of labels; optional</p>
<p>运行时中的所有文件。<br>java<br>Label; optional</p>
<p>java可执行文件的路径。<br>java_home<br>String; optional</p>
<p>运行时根目录的路径。受“制造”变量替代。如果此路径是绝对路径，则该规则表示具有众所周知路径的非密集Java运行时。在那种情况下，srcs和 属性必须为空。<br>java_toolchain<br>java_toolchain（名称，启动类路径，compatible_with，折旧，发行商，extclasspath，功能，forcibly_disable_header_compilation，genclass，header_compiler，header_compiler_direct，ijar，jacocorunner，javabuilder，javabuilder_jvm_opts，javac的，javac_supports_workers，javacopts，jvm_opts，许可证，oneversion，oneversion_whitelist，package_configuration，resourcejar，restricted_to，singlejar，source_version，tags，target_version，testonly，timezone_data，tools，visibility，xlint）<br>指定Java编译器的配置。可以通过–java_toolchain参数更改要使用的工具链。通常，除非要调整Java编译器，否则不应编写这些规则。</p>
<p>例子<br>一个简单的例子是：</p>
<figure class="highlight nix hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java_toolchain（</span><br><span class="line">    <span class="hljs-attr">name</span> =“toolchain”，</span><br><span class="line">    <span class="hljs-attr">source_version</span> =“<span class="hljs-number">7</span>”，</span><br><span class="line">    <span class="hljs-attr">target_version</span> =“<span class="hljs-number">7</span>”，</span><br><span class="line">    <span class="hljs-attr">bootclasspath</span> = [“// tools / jdk：bootclasspath”]，</span><br><span class="line">    <span class="hljs-attr">xlint</span> = [“classfile”，“divzero”，“empty”，“options”，“path”]，</span><br><span class="line">    <span class="hljs-attr">javacopts</span> = [“ -  g”]，</span><br><span class="line">    <span class="hljs-attr">javabuilder</span> =“：JavaBuilder_deploy.jar”，</span><br><span class="line">）</span><br></pre></td></tr></table></figure>

<p>参数<br>属性<br>name<br>Name; required</p>
<p>此目标的唯一名称。</p>
<p>bootclasspath<br>List of labels; optional</p>
<p>Java目标bootclasspath条目。对应于javac的-bootclasspath标志。<br>extclasspath<br>List of labels; optional</p>
<p>Java目标extdir条目。对应于javac的-extdir标志。<br>forcibly_disable_header_compilation<br>Boolean; optional; default is False</p>
<p>覆盖–java_header_compilation以在不支持它的平台上禁用标头编译，例如JDK 7 Bazel。<br>genclass<br>List of labels; required</p>
<p>GenClass部署jar的标签。<br>header_compiler<br>List of labels; optional</p>
<p>标头编译器的标签。如果启用了–java_header_compilation，则为必需。<br>header_compiler_direct<br>List of labels; optional</p>
<p>标头编译器的可选标签，用于不包含任何API生成注释处理器的直接类路径操作。<br>此工具不支持注释处理。</p>
<p>ijar<br>List of labels; required</p>
<p>ijar可执行文件的标签。<br>jacocorunner<br>Label; optional</p>
<p>JacocoCoverageRunner部署jar的标签。<br>javabuilder<br>List of labels; required</p>
<p>JavaBuilder部署jar的标签。<br>javabuilder_jvm_opts<br>List of strings; optional</p>
<p>调用JavaBuilder时JVM的参数列表。<br>javac<br>List of labels; optional</p>
<p>javac jar的标签。<br>javac_supports_workers<br>Boolean; optional; default is True</p>
<p>如果JavaBuilder支持作为持久性工作程序运行，则为True，否则为false。<br>javacopts<br>List of strings; optional</p>
<p>Java编译器的额外参数列表。有关可能的Java编译器标志的详尽列表，请参阅Java编译器文档。<br>jvm_opts<br>List of strings; optional</p>
<p>调用Java编译器时JVM的参数列表。有关此选项的可能标志的详细列表，请参阅Java虚拟机文档。<br>oneversion<br>Label; optional</p>
<p>单版本强制二进制文件的标签。<br>oneversion_whitelist<br>Label; optional</p>
<p>单版本白名单的标签。<br>package_configuration<br>List of labels; optional</p>
<p>应该应用于指定包组的配置。<br>resourcejar<br>List of labels; optional</p>
<p>资源jar构建器可执行文件的标签。<br>singlejar<br>List of labels; required</p>
<p>SingleJar部署jar的标签。<br>source_version<br>String; optional</p>
<p>Java源代码版本（例如，’6’或’7’）。它指定Java源代码中允许哪组代码结构。<br>target_version<br>String; optional</p>
<p>Java目标版本（例如，’6’或’7’）。它指定应该为哪个Java运行时构建类。<br>timezone_data<br>Label; optional</p>
<p>包含时区数据的资源jar的标签。如果设置，则时区数据将作为所有java_binary规则的隐式运行时依赖项添加。<br>tools<br>List of labels; optional</p>
<p>可用于jvm_opts中标签扩展的工具标签。<br>xlint<br>List of strings; optional</p>
<p>要添加或从默认列表中删除的警告列表。用破折号在它之前删除它。有关更多信息，请参阅-Xlint选项上的Javac文档。</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-29T13:06:00.000Z">2019-07-29</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    10 分钟 read (About 1479 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/29/OSGI-Command3/">OSGI Command3</a>
            
        </h1>
        <div class="content">
            <p>OSGI中自定义command<br>前文</p>
<p>在上一篇博文中，我们讲述了什么是OSGI中的command，同时写了一个简单的command，这个command实现了org.apache.felix.gogo.commands.Action这个接口，同样可以实现相同功能的还有<br>org.apache.karaf.shell.console.OsgiCommandSupport这一个抽象类，但是在本程序中，这两个接口或者抽象类上都标注了@Deprecated，因此已经不推荐使用了，而当前推荐使用的则是karaf中的一个接口，为org.apache.karaf.shell.api.action.Action，但是这个在使用过程中会出现一定的问题，这个稍后再说，本文主要讲解的是，不再使用karaf提供的@Service,@Command和继承或者实现相关接口来编写Command，而是在blueprint.xml的方式配置一个Command，这个文字不太好描述，下面就直接用相关程序来讲解本次编写的command。<br>自定义command<br>首先不多说，新建一个类，命名为SampleCommand，里面分别写三个方法，两个无参方法，一个有参，为以下：  </p>
<figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">first</span>(<span class="hljs-params"></span>)</span> &#123;</span><br><span class="line">        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"first"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">second</span>(<span class="hljs-params"></span>)</span> &#123;</span><br><span class="line">        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"second"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hello</span>(<span class="hljs-params">String name</span>)</span> &#123;</span><br><span class="line">        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"hello "</span> + name);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>以上，等会再控制台中显示，上述两个无参方法，就是普通命令，而有参方法则是可以传入一个参数，并且会在控制台中打出，在以上完成之后，还要在blueprint.xml中配置相关命令，blueprint.xml中内容如下：  </p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">"cn.com.files.command.SampleCommand"</span> id=<span class="hljs-string">"sampleCommand"</span>/&gt;</span><br><span class="line">    &lt;service auto-<span class="hljs-keyword">export</span>=<span class="hljs-string">"all-classes"</span> ref=<span class="hljs-string">"sampleCommand"</span>&gt;</span><br><span class="line">        &lt;service-properties&gt;</span><br><span class="line">            &lt;entry key=<span class="hljs-string">"osgi.command.scope"</span>&gt;</span><br><span class="line">                &lt;!-- define the prefix <span class="hljs-keyword">for</span> you commands --&gt;</span><br><span class="line">                &lt;value&gt;sample&lt;<span class="hljs-regexp">/value&gt;</span></span><br><span class="line"><span class="hljs-regexp">            &lt;/</span>entry&gt;</span><br><span class="line">            &lt;entry key=<span class="hljs-string">"osgi.command.function"</span>&gt;</span><br><span class="line">                &lt;!-- declare the list <span class="hljs-keyword">of</span> all the methods you want to expose --&gt;</span><br><span class="line">                &lt;array value-type=<span class="hljs-string">"java.lang.String"</span>&gt;</span><br><span class="line">                    &lt;value&gt;first&lt;<span class="hljs-regexp">/value&gt;</span></span><br><span class="line"><span class="hljs-regexp">                    &lt;value&gt;second&lt;/</span>value&gt;</span><br><span class="line">                    &lt;value&gt;hello&lt;<span class="hljs-regexp">/value&gt;</span></span><br><span class="line"><span class="hljs-regexp">                &lt;/</span>array&gt;</span><br><span class="line">            &lt;<span class="hljs-regexp">/entry&gt;</span></span><br><span class="line"><span class="hljs-regexp">        &lt;/</span>service-properties&gt;</span><br><span class="line">    &lt;<span class="hljs-regexp">/service&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们首先进行了一个bean的配置，即将SampleCommand配置为bean，其次我们配置了一个service，并在osgi.command.scope中的value中指定值为sample，这就是我们先前写的scope，而在指定的osgi.command.function中指定的数组中的值，即为我们编写的几个方法名，如此配置完成之后，我们的command就基本完成了，现在只需要重新在控制台mvn clean install -U -DskipTests之后，再次打开karaf的控制台，观察当前bundle的启动状态，以及我们编写的command。<br>运行<br>打开karaf控制台，输入list，bundle运行状态如下所示： </p>
<p><img src="/images/pasted-58.png" alt="upload successful"></p>
<p>其中ID为13的，name为Storage的这一个state为Active，说明Bundle正常启动，现在尝试运行我们编写的命令，输入sample，这是我们之前定义的scope，按下tab键，有以下提示: </p>
<p><img src="/images/pasted-59.png" alt="upload successful">  </p>
<p>在提示中，三个方法依次提示出来，我们执行sample:first,sample:second都将会在控制台中打出内容，如下所示：   </p>
<p><img src="/images/pasted-60.png" alt="upload successful">  </p>
<p>以上依次执行我们方法中的内容，现在开始我们的方法3即sample:hello,在输入以上命令后，按下tab键，此时并没有什么提示，但是我们却是需要输入一个参数，这个提示在上一篇中的command的定义方法，并指定一个参数，并编写相关方法后确实是有提示的这个稍后再提，在我们输入sample:hello world后，控制台打出的内容为：   </p>
<p><img src="/images/pasted-61.png" alt="upload successful">  </p>
<p>如此，带有参数的命令也正常执行了。</p>
<p>其他实现</p>
<p>其实在实现带有参数的命令中，还有另外一种实现，在此可以说一下，这里提供了另外一种注解，即为@Argument,将这个加在我们在命令中的参数上，就像是以下这样：</p>
<figure class="highlight nix hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Argument(<span class="hljs-attr">index</span> = <span class="hljs-number">0</span>, <span class="hljs-attr">name</span> = <span class="hljs-string">"arg"</span>, <span class="hljs-attr">description</span> = <span class="hljs-string">"the command argument"</span>, <span class="hljs-attr">required</span> = <span class="hljs-literal">false</span>, <span class="hljs-attr">multiValued</span> = <span class="hljs-literal">false</span>)</span><br><span class="line">String arg;</span><br><span class="line">```  </span><br><span class="line">然后还需要一个completer类，在这作为对参数的提示，我编写的如下所示：</span><br></pre></td></tr></table></figure>

<p>/**</p>
<ul>
<li><p>Created by xiaxuan on 16/7/6.</p>
</li>
<li><p>a simple Completer</p>
</li>
<li><p>/
public class SimpleCompeter implements Completer {</p>
<p>  public int complete(String buffer, int cursor, List<string> candidates) {</string></p>
<pre><code>StringsCompleter delegate = new StringsCompleter();
delegate.getStrings().add(&quot;one&quot;);
delegate.getStrings().add(&quot;two&quot;);
delegate.getStrings().add(&quot;three&quot;);
return delegate.complete(buffer, cursor, candidates);</code></pre><p>  }<br>}</p>
<figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">同时还需在<span class="hljs-selector-tag">blueprint</span><span class="hljs-selector-class">.xml</span>中的命令中配置相关的<span class="hljs-selector-tag">completer</span>，如下：</span><br></pre></td></tr></table></figure>

</li>
</ul>
<command-bundle xmlns="http://karaf.apache.org/xmlns/shell/v1.0.0">
        <command name="test/args">
            <action class="cn.com.files.command.ArgsCommand">
            </action>
            <completers>
                <ref component-id="simpleCompleter">
                <null>
            </null></ref></completers>
        
    </command-bundle>
```
如此也是完成了一个带有参数的命令，但是问题在于，我在karaf控制台中执行这个命令的时候，按下tab键的时候确实是有相关的提示，就是我们在completer中编写的one、two、three。但是输入其中任何一个，在控制台中输出的始终是null，我在看karaf源码的时候，karaf中的任意一个模块基本都是使用了大量的命令，我使用的方法和他们的类似，但是输出却是出了一定的问题，这个如果有过研究的人希望能与我探讨一下这个问题。

<p>总结</p>
<ul>
<li><p>其实这种命令，在更多上，是属于自己的扩展，应用于制作第三方的客户端的较多，在平常应用的编写中，这种command编写的还是比较少，因为在生产环境中，多半已经把ssh登录限制了，所以基本不可能远程登录karaf控制台来执行自己的命令。</p>
</li>
<li><p>在命令的使用上，更多还是使用后续讲解这一种命令较好，这种官方提供更多的支持，并且提供了许多种注解可以使用，可以加上@Argument,@Option等等。</p>
</li>
<li><p>命令更多的只是对我们的应用程序的一种辅助，在真正的生产环境中，建议还是不要大量的运用这种命令，该用接口的还是使用接口实现。</p>
</li>
</ul>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-27T10:48:00.000Z">2019-07-27</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 分钟 read (About 516 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/27/OSGI-Command/">OSGI Command</a>
            
        </h1>
        <div class="content">
            <p>OSGI中Command -控制台命令</p>
<p>在OSGI的中开发bundle，在Karaf容器中加载bundle后，往往需要获取bundle处理的中间信息，用于调试、故障定位等。而org.apache.karaf.shell.console提供一种可以以控制台命令的方式介入bundle。提供一种在运行时，以命令触发原代码中的逻辑功能。</p>
<p><img src="/images/pasted-53.png" alt="upload successful"><br>具体开发，与开发bundle过程一样，有几点需要注意：</p>
<p>1、@Command @Option @Argument 的使用，父类OsgiCommandSupport和重载方法doExecute</p>
<p>2、pom中的build的plugin需要增加maven-scr-plugin</p>
<p>3、pom的build的maven-bundle-plugin显示Import org.apache.karaf.shell.*</p>
<figure class="highlight scala hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> com.zte.sdn.oscp.yang.adapter;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> org.apache.karaf.shell.commands.<span class="hljs-type">Argument</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> org.apache.karaf.shell.commands.<span class="hljs-type">Command</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> org.apache.karaf.shell.commands.<span class="hljs-type">Option</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> org.apache.karaf.shell.console.<span class="hljs-type">OsgiCommandSupport</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Created by sunquan on 2017/10/20.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-meta">@Command</span>(scope = <span class="hljs-string">"livio"</span>, name = <span class="hljs-string">"example"</span>, description = <span class="hljs-string">"livio exmaple command"</span>)</span><br><span class="line">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExampleCommand</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">OsgiCommandSupport</span> </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@Option</span>(name = <span class="hljs-string">"-n"</span>,</span><br><span class="line">            aliases = &#123;<span class="hljs-string">"--Name"</span>&#125;,</span><br><span class="line">            description = <span class="hljs-string">"Show the information of specific shard module"</span>,</span><br><span class="line">            required = <span class="hljs-literal">false</span>,</span><br><span class="line">            multiValued = <span class="hljs-literal">false</span>)</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> shardModuleName = <span class="hljs-string">""</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-meta">@Argument</span>(index = <span class="hljs-number">0</span>, name = <span class="hljs-string">"command"</span>,</span><br><span class="line">            description = <span class="hljs-string">"[help]"</span>,</span><br><span class="line">            required = <span class="hljs-literal">true</span>, multiValued = <span class="hljs-literal">false</span>)</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> command = <span class="hljs-string">"help"</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-keyword">protected</span> <span class="hljs-type">Object</span> doExecute() <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (!shardModuleName.isEmpty()) &#123;</span><br><span class="line">            <span class="hljs-type">System</span>.out.println(<span class="hljs-string">"Name:"</span> + shardModuleName);</span><br><span class="line">        &#125;</span><br><span class="line">        switch (command) &#123;</span><br><span class="line">            <span class="hljs-keyword">case</span> <span class="hljs-string">"help"</span>:</span><br><span class="line">                session.getConsole().println(<span class="hljs-string">"help command output"</span>);</span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">            <span class="hljs-keyword">case</span> <span class="hljs-string">"print"</span>:</span><br><span class="line">                session.getConsole().println(<span class="hljs-string">"print command output"</span>);</span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">            <span class="hljs-keyword">default</span>:</span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中multiValued为false，command字段则为字符串help或print，即输入命令中字面量<br>但如果为true,表示该参数可以配置多个值command字段，会自动加上[],并以逗号分隔。如livio:example print help  则command字段为[print,help]</p>
<figure class="highlight dust hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span></span><br><span class="line"><span class="hljs-xml">         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;</span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"> </span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.zte.sunquan.demo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>yang-adapter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>bundle<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"> </span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"> </span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-comment">&lt;!--&lt;dependency&gt;--&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-comment">&lt;!--&lt;groupId&gt;com.zte.sunquan.demo&lt;/groupId&gt;--&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-comment">&lt;!--&lt;artifactId&gt;yang-middle&lt;/artifactId&gt;--&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-comment">&lt;!--&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;--&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-comment">&lt;!--&lt;/dependency&gt;--&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.osgi<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>org.osgi.compendium<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.osgi<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>org.osgi.core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.felix<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>org.apache.felix.scr<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.8.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.felix<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>org.apache.felix.scr.annotations<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.9.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.karaf.shell<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>org.apache.karaf.shell.console<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.zte.sunquan.demo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>yang-admodel<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.felix<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-bundle-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">extensions</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">extensions</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">instructions</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">Bundle-ManifestVersion</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">Bundle-ManifestVersion</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">Bundle-Name</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;project.description&#125;</span><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Bundle-Name</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">Bundle-SymbolicName</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;project.groupId&#125;</span><span class="hljs-xml">.$</span><span class="hljs-template-variable">&#123;project.artifactId&#125;</span><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Bundle-SymbolicName</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">Bundle-Version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;project.version&#125;</span><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Bundle-Version</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">Bundle-Vendor</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;project.groupId&#125;</span><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Bundle-Vendor</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">Import-Package</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                            !com.zte.sdn.oscp.commons.serialize.binary.protostuff*,</span></span><br><span class="line"><span class="hljs-xml">                            org.apache.karaf.shell.*,</span></span><br><span class="line"><span class="hljs-xml">                            com.zte.sdn.oscp.yang.gen.v1.ip.device.rev20170324.*,</span></span><br><span class="line"><span class="hljs-xml">                            com.zte.sdn.oscp.yang.gen.v1.ip.device.rev20170324.NetconfState.*,</span></span><br><span class="line"><span class="hljs-xml">                        *<span class="hljs-tag">&lt;/<span class="hljs-name">Import-Package</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                        <span class="hljs-comment">&lt;!--&lt;Private-Package&gt;&lt;/Private-Package&gt;--&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                        <span class="hljs-comment">&lt;!--&lt;Embed-Dependecy&gt;&lt;/Embed-Dependecy&gt;--&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">instructions</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.felix<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-scr-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.21.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>generate-scr-scrdescriptor<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>scr<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                        <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>在reources/OSGI-INF/blueprint目录中增加文件shell-config.xml并输入</p>
<figure class="highlight livecodeserver hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;blueprint xmlns=<span class="hljs-string">"http://www.osgi.org/xmlns/blueprint/v1.0.0"</span>&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;<span class="hljs-keyword">command</span>-bundle <span class="hljs-title">xmlns</span>=<span class="hljs-string">"http://karaf.apache.org/xmlns/shell/v1.1.0"</span>&gt;</span><br><span class="line">        &lt;<span class="hljs-keyword">command</span>&gt;</span><br><span class="line">            &lt;action class=<span class="hljs-string">"com.zte.sdn.oscp.yang.adapter.ExampleCommand"</span>/&gt;</span><br><span class="line">        &lt;/<span class="hljs-keyword">command</span>&gt;</span><br><span class="line">    &lt;/<span class="hljs-keyword">command</span>-bundle&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/blueprint&gt;</span><br></pre></td></tr></table></figure>


        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-27T10:48:00.000Z">2019-07-27</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    8 分钟 read (About 1271 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/27/OSGI-Command2/">OSGI Command2</a>
            
        </h1>
        <div class="content">
            <p>OSGI中command的应用  </p>
<p>在上一篇博文中，我们讲解了osgi中的blueprint，但并没有对此作出具体的运用，在本文及以后将会在讲osgi中其他应用的时候将blueprint串进来讲解，本文将要讲讲解的是osgi中的command，在编写的应用中，可能涉及到数据迁移或者其他一些操作，如果这个通过调用接口来进行操作的话，如果非相关人员获取到相关接口调用方式，可能会带来一些危害，所以在不得已的情况下不会使用接口的方式，这个时候command的作用就体现出来了，如果自己编写数个命令，然后在运行容器的command中执行命令，就可以直接完成我们所需要的操作，下面我们就开始使用相关api完成我们所用的command。</p>
<p>相关程序</p>
<p>使用osgi的command必须在相关类中实现Action接口，这是felix提供的一个interface，具体为<br><code>import org.apache.felix.gogo.commands.Action</code><br>在其实现的方法中写入我们所需要的程序逻辑，我们命令执行的内容都在这里，其中要提一下的是，并不只是可以s实现Action接口一种，还可以继承OsgiCommandSupport类，实现方法doExecute，也可以实现相同的效果，其中OsgiCommandSupport包名及类名为以下：  </p>
<p><code>import org.apache.karaf.shell.console.OsgiCommandSupport</code><br>其实在这里面还有一种为:<br><code>org.apache.karaf.shell.api.action.Action</code><br>这个应该也是可以的，但是在使用的时候，karaf会报错，因此这个再次暂且不讲，等日后有机会搞清楚了再来说这个，我估计的话，现在最好实现的都是这一种，因为前两种都已经被不推荐使用了。<br>在实现相应的方法后，还需要在类上加上以下注解：  </p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@Service</span></span><br><span class="line"><span class="hljs-variable">@Log4j</span></span><br><span class="line"><span class="hljs-variable">@Command</span>(scope = <span class="hljs-string">"test"</span>, name = <span class="hljs-string">"hello"</span>, description = <span class="hljs-string">"start for hello world"</span>)</span><br></pre></td></tr></table></figure>

<p>@Log4j注解可有可无，在这主要是用来记录日志，加上@Service和@Command注解是必须的，标注为command和在karaf控制台中使用，里面具体参数使用可以查看到相应注解的源码，上面都有着详细的注释和说明。<br>commmand基本就是这么多东西，其中源码为：  </p>
<figure class="highlight actionscript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span> lombok.extern.log4j.Log4j;</span></span><br><span class="line"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span> org.apache.felix.gogo.commands.Action;</span></span><br><span class="line"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span> org.apache.felix.service.command.CommandSession;</span></span><br><span class="line"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span> org.apache.karaf.shell.api.action.Command;</span></span><br><span class="line"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span> org.apache.karaf.shell.api.action.lifecycle.Service;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Created by xiaxuan on 16/4/20.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line">@Service</span><br><span class="line">@Log4j</span><br><span class="line">@Command(scope = <span class="hljs-string">"test"</span>, name = <span class="hljs-string">"hello"</span>, description = <span class="hljs-string">"start for hello world"</span>)</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloCommand</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Action</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">public</span> Object execute(CommandSession session) throws Exception &#123;</span><br><span class="line">        log.info(<span class="hljs-string">"Hello word"</span>);</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个完成之后，还需要在blueprint.xml文件中配置command，如下所示：  </p>
<figure class="highlight livecodeserver hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="hljs-keyword">command</span>-bundle <span class="hljs-title">xmlns</span>=<span class="hljs-string">"http://karaf.apache.org/xmlns/shell/v1.0.0"</span>&gt;</span><br><span class="line">      &lt;<span class="hljs-keyword">command</span> <span class="hljs-title">name</span>=<span class="hljs-string">"test/hello"</span>&gt;</span><br><span class="line">          &lt;action class=<span class="hljs-string">"cn.com.files.command.HelloCommand"</span>&gt;&lt;/action&gt;</span><br><span class="line">      &lt;/<span class="hljs-keyword">command</span>&gt;</span><br><span class="line">  &lt;/<span class="hljs-keyword">command</span>-bundle&gt;</span><br></pre></td></tr></table></figure>

<p>程序运行<br>在启动容器之后，在命令行中，打开karaf客户端，为以下： </p>
<p><img src="/images/pasted-54.png" alt="upload successful"><br>首先输入list命令，确保bundle正常启动，本示例写在storage这个bundle中，为以下： </p>
<p><img src="/images/pasted-55.png" alt="upload successful"><br>id为13的bundle的状态为active，可以确定我们的bundle处于活跃状态，现在控制台输入test，为我们之前command的scope，按tab键，提示如下：</p>
<p><img src="/images/pasted-56.png" alt="upload successful"><br>有多个提示，第一个可以不用理会，第二个即为我们编写的command命令，第三个为之后我将要讲述的。<br>控制台输入test:hello，查看控制台输出：<br><img src="/images/pasted-57.png" alt="upload successful"><br>控制台得到正常输出结果，hello world,命令执行正常。</p>
<p>使用规范及其他</p>
<ul>
<li><p>个人在使用command上，更多是使用在数据导入或者数据修复的时候使用，正常的业务逻辑一般不会使用command来实现。</p>
</li>
<li><p>我在以上使用的command实现的接口或者继承的类中，两个都是已经过时的接口或者抽象类，现在一般通常使用的应该是karaf的那一个Action，但是在使用上可能会有些问题，个人认为可能是在配置上和当前有所区别，应该和注解无关，在@Service注解中的注释中，还提到了karaf的这一个Action类。但是本文在此没有使用这个Action，望有使用过的可以和我讨论一下。</p>
</li>
<li><p>command可以实现接口或者继承类来做到，也可以自定义自己的command，然后在blueprint做相关的配置即可，要比上述编写的command稍微简单点，用法也多样化一点。</p>
</li>
<li><p>在上述command中，command可以传入参数，并且参数可以有多个，这个在下一篇博文中或许会有所提及。</p>
</li>
<li><p>以上编写的command，都是基于karaf容器来运行的。</p>
</li>
</ul>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-26T21:49:00.000Z">2019-07-26</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    10 分钟 read (About 1468 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/27/karaf命令行开发/">karaf命令行开发</a>
            
        </h1>
        <div class="content">
            <p>ONOS编程系列(二)命令行命令与服务开发</p>
<p>此文章承接ONOS编程系列（一） Application Tutorial ，如果尚未看过上一篇，请先看完上一篇，再回过头来看此篇。<br>本文章的目的在于让读者明白：</p>
<pre><code>如何将新建的application扩展为新的服务，以便其他服务或者应用可以调用它
如何将该application的功能扩展为Karaf命令行界面下的一个新命令</code></pre><p>我们假设你已经安装并且能初步掌握Mininet，因为后面的测试工作需要用到它。<br>项目架构</p>
<p><img src="/images/pasted-39.png" alt="upload successful"><br>一、扩展为服务<br>1.1 定义服务接口<br>首先，在onos-api包下定义一个新的服务的接口，该包目录是${ONOS_ROOT}/core/api/src/main/java/org/onosproject/net/。在此目录下，创建一个新文件夹apps/，作为新接口的位置。接口文件放在此处的意义在于只有这样cli的包才能访问到它，而cli包正是实现命令行命令的包。  </p>
<p><img src="/images/pasted-40.png" alt="upload successful">    </p>
<p><img src="/images/pasted-41.png" alt="upload successful">  </p>
<p>1.2 导入服务接口<br>接下来，我们会在IntentReactiveForwarding文件中实现该服务接口。  </p>
<p><img src="/images/pasted-42.png" alt="upload successful"><br>在本教程中我们用不到该应用生成的服务，不过如果要调用该服务，只需要这样既可：  </p>
<p><img src="/images/pasted-43.png" alt="upload successful">    </p>
<p>1.3 实现该服务接口</p>
<p>要实现该服务接口，我们向类IntentReactiveForwarding增加了新的Map，endPoints成员变量。Map成员在process()方法中用来存储HostService提供的终端信息。</p>
<p><img src="/images/pasted-44.png" alt="upload successful">  </p>
<p>现在，一个引用了ForwardingMapService的模块就可以通过调用getEndPoints()方法获取能够双向通信的终端列表了，这些终端上都安装了本模块的intents。</p>
<p>接下来，创建一个新的Karaf CLI命令来使用这个新的服务。该命令的动能是列出map的内容，并且可选地提供一个过滤参数，来过滤主机源的地址。  </p>
<p>二、创建karaf的一个新命令<br>Karaf CLI命令定义在项目目录${ONOS_ROOT}/cli/之下。有两种类型的命令，分别在不同的目录下：  </p>
<pre><code>${ONOS_ROOT}/cli/src/main/java/org/onosproject/cli 系统配置与监视相关的命令所在目录
${ONOS_ROOT}/cli/src/main/java/org/onosproject/cli/net 网络配置与监视相关的命令所在目录  </code></pre><p>我们要建立的命令要显示网络相关的信息，所以我们要在第二个目录下增加我们的command类。  </p>
<p>2.1 新建一个command类</p>
<p>在第二个目录下，创建一个名为ForwardingMapCommand的类文件。该类是AbstractShellCommand的子类，在类中要使用命令相关的一些注解：</p>
<pre><code>@Command 该注解用来设置命令的名字，作用范围以及功能描述
@Argument 该注解用来指定命令的参数</code></pre><p><img src="/images/pasted-45.png" alt="upload successful">  </p>
<p>2.3 注册这个command，使其能在karaf CLI下使用<br>接下来，我们需要编辑shell-config.xml文件，该文件位于${ONOS_ROOT}/cli/src/main/resources/OSGI-INF/blueprint/，其作用是告诉karaf有新的命令加入了。编辑格式是在里面填上我们的命令的相关信息：  </p>
<p><img src="/images/pasted-46.png" alt="upload successful">  </p>
<p>三、验证<br>3.1 重编译，重启动ONOS  </p>
<p>一切修改完毕之后，进入onos根目录重新编译，编译成功之后运行onos：  </p>
<p><img src="/images/pasted-47.png" alt="upload successful">  </p>
<p>进入欢迎界面之后，可以键入“fwdmap –help”查看我们新建命令的描述： </p>
<p><img src="/images/pasted-48.png" alt="upload successful">  </p>
<p>3.2 启动Mininet，构建测试网络  </p>
<p>新开一个命令行界面，在此界面下开启mininet（默认是本地启动，所以ip是127.0.0.1）：<br>sudomn –topo=tree,2,2 –controller=remote,ip=127.0.0.1 –mac<br>此时，在ONOS界面下可以看到四个终端，三个交换机：<br>3.3 测试命令行<br>键入fwdmap，可以看到没有什么结果返回，因为这个时候网络中的主机之间还没有进行通信呢。  </p>
<p><img src="/images/pasted-49.png" alt="upload successful">  </p>
<p>切换到mininet控制界面，键入pingall，执行一次主机间的通信。</p>
<p><img src="/images/pasted-50.png" alt="upload successful"><br>然后再切换回onos命令行，再次键入fwdmap命令：  </p>
<p><img src="/images/pasted-51.png" alt="upload successful"><br>问题一</p>
<p>在onos命令行下键入fwdmap，如果出现以下结果：<br>就要回头看看IntentReactiveForwarding类前面有没有加@Service注解了。    </p>
<p>如果注解没问题，那么就有可能是当前并没有安装ifwd模块。用命令“feature:list -i | grepifwd”查看当前是否安装了ifwd模块，如果返回结果为空，则要手动安装一下：feature:installonos-app-ifwd 。<br>问题二</p>
<p>在用mininet命令行下pingall以后，再次在onos下键入fwdma，如果还没有任何输出，可能就是源代码哪里又出了问题。</p>
<p>我下载到源代码以后，切换版本到了onos-1.1，该版本下，本来就是有一个ifwd的项目的，不过比教程里的东西要少一些。在手动敲入代码的时候，我大致略过了已有的代码，但是注意，教程里的代码并非完全在原有代码基础上进行的增加，在IntentReactiveForwarding文件中，函数setUpConnectivity中，红框框住的部分是原有的部分，蓝框框住的部分是教程中的部分，可以看到，两者还是有一点区别的：  </p>
<p><img src="/images/pasted-52.png" alt="upload successful"><br>解决这个问题以后，再次走一遍流程，应该就能看到结果了吧。</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-26T07:29:00.000Z">2019-07-26</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 分钟 read (About 1028 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/26/karaf-部署应用/">karaf 部署应用 </a>
            
        </h1>
        <div class="content">
            <h4 id="ONOS编程系列-一-之简单应用开发"><a href="#ONOS编程系列-一-之简单应用开发" class="headerlink" title="ONOS编程系列(一)之简单应用开发"></a>ONOS编程系列(一)之简单应用开发</h4><p>一个ONOS application是使用mevan做管理的OSGi bundle。 因此，ONOS application 可以归结为Java类和pom文件的集合。本教程以基于intent的交互式转发application为例，讨论了如何从零开始建立一个新应用。<br>本教程假设读者已经具备ONOS的运行经验，能够熟练启动ONOS实例。有关ONOS的启动不做过多描述。如果出现启动上的问题，请移步官方wiki文档自行寻找答案。<br>本文章结束后，你应该学会：</p>
<pre><code>应用的组织与结构；
如何在多个服务中注册你的应用；
北向API的基本应用；
如何运行一个应用。</code></pre><p>一、在idea中导入工程</p>
<p>1.设置项目的目录结构<br>应用的根目录设置在apps/之下：  </p>
<p>2.添加并编辑pom文件<br>在启动karaf/ONOS命令行界面以后，直接用feature:install加上名字，即可安装此应用。<br>然后，编辑apps/pom.xml，在文件中以形式包含该项目：</p>
<p><img src="/images/pasted-33.png" alt="upload successful"></p>
<p>2.3 在karaf中注册该应用<br>Karaf在运行时若要部署该应用module，需要名为feature.xml的描述性文件，编辑 ${ONOS_ROOT}/features/features.xml：   </p>
<p><img src="/images/pasted-32.png" alt="upload successful"></p>
<p>该应用的核心是名为 IntentReactiveForwarding.java的文件，被定义在${ONOS_ROOT}/apps/ src/main/java/org/onosproject/ifwd/ 里。<br>为了便于对文档进行注释，在main/java/下需要添加一个package-info.java文件，其包含一下内容：</p>
<p><img src="/images/pasted-34.png" alt="upload successful"></p>
<p>3.1 注册Karaf，使其自动加载</p>
<p>karaf的模块加载机制需要几个annotations，即注解，去注册。可用的注解尤其是以下四个尤为重要：</p>
<pre><code>@Component(immediate = true) - declares a class as a component to activate, and forces immediate activation;
@Activate - marks a method as the method to call during the component startup routine;
@Deactivate - marks a method as the method to call during component shutdown;
@Reference(cardinality = ReferenceCardinality.MANDATORY_UNARY) - Marks a service as an application&apos;s dependency,and requires one instance of such a service to be loaded before this application&apos;s activation.</code></pre><p><img src="/images/pasted-35.png" alt="upload successful"></p>
<p>3.2 注册服务</p>
<p>接下来，我们的应用必须使用CoreService注册一个独一无二的application ID，这样才能够使该应用正常使用ONOS的其他服务。我们的应用接下来还要使用PacketService监听PacketIn和PacketOut事件。而PacketService需要一个事件处理器的类，该类用途单一，通常写在其所属类的内部，成为其私有内部类：</p>
<p><img src="/images/pasted-36.png" alt="upload successful"></p>
<p>3.3增加包处理代码</p>
<p>在上一步的私有内部类ReactivePacketProcessor里，要覆写扩展自接口PacketProcessor的方法process()。每当有网络包进来的时候，PacketService都会调用一下process()函数。这意味着我们可以在这个方法里定义我们自己的包转发行为：</p>
<p><img src="/images/pasted-37.png" alt="upload successful"><br>接下来我们要实现上图中用到的三个方法，注意，这些方法定义在私有内部类的外面，是IntentReactiveForwarding的成员：</p>
<p><img src="/images/pasted-38.png" alt="upload successful"><br>3.4 编译该应用  </p>
<p>3.5 启动该应用  </p>
<p>启动分为动态启动与静态启动：<br>动态启动就是用karaf clean命令启动onos之后，在onos命令行下键入feature:installonos-app-ifwd命令安装该应用。<br>静态启动就是修改karaf的启动配置文件。该文件路径为${KARAF_ROOT}/etc/org.apache.karaf.features.cfg，直接将onos-app-ifwd字样缀到featuresBoot变量的尾部即可。<br>启动并加载该应用以后，可已键入：  </p>
<p><code>feature:list -i | grepifwd</code></p>
<p>该应用安装以后，并不能对其做什么操作，也无法看到它的运行情况，这时我们就需要将该应用扩展为一种服务，以便于其它服务或者应用与其交互，并且需要新建一条karaf的命令，用于展示当前应用的相关信息与状态。</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-25T18:01:00.000Z">2019-07-25</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    15 分钟 read (About 2324 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/26/java-动态代理/">java 动态代理</a>
            
        </h1>
        <div class="content">
            <p>retrofit是一个解耦性非常高的网络请求框架，最近在研究的时候发现了动态代理这个非常强大且实用的技术，这篇文章将作为retrofit的前置知识，让大家认识：动态代理有哪些应用场景,什么是动态代理，怎样使用，它的局限性在什么地方？</p>
<p>动态代理的应用场景</p>
<ol>
<li>AOP—面向切面编程，程序解耦</li>
</ol>
<p>简言之当你想要对一些类的内部的一些方法，在执行前和执行后做一些共同的的操作，而在方法中执行个性化操作的时候–用动态代理。在业务量庞大的时候能够降低代码量，增强可维护性。</p>
<ol start="2">
<li>想要自定义第三放类库中的某些方法</li>
</ol>
<p>我引用了一个第三方类库，但他的一些方法不满足我的需求，我想自己重写一下那几个方法，或在方法前后加一些特殊的操作–用动态代理。但需要注意的是，这些方法有局限性，我会在稍后说明。</p>
<p>什么是动态代理</p>
<p>以上的图太过于抽象，我们从生活中的例子开始切入。</p>
<p>假如你是一个大房东（被代理人），你有很多套房子想要出租，而你觉得找租客太麻烦，不愿意自己弄，因而你找一个人来代理你（代理人），帮打理这些东西，而这个人（代理人也就是中介）在帮你出租房屋的时候对你收取一些相应的中介费（对房屋出租的一些额外操作）。对于租客而言，中介就是房东，代理你做一些事情。</p>
<p>以上，就是一个代理的例子，而他为什么叫动态代理，“动态”两个字体现在什么地方？</p>
<p>我们可以这样想，如果你的每一套房子你都请一个代理人帮你打理，每当你想再出租一套房子的时候你得再请一个，这样你会请很多的代理人，花费高额的中介成本，这可以看作常说的“静态代理”。</p>
<p>但假如我们把所有的房子都交给一个中介来代理，让他在多套房子之间动态的切换身份，帮你应付每一个租客。这就是一个“动态代理”的过程。动态代理的一大特点就是编译阶段没有代理类在运行时才生成代理类。</p>
<p>我们用一段代码来看一下</p>
<p>房屋出租的操作</p>
<figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">*定义一个接口</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">**/</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">RentHouse</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">rent</span>(<span class="hljs-params"></span>)</span>;<span class="hljs-comment">//房屋出租</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">charge</span>(<span class="hljs-params">String str</span>)</span>;<span class="hljs-comment">//出租费用收取</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>房东</p>
<figure class="highlight axapta hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HouseOwner</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RentHouse</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> rent() &#123;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="hljs-string">"I want to rent my house"</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> charge(String <span class="hljs-keyword">str</span>) &#123;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="hljs-string">"You get : "</span> + <span class="hljs-keyword">str</span> + <span class="hljs-string">" RMB HouseCharge."</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>中介</p>
<figure class="highlight monkey hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DynamicProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">InvocationHandler</span> &#123;</span></span><br><span class="line"></span><br><span class="line">// 这个就是我们要代理的真实对象，即房东</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">private</span> Object subject;</span><br><span class="line"></span><br><span class="line">// 构造方法，给我们要代理的真实对象赋初值</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> DynamicProxy(Object subject) &#123;</span><br><span class="line"></span><br><span class="line">this.subject = subject;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> Object invoke(Object proxy, <span class="hljs-function"><span class="hljs-keyword">Method</span> <span class="hljs-title">method</span>, <span class="hljs-title">Object</span>[] <span class="hljs-title">args</span>) <span class="hljs-title">throws</span> <span class="hljs-title">Throwable</span> &#123;</span></span><br><span class="line"></span><br><span class="line">// 在代理真实对象前我们可以添加一些自己的操作，中介收取中介费</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="hljs-string">"before "</span>+<span class="hljs-function"><span class="hljs-keyword">method</span>.<span class="hljs-title">getName</span>(</span>)+<span class="hljs-string">" house"</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="hljs-string">"Method:"</span> + <span class="hljs-function"><span class="hljs-keyword">method</span>.<span class="hljs-title">getName</span>(</span>));</span><br><span class="line"></span><br><span class="line">// 如果方法是 charge 则中介收取<span class="hljs-number">100</span>元中介费</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span> (<span class="hljs-function"><span class="hljs-keyword">method</span>.<span class="hljs-title">getName</span>(</span>).equals(<span class="hljs-string">"charge"</span>)) &#123;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">method</span>.<span class="hljs-title">invoke</span>(</span>subject, args);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="hljs-string">"I will get 100 RMB ProxyCharge."</span>);</span><br><span class="line"></span><br><span class="line">&#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">// 当代理对象调用真实对象的方法时，其会自动的跳转到代理对象关联的handler对象的invoke方法来进行调用</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">method</span>.<span class="hljs-title">invoke</span>(</span>subject, args);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 在代理真实对象后我们也可以添加一些自己的操作</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="hljs-string">"after "</span>+<span class="hljs-function"><span class="hljs-keyword">method</span>.<span class="hljs-title">getName</span>(</span>)+<span class="hljs-string">" house"</span>);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客人</p>
<figure class="highlight haxe hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> void main(<span class="hljs-keyword">String</span>[] args)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 我们要代理的真实对象--房东</span></span><br><span class="line"></span><br><span class="line">HouseOwner houseOwner = <span class="hljs-keyword">new</span> <span class="hljs-type">HouseOwner</span>();</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 我们要代理哪个真实对象，就将该对象传进去，最后是通过该真实对象来调用其方法的</span></span><br><span class="line"></span><br><span class="line">InvocationHandler handler = <span class="hljs-keyword">new</span> <span class="hljs-type">DynamicProxy</span>(houseOwner);</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">* 通过Proxy的newProxyInstance方法来创建我们的代理对象，我们来看看其三个参数</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">* 第一个参数 handler.getClass().getClassLoader() ，我们这里使用handler这个类的ClassLoader对象来加载我们的代理对象</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">* 第二个参数realSubject.getClass().getInterfaces()，我们这里为代理对象提供的接口是真实对象所实行的接口，表示我要代理的是该真实对象，这样我就能调用这组接口中的方法了</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">* 第三个参数handler， 我们这里将这个代理对象关联到了上方的 InvocationHandler 这个对象上</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">*/</span></span><br><span class="line"></span><br><span class="line">RentHouse rentHouse = (RentHouse) Proxy.<span class="hljs-keyword">new</span><span class="hljs-type">ProxyInstance</span>(handler.getClass().getClassLoader(), houseOwner</span><br><span class="line"></span><br><span class="line">.getClass().getInterfaces(), handler);<span class="hljs-comment">//一个动态代理类，中介</span></span><br><span class="line"></span><br><span class="line">System.out.println(rentHouse.getClass().getName());</span><br><span class="line"></span><br><span class="line">rentHouse.rent();</span><br><span class="line"></span><br><span class="line">rentHouse.charge(<span class="hljs-string">"10000"</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们来看一下输出</p>
<figure class="highlight awk hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">com.sun.proxy.<span class="hljs-variable">$Proxy0</span></span><br><span class="line"></span><br><span class="line">before rent house</span><br><span class="line"></span><br><span class="line">Method:rent</span><br><span class="line"></span><br><span class="line">I want to rent my house</span><br><span class="line"></span><br><span class="line">after rent house</span><br><span class="line"></span><br><span class="line">before charge house</span><br><span class="line"></span><br><span class="line">Method:charge</span><br><span class="line"></span><br><span class="line">You get : <span class="hljs-number">10000</span> RMB HouseCharge.</span><br><span class="line"></span><br><span class="line">I will get <span class="hljs-number">100</span> RMB ProxyCharge.</span><br><span class="line"></span><br><span class="line">after charge house</span><br><span class="line"></span><br><span class="line">Process finished with <span class="hljs-keyword">exit</span> code <span class="hljs-number">0</span></span><br></pre></td></tr></table></figure>

<p>输出里有 before rent house以及after rent house，说明我们可以在方法的前后增加操作。再看输出 I will get 100 RMB ProxyCharge. 中介收取了100块的中介费，说明我们不仅可以增加操作，甚至可以替换该方法或者直接让该方法不执行。</p>
<p>刚开始看代码你可能会有很多疑惑，我们通过以下的内容来看看动态代理应该怎么用。</p>
<p>动态代理该如何使用</p>
<p>在java的动态代理机制中，有两个重要的类和接口，一个是InvocationHandler(Interface)、另一个则是Proxy(Class)，这一个类和接口是实现我们动态代理所必须用到的。</p>
<p>每一个动态代理类都必须要实现InvocationHandler这个接口（代码中的中介），并且每个代理类的实例都关联到了一个handler，当我们通过代理对象调用一个方法的时候，这个方法的调用就会被转发为由InvocationHandler这个接口的invoke（对方法的增强就写在这里面） 方法来进行调用。</p>
<p>Object invoke(Object proxy, Method method, Object[] args) throws Throwable</p>
<p>我们看到这个方法一共接受三个参数，那么这三个参数分别代表什么呢？</p>
<p>Object invoke(Object proxy, Method method, Object[] args) throws Throwable</p>
<p>//proxy: 指代我们所代理的那个真实对象</p>
<p>//method: 指代的是我们所要调用真实对象的某个方法的Method对象</p>
<p>//args: 指代的是调用真实对象某个方法时接受的参数</p>
<p>接下来我们来看看Proxy这个类</p>
<p>public static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) throws IllegalArgumentException</p>
<p>Proxy这个类的作用就是用来动态创建一个代理对象的类，它提供了许多的方法，但是我们用的最多的就是 newProxyInstance 这个方法：</p>
<p>public static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) throws IllegalArgumentException</p>
<p>这个方法的作用就是得到一个动态的代理对象，其接收三个参数，我们来看看这三个参数所代表的含义</p>
<p>public static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) throws IllegalArgumentException</p>
<p>//loader: 一个ClassLoader对象，定义了由哪个ClassLoader对象来对生成的代理对象进行加载</p>
<p>//interfaces: 一个Interface对象的数组，表示的是我将要给我需要代理的对象提供一组什么接口，如果我提供了一组接口给它，那么这个代理对象就宣称实现了该接口(多态)，这样我就能调用这组接口中的方法了</p>
<p>//h: 一个InvocationHandler对象，表示的是当我这个动态代理对象在调用方法的时候，会关联到哪一个InvocationHandler对象上</p>
<p>这样一来，结合上面给出的代码，我们就可以明白动态代理的使用方法了</p>
<p>动态代理的局限性</p>
<p>从动态代理的使用方法中我们看到其实可以被增强的方法都是实现了借口的（不实现借口的public方法也可以通过继承被代理类来使用），代码中的HouseOwner继承了RentHouse 。而对于private方法JDK的动态代理无能为力！</p>
<p>以上的动态代理是JDK的，对于java工程还有大名鼎鼎的CGLib，但遗憾的是CGLib并不能在android中使用，android虚拟机相对与jvm还是有区别的。</p>
<p>结束语</p>
<p>动态代理的使用场景远不止这些，内部原理会在以后的文章中介绍，但应用类反射临时生成代理类这一机制决定它对性能会有一定的影响。本文作为retrofit原理的前置文章并没有太过详尽，如有疏漏和错误，欢迎指正，如果觉得不错的朋友也请帮我点个关注，你的喜欢是我最大的动力~！</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-25T14:19:00.000Z">2019-07-25</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    几秒 read (About 43 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/25/serialVersionUID-idea-生成/">serialVersionUID idea 生成</a>
            
        </h1>
        <div class="content">
            <p>1.进入到设置<br><img src="/images/pasted-30.png" alt="upload successful"><br>2.设置之后，选中对应的类名，然后按 alt+enter 快捷键 的情况如下所示<br><img src="/images/pasted-31.png" alt="upload successful"></p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-25T13:15:00.000Z">2019-07-25</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 分钟 read (About 497 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/25/SuppressWarning/">@SuppressWarning</a>
            
        </h1>
        <div class="content">
            <p>@SuppressWarnings(“rawtypes”) 是什么含义</p>
<p>简介：java.lang.SuppressWarnings是J2SE 5.0中标准的Annotation之一。可以标注在类、字段、方法、参数、构造方法，以及局部变量上。<br>作用：告诉编译器忽略指定的警告，不用在编译完成后出现警告信息。<br>使用：<br>@SuppressWarnings(“”)<br>@SuppressWarnings({})<br>@SuppressWarnings(value={})<br>根据sun的官方文档描述：<br>value - 将由编译器在注释的元素中取消显示的警告集。允许使用重复的名称。忽略第二个和后面出现的名称。出现未被识别的警告名不是 错误：编译器必须忽略无法识别的所有警告名。但如果某个注释包含未被识别的警告名，那么编译器可以随意发出一个警告。<br>各编译器供应商应该将它们所支持的警告名连同注释类型一起记录。鼓励各供应商之间相互合作，确保在多个编译器中使用相同的名称。<br>示例：<br>·   @SuppressWarnings(“unchecked”)<br>告诉编译器忽略 unchecked 警告信息，如使用List，ArrayList等未进行参数化产生的警告信息。<br>·   @SuppressWarnings(“serial”)<br>如果编译器出现这样的警告信息：The serializable class WmailCalendar does not declare a static final serialVersionUID field of type long<br>       使用这个注释将警告信息去掉。<br>·   @SuppressWarnings(“deprecation”)<br>如果使用了使用@Deprecated注释的方法，编译器将出现警告信息。<br>       使用这个注释将警告信息去掉。<br>·   @SuppressWarnings(“unchecked”, “deprecation”)<br>告诉编译器同时忽略unchecked和deprecation的警告信息。<br>·   @SuppressWarnings(value={“unchecked”, “deprecation”})<br>等同于@SuppressWarnings(“unchecked”, “deprecation”)  </p>
<p>SuppressWarnings压制警告，即去除警告<br>rawtypes是说传参时也要传递带泛型的参数<br>@SuppressWarnings(“unchecked”)<br>告诉编译器忽略 unchecked 警告信息，如使用List，ArrayList等未进行参数化产生的警告信息。  </p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-24T19:18:00.000Z">2019-07-24</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    1 小时 read (About 9747 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/25/KARAF/">KARAF</a>
            
        </h1>
        <div class="content">
            <p>Karaf：简述对Karaf的认识</p>
<p>Karaf是基于OSGI之上建立的应用容器，能方便部署各种选定的组件，简化打包和安装应用的操作难度。Open DayLight项目发布之初，后台框架仅采用OSG技术，但自从第三版氦He版本至今， Open Daylight项目就采用了Kaaf作为后台的框架，明显提升了项目的可用性和灵活性。<br>Karaf是一个 Apache软件基金会项目，具有 Apache v2许可证。是一个基于实时运行的轻量级的基于OSGI的容器，各种组件和应用都能部署到这个容器中。<br>一、Karaf 的架构图<br><img src="/images/pasted-27.png" alt="upload successful"><br>二、Karaf 的安装目录结构  </p>
<p>/bin: 启动脚本<br>/etc: 初始化文件<br>/data: 工作目录<br>/cache: OSGi框架包缓存<br>/generated-bundles: 部署使用的临时文件夹<br>/log: 日志文件<br>/deploy: 热部署目录<br>/instances: 含有子实例的目录<br>/lib: 包含引导库<br>/lib/ext:JRE扩展目录<br>/lib/endorsed: 赞同库目录<br>/system: OSGi包库，作为一个Maven2存储库  </p>
<p>三、Karaf的基本特性<br>Karaf典型的特性有:<br>热部署： Karaf支持 OSGI bundles的热部署。实现这个支持的关键在于 Karaf持续监测[home]/deply目录内的jar文件。每次当一个jar文件被复制到这个文件夹内，它将在运行时被安装。可以更新或删除它，这个改动将被自动处理。此外， Karaf也支持 exploded bundles和自定义的部署(默认包含 blueprint和 spring)<br>动态配置：服务通常通过OsGi服务的配置管理来进行配置。这样的配置可在 Karaf中的[home]/ec目录使用合适的文件进行定义。这样配置被监控，并且属性的改变将传播给服务。<br>日志系统：使用Log4J支持的集中日志后端，Kaaf能支持许多不同的APls(JDK14、JCL、SLF4J、 Avalon、 Tomcat、OSGi)。<br>供应：库或应用的供应( Provisioning)能通过不同的方式完成。供应在本地下载、安装、启动。<br>原生OS整合：Karaf能以服务的方式整合到一个操作系统OS中，这样生命周期就和这个OS相绑定。<br>扩展的内核控制台：Karaf的内核控制台可管理服务，安装新应用或库，并且管理它们的状态。这个内核能通过部署新命令以安装新功能或应用实现动态扩展。<br>远程访问：使用任何的SSH客户端以连接Karaf并且在控制台发出命令。<br>基于JAAS的安全框架。<br>管理实例：Karaf提供简单的命令以管理多实例。通过控制台能简单地创建、删除、启动、终止 Karaf的实例。<br>四、karaf在 Open Daylight使用中的一些常用命令<br>[cmd]-help：获取一个指定命令的相关帮助。<br><code>若需要了解 bundle: list命令，则输入:bundle: list --help; Karat将返回有关这个命令的帮助。</code><br>features: list：查看已安装的 features。<br><code>feature: install my_feature：安装本地 feature的命令。</code><br>如 <code>feature: install odl-reston。</code><br><code>feature:uninstall my_feature</code>:卸载已经安装的fm的命令。<br>如  
<code>feature uninstall odl-restconf</code> </p>
<p><code>feature: repo-add my repo：将库安装至本地。</code><br>如 <code>feature: repo-add camel2.152</code></p>
<p>log: display：显示系统日志，可配合grep来筛选需要查看的内容。<br>system: shutdown：关闭系统，退出 Karaf。同样也可运行halt命令退出 Karaf。<br>注意:<br>进入 Karaf的控制台后，按&lt; Tab &gt;键即可显示目前所有可用的命令。<br>控制台支持&lt; Tab &gt;键的输入辅助完成功能，当输入一个命令的前面一些字符时，按&lt; Tab &gt;键后，控制台将自动列出所有可能的命令，并且在只有一个提示命令时自动完成该命令的输入。</p>
<p>Karaf教程之安装和应用开发</p>
<p>概览</p>
<p>安装和启动</p>
<p>一些便利的命令</p>
<p>Tasklist - 一个小的OSGI应用</p>
<p>父pom和通用工程的设置</p>
<p>Tasklist-model</p>
<p>Tasklist-persistence</p>
<p>Tasklist-ui</p>
<p>Tasklist-features</p>
<p>在Karaf中安装应用</p>
<p>总结</p>
<p>概览</p>
<p>以这篇文章为起点，我将开始写一系列关于Apache Karaf的文章，Apache Karaf是一个基于Equinox或者Felix框架开发的一个OSGI容器。<br>与这些框架最大的不同在于它带来了优秀的管理功能。</p>
<p>Karaf突出的特性如下: </p>
<ul>
<li>可扩展控制台和Bash相似的命令补齐功能 </li>
<li>ssh控制台 </li>
<li>从maven仓库中获取bundles和features的部署文件 </li>
<li>可以在命令行中轻松的创建一个新的实例</li>
</ul>
<p>所有这些特性使开发服务端OSGi应用和开发一般的java应用几乎一样的简单。<br>从某个层面上，部署和管理比目前我知道所有应用服务器都好。所有这些karaf特性的结合带来了最终的程序。在我看来，Karaf允许轻量级的开发风格就像J2EE结合spring应用程序的灵活性一样。</p>
<p>安装和启动</p>
<p>从karaf官网下载Karaf4.0.7。<br>解压并运行bin/karaf。<br>一些便利的命令</p>
<table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">la</td>
<td align="left">显示所有安装的bundle</td>
</tr>
<tr>
<td align="left">list</td>
<td align="left">显示用户的bundle</td>
</tr>
<tr>
<td align="left">service:list</td>
<td align="left">显示active的OSGI服务。这个列表十分长。这里有一个方便的方法，就是你可以使用unix的管道，如 “ls</td>
</tr>
<tr>
<td align="left">exports</td>
<td align="left">显示导出的packages和bundles，这个命令可以帮助你查找出package是来自哪里</td>
</tr>
<tr>
<td align="left">feature:list</td>
<td align="left">显示所有feature包括已安装和未安装的</td>
</tr>
<tr>
<td align="left">feature:install webconsole</td>
<td align="left">访问<a href="http://localhost:8181/system/console，用karaf/karaf登录并花些时间看下它所提供的信息" target="_blank" rel="noopener">http://localhost:8181/system/console，用karaf/karaf登录并花些时间看下它所提供的信息</a></td>
</tr>
<tr>
<td align="left">diag</td>
<td align="left">显示那些无法启动的bundle的诊断信息</td>
</tr>
<tr>
<td align="left">log:tail</td>
<td align="left">显示日志。可以按ctrl-c返回控制台</td>
</tr>
<tr>
<td align="left">Ctrl-d</td>
<td align="left">退出控制台。如果是主控制台，则karaf被关闭</td>
</tr>
<tr>
<td align="left">重启后OSGI容器会保存状态</td>
<td align="left"></td>
</tr>
</tbody></table>
<p>注意Karaf和其他所有的OSGI容器一样会维护已安装和已启动的bundles的最后状态。所以如果有些组件再也不能工作，重启也不一定有所帮助。为了启动一个全新的Karaf，可以停止karaf然后删除data目录或者启动的时候加个clean参数bin/karaf clean。</p>
<p>检查日志</p>
<p>Karaf运行的时候非常安静。为了不错过错误消息，可以运行tail -f data/karaf.log让日志文件处于打开状态。</p>
<p>Tasklist - 一个小的OSGI应用</p>
<p>没有任何有用的应用，Karaf是一个很棒但是没用的容器。所以让我们来创建第一个应用吧。好消息是创建一个OSGI应用非常的简单，maven会处理很多事情。和一个正常的maven工程的差异是非常少的。我推荐使用Eclipse 4写应用程序，Eclipse 4默认已经安装m2eclipse插件。</p>
<p>从github的Karaf-Tutorial仓库中获取源码。</p>
<p><code>git clone https://github.com/cschneider/Karaf-Tutorial.git</code>  </p>
<p>或者从 <a href="https://github.com/cschneider/Karaf-Tutorial/zipball/master" target="_blank" rel="noopener">https://github.com/cschneider/Karaf-Tutorial/zipball/master</a> 下载示例工程，然后解压到某个目录下。  </p>
<p>导入到Eclipse   </p>
<ul>
<li>启动Eclipse Neon或者更新版本。   </li>
<li>在Eclipse中选择File -&gt; Import -&gt; Existing maven project -&gt; Browse到刚才解压的目录选择tasklist 子文件夹。   </li>
<li>Eclipse将显示所有它找到的maven工程。   </li>
<li>单击默认导入所有工程。  </li>
</ul>
<p>Eclipse将导入所有的工程并使用m2eclipse插件管理它们之间所有的依赖。  </p>
<p>tasklist有以下这些工程组成。  </p>
<table>
<thead>
<tr>
<th align="left">模块</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">tasklist-model</td>
<td align="left">服务接口和Task类</td>
</tr>
<tr>
<td align="left">tasklist-persistence</td>
<td align="left">提供了一个TaskService接口的简单持久化实现</td>
</tr>
<tr>
<td align="left">tasklist-ui</td>
<td align="left">使用TaskService显示任务列表的servlet</td>
</tr>
<tr>
<td align="left">tasklist-features</td>
<td align="left">为应用提供features的描述信息，使应用能够很容易的安装到Karaf容器中</td>
</tr>
<tr>
<td align="left">父pom和通用工程的设置</td>
<td align="left"></td>
</tr>
</tbody></table>
<p>pom.xml打包bundle，而maven-bundle-plugin创建具有OSGi Manifest信息的jar包。默认情况，插件导入java文件import的或者在bluneprint上下文引用的所有的包。同时导出不包含内部实现的所有包。在我们的例子中我们想要model包被导入，但是persistence的实现包不导入。按照命名约定，我们不需要额外的配置。</p>
<p>Tasklist-model</p>
<p>这个工程包含domain model，这里指Task类和TaskService接口。model同时被persistence工程和用户界面工程使用。任意TaskService服务的使用者只需要依赖model工程。所以不用直接绑定到当前的实现。</p>
<p>Tasklist-persistence</p>
<p>简单持久化实现的TaskServiceImpl类用一个简单的HashMap管理task。类用@Singleton注解标记自己为blueprint bean。注解@OsgiServiceProvider用于标记为自己是一个OSGi服务，而@Properties注解允许添加服务属性。在这个例子中我们设置的属性service.exported.interfaces可以被我们在后续的教程要介绍的CXF-DOSGI使用。目前该教程这个属性可以删除。</p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@OsgiServiceProvider</span></span><br><span class="line"><span class="hljs-variable">@Properties</span>(<span class="hljs-variable">@Property</span>(name = <span class="hljs-string">"service.exported.interfaces"</span>, value = <span class="hljs-string">"*"</span>))</span><br><span class="line"><span class="hljs-variable">@Singleton</span></span><br><span class="line">public class TaskServiceImpl implements TaskService &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>blueprint-maven-plugin插件将处理上面的类，且自动创建合适的blueprint xml文件。这样可以帮我们节省手动写blueprint xml文件的时间。</p>
<p>自动创建的blueprint xml文件位于target/generated-resources文件夹下</p>
<figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;blueprint xmlns=<span class="hljs-string">"http://www.osgi.org/xmlns/blueprint/v1.0.0"</span>&gt;</span><br><span class="line">    &lt;bean id=<span class="hljs-string">"taskService"</span> <span class="hljs-keyword">class</span>=<span class="hljs-string">"net.lr.tasklist.persistence.impl.TaskServiceImpl"</span> /&gt;</span><br><span class="line">    &lt;service <span class="hljs-keyword">ref</span>=<span class="hljs-string">"taskService"</span> <span class="hljs-keyword">interface</span>=<span class="hljs-string">"net.lr.tasklist.model.TaskService"</span> /&gt;</span><br><span class="line">&lt;/blueprint&gt;</span><br></pre></td></tr></table></figure>

<p>Tasklist-ui</p>
<p>UI工程使用一个TaskServlet显示任务列表和单独的任务。为了和tasks任务协作，这个servlet需要TaskService服务。我们通过使用注解@Inject和@OsgiService注入TaskService服务，@Inject注解能够根据类型注入任意的实例。而注解@OsgiService将创建一个指定类型的OSGiSerivce服务的blueprint引用。（译注：这里我是这么理解的，@OsgiService表示从Karaf中获取一个bean，@Inject则负责注入）<br>这个类被暴露为一个OSGi服务,该类是一个有特别属性alias=/tasklist的接口java.http.Servlet实现。这样做触发了pax web的whiteboard扩展器接收这个服务，并使用url /tasklist映射到该servlet。</p>
<p>相关代码小片段</p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@OsgiServiceProvider</span>(classes = Servlet.class)</span><br><span class="line"><span class="hljs-variable">@Properties</span>(<span class="hljs-variable">@Property</span>(name = <span class="hljs-string">"alias"</span>, value = <span class="hljs-string">"/tasklist"</span>))</span><br><span class="line"><span class="hljs-variable">@Singleton</span></span><br><span class="line">public class TaskListServlet extends HttpServlet &#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-variable">@Inject</span> <span class="hljs-variable">@OsgiService</span></span><br><span class="line">    TaskService taskService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自动创建的blueprint xml文件位于target/generated-resources文件夹下</p>
<figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">blueprint</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.osgi.org/xmlns/blueprint/v1.0.0"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">reference</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"taskService"</span> <span class="hljs-attr">availability</span>=<span class="hljs-string">"mandatory"</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"net.lr.tasklist.model.TaskService"</span> /&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"taskServlet"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"net.lr.tasklist.ui.TaskListServlet"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"taskService"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"taskService"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"taskServlet"</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"javax.servlet.http.HttpServlet"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">service-properties</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"alias"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"/tasklist"</span> /&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">service-properties</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">blueprint</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Tasklist-features</p>
<p>最后一个工程仅安装一个feature描述信息文件到一个maven仓库，这样我们可以很容易的安装应用到Karaf。描述信息定义了一个叫tasklist的feature和将从maven仓库下载安装的bundles</p>
<figure class="highlight dust hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">feature</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"example-tasklist-persistence"</span> <span class="hljs-attr">version</span>=<span class="hljs-string">"$</span></span></span><span class="hljs-template-variable">&#123;pom.version&#125;</span><span class="hljs-xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">bundle</span>&gt;</span>mvn:net.lr.tasklist/tasklist-model/$</span><span class="hljs-template-variable">&#123;pom.version&#125;</span><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">bundle</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">bundle</span>&gt;</span>mvn:net.lr.tasklist/tasklist-persistence/$</span><span class="hljs-template-variable">&#123;pom.version&#125;</span><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">bundle</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">feature</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">feature</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"example-tasklist-ui"</span> <span class="hljs-attr">version</span>=<span class="hljs-string">"$</span></span></span><span class="hljs-template-variable">&#123;pom.version&#125;</span><span class="hljs-xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">feature</span>&gt;</span>http<span class="hljs-tag">&lt;/<span class="hljs-name">feature</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">feature</span>&gt;</span>http-whiteboard<span class="hljs-tag">&lt;/<span class="hljs-name">feature</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">bundle</span>&gt;</span>mvn:net.lr.tasklist/tasklist-model/$</span><span class="hljs-template-variable">&#123;pom.version&#125;</span><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">bundle</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">bundle</span>&gt;</span>mvn:net.lr.tasklist/tasklist-ui/$</span><span class="hljs-template-variable">&#123;pom.version&#125;</span><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">bundle</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">feature</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>一个feature可以由其他features和bundles组成，这些features和bundles也应该被安装。一般bundles使用mvn urls。这也意味着它们从配置好的仓库或者你的本地maven仓库~/.m2/repository中加载。</p>
<p>在Karaf中安装应用</p>
<figure class="highlight maxima hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">feature</span>:repo-add mvn:net.lr.tasklist/tasklist-<span class="hljs-built_in">features</span>/<span class="hljs-number">1.0</span>.0-SNAPSHOT/xml</span><br><span class="line"><span class="hljs-built_in">feature</span>:install <span class="hljs-built_in">example</span>-tasklist-persistence <span class="hljs-built_in">example</span>-tasklist-ui</span><br></pre></td></tr></table></figure>

<p>添加features描述信息文件到Karaf，所以它被添加到可用的features列表中，然后安装和启动tasklist feature。运行命令之后tasklist应用应该运行了。</p>
<p>list</p>
<p>检查tasklist的所有bundles是在active状态。如果没有，尝试启动它们和检查日志。</p>
<p>http:list</p>
<figure class="highlight asciidoc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ID | Servlet         | Servlet-Name   | State       | Alias     | Url</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">56 | TaskListServlet | ServletModel-2 | Deployed    | /tasklist | [/tasklist/<span class="hljs-strong">*]</span></span><br></pre></td></tr></table></figure>

<p>应该显示TaskListServlet。默认情况下这个例子应该运行在<a href="http://localhost:8181/tasklist。" target="_blank" rel="noopener">http://localhost:8181/tasklist。</a></p>
<p>你可以通过创建一个文本文件”etc/org.ops4j.pax.web.cfg”改变端口。文本内容为”org.osgi.service.http.port=8080”。这个方式将告诉HttpService使用这个端口8080. 现在tasklist应用应该运行在<a href="http://localhost:8080/tasklist地址。" target="_blank" rel="noopener">http://localhost:8080/tasklist地址。</a></p>
<p>总结</p>
<p>在该教程中我们已经安装了Karaf和学习了一些命令。然后我们创建了一个小的OSGi应用，这个应用涉及到servlets，OSGi服务，blueprint和whiteboard模式。下一个教程我们看下在OSGi中Apache Camel和Apache CXF的使用。</p>
<p>Apache Karaf用户指导  </p>
<p>一 安装karaf  </p>
<p>本章讲述如何在windows和unix平台安装Apache Karaf，这里你将知道预先要安装什么软件，如何下载并且安装Karaf。  </p>
<p>预安装需求<br>硬件：  </p>
<ul>
<li>20M磁盘剩余空间。<br>操作系统：<br>Windows：Windows vista，Windows XP sp2，windows2000。- Unix：Ubuntu Linux，Powerdog Linux,MacOS，AIX,HP-UX,Solaris，任何支持java的unix平台。<br>环境：<br>Java SE 1.5x或者更高。- 环境变量JAVAHOME必须设置为java运行时的安装目录，比如C:\Program Files\Java\jdk1.6.026。按住windows和break键切换到高级选项，点击环境变量，把上面的路径加入到变量中。<br>从源码构建<br>如果你想从源码构建KARAF，需求会有点不同：  </li>
</ul>
<p>硬件：  </p>
<ul>
<li>200M磁盘空间便于apache karaf源码展开或者是SVN的验证，以及maven构建和依赖maven组件的下载。<br>环境：<br>JDK 1.5或者是更高。- Apache maven 2.2.1.<br>在windows上构建<br>这过程说明如何下载和安装windows上的源码文件。注：Karaf需要java5编译，构建和运行。  </li>
</ul>
<p>在浏览器输入<a href="http://karaf.apache.org/index/community/download.html" target="_blank" rel="noopener">http://karaf.apache.org/index/community/download.html</a>.  
滚动到“Apache Karaf”区域选择需要的链接。源码文件名称类似于：apache-karaf-x.y-src.zip.<br>解压缩zip文件到你选择的目录中，请记住非法java路径的限制，比如！，%等。<br>用maven 2.2.1 或者更高的java5来构建karaf。 构建karaf的方法如下：<br>Cd [karaf安装路径]\src- Mvn<br>这两个步骤均需要10到15分钟。<br>用zip工具加压文件，windows的路径是 [karaf安装路径]\assembly\target\apache-karaf-x.y.zip<br>转到开始karaf一节<br>在Unix上构建<br>本过程将讲述如何在unix系统上下载和安装源码文件。这里假定unix机器上有浏览器，没有浏览器的请参照前面二进制unix安装区域。注：Karaf需要java5编译，构建和运行。  </p>
<p>在浏览器输入<a href="http://karaf.apache.org/" target="_blank" rel="noopener">http://karaf.apache.org/</a> download.html.<br>滚动到“Apache Karaf”区域选择需要的链接。源码文件名称类似于：apache-karaf-x.y-src.zip.<br>解压缩zip文件到你选择的目录中，例如：gunzip apache-karaf-x.y-src.tar.gz tar xvf apache-karaf-x.y-src.tar请记住非法java路径的限制，比如！，%等<br>用maven构建karaf建议方法如下: cd [karaf安装路径]\src cvn 5.解压缩刚刚创建的文件 cd [karaf安装路径]/assembly/target gunzip apache-karaf-x.y.tar.gz tar xvf apache-karaf-x.y.tar<br>转到开始karaf一节<br>Windows安装过程<br>这里说明如何在windows系统上下载和安装二进制文件。  </p>
<p>在浏览器输入 <a href="http://karaf.apache.org/index/community/download.html" target="_blank" rel="noopener">http://karaf.apache.org/index/community/download.html</a>.  
滚动到“Apache Karaf”区域选择需要的链接。源码文件名称类似于：apache-karaf-x.y-src.zip.<br>解压缩zip文件到你选择的目录中，请记住非法java路径的限制，比如！，%等。<br>转到开始karaf一节<br>可选：在Windows中启用彩色控制台输出  </p>
<ul>
<li>提示：如果你安装karaf到很深的路径或者是非法的java路径，！，%等，你可以创建一个bat文件来执行：subst S: “C:\your very % problematic path!\KARAF” 这样karaf的路径是 s: 这样的短类型。<br>Unix安装过程<br>这里属于如何在unix系统上下载和安装二进制文件。  </li>
</ul>
<p>在浏览器输入<a href="http://karaf.apache.org/" target="_blank" rel="noopener">http://karaf.apache.org/</a> download.html.<br>滚动到“Apache Karaf”区域选择需要的链接。源码文件名称类似于：apache-karaf-x.y.tar.gz<br>解压缩zip文件到你选择的目录中，例如：gunzip apache-karaf-x.y.tar.gz tar xvf apache-karaf-x.y.tar 请记住非法java路径的限制，比如！，%等。<br>转到开始karaf一节<br>安装后的步骤<br>在开始使用karaf之前强烈建议设置指向JDK的JAVA_HOME用来定位java可执行文件，并且应该配置为指向已安装java se5或者6的根目录。  </p>
<p>二 目录结构  </p>
<p>Karaf安装目录结构如下：  </p>
<p>/bin: 启动脚本<br>/etc: 初始化文件<br>/data: 工作目录<br>/cache: OSGi框架包缓存<br>/generated-bundles: 部署使用的临时文件夹<br>/log: 日志文件<br>/deploy: 热部署目录<br>/instances: 含有子实例的目录<br>/lib: 包含引导库<br>/lib/ext:JRE扩展目录<br>/lib/endorsed: 赞同库目录<br>/system: OSGi包库，作为一个Maven2存储库<br>Data文件夹包括karaf所有的工作和临时文件，如果你想从一个初始状态重启，你可以清空这个目录，这和“恢复初始化设置”一样的效果。  </p>
<p>三 启动和停止karaf  </p>
<p>本章介绍如何启动和停止Apache Karaf和各种可用的选项。  </p>
<p>启动karaf<br>Windows下：打开一个控制台窗口，更改到安装目录，并运行Karaf。对于二进制文件，运行 Cd [karaf安装目录] 然后输入：bin\karaf.bat  </p>
<p>Linux下：打开一个控制台窗口，更改到安装目录，并运行Karaf。运行 Cd [karaf安装目录] 然后输入：bin\karaf 警告：karaf运行后不要关闭控制台，否则会终止karaf（除非用非控制台启动karaf）。  </p>
<p>非控制台启动karaf<br>没有控制台也可以启动karaf，它总可以是用远程SSH访问，是用下面的命令： bin\karaf.bat server 或者是unix下：bin/karaf server  </p>
<p>在后台启动karaf<br>采用以下命令可以轻易地在后台进程启动karaf：   Bin\start.bat 或者在unix下：bin/start  </p>
<p>重置模式启动karaf<br>清空[karaf安装目录]\data文件夹就可以简单的在重置模式启动karaf，为方便起见，在karaf启动脚本使用以下参数也可以实现重置启动： bin/start clean  </p>
<p>停止karaf<br>无论是windows还是unix，你都可以在karaf控制台采用以下命令来停止它： <code>osgi:shutdown</code>, 或者简单的是：<code>shutdown</code>。    </p>
<p>Shutdown命令会询问你是否真的想要停止，如果你确认停止并且拒绝确认信息，你可以用-f或者-force选项： osgi：shutdown –f， 也可以用时间参数来延迟停止，时间参数有不同的形式。  </p>
<p>首先，可以是绝对时间各式hh：mm。第二，也可以是+m，其中m是等待的分。现在就是+0。  </p>
<p>下面的命令可以在10:35am关闭karaf:  </p>
<p>osgi:shutdown 10:35。  </p>
<p>下面的命令在10分钟后关闭karaf：  </p>
<p>osgi:shutdown +10。  </p>
<p>如果你在主控制台运行，用注销或者Ctrl+D退出控制台也可以终止karaf实例。 在控制台你可以运行如下命令：  </p>
<p>bin\stop.bat  </p>
<p>或者在unix下：  </p>
<p>bin/stop。  </p>
<p>四 使用控制台  </p>
<p>查看可用的命令<br>按提示键tab可以在控制台看到可用的命令列表：    </p>
<figure class="highlight vim hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">root@root&gt; <span class="hljs-symbol">&lt;tab&gt;</span>Display <span class="hljs-keyword">all</span> <span class="hljs-number">182</span> possibilities? (<span class="hljs-keyword">y</span> <span class="hljs-built_in">or</span> n)</span><br><span class="line">*:<span class="hljs-keyword">help</span>                           addurl                           admin:<span class="hljs-keyword">change</span>-opts</span><br><span class="line">admin:<span class="hljs-keyword">change</span>-rmi-registry-port   admin:<span class="hljs-keyword">change</span>-ssh-port            admin:connect</span><br><span class="line">admin:create                     admin:destroy                    admin:<span class="hljs-keyword">list</span></span><br><span class="line">admin:<span class="hljs-built_in">rename</span>                     admin:start                      admin:<span class="hljs-keyword">stop</span></span><br><span class="line">bundle-level                     cancel                           <span class="hljs-keyword">cat</span></span><br><span class="line"><span class="hljs-keyword">change</span>-opts                      <span class="hljs-keyword">change</span>-rmi-registry-port         <span class="hljs-keyword">change</span>-ssh-port</span><br><span class="line">clear                            commandlist                      confi<span class="hljs-variable">g:cancel</span></span><br><span class="line">confi<span class="hljs-variable">g:edit</span>                      confi<span class="hljs-variable">g:list</span>                      confi<span class="hljs-variable">g:propappend</span></span><br><span class="line">confi<span class="hljs-variable">g:propdel</span>                   confi<span class="hljs-variable">g:proplist</span>                  confi<span class="hljs-variable">g:propset</span></span><br><span class="line">confi<span class="hljs-variable">g:update</span>                    connect                          create</span><br><span class="line">create-dump                      destroy                          de<span class="hljs-variable">v:create</span>-dump</span><br><span class="line">de<span class="hljs-variable">v:dynamic</span>-import               de<span class="hljs-variable">v:framework</span>                    de<span class="hljs-variable">v:print</span>-stack-traces</span><br><span class="line">de<span class="hljs-variable">v:restart</span>                      de<span class="hljs-variable">v:show</span>-tree                    de<span class="hljs-variable">v:watch</span></span><br><span class="line"><span class="hljs-keyword">display</span>                          <span class="hljs-keyword">display</span>-exception                dynamic-import</span><br><span class="line">each                             <span class="hljs-keyword">echo</span>                             <span class="hljs-keyword">edit</span></span><br><span class="line">exec                             exports                          feature<span class="hljs-variable">s:addurl</span></span><br><span class="line">feature<span class="hljs-variable">s:info</span>                    feature<span class="hljs-variable">s:install</span>                 feature<span class="hljs-variable">s:list</span></span><br><span class="line">feature<span class="hljs-variable">s:listrepositories</span>        feature<span class="hljs-variable">s:listurl</span>                 feature<span class="hljs-variable">s:listversions</span></span><br><span class="line">feature<span class="hljs-variable">s:refreshurl</span>              feature<span class="hljs-variable">s:removerepository</span>        feature<span class="hljs-variable">s:removeurl</span></span><br><span class="line">feature<span class="hljs-variable">s:uninstall</span>               framework                        <span class="hljs-built_in">get</span></span><br><span class="line"><span class="hljs-keyword">grep</span>                             head                             headers</span><br><span class="line"><span class="hljs-keyword">help</span>                             <span class="hljs-keyword">history</span>                          <span class="hljs-keyword">if</span></span><br><span class="line">imports                          info                             install</span><br><span class="line">jaa<span class="hljs-variable">s:cancel</span>                      jaa<span class="hljs-variable">s:commandlist</span>                 jaa<span class="hljs-variable">s:list</span></span><br><span class="line">jaa<span class="hljs-variable">s:manage</span>                      jaa<span class="hljs-variable">s:roleadd</span>                     jaa<span class="hljs-variable">s:roledel</span></span><br><span class="line">jaa<span class="hljs-variable">s:update</span>                      jaa<span class="hljs-variable">s:useradd</span>                     jaa<span class="hljs-variable">s:userdel</span></span><br><span class="line">jaa<span class="hljs-variable">s:userlist</span>                    java                             <span class="hljs-keyword">list</span></span><br><span class="line">listrepositories                 listurl                          listversions</span><br><span class="line"><span class="hljs-keyword">lo</span><span class="hljs-variable">g:clear</span>                        <span class="hljs-keyword">lo</span><span class="hljs-variable">g:display</span>                      <span class="hljs-keyword">lo</span><span class="hljs-variable">g:display</span>-exception</span><br><span class="line"><span class="hljs-keyword">lo</span><span class="hljs-variable">g:get</span>                          <span class="hljs-keyword">lo</span><span class="hljs-variable">g:set</span>                          <span class="hljs-keyword">lo</span><span class="hljs-variable">g:tail</span></span><br><span class="line">logout                           <span class="hljs-keyword">ls</span>                               manage</span><br><span class="line">more                             <span class="hljs-keyword">new</span>                              osgi:bundle-level</span><br><span class="line">osgi:headers                     osgi:info                        osgi:install</span><br><span class="line">osgi:<span class="hljs-keyword">list</span>                        osgi:<span class="hljs-keyword">ls</span>                          osgi:refresh</span><br><span class="line">osgi:<span class="hljs-built_in">resolve</span>                     osgi:restart                     osgi:shutdown</span><br><span class="line">osgi:start                       osgi:start-level                 osgi:<span class="hljs-keyword">stop</span></span><br><span class="line">osgi:uninstall                   osgi:<span class="hljs-keyword">update</span>                      package<span class="hljs-variable">s:exports</span></span><br><span class="line">package<span class="hljs-variable">s:imports</span>                 <span class="hljs-keyword">print</span>-stack-traces               <span class="hljs-built_in">printf</span></span><br><span class="line">propappend                       propdel                          proplist</span><br><span class="line">propset                          refresh                          refreshurl</span><br><span class="line">removerepository                 removeurl                        <span class="hljs-built_in">rename</span></span><br><span class="line"><span class="hljs-built_in">resolve</span>                          restart                          roleadd</span><br><span class="line">roledel                          <span class="hljs-keyword">set</span>                              shel<span class="hljs-variable">l:cat</span></span><br><span class="line">shel<span class="hljs-variable">l:clear</span>                      shel<span class="hljs-variable">l:each</span>                       shel<span class="hljs-variable">l:echo</span></span><br><span class="line">shel<span class="hljs-variable">l:exec</span>                       shel<span class="hljs-variable">l:grep</span>                       shel<span class="hljs-variable">l:head</span></span><br><span class="line">shel<span class="hljs-variable">l:history</span>                    shel<span class="hljs-variable">l:if</span>                         shel<span class="hljs-variable">l:info</span></span><br><span class="line">shel<span class="hljs-variable">l:java</span>                       shel<span class="hljs-variable">l:logout</span>                     shel<span class="hljs-variable">l:more</span></span><br><span class="line">shel<span class="hljs-variable">l:new</span>                        shel<span class="hljs-variable">l:printf</span>                     shel<span class="hljs-variable">l:sleep</span></span><br><span class="line">shel<span class="hljs-variable">l:sort</span>                       shel<span class="hljs-variable">l:tac</span>                        shel<span class="hljs-variable">l:tail</span></span><br><span class="line">show-tree                        shutdown                         <span class="hljs-keyword">sleep</span></span><br><span class="line"><span class="hljs-keyword">sort</span>                             ssh                              ssh:ssh</span><br><span class="line">ssh:sshd                         sshd                             start</span><br><span class="line">start-level                      <span class="hljs-keyword">stop</span>                             tac</span><br><span class="line">tail                             uninstall                        <span class="hljs-keyword">update</span></span><br><span class="line">useradd                          userdel                          userlist</span><br><span class="line">watch</span><br><span class="line">root@root&gt;</span><br></pre></td></tr></table></figure>

<p>获得命令的帮助<br>要查看一个特定的命令的帮助，在命令后加–help或使用help命令加上命令的名称：</p>
<p><code>karaf@root&gt; feature:list --help</code><br>描述</p>
<p>   <code>feature:list       列出库中定义的所有功能。</code><br>语法</p>
<pre><code>`feature:list [options]`</code></pre><p>选项</p>
<p>   <code>--help               显示此帮助信息</code><br>   <code>-i, --installed      只列出已安装的功能列表</code><br>更多…<br>所有可用命令列表和它们的用法，也可以在一个专门的章节。  </p>
<p>你在开发指南会获得更多的shell语法的深入引导。  </p>
<p>如开发指南解释的那样，控制台可以很容易的被新命令扩展。  </p>
<p>五 网络控制台  </p>
<p>Karaf Web控制台提供了一个运行时的图形概述。  </p>
<p>你可以是用它来：  </p>
<p>安装和卸载功能<br>启动，停止，安装捆绑<br>创建子实例<br>配置Karaf<br>查看日志信息<br>安装web控制台<br>默认情况下web控制台是不安装的，安装请在karaf提示中运行以下命令： root@karaf&gt; features:install webconsole  </p>
<p>访问Web控制台<br>访问本地运行的一个karaf实例，在浏览器输入：   <a href="http://localhost:8181/system/console" target="_blank" rel="noopener">http://localhost:8181/system/console</a> 使用karaf用户名和karaf密码来登录系统，如果你修改过用户名或密码，请是用修改后的。  </p>
<p>改变web控制台端口号<br>默认情况下，控制台在8181端口运行，你可以通过创建属性文件etc/org.ops4j.pax.web.cfg并在后面添加如下属性设置（改成任意你想要的端口号）来改变端口：  </p>
<p><code>org.osgi.service.http.port=8181</code>    </p>
<p>六 远程控制台  </p>
<p>使用远程实例<br>初始化远程实例<br>用它本地控制台管理karaf实例不总是有意义的，你可以用远程控制台远程管理karaf。  </p>
<p>当你启动karaf时，它使任何其他Karaf控制台或纯SSH客户端可以通过SSH访问远程控制台。远程控制台提供本地控制台的所有功能，并通过运行它里面的容器和服务给远程用户完全控制。  </p>
<p>SSH主机名和端口号在配置文件[karaf安装目录]/etc/org.apache.karaf.shell.cfg用以下默认值配置：  </p>
<p>sshPort=8101<br>sshHost=0.0.0.0<br>sshRealm=karaf<br>hostKey=${karaf.base}/etc/host.key<br>你可以用初始化命令或者编辑上面的文件更改这个配置，但是需要重启ssh控制台以便它是用新的参数。  </p>
<figure class="highlight stata hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># define helper functions  </span><br><span class="line">bundle-<span class="hljs-keyword">by</span>-sn = &#123; bm = new java.util.HashMap ;  each (bundles) &#123; <span class="hljs-variable">$bm</span> put (<span class="hljs-variable">$it</span> symbolicName) <span class="hljs-variable">$it</span> &#125; ; <span class="hljs-variable">$bm</span> get <span class="hljs-variable">$1</span> &#125;</span><br><span class="line">bundle-id-<span class="hljs-keyword">by</span>-sn = &#123; b = (bundle-<span class="hljs-keyword">by</span>-sn <span class="hljs-variable">$1</span>) ; <span class="hljs-keyword">if</span> &#123; <span class="hljs-variable">$b</span> &#125; &#123; <span class="hljs-variable">$b</span> bundleId &#125; &#123; -1 &#125; &#125;</span><br><span class="line"># <span class="hljs-keyword">edit</span> config</span><br><span class="line">config:<span class="hljs-keyword">edit</span> org.apache.karaf.<span class="hljs-keyword">shell</span></span><br><span class="line">config:propset sshPort 8102</span><br><span class="line">config:<span class="hljs-keyword">update</span> </span><br><span class="line"># force a restart</span><br><span class="line">osgi:restart --force (bundle-id-<span class="hljs-keyword">by</span>-sn org.apache.karaf.<span class="hljs-keyword">shell</span>.ssh)</span><br></pre></td></tr></table></figure>

<p>远程连接和断开<br>使用ssh：ssh命令</p>
<p>你可以使用ssh：ssh命令来连接远程karaf控制台。 <code>karaf@root&gt; ssh:ssh -l karaf -P karaf -p 8101 hostname</code></p>
<p>注意：默认的密码是karaf，但是我们强烈建议个更改。在安全模块查看更多信息。 为了确定你已经连接到正确的karaf实例，输入ssh：info在karaf提示符。返回当前连接的实例的信息，如下所示。</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Karaf</span><br><span class="line">  Karaf home  /local/apache-karaf-2.0.0</span><br><span class="line">  Karaf base  /local/apache-karaf-2.0.0</span><br><span class="line">  OSGi Framework  org.eclipse.osgi - 3.5.1.R35x_v20090827</span><br><span class="line">JVM</span><br><span class="line">  Java Virtual MachineJava HotSpot(TM)<span class="hljs-built_in"> Server </span>VM version 14.1-b02</span><br><span class="line">  <span class="hljs-built_in">..</span>.</span><br></pre></td></tr></table></figure>

<p>使用karaf客户端<br>Karaf允许你安全的连接到远程karaf实例而不必运行本地karaf实例。</p>
<p>例如，在同一台机器上快速连接在server模式下运行的karaf实例，在karaf安装目录运行以下命令：<code>bin/client</code>。 通常情况下，你需要提供主机名，端口，用户名和密码来连接到远程实例。如果你使用的客户端在一个较大的脚本，你可以附加控制台命令如下： <code>bin/client -a 8101 -h hostname -u karaf -p karaf features:install wrapper</code></p>
<p>显示可用的客户端选项，输入：</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; bin<span class="hljs-built_in">/client </span>--help</span><br><span class="line">Apache Karaf client</span><br><span class="line">  -a [port] specify the<span class="hljs-built_in"> port </span><span class="hljs-keyword">to</span> connect <span class="hljs-keyword">to</span></span><br><span class="line">  -h [host] specify the host <span class="hljs-keyword">to</span> connect <span class="hljs-keyword">to</span></span><br><span class="line">  -u [user] specify the<span class="hljs-built_in"> user </span>name</span><br><span class="line">  -p [password] specify the password</span><br><span class="line">  --helpshows this help message</span><br><span class="line">  -vraise verbosity</span><br><span class="line">  -r [attempts] retry<span class="hljs-built_in"> connection </span>establishment (up <span class="hljs-keyword">to</span> attempts times)</span><br><span class="line">  -d [delay]intra-retry delay (defaults <span class="hljs-keyword">to</span> 2 seconds)</span><br><span class="line">  [commands]commands <span class="hljs-keyword">to</span> run</span><br></pre></td></tr></table></figure>

<p>如果没有指定的命令，客户端将在互动模式。</p>
<p>使用纯SSH客户端<br>你也可以使用你的unix系统中的纯SSH客户端或者windows SSH客户端像putty来连接。 <code>~$ ssh -p 8101 karaf@localhost karaf@localhost&#39;s password:</code></p>
<p>从远程控制台断开<br>按Ctrl+D，shell：logout或者简单的在karaf提示符输入logout就可以断开远程控制台。</p>
<p>关闭远程实例<br>使用远程控制台<br>如果你已经用ssh:ssh命令或者karaf客户端连接到远程控制台，你可以用使用osgi:shutdown命令来停止远程实例。 注意：在远程控制台按Ctrl + D键，简单地关闭远程连接并返回到本地shell。</p>
<p>使用karaf客户端<br>使用karaf客户端停止远程实例，在karaf安装目录/lib目录运行以下命令： <code>bin/client -u karaf -p karaf -a 8101 hostname osgi:shutdown</code></p>
<p>七 子实例</p>
<p>管理子实例<br>一个Karaf的子实例是一个副本，你可以分别启动和部署应用程序。实例不包含的完整副本Karaf，但只有一个配置文件和数据文件夹的副本，其中包含了所有运行中的信息，日志文件和临时文件。</p>
<p>使用管理控制台命令<br>管理控制台命令允许您在同一台机器创建和管理Karaf实例。每一个新的运行时是运行时创建的子实例。您可以轻松地使用的名称管理子实例，而不是网络地址。有关管理命令的详细信息，请参阅管理命令。</p>
<p>创建子实例<br>你可以在karaf控制台输入admin:create创建新的运行时实例.</p>
<p>如下例子所示，admin:create将使运行时在活动的运行时{实例/名称}目录创建新的运行时安装。新的实例是一个新的karaf实例并且分配一个SSH端口号基于始于8101的增量和一个RMI注册端口号基于始于1099的增量。</p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">karaf<span class="hljs-meta">@root</span>&gt;<span class="hljs-string">admin:</span>create finn</span><br><span class="line">Creating <span class="hljs-keyword">new</span> instance on SSH port <span class="hljs-number">8106</span> and RMI port <span class="hljs-number">1100</span> <span class="hljs-string">at:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances/finn</span><br><span class="line">Creating <span class="hljs-string">dir:</span>  <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>bin</span><br><span class="line">Creating <span class="hljs-string">dir:</span>  <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc</span><br><span class="line">Creating <span class="hljs-string">dir:</span>  <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>system</span><br><span class="line">Creating <span class="hljs-string">dir:</span>  <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>deploy</span><br><span class="line">Creating <span class="hljs-string">dir:</span>  <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>data</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/config.properties</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/java.util.logging.properties</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/org.apache.felix.fileinstall-deploy.cfg</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/org.apache.karaf.log.cfg</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/org.apache.karaf.features.cfg</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/org.ops4j.pax.logging.cfg</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/org.ops4j.pax.url.mvn.cfg</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/startup.properties</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/system.properties</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/org.apache.karaf.shell.cfg</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/org.apache.karaf.management.cfg</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>bin/karaf</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>bin/start</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>bin/stop</span><br><span class="line">karaf<span class="hljs-meta">@root</span>&gt;</span><br></pre></td></tr></table></figure>

<p>改变子实例端口号<br>你可以使用admin:change-ssh-port命令来改变分配给子实例的SSH端口号。命令语法是： admin:change-ssh-port 实例 端口号，需要注意的必须停止子实例才能运行此命令。  </p>
<p>同样，你可以使用admin:change-rmi-registry-port命令改变分配给子实例的RMI注册端口号。命令的语法是：   admin:change-rmi-registry-port instance port，需要注意的必须停止子实例才能运行此命令。  </p>
<p>启动子实例<br>新的子实例在停止状态下被创建，用admin:start命令来启动子实例并使之准备主机应用。这个命令需要一个标识你想启动的子实例的instance-name参数。  </p>
<p>列出所有容器实例<br>要查看一个特定的安装下运行的所有Karaf实例的列表，使用admin:list命令。  </p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">karaf@root&gt;admin:list</span><br><span class="line">  SSH<span class="hljs-built_in"> Port </span>  RMI<span class="hljs-built_in"> Port </span>  State   Pid  Name</span><br><span class="line">[8107] [  1106] [Started ] [10628] harry</span><br><span class="line">[8101] [  1099] [Started ] [20076] root</span><br><span class="line">[8106] [  1105] [Stopped ] [15924] dick</span><br><span class="line">[8105] [  1104] [Started ] [18224] tom</span><br><span class="line">karaf@root&gt;</span><br></pre></td></tr></table></figure>

<p>连接到子实例<br>你可以使用admin:connect命令连接到开始的子实例远程控制台，这需要三个参数： admin:connect [-u username] [-p password] instance, 一旦你连接到子实例，karaf提示符显示现在实例的名字，如下： karaf@harry&gt;</p>
<p>停止一个子实例<br>在实例自己内部停止一个子实例，输入osgi:shutdown或者简单的shutdown。 远程停止子实例，换句话说，从父或者兄弟实例，使用<code>admin:stop： admin:stop instance</code></p>
<p>注销一个子实例<br>你可以使用<code>admin:destroy</code>命令永久的删除一个停止的子实例：</p>
<p><code>*admin:destroy instance*</code><br>请注意只有停止的实例可以被注销。</p>
<p>使用管理脚本<br>你也可以管理本地的karaf实例，在karaf安装目录/bin目录下的管理员脚本提供了像管理员控制台相同的命令，除了admin:connect。</p>
<figure class="highlight livecodeserver hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; bin/admin</span><br><span class="line">Available commands:</span><br><span class="line">  change-ssh-port - Changes <span class="hljs-keyword">the</span> secure <span class="hljs-built_in">shell</span> port <span class="hljs-keyword">of</span> <span class="hljs-keyword">an</span> existing container instance.</span><br><span class="line">  change-rmi-registry-port - Changes <span class="hljs-keyword">the</span> RMI registry port (used <span class="hljs-keyword">by</span> management layer) <span class="hljs-keyword">of</span> <span class="hljs-keyword">an</span> existing container instance.</span><br><span class="line">  <span class="hljs-built_in">create</span> - Creates <span class="hljs-keyword">a</span> <span class="hljs-built_in">new</span> container instance.</span><br><span class="line">  destroy - Destroys <span class="hljs-keyword">an</span> existing container instance.</span><br><span class="line">  list - List all existing container instances.</span><br><span class="line">  <span class="hljs-built_in">start</span> - Starts <span class="hljs-keyword">an</span> existing container instance.</span><br><span class="line">  <span class="hljs-built_in">stop</span> - Stops <span class="hljs-keyword">an</span> existing container instance.</span><br><span class="line">Type <span class="hljs-string">'command --help'</span> <span class="hljs-keyword">for</span> more help <span class="hljs-keyword">on</span> <span class="hljs-title">the</span> <span class="hljs-title">specified</span> <span class="hljs-title">command</span>.</span><br></pre></td></tr></table></figure>

<p>例如，列出所有本机器的karaf实例，输入：</p>
<p>bin/admin list<br>八 安全</p>
<p>管理用户名和密码<br>默认安全配置使用一个位于 karaf安装目录/etc/users.properties属性文件存储授权的用户和他们的密码。</p>
<p>默认的用户名是karaf，与之相关联的密码也是karaf。我们强烈建议在将karaf转移到产品前通过编辑上面的文件修改默认密码。</p>
<p>在karaf中用户现在被使用在三个地方：</p>
<p>访问SSH控制台<br>访问JMX管理层<br>访问web控制台<br>这三种方式的全部委托基于安全认证的相同的JAAS。 users.properties文件包含一或者多行，每行都定义了一个用户，密码和相关的角色。 user=password[,role][,role]…</p>
<p>管理角色<br>JAAS角色可以被各种组件使用。三个管理层（SSH,JMX和web控制台）都使用用基于认证系统的全局角色。默认的角色名称在etc/system.properties中使用karaf.admin.role系统属性配置，并且默认值是admin。对管理层进行身份验证的所有用户必须有这个角色的定义。</p>
<p>这个值的语法如下： [classname:]principal</p>
<p>其中classname是主要对象的类名（默认以org.apache.karaf.jaas.modules.RolePrincipal），主要是这一类（默认为admin）的主要的名称。 注意，可以使用以下配置ConfigAdmin对于一个给定的层改变角色：</p>
<p>Layer    PID    Value<br>SSH    org.apache.karaf.shell    sshRole<br>JMX    org.apache.karaf.management    jmxRole<br>Web    org.apache.karaf.webconsole    role<br>启用密码加密<br>为了避免密码是纯文本，密码可以加密存储在配置文件中。 这可以通过以下命令轻易的实现：</p>
<figure class="highlight yaml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># edit config</span></span><br><span class="line"><span class="hljs-attr">config:</span><span class="hljs-string">edit</span> <span class="hljs-string">org.apache.karaf.jaas</span></span><br><span class="line"><span class="hljs-attr">config:</span><span class="hljs-string">propset</span> <span class="hljs-string">encryption.enabled</span> <span class="hljs-literal">true</span></span><br><span class="line"><span class="hljs-attr">config:</span><span class="hljs-string">update</span> </span><br><span class="line"><span class="hljs-comment"># force a restart</span></span><br><span class="line"><span class="hljs-attr">dev:</span><span class="hljs-string">restart</span></span><br></pre></td></tr></table></figure>

<p>用户第一次登录，密码将在 etc/users.properties 配置文件中被自动的加密。加密密码在前面加上{CRYPT}，因此很容易识别。</p>
<p>管理领域<br>更多关于更改默认领域或者部署新领域信息将会在开发者指南中被提供。</p>
<p>部署安全供应商<br>有些应用程序需要特定的安全性提供者可用，如BouncyCastle。JVM在这些jar包的使用上施加一些限制：他们必须签署和引导类路径上可用。部署这些供应商的方法之一是把他们放在位于$ JAVAHOME/ JRE/ lib / ext的JRE文件夹中并且修改安全策略配置（$JAVAHOME/jre/lib/security/java.security）以登记等供应商。</p>
<p>虽然这种方法工作的很好，他将会有全局的影响并且需要你配置所有相应的服务器。</p>
<p>Karaf提供了一个简单的方式来配置额外的安全性提供者：</p>
<p>把你的供应商jar放在karaf-install-dir/lib/ext中<br>修改初始化文件 karaf-install-dir/etc/config.properties ，添加如下属性： org.apache.karaf.security.providers = xxx,yyy 这个属性的值是一个逗号分隔的提供商类名的注册名单。 例如：org.apache.karaf.security.providers = org.bouncycastle.jce.provider.BouncyCastleProvider 此外，你可能想向系统中捆绑的供应商的类提供访问，使所有束可以访问那些。它可以通过在相同的配置文件中修改org.osgi.framework.bootdelegation 属性来实现： </p>
<figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org<span class="hljs-selector-class">.osgi</span><span class="hljs-selector-class">.framework</span><span class="hljs-selector-class">.bootdelegation</span> = ...,org.bouncycastle*</span><br></pre></td></tr></table></figure>

<p>九 故障转移部署</p>
<p>Karaf提供故障转移功能，使用一个简单的锁定文件系统或JDBC锁定机制。在这两种情况下，一个容器级锁系统允许绑定预装到副Karaf实例，以提供更快的故障转移性能。</p>
<p>简单文件锁定<br>简单文件锁定机制用于驻留在同一台主机的实例故障转移配置。 要使用这个功能，按照如下形式编辑<code>$KARAF_HOME/etc/system.properties</code>文件中的每个系统上的主/从设置：  </p>
<figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">karaf.lock=true</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.class</span>=org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.felix</span><span class="hljs-selector-class">.karaf</span><span class="hljs-selector-class">.main</span><span class="hljs-selector-class">.SimpleFileLock</span></span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.dir</span>=&lt;PathToLockFileDirectory&gt;</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.delay</span>=<span class="hljs-number">10</span></span><br></pre></td></tr></table></figure>

<p>说明：确保karaf.lock.dir属性指向相同的主从实例目录，以便当主释放从，从只能获得锁定。  </p>
<p>JDBC锁定<br>JDBC锁定机制的目的就是为了存在单独机器上的故障转移配置。在此部署中，主实例拥有一个Karaf锁定数据库上的表上的锁，如果主失去了锁，等待从进程获得锁定表，并全面启动它的容器。  </p>
<p>要使用这个功能，按照如下形式设置每个系统上的主/从设置：  </p>
<p>更新CLASSPATH包含JDBC驱动程序  </p>
<p>更新KARAF_HOME/bin/ karaf脚本有独特的JMX远程端口设置，如果实例驻留在同一主机上  </p>
<p>更新KARAF_HOME的/ etc/ system.properties文件如下：  </p>
<figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">karaf.lock=true</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.class</span>=org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.felix</span><span class="hljs-selector-class">.karaf</span><span class="hljs-selector-class">.main</span><span class="hljs-selector-class">.DefaultJDBCLock</span></span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.level</span>=<span class="hljs-number">50</span></span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.delay</span>=<span class="hljs-number">10</span></span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.url</span>=jdbc:derby:<span class="hljs-comment">//dbserver:1527/sample</span></span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.driver</span>=org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.derby</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.ClientDriver</span></span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.user</span>=user</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.password</span>=password</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.table</span>=KARAF_LOCK</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.clustername</span>=karaf</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.timeout</span>=<span class="hljs-number">30</span></span><br></pre></td></tr></table></figure>

<p>说明：</p>
<p>如果JDBC驱动程序不在classpath中会失败。<br>将创建数据库名称“sample”，如果它不存在于数据库。<br>Karaf的第一个实例来获得锁定表的是主实例。<br>如果数据库连接丢失，主实例尝试正常关闭，主数据库服务恢复时允许一个从的实例成为主，前主将需要手动重新启动。<br>Oracle的JDBC锁定<br>在JDBC锁定情况下如果你采用oracle作为你的数据库，在$KARAF_HOME/etc/system.properties 文件中的karaf.lock.class 属性必须指向org.apache.felix.karaf.main.OracleJDBCLock。 否则，对于你的设置初始化system.properties文件是正常的，例如：</p>
<figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">karaf.lock=true</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.class</span>=org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.felix</span><span class="hljs-selector-class">.karaf</span><span class="hljs-selector-class">.main</span><span class="hljs-selector-class">.OracleJDBCLock</span></span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.url</span>=jdbc:oracle:thin:@hostname:<span class="hljs-number">1521</span>:XE</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.driver</span>=oracle<span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.OracleDriver</span></span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.user</span>=user</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.password</span>=password</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.table</span>=KARAF_LOCK</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.clustername</span>=karaf</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.timeout</span>=<span class="hljs-number">30</span></span><br></pre></td></tr></table></figure>

<p>正如默认的JDBC锁定设置，Oracle JDBC驱动包必须在calsspath中，为了确保如此你可以在karaf启动之前复制ojdbc14.jar到karaf的lib文件夹下。 说明：karaf.lock.jdbc.url 需要活动的SID，这意味着在使用这个特定的锁之前你必须手动创建数据库实例。</p>
<p>容器级锁定<br>容器级锁定允许绑定预装到从内核的实例，以提供更快的故障转移性能。容器级锁被简单的文件和JDBC锁定机制支持。 为了实现容器及说定，添加如下内容到  <code>$KARAF_HOME/etc/system.properties</code> 文件中在每个系统的主从设置上：  </p>
<figure class="highlight ini hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-attr">karaf.lock</span>=<span class="hljs-literal">true</span></span><br><span class="line"><span class="hljs-attr">karaf.lock.level</span>=<span class="hljs-number">50</span></span><br><span class="line"><span class="hljs-attr">karaf.lock.delay</span>=<span class="hljs-number">10</span></span><br></pre></td></tr></table></figure>

<p>Karaf.log.level属性告诉karaf实例引导过程带来的OSGI容器有多远。分配相同级别的绑定或者是更低的也会在那个karaf实例中被启动。  </p>
<p>绑定开始级别在$KARAF_HOME/etc/startup.properties指定，以jar.name=levle的形式。核心系统绑定级数低于50，用户绑定级别大于50。  </p>
<p>级别    行为<br>1    一个“冷”的备用实例，核心绑定不会被加载到容器中，从实例将等待指导锁定需要启动服务器。<br>&lt;50    一个“热”的备用实例，核心捆绑将被加载到容器，从实例等待指导锁需要启动用户级别绑定。控制台对于每个从实例可以在这个级别访问。  </p>
<blockquote>
<p>50    这个设置不建议作为用户捆绑被启动。<br>注意：挡在同一主机上使用“热”备用，你需要设置JMX远程端口为唯一值以避免绑定冲突，你可以编辑karaf启动脚本以包括以下内容：</p>
</blockquote>
<figure class="highlight haml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DEFAULT_JAVA_OPTS="-server $DEFAULT_JAVA_OPTS </span><br><span class="line">-<span class="hljs-ruby">Dcom.sun.management.jmxremote.port=<span class="hljs-number">1100</span> </span></span><br><span class="line"><span class="hljs-ruby">-Dcom.sun.management.jmxremote.authenticate=<span class="hljs-literal">false</span></span></span><br></pre></td></tr></table></figure>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-24T16:54:00.000Z">2019-07-24</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    9 分钟 read (About 1377 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/25/springboot-osgi-系统监控/">springboot osgi 系统监控</a>
            
        </h1>
        <div class="content">
            <p>Springboot 集成osgi 实现本机性能监控</p>
<!-- 获取系统信息 -->
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.github.oshi&lt;/groupId&gt;
    &lt;artifactId&gt;oshi-core&lt;/artifactId&gt;
    &lt;version&gt;3.9.1&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;net.java.dev.jna&lt;/groupId&gt;
    &lt;artifactId&gt;jna&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;net.java.dev.jna&lt;/groupId&gt;
    &lt;artifactId&gt;jna-platform&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre><p>第二步：CPU、内存、虚拟机、系统、系统文件属性基础封装</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">package com.zzg.monit.domain.server;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.util.Arith;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="hljs-keyword">import</span> lombok.Setter;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cpu</span> &#123;</span></span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 核心数</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Getter</span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> cpuNum;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * CPU总的使用率</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> total;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * CPU系统使用率</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> sys;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * CPU用户使用率</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> used;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * CPU当前等待率</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> wait;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * CPU当前空闲率</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> <span class="hljs-built_in">free</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getTotal</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.round(Arith.mul(total, <span class="hljs-number">100</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getSys</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.round(Arith.mul(sys / total, <span class="hljs-number">100</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getUsed</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.round(Arith.mul(used / total, <span class="hljs-number">100</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getWait</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.round(Arith.mul(wait / total, <span class="hljs-number">100</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getFree</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.round(Arith.mul(<span class="hljs-built_in">free</span> / total, <span class="hljs-number">100</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">package com.zzg.monit.domain.server;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> java.lang.management.ManagementFactory;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.util.Arith;</span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.util.DateUtils;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="hljs-keyword">import</span> lombok.Setter;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * 虚拟机相关设置</span></span><br><span class="line"><span class="hljs-comment"> * @author zzg</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Jvm</span> &#123;</span></span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 当前JVM占用的内存总数(M)</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> total;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * JVM最大可用内存总数(M)</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> max;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * JVM空闲内存(M)</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> <span class="hljs-built_in">free</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * JDK版本</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Getter</span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> String version;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * JDK路径</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Getter</span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> String home;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getTotal</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.div(total, (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getMax</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.div(max, (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getFree</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.div(<span class="hljs-built_in">free</span>, (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getUsed</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.div(total - <span class="hljs-built_in">free</span>, (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getUsage</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.mul(Arith.div(total - <span class="hljs-built_in">free</span>, total, <span class="hljs-number">4</span>), <span class="hljs-number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 获取JDK名称</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> ManagementFactory.getRuntimeMXBean().getVmName();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * JDK启动时间</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getStartTime</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> DateUtils.parseDateToStr(DateUtils.YYYY_MM_DD_HH_MM_SS, DateUtils.getServerStartDate());</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * JDK运行时间</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getRunTime</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> DateUtils.getDatePoor(DateUtils.getNowDate(), DateUtils.getServerStartDate());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">package com.zzg.monit.domain.server;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.util.Arith;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> lombok.Setter;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * 内存相关信息</span></span><br><span class="line"><span class="hljs-comment"> * @author zzg</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Mem</span> &#123;</span></span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 内存总量</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> total;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 已用内存</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> used;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 剩余内存</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> <span class="hljs-built_in">free</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getTotal</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.div(total, (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getUsed</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.div(used, (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getFree</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.div(<span class="hljs-built_in">free</span>, (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getUsage</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.mul(Arith.div(used, total, <span class="hljs-number">4</span>), <span class="hljs-number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.zzg</span><span class="hljs-selector-class">.monit</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.server</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">lombok</span><span class="hljs-selector-class">.Getter</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">lombok</span><span class="hljs-selector-class">.Setter</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * 系统相关信息</span></span><br><span class="line"><span class="hljs-comment"> * @author zzg</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">Sys</span> &#123;</span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 服务器名称</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String computerName;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 服务器Ip</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String computerIp;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 项目路径</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String userDir;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 操作系统</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String osName;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 系统架构</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String osArch;		</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.zzg</span><span class="hljs-selector-class">.monit</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.server</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">lombok</span><span class="hljs-selector-class">.Getter</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">lombok</span><span class="hljs-selector-class">.Setter</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * 系统文件相关信息</span></span><br><span class="line"><span class="hljs-comment"> * @author zzg</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">SysFile</span> &#123;</span><br><span class="line">	 <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 盘符路径</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String dirName;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 盘符类型</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String sysTypeName;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 文件类型</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String typeName;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 总大小</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String total;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 剩余大小</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String free;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 已经使用量</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String used;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 资源的使用率</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private double usage;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight processing hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> com.zzg.monit.domain;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="hljs-keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.List;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.monit.domain.server.Cpu;</span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.monit.domain.server.Jvm;</span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.monit.domain.server.Mem;</span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.monit.domain.server.Sys;</span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.monit.domain.server.SysFile;</span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.util.Arith;</span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.util.IpUtils;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="hljs-keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="hljs-keyword">import</span> oshi.SystemInfo;</span><br><span class="line"><span class="hljs-keyword">import</span> oshi.hardware.CentralProcessor;</span><br><span class="line"><span class="hljs-keyword">import</span> oshi.hardware.GlobalMemory;</span><br><span class="line"><span class="hljs-keyword">import</span> oshi.hardware.HardwareAbstractionLayer;</span><br><span class="line"><span class="hljs-keyword">import</span> oshi.hardware.CentralProcessor.TickType;</span><br><span class="line"><span class="hljs-keyword">import</span> oshi.software.os.FileSystem;</span><br><span class="line"><span class="hljs-keyword">import</span> oshi.software.os.OSFileStore;</span><br><span class="line"><span class="hljs-keyword">import</span> oshi.software.os.OperatingSystem;</span><br><span class="line"><span class="hljs-keyword">import</span> oshi.util.Util;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">public</span> class Server implements Serializable &#123;</span><br><span class="line"> </span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	 * </span></span><br><span class="line"><span class="hljs-comment">	 */</span></span><br><span class="line">	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1</span>L;</span><br><span class="line"> </span><br><span class="line">	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> OSHI_WAIT_SECOND = <span class="hljs-number">1000</span>;</span><br><span class="line"> </span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	 * CPU相关信息</span></span><br><span class="line"><span class="hljs-comment">	 */</span></span><br><span class="line">	@Getter</span><br><span class="line">	@Setter</span><br><span class="line">	<span class="hljs-keyword">private</span> Cpu cpu = <span class="hljs-keyword">new</span> Cpu();</span><br><span class="line"> </span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	 * 內存相关信息</span></span><br><span class="line"><span class="hljs-comment">	 */</span></span><br><span class="line">	@Getter</span><br><span class="line">	@Setter</span><br><span class="line">	<span class="hljs-keyword">private</span> Mem mem = <span class="hljs-keyword">new</span> Mem();</span><br><span class="line"> </span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	 * JVM相关信息</span></span><br><span class="line"><span class="hljs-comment">	 */</span></span><br><span class="line">	@Getter</span><br><span class="line">	@Setter</span><br><span class="line">	<span class="hljs-keyword">private</span> Jvm jvm = <span class="hljs-keyword">new</span> Jvm();</span><br><span class="line"> </span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	 * 服务器相关信息</span></span><br><span class="line"><span class="hljs-comment">	 */</span></span><br><span class="line">	@Getter</span><br><span class="line">	@Setter</span><br><span class="line">	<span class="hljs-keyword">private</span> Sys sys = <span class="hljs-keyword">new</span> Sys();</span><br><span class="line"> </span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	 * 磁盘相关信息</span></span><br><span class="line"><span class="hljs-comment">	 */</span></span><br><span class="line">	@Getter</span><br><span class="line">	@Setter</span><br><span class="line">	<span class="hljs-keyword">private</span> List&lt;SysFile&gt; sysFiles = <span class="hljs-keyword">new</span> LinkedList&lt;SysFile&gt;();</span><br><span class="line">	</span><br><span class="line"> </span><br><span class="line">	 <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> copyTo() <span class="hljs-keyword">throws</span> Exception &#123;</span><br><span class="line">	        SystemInfo si = <span class="hljs-keyword">new</span> SystemInfo();</span><br><span class="line">	        HardwareAbstractionLayer hal = si.getHardware();</span><br><span class="line"> </span><br><span class="line">	        setCpuInfo(hal.getProcessor());</span><br><span class="line"> </span><br><span class="line">	        setMemInfo(hal.getMemory());</span><br><span class="line"> </span><br><span class="line">	        setSysInfo();</span><br><span class="line"> </span><br><span class="line">	        setJvmInfo();</span><br><span class="line"> </span><br><span class="line">	        setSysFiles(si.getOperatingSystem());</span><br><span class="line">	    &#125;</span><br><span class="line"> </span><br><span class="line">	    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	     * 设置CPU信息</span></span><br><span class="line"><span class="hljs-comment">	     */</span></span><br><span class="line">	    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> setCpuInfo(CentralProcessor processor) &#123;</span><br><span class="line">	        <span class="hljs-comment">// CPU信息</span></span><br><span class="line">	        <span class="hljs-keyword">long</span>[] prevTicks = processor.getSystemCpuLoadTicks();</span><br><span class="line">	        Util.sleep(OSHI_WAIT_SECOND);</span><br><span class="line">	        <span class="hljs-keyword">long</span>[] ticks = processor.getSystemCpuLoadTicks();</span><br><span class="line">	        <span class="hljs-keyword">long</span> nice = ticks[TickType.NICE.getIndex()] - prevTicks[TickType.NICE.getIndex()];</span><br><span class="line">	        <span class="hljs-keyword">long</span> irq = ticks[TickType.IRQ.getIndex()] - prevTicks[TickType.IRQ.getIndex()];</span><br><span class="line">	        <span class="hljs-keyword">long</span> softirq = ticks[TickType.SOFTIRQ.getIndex()] - prevTicks[TickType.SOFTIRQ.getIndex()];</span><br><span class="line">	        <span class="hljs-keyword">long</span> steal = ticks[TickType.STEAL.getIndex()] - prevTicks[TickType.STEAL.getIndex()];</span><br><span class="line">	        <span class="hljs-keyword">long</span> cSys = ticks[TickType.SYSTEM.getIndex()] - prevTicks[TickType.SYSTEM.getIndex()];</span><br><span class="line">	        <span class="hljs-keyword">long</span> user = ticks[TickType.USER.getIndex()] - prevTicks[TickType.USER.getIndex()];</span><br><span class="line">	        <span class="hljs-keyword">long</span> iowait = ticks[TickType.IOWAIT.getIndex()] - prevTicks[TickType.IOWAIT.getIndex()];</span><br><span class="line">	        <span class="hljs-keyword">long</span> idle = ticks[TickType.IDLE.getIndex()] - prevTicks[TickType.IDLE.getIndex()];</span><br><span class="line">	        <span class="hljs-keyword">long</span> totalCpu = user + nice + cSys + idle + iowait + irq + softirq + steal;</span><br><span class="line">	        cpu.setCpuNum(processor.getLogicalProcessorCount());</span><br><span class="line">	        cpu.setTotal(totalCpu);</span><br><span class="line">	        cpu.setSys(cSys);</span><br><span class="line">	        cpu.setUsed(user);</span><br><span class="line">	        cpu.setWait(iowait);</span><br><span class="line">	        cpu.setFree(idle);</span><br><span class="line">	    &#125;</span><br><span class="line"> </span><br><span class="line">	    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	     * 设置内存信息</span></span><br><span class="line"><span class="hljs-comment">	     */</span></span><br><span class="line">	    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> setMemInfo(GlobalMemory memory) &#123;</span><br><span class="line">	        mem.setTotal(memory.getTotal());</span><br><span class="line">	        mem.setUsed(memory.getTotal() - memory.getAvailable());</span><br><span class="line">	        mem.setFree(memory.getAvailable());</span><br><span class="line">	    &#125;</span><br><span class="line"> </span><br><span class="line">	    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	     * 设置服务器信息</span></span><br><span class="line"><span class="hljs-comment">	     */</span></span><br><span class="line">	    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> setSysInfo() &#123;</span><br><span class="line">	        Properties props = System.getProperties();</span><br><span class="line">	        sys.setComputerName(IpUtils.getHostName());</span><br><span class="line">	        sys.setComputerIp(IpUtils.getHostIp());</span><br><span class="line">	        sys.setOsName(props.getProperty(<span class="hljs-string">"os.name"</span>));</span><br><span class="line">	        sys.setOsArch(props.getProperty(<span class="hljs-string">"os.arch"</span>));</span><br><span class="line">	        sys.setUserDir(props.getProperty(<span class="hljs-string">"user.dir"</span>));</span><br><span class="line">	    &#125;</span><br><span class="line"> </span><br><span class="line">	    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	     * 设置Java虚拟机</span></span><br><span class="line"><span class="hljs-comment">	     */</span></span><br><span class="line">	    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> setJvmInfo() <span class="hljs-keyword">throws</span> UnknownHostException &#123;</span><br><span class="line">	        Properties props = System.getProperties();</span><br><span class="line">	        jvm.setTotal(Runtime.getRuntime().totalMemory());</span><br><span class="line">	        jvm.setMax(Runtime.getRuntime().maxMemory());</span><br><span class="line">	        jvm.setFree(Runtime.getRuntime().freeMemory());</span><br><span class="line">	        jvm.setVersion(props.getProperty(<span class="hljs-string">"java.version"</span>));</span><br><span class="line">	        jvm.setHome(props.getProperty(<span class="hljs-string">"java.home"</span>));</span><br><span class="line">	    &#125;</span><br><span class="line"> </span><br><span class="line">	    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	     * 设置磁盘信息</span></span><br><span class="line"><span class="hljs-comment">	     */</span></span><br><span class="line">	    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> setSysFiles(OperatingSystem os) &#123;</span><br><span class="line">	        FileSystem fileSystem = os.getFileSystem();</span><br><span class="line">	        OSFileStore[] fsArray = fileSystem.getFileStores();</span><br><span class="line">	        <span class="hljs-keyword">for</span> (OSFileStore fs : fsArray) &#123;</span><br><span class="line">	            <span class="hljs-keyword">long</span> free = fs.getUsableSpace();</span><br><span class="line">	            <span class="hljs-keyword">long</span> total = fs.getTotalSpace();</span><br><span class="line">	            <span class="hljs-keyword">long</span> used = total - free;</span><br><span class="line">	            SysFile sysFile = <span class="hljs-keyword">new</span> SysFile();</span><br><span class="line">	            sysFile.setDirName(fs.getMount());</span><br><span class="line">	            sysFile.setSysTypeName(fs.getType());</span><br><span class="line">	            sysFile.setTypeName(fs.getName());</span><br><span class="line">	            sysFile.setTotal(convertFileSize(total));</span><br><span class="line">	            sysFile.setFree(convertFileSize(free));</span><br><span class="line">	            sysFile.setUsed(convertFileSize(used));</span><br><span class="line">	            sysFile.setUsage(Arith.mul(Arith.div(used, total, <span class="hljs-number">4</span>), <span class="hljs-number">100</span>));</span><br><span class="line">	            sysFiles.<span class="hljs-built_in">add</span>(sysFile);</span><br><span class="line">	        &#125;</span><br><span class="line">	    &#125;</span><br><span class="line"> </span><br><span class="line">	    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	     * 字节转换</span></span><br><span class="line"><span class="hljs-comment">	     *</span></span><br><span class="line"><span class="hljs-comment">	     * @param size 字节大小</span></span><br><span class="line"><span class="hljs-comment">	     * @return 转换后值</span></span><br><span class="line"><span class="hljs-comment">	     */</span></span><br><span class="line">	    <span class="hljs-keyword">public</span> <span class="hljs-keyword">String</span> convertFileSize(<span class="hljs-keyword">long</span> <span class="hljs-built_in">size</span>) &#123;</span><br><span class="line">	        <span class="hljs-keyword">long</span> kb = <span class="hljs-number">1024</span>;</span><br><span class="line">	        <span class="hljs-keyword">long</span> mb = kb * <span class="hljs-number">1024</span>;</span><br><span class="line">	        <span class="hljs-keyword">long</span> gb = mb * <span class="hljs-number">1024</span>;</span><br><span class="line">	        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">size</span> &gt;= gb) &#123;</span><br><span class="line">	            <span class="hljs-keyword">return</span> <span class="hljs-keyword">String</span>.format(<span class="hljs-string">"%.1f GB"</span> , (<span class="hljs-built_in">float</span>) <span class="hljs-built_in">size</span> / gb);</span><br><span class="line">	        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">size</span> &gt;= mb) &#123;</span><br><span class="line">	            <span class="hljs-built_in">float</span> f = (<span class="hljs-built_in">float</span>) <span class="hljs-built_in">size</span> / mb;</span><br><span class="line">	            <span class="hljs-keyword">return</span> <span class="hljs-keyword">String</span>.format(f &gt; <span class="hljs-number">100</span> ? <span class="hljs-string">"%.0f MB"</span> : <span class="hljs-string">"%.1f MB"</span> , f);</span><br><span class="line">	        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">size</span> &gt;= kb) &#123;</span><br><span class="line">	            <span class="hljs-built_in">float</span> f = (<span class="hljs-built_in">float</span>) <span class="hljs-built_in">size</span> / kb;</span><br><span class="line">	            <span class="hljs-keyword">return</span> <span class="hljs-keyword">String</span>.format(f &gt; <span class="hljs-number">100</span> ? <span class="hljs-string">"%.0f KB"</span> : <span class="hljs-string">"%.1f KB"</span> , f);</span><br><span class="line">	        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">	            <span class="hljs-keyword">return</span> <span class="hljs-keyword">String</span>.format(<span class="hljs-string">"%d B"</span> , <span class="hljs-built_in">size</span>);</span><br><span class="line">	        &#125;</span><br><span class="line">	    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第三步：控制层编写：</p>
<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> com.zzg.controller;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RequestMapping;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.monit.domain.Server;</span><br><span class="line"><span class="hljs-keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * 服务器监控</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> zzg</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-meta">@Api(value = <span class="hljs-meta-string">"服务器监控"</span>, description = <span class="hljs-meta-string">"服务器监控管理"</span>)</span></span><br><span class="line"><span class="hljs-meta">@Controller</span></span><br><span class="line"><span class="hljs-meta">@RequestMapping(<span class="hljs-meta-string">"/server"</span>)</span></span><br><span class="line"><span class="hljs-meta">@Slf4j</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServerController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="hljs-comment">/**服务器监控首页</span></span><br><span class="line"><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> Exception **/</span></span><br><span class="line">    <span class="hljs-meta">@ApiOperation(value = <span class="hljs-meta-string">"服务器监控首页"</span>, notes = <span class="hljs-meta-string">"服务器监控首页"</span>)</span></span><br><span class="line">    <span class="hljs-meta">@GetMapping(<span class="hljs-meta-string">"/server"</span>)</span></span><br><span class="line">    <span class="hljs-keyword">public</span> ModelAndView user() throws Exception&#123;</span><br><span class="line">    	Server server = new Server();</span><br><span class="line">        server.copyTo();</span><br><span class="line">    	ModelAndView modelAndView = new ModelAndView();</span><br><span class="line">    	modelAndView.setViewName(<span class="hljs-string">"admin/server/server"</span>);</span><br><span class="line">    	modelAndView.addObject(<span class="hljs-string">"server"</span>, server);</span><br><span class="line">        <span class="hljs-keyword">return</span> modelAndView;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/images/pasted-28.png" alt="upload successful"></p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-24T16:42:00.000Z">2019-07-24</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    4 分钟 read (About 575 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/25/karaf-cmd-develop/">karaf cmd develop</a>
            
        </h1>
        <div class="content">
            <p>Karaf命令行辅助开发</p>
<p>在命令行中，要实现如上常用的help,通过ArgumentParsers，则可以容易实现,参考代码</p>
<pre><code>package com.zte.sunquan.demo.param;

import java.io.File;
import java.util.ArrayList;
import net.sourceforge.argparse4j.ArgumentParsers;
import net.sourceforge.argparse4j.annotation.Arg;
import net.sourceforge.argparse4j.inf.ArgumentParser;
import net.sourceforge.argparse4j.inf.ArgumentParserException;

/**
 * Created by sunquan on 2018/1/10.
 */
public class ParamTest {
    public static class Params {

        @Arg(dest = &quot;type&quot;)
        public String type;

        @Arg(dest = &quot;num1&quot;)
        public String num;

        @Arg(dest = &quot;auth&quot;)
        public ArrayList&lt;String&gt; auth;

        @Arg(dest = &quot;schemas-dir&quot;)
        public File schemasDir;

        public String getType() {
            return type;
        }

        public String getNum() {
            return num;
        }

        public ArrayList&lt;String&gt; getAuth() {
            return auth;
        }

        public File getSchemasDir() {
            return schemasDir;
        }
    }

    public static void main(String[] args) throws ArgumentParserException {
        //指定命令gcs
        final ArgumentParser parser = ArgumentParsers.newArgumentParser(&quot;gcs&quot;)
                .defaultHelp(true)
                .description(&quot;alculate checksum of given String.&quot;);//描述命令功能

        parser.addArgument(&quot;-t&quot;, &quot;--type&quot;)//参数选项,第二个参数默认对应@Arg中dest
                .type(String.class)//默认值
                .choices(&quot;SHA-256&quot;, &quot;SHA-512&quot;, &quot;SHA1&quot;)//可选项
                .setDefault(&quot;SHA-256&quot;)//默认值
                .help(&quot;Specify hash function to use&quot;);//选项描述
        parser.addArgument(&quot;-c&quot;, &quot;--content&quot;)
                .type(String.class)
                .help(&quot;content which need calculate&quot;)
                .dest(&quot;num1&quot;);//指定对应的@Arg 定义属性
        parser.addArgument(&quot;-a&quot;, &quot;--auth&quot;)
                .nargs(2)
                .help(&quot;Username and password for HTTP basic authentication in order username password.&quot;)
                .dest(&quot;auth&quot;);

        parser.addArgument(&quot;-f&quot;, &quot;--schemas-dir&quot;)
                .type(File.class)
                .help(&quot;Directory containing yang schemas to describe simulated devices. Some schemas e.g. netconf monitoring and inet types are included by default&quot;)
                .dest(&quot;schemas-dir&quot;);

        parser.printHelp();//打印help信息

        Params params = new Params();//命令包装对象
        try {
            //命令行参数--&gt;自动转包装对象
            parser.parseArgs(new String[]{&quot;-t&quot;, &quot;SHA-256&quot;,
                    &quot;--content&quot;, &quot;sunquan&quot;,
                    &quot;-a&quot;, &quot;sunquan&quot;, &quot;password&quot;,
                    &quot;-f&quot;, &quot;C:/Users/Administrator/.m2/settings.xml&quot;}, params);//字符串转命令包装对象
        } catch (final ArgumentParserException e) {
            parser.handleError(e);
        }
        System.out.println(&quot;type:\t&quot; + params.getType());
        System.out.println(&quot;num:\t&quot; + params.getNum());
        System.out.println(&quot;userName:\t&quot; + params.getAuth().get(0));
        System.out.println(&quot;password:\t&quot; + params.getAuth().get(1));
        if (params.getSchemasDir().exists())
            System.out.println(&quot;file:\t&quot; + params.getSchemasDir().getName());

    }
}</code></pre><p>再介绍org.apache.karaf.shell.table.ShellTable</p>
<pre><code>    public static void main(String[] args) {

        ShellTable table = new ShellTable();
        table.size(40);//设置显示列宽（从最后一列开始计数），不设置
        table.column(&quot;name&quot;).alignLeft();//设置1列标题靠左
        table.column(&quot;age&quot;).alignCenter();//设置1列标题居中
        Col gender = new Col(&quot;gender&quot;);
        gender.alignRight();
        gender.maxSize(10);//设置该列长度，多余字符会被截断，不设置
        table.column(gender);
//        table.column(&quot;gender&quot;).alignRight();//设置1列标题靠右
        table.separator(&quot; % &quot;);//设置分隔符
        table.addRow().addContent(&quot;sunquan111111111111111111&quot;, &quot;291111111111&quot;, &quot;boy456789&quot;);
        table.addRow().addContent(&quot;sunquan&quot;, &quot;29&quot;, &quot;boy&quot;);
        table.addRow().addContent(&quot;sunquan&quot;, &quot;29&quot;, &quot;boy&quot;);
//        table.noHeaders();//不显示头，不设置
        table.print(System.out);

        table = new ShellTable();
        table.column(&quot;name&quot;).alignLeft();//设置1列标题靠左
        table.emptyTableText(&quot;null&quot;);//表示一个空表，用null替代
        table.print(System.out, true);

    }</code></pre>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-24T10:23:00.000Z">2019-07-24</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    16 分钟 read (About 2346 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/24/OSGI/">OSGI</a>
            
        </h1>
        <div class="content">
            <p>OSGI （面向Java的动态模型系统）   </p>
<p>OSGi（开放服务网关协议，Open Service Gateway Initiative）技术是Java动态化模块化系统的一系列规范。OSGi一方面指维护OSGi规范的OSGI官方联盟，另一方面指的是该组织维护的基于Java语言的服务（业务）规范。简单来说，OSGi可以认为是Java平台的模块层。OSGi服务平台向Java提供服务，这些服务使Java成为软件集成和软件开发的首选环境。SGi技术提供允许应用程序使用精炼、可重用和可协作的组件构建的标准化原语，这些组件能够组装进一个应用和部署中。<br>开放服务网关协议有双重含义。一方面它指OSGi Alliance组织；另一方面指该组织制定的一个基于Java语言的服务规范——OSGi服务平台。 OSGi Alliance是一个由Sun Microsystems、IBM、爱立信等于1999年3月成立的开放的标准化组织，最初名为Connected Alliance。该组织及其标准原本主要目的在于使服务提供商通过住宅网关，为各种家庭智能设备提供各种服务。该平台逐渐成为一个为室内、交通工具、移动电话和其他环境下的所有类型的网络设备的应用程序和服务进行传递和远程管理的开放式服务平台。<br>该规范和核心部分是一个框架，其中定义了应用程序的生命周期模式和服务注册。基于这个框架定义了大量的OSGi服务：日志、配置管理、偏好，HTTP（运行servlet）、XML分析、设备访问、软件包管理、许可管理、星级、用户管理、IO连接、连线管理、Jini和UPnP。<br>这个框架实现了一个优雅、完整和动态的组件模型。应用程序（称为bundle）无需重新引导可以被远程安装、启动、升级和卸载（其中Java包/类的管理被详细定义）。API中还定义了运行远程下载管理政策的生命周期管理。<font color="red">服务注册允许bundles去检测新服务和取消的服务，然后相应配合。 </font>OSGI框架一般具备的基础功能：<br>支持模块化的动态部署。基于OSGI而构建的系统可以以模块化的方式动态地部署至框架中，从而增加、扩展或改变系统的功能。支持模块化的封装和交互。每个工程（模块）可通过声明Export-Package对外提供访问此工程的类和接口。<br>支持模块的动态扩展。基于OSGI提供的面向服务的组件模型的设计方法，以及OSGI实现框架提供的扩展点方法可实现模块的动态扩展。模块化的设计。在OSGI中模块由一个或多个bundle构成，模块之间的交互通过Import-Package、Export-Package以及OSGI Service的方式实现。<br>动态化的设计。动态化的设计是指系统中所有的模块必须支持动态的插拔和修改，“即插即用，即删即无”。<br>可扩展的设计。通常使用定义扩展点的方式。按照Eclipse推荐的扩展点插件的标准格式定义bundle中的扩展点，其它要扩展的bundle可通过实现相应的扩展点来扩展该bundle的功能。<font color="red">每个bundle拥有独立的class loader，通过它来完成本bundle类的加载。 </font><br>稳定、高效的系统。基于OSGI的系统采用的是微核机制，微核机制保证了系统的稳定性，微核机制的系统只要微核是稳定运行的，那么系统就不会崩溃，也就是说基于OSGI的系统不会受到运行在其中的bundle的影响，不会因为bundle的崩溃而导致整个系统的崩溃。 [1]<br>OSGi服务平台提供在多种网络设备上无需重启的动态改变构造的功能。为了最小化耦合度和促使这些耦合度可管理，OSGi技术提供一种面向服务的架构，它能使这些组件动态地发现对方。OSGi联盟已经开发了例如像HTTP服务器、配置、日志、安全、用户管理、XML等很多公共功能标准组件接口。这些组件的兼容性插件实现可以从进行了不同优化和使用代价的不同计算机服务提供商得到。然而，服务接口能够基于专有权基础上开发。<br>因为OSGi技术为集成提供了预建立和预测试的组件子系统，所以OSGi技术使你从改善产品上市时间和降低开发成本上获益。因为这些组件能够动态发布到设备上，所以OSGi技术也能降低维护成本和拥有新的配件市场机会。 </p>
<p>OSGI规范的核心组件是OSGI框架。这个框架为应用程序（被叫做组件（bundle））提供了一个标准环境。整个框架可以划分为一些层次：</p>
<p>OSGI<br>L0：运行环境<br>L1：模块<br>L2：生命周期管理<br>L3：服务注册<br>还有一个无处不在的安全系统渗透到所有层。</p>
<p>L0层执行环境是Java环境的规范。Java2配置和子规范，像J2SE，CDC，CLDC，MIDP等等，都是有效的执行环境。OSGi平台已经标准化了一个执行环境，它是基于基础轮廓和在一个执行环境上确定了最小需求的一个小一些的变种，该执行环境对OSGi组件是有用的。<br>L1模块层定义类的装载策略。OSGi框架是一个强大的具有严格定义的类装载模型。它基于Java之上，但是增加了模块化。在Java中，正常情况下有一个包含所有类和资源的类路径。OSGi模块层为一个模块增加了私有类同时有可控模块间链接。模块层同安全架构完全集成，可以选择部署到部署封闭系统，防御系统，或者由厂商决定的完全由用户管理的系统。<br>L2生命周期层增加了能够被动态安装、开启、关闭、更新和卸载的bundles。这些bundles依赖于于具有类装载功能的模块层，但是增加了在运行时管理这些模块的API。生命周期层引入了正常情况下不属于一个应用程序的动态性。扩展依赖机制用于确保环境的操作正确。生命周期操作在安全架构保护之下，使其不受到病毒的攻击。<br>L3层增加了服务注册。服务注册提供了一个面向bundles的考虑到动态性的协作模型。bundles能通过传统的类共享进行协作，但是类共享同动态安装和卸载代码不兼容。服务注册提供了一个在bundles间分享对象的完整模型。定义了大量的事件来处理服务的注册和删除。这些服务仅仅是能代表任何事物的Java对象。很多服务类似服务器对象，例如HTTP服务器，而另一些服务表示的是一个真实世界的对象，例如附近的一个蓝牙手机。这个服务模块提供了完整安全保障。该服务安全模块使用了一个很聪明的方式来保障bundles之间通信安全。</p>
<p>标准服务<br>在该框架之上，OSGi联盟定义了很多服务。这些服务通过一个Java接口指定。bundles能够实  </p>
<p>OSGI<br>现这个接口，并在注册服务层注册该服务。服务的客户端在注册库中找到它，或者当它出现或者消失时做出响应。这个同SOA架构使用Web服务进行发布的方式相似。<br>两者主要不同是Web服务总是需要传输层，这个使它比采用直接方法调用的OSGi服务慢几千倍。同时，OSGi组件能够对这些服务的出现和消失做出响应。更多的信息可以从OSGi服务平台发行版本4手册或者PDF下载中找到。需要注意的是每一种服务都是抽象定义的，与不同计算机服务商的实现相独立。  </p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-20T02:29:00.000Z">2019-07-20</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 分钟 read (About 519 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/20/onos-源码编译安装/">onos-buck 源码编译安装</a>
            
        </h1>
        <div class="content">
            <p>老版本  onos-buck<br>ONOS新版本源码安装方式<br>发表于 2017-03-08   |   分类于 项目展示   |     |    访问量:<br>1.安装JDK（从Oracle官网下载，不要用OpenJDK）<br>1.Download and Extract JDK package, such as jdk-8u121-linux-x64.tar.gz.<br><code>tar -xzf jdk-8u121-linux-x64.tar.gz</code></p>
<p>and you can see new directory /home/yourname/jdk1.8.0_121.<br>2.Add two environment variables into ~/.bashrc or /etc/profile:</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">JAVA_HOME</span>=/home/yourname/jdk1.8.0_121</span><br><span class="line"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">PATH</span>=<span class="hljs-variable">$&#123;JAVA_HOME&#125;</span>/bin:$PATH</span><br></pre></td></tr></table></figure>

<p>3.Save and open a new terminal, go on next step.</p>
<figure class="highlight sql hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get <span class="hljs-keyword">install</span> software-properties-common -y &amp;&amp; \</span><br><span class="line">sudo <span class="hljs-keyword">add</span>-apt-repository ppa:webupd8team/<span class="hljs-keyword">java</span> -y &amp;&amp; \</span><br><span class="line">sudo apt-<span class="hljs-keyword">get</span> <span class="hljs-keyword">update</span> &amp;&amp; \</span><br><span class="line">echo <span class="hljs-string">"oracle-java8-installer shared/accepted-oracle-license-v1-1 select true"</span> | sudo debconf-<span class="hljs-keyword">set</span>-selections &amp;&amp; \</span><br><span class="line">sudo apt-<span class="hljs-keyword">get</span> <span class="hljs-keyword">install</span> <span class="hljs-keyword">oracle</span>-java8-installer <span class="hljs-keyword">oracle</span>-java8-<span class="hljs-keyword">set</span>-<span class="hljs-keyword">default</span> -y</span><br></pre></td></tr></table></figure>

<p>2.下载源码并编译</p>
<figure class="highlight crmsh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="hljs-keyword">clone</span> <span class="hljs-title">https</span>://gerrit.onosproject.org/onos</span><br><span class="line">cd onos <span class="hljs-comment">#之后的命令均在此目录下</span></span><br><span class="line">tools/build/onos-buck build onos --show-output</span><br></pre></td></tr></table></figure>

<p>正常的话，会打印出.tar.gz目录，这个就是二进制安装文件。<br>3.本地运行ONOS<br><code>tools/build/onos-buck run onos-local -- clean debug</code><br>以上命令将会从本地的 onos.tar.gz文件中进行本地安装，并在后台开启ONOS服务。在终端上将会持续打出ONOS的日志内容。clean选项会使其进行ONOS的清洁安装，而debug选项意为默认调试端口5005将会开启。<br>4.设置环境变量<br>在/etc/profile中添加： </p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">ONOS_ROOT</span>=/home/yourname/onos</span><br><span class="line">source <span class="hljs-variable">$ONOS_ROOT</span>/tools/dev/bash_profile</span><br></pre></td></tr></table></figure>

<p>5.开启ONOS的CLI控制台<br>在本地开启ONOS之后，在新的终端执行以下命令：<br><code>tools/test/bin/onos localhost</code><br>6.开启ONOS的GUI界面<br>在本地开启ONOS之后，在新的终端执行以下命令：<br><code>tools/test/bin/onos-gui localhost</code></p>
<p>#（实际执行了open http://$host:8181/onos/ui，Ubuntu不支持，</p>
<p>#出错Couldn’t get a file descriptor referring to the console）<br>或者访问<a href="http://localhost:8181/onos/ui" target="_blank" rel="noopener">http://localhost:8181/onos/ui</a> （推荐）<br>默认用户名onos，密码rocks<br>7.ONOS单元测试<br>To execute ONOS unit tests, including code Checkstyle validation, run the following command:<br><code>tools/build/onos-buck test</code><br>8.导入工程到IDE<code>If you want to import the project into IntelliJ, you can generate the hierarchical module structure via the following command:</code><br><code>tools/build/onos-buck project</code></p>
<p>Then simply open the onos directory from IntelliJ IDEA.</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-18T19:48:00.000Z">2019-07-18</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    8 分钟 read (About 1199 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/19/bazel/">bazel</a>
            
        </h1>
        <div class="content">
            <p>bazel<br>演变一: Carthage<br>将整个工程拆分成多个仓库.每个仓库都是一个Framework.<br>每个小组维护一个仓库.<br>每个小组也只需关心这一个仓库.对其他仓库的依赖都用二进制依赖.<br>大大加快编译速度.<br>代表工具: Carthage.<br>演变二: bazel<br>不把每个库拆分成小仓库了.<br>所有库都在一个Git仓库中.<br>通过bazel拆分成多个package.<br>每个package的编译缓存都是独立的.<br>解决了编译过慢的问题.<br>虽然在同一个大仓库里.<br>但是每组各自维护自己的package.<br>所以不会导致不同组之间的git冲突  </p>
<p>bazel :<br>解决了编译过慢问题<br>解决了库之间依赖问题<br>解决了多人协作导致的git冲突  </p>
<p>安装<br>安装过程请参考: <a href="http://bazel.io/docs/install.html" target="_blank" rel="noopener">http://bazel.io/docs/install.html</a><br>使用工作区（workspace）<br>所有的Bazel构建都是基于一个 工作区（workspace） 概念，它是文件系统中一个保存了全部源代码的目录，同时还将包含一些构建后的输出目录的符号链接（例如：bazel-bin和 bazel-out 等输出目录）。工作区目录可以随意放在哪里，但是工作区的根目录必须包含一个名为 WORKSPACE 的工作区配置文件。工作区配置文件可以是一个空文件，也可以包含引用外部构建输出所需的 依赖关系。<br>在一个工作区内，可以根据需要共享多个项目。为了简单，我们先从只有一个项目的工作区开始介绍。<br>先假设你已经有了一个项目，对应 ~/gitroot/my-project/ 目录。我们先创建一个空的 ~/gitroot/my-project/WORKSPACE 工作区配置文件，用于表示这是Bazel项目对应的根目录。<br>创建自己的Build构建文件<br>使用下面的命令创建一个简单的Java项目：<br>$ # If you’re not already there, move to your workspace directory.<br>$ cd ~/gitroot/my-project<br>$ mkdir -p src/main/java/com/example<br>$ cat &gt; src/main/java/com/example/ProjectRunner.java &lt;&lt;EOF<br>package com.example;  </p>
<p>public class ProjectRunner {<br>public static void main(String args[]) {<br>Greeting.sayHi();<br>}  
}<br>EOF<br>$ cat &gt; src/main/java/com/example/Greeting.java &lt;&lt;EOF<br>package com.example;  </p>
<p>public class Greeting {<br>public static void sayHi() {<br>System.out.println(“Hi!”);<br>}  
}<br>EOF  </p>
<p>Bazel通过工作区中所有名为 BUILD 的文件来解析需要构建的项目信息，因此，我们需要先在 ~/gitroot/my-project 目录创建一个 BUILD 构建文件。下面是BUILD构建文件的内容：  </p>
<h4 id="gitroot-my-project-BUILD"><a href="#gitroot-my-project-BUILD" class="headerlink" title="~/gitroot/my-project/BUILD"></a>~/gitroot/my-project/BUILD</h4><figure class="highlight makefile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java_binary(</span><br><span class="line">name = <span class="hljs-string">"my-runner"</span>,</span><br><span class="line">srcs = glob([<span class="hljs-string">"**/*.java"</span>]),</span><br><span class="line">main_class = <span class="hljs-string">"com.example.ProjectRunner"</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>BUILD文件采用类似Python的语法。虽然不能包含任意的Python语法，但是BUILD文件中的每个构建规则看起来都象是一个Python函数调用，而且你也可以用 “#” 开头来添加单行注释。<br>java_binary 是一个构建规则。其中 name 对应一个构建目标的标识符，可用用它来向Bazel指定构建哪个项目。srcs 对应一个源文件列表，Bazel需要将这些源文件编译为二进制文件。其中 glob([“<em>*/</em>.java”]) 表示递归包含每个子目录中以每个 .java 为后缀名的文件。com.example.ProjectRunner 指定包含main方法的类。</p>
<p>现在可以用下面的命令构建这个Java程序了：</p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ cd <span class="hljs-regexp">~/gitroot/</span>my-project</span><br><span class="line">$ bazel build <span class="hljs-comment">//:my-runner</span></span><br><span class="line"><span class="hljs-string">INFO:</span> Found <span class="hljs-number">1</span> target...</span><br><span class="line">Target <span class="hljs-comment">//:my-runner up-to-date:</span></span><br><span class="line">bazel-bin/my-runner.jar</span><br><span class="line">bazel-bin/my-runner</span><br><span class="line"><span class="hljs-string">INFO:</span> Elapsed <span class="hljs-string">time:</span> <span class="hljs-number">1.021</span>s, Critical <span class="hljs-string">Path:</span> <span class="hljs-number">0.83</span>s</span><br><span class="line">$ bazel-bin/my-runner</span><br><span class="line">Hi!</span><br></pre></td></tr></table></figure>

<p>恭喜，你已经成功构建了第一个Bazel项目了！<br>添加依赖关系<br>对于小项目创建一个规则是可以的，但是随着项目的变大，则需要分别构建项目的不同的部件，最终再组装成产品。这种构建方式可以避免因为局部细小的修改儿导致重现构建整个应用，同时不同的构建步骤可以很好地并发执行以提高构建效率。<br>我们现在将一个项目拆分为两个部分独立构建，同时设置它们之间的依赖关系。基于上面的例子，我们重写了BUILD构建文件：</p>
<figure class="highlight makefile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">java_binary(</span><br><span class="line">name = <span class="hljs-string">"my-other-runner"</span>,</span><br><span class="line">srcs = [<span class="hljs-string">"src/main/java/com/example/ProjectRunner.java"</span>],</span><br><span class="line">main_class = <span class="hljs-string">"com.example.ProjectRunner"</span>,</span><br><span class="line">deps = [<span class="hljs-string">":greeter"</span>],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">java_library(</span><br><span class="line">name = <span class="hljs-string">"greeter"</span>,</span><br><span class="line">srcs = [<span class="hljs-string">"src/main/java/com/example/Greeting.java"</span>],</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>虽然源文件是一样的，但是现在Bazel将采用不同的方式来构建：首先是构建 greeter库，然后是构建 my-other-runner。可以在构建成功后立刻运行 //:my-other-runner：</p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ bazel run <span class="hljs-comment">//:my-other-runner</span></span><br><span class="line"><span class="hljs-string">INFO:</span> Found <span class="hljs-number">1</span> target...</span><br><span class="line">Target <span class="hljs-comment">//:my-other-runner up-to-date:</span></span><br><span class="line">bazel-bin/my-other-runner.jar</span><br><span class="line">bazel-bin/my-other-runner</span><br><span class="line"><span class="hljs-string">INFO:</span> Elapsed <span class="hljs-string">time:</span> <span class="hljs-number">2.454</span>s, Critical <span class="hljs-string">Path:</span> <span class="hljs-number">1.58</span>s</span><br><span class="line"></span><br><span class="line"><span class="hljs-string">INFO:</span> Running command <span class="hljs-string">line:</span> bazel-bin/my-other-runner</span><br><span class="line">Hi!</span><br></pre></td></tr></table></figure>

<p>现在如果你改动ProjectRunner.java代码并重新构建my-other-runner目标，Greeting.java文件因为没有变化而不会重现编译。<br>使用多个包（Packages）<br>对于更大的项目，我们通常需要将它们拆分到多个目录中。你可以用类似//path/to/directory:target-name的名字引用在其他BUILD文件定义的目标。假设src/main/java/com/example/有一个cmdline/子目录，包含下面的文件：</p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p src<span class="hljs-regexp">/main/</span>java<span class="hljs-regexp">/com/</span>example/cmdline</span><br><span class="line">$ cat &gt; src<span class="hljs-regexp">/main/</span>java<span class="hljs-regexp">/com/</span>example<span class="hljs-regexp">/cmdline/</span>Runner.java &lt;&lt;EOF</span><br><span class="line"><span class="hljs-keyword">package</span> com.example.cmdline;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> com.example.Greeting;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Runner</span> &#123;</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> main(String args[]) &#123;</span><br><span class="line">Greeting.sayHi();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>Runner.java依赖com.example.Greeting，因此我们需要在src/main/java/com/example/cmdline/BUILD构建文件中添加相应的依赖规则：  </p>
<h5 id="gitroot-my-project-src-main-java-com-example-cmdline-BUILD"><a href="#gitroot-my-project-src-main-java-com-example-cmdline-BUILD" class="headerlink" title="~/gitroot/my-project/src/main/java/com/example/cmdline/BUILD"></a>~/gitroot/my-project/src/main/java/com/example/cmdline/BUILD</h5><figure class="highlight makefile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">java_binary(</span><br><span class="line">name = <span class="hljs-string">"runner"</span>,</span><br><span class="line">srcs = [<span class="hljs-string">"Runner.java"</span>],</span><br><span class="line">main_class = <span class="hljs-string">"com.example.cmdline.Runner"</span>,</span><br><span class="line">deps = [<span class="hljs-string">"//:greeter"</span>]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>然而，默认情况下构建目标都是 私有 的。也就是说，我们只能在同一个BUILD文件中被引用。这可以避免将很多实现的细节暴漏给公共的接口，但是也意味着我们需要手工允许runner所依赖的//:greeter目标。就是类似下面这个在构建runner目标时遇到的错误：  </p>
<figure class="highlight subunit hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ bazel build //src/main/java/com/example/cmdline:runner</span><br><span class="line"><span class="hljs-keyword">ERROR: </span>/home/user/gitroot/my-project/src/main/java/com/example/cmdline/BUILD:2:1:</span><br><span class="line">Target '//:greeter' is not visible from target '//src/main/java/com/example/cmdline:runner'.</span><br><span class="line">Check the visibility declaration of the former target if you think the dependency is legitimate.</span><br><span class="line"><span class="hljs-keyword">ERROR: </span>Analysis of target '//src/main/java/com/example/cmdline:runner' failed; build aborted.</span><br><span class="line">INFO: Elapsed time: 0.091s</span><br></pre></td></tr></table></figure>

<p>可用通过在BUILD文件增加visibility = level属性来改变目标的可间范围。下面是通过在~/gitroot/my-project/BUILD文件增加可见规则，来改变greeter目标的可见范围：</p>
<figure class="highlight makefile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java_library(</span><br><span class="line">name = <span class="hljs-string">"greeter"</span>,</span><br><span class="line">srcs = [<span class="hljs-string">"src/main/java/com/example/Greeting.java"</span>],</span><br><span class="line">visibility = [<span class="hljs-string">"//src/main/java/com/example/cmdline:__pkg__"</span>],</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>这个规则表示//:greeter目标对于//src/main/java/com/example/cmdline包是可见的。现在我们可以重新构建runner目标程序：</p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ bazel run <span class="hljs-comment">//src/main/java/com/example/cmdline:runner</span></span><br><span class="line"><span class="hljs-string">INFO:</span> Found <span class="hljs-number">1</span> target...</span><br><span class="line">Target <span class="hljs-comment">//src/main/java/com/example/cmdline:runner up-to-date:</span></span><br><span class="line">bazel-bin<span class="hljs-regexp">/src/</span>main<span class="hljs-regexp">/java/</span>com<span class="hljs-regexp">/example/</span>cmdline/runner.jar</span><br><span class="line">bazel-bin<span class="hljs-regexp">/src/</span>main<span class="hljs-regexp">/java/</span>com<span class="hljs-regexp">/example/</span>cmdline/runner</span><br><span class="line"><span class="hljs-string">INFO:</span> Elapsed <span class="hljs-string">time:</span> <span class="hljs-number">1.576</span>s, Critical <span class="hljs-string">Path:</span> <span class="hljs-number">0.81</span>s</span><br><span class="line"><span class="hljs-string">INFO:</span> Running command <span class="hljs-string">line:</span> bazel-bin<span class="hljs-regexp">/src/</span>main<span class="hljs-regexp">/java/</span>com<span class="hljs-regexp">/example/</span>cmdline/runner</span><br><span class="line">Hi!</span><br></pre></td></tr></table></figure>

<p>参考文档 中有可见性配置说明。<br>部署<br>如果你查看 bazel-bin/src/main/java/com/example/cmdline/runner.jar 的内容，可以看到里面只包含了Runner.class，并没有保护所依赖的Greeting.class：</p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ jar tf bazel-bin<span class="hljs-regexp">/src/</span>main<span class="hljs-regexp">/java/</span>com<span class="hljs-regexp">/example/</span>cmdline/runner.jar</span><br><span class="line">META-INF/</span><br><span class="line">META-INF/MANIFEST.MF</span><br><span class="line">com/</span><br><span class="line">com<span class="hljs-regexp">/example/</span></span><br><span class="line">com<span class="hljs-regexp">/example/</span>cmdline/</span><br><span class="line">com<span class="hljs-regexp">/example/</span>cmdline/Runner.<span class="hljs-keyword">class</span></span><br></pre></td></tr></table></figure>

<p>这只能在本机正常工作（因为Bazel的runner脚本已经将greeter jar添加到了classpath），但是如果将runner.jar单独复制到另一台机器上讲不能正常运行。如果想要构建可用于部署发布的自包含所有依赖的目标，可以构建runner_deploy.jar目标（类似<target-name>_deploy.jar以_deploy为后缀的名字对应可部署目标）。</target-name></p>
<figure class="highlight elixir hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">$ </span>bazel build /<span class="hljs-regexp">/src/main</span><span class="hljs-regexp">/java/com</span><span class="hljs-regexp">/example/cmdline</span><span class="hljs-symbol">:runner_deploy</span>.jar</span><br><span class="line"><span class="hljs-symbol">INFO:</span> Found <span class="hljs-number">1</span> target...</span><br><span class="line">Target /<span class="hljs-regexp">/src/main</span><span class="hljs-regexp">/java/com</span><span class="hljs-regexp">/example/cmdline</span><span class="hljs-symbol">:runner_deploy</span>.jar up-to-<span class="hljs-symbol">date:</span></span><br><span class="line">bazel-bin/src/main/java/com/example/cmdline/runner_deploy.jar</span><br><span class="line"><span class="hljs-symbol">INFO:</span> Elapsed <span class="hljs-symbol">time:</span> <span class="hljs-number">1.700</span>s, Critical <span class="hljs-symbol">Path:</span> <span class="hljs-number">0</span>.<span class="hljs-number">23</span>s</span><br></pre></td></tr></table></figure>

<p>win环境下 Bazel 离线安装教程<br>对于bazel谷歌的开发脚手架，发现用windows系统下powershell下载速度特别慢，在刨坑过程中发现了一种捷径，就是离线安装，接下来将简单介绍离线安装过程<br>1、安装choco<br>cmd安装指令：  </p>
<figure class="highlight plain hljs"><figcaption><span>-NoProfile -InputFormat None -ExecutionPolicy Bypass -Command "iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))" && SET "PATH</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">powershell安装指令：  </span><br><span class="line">```Set-ExecutionPolicy Bypass -Scope Process -Force; iex ((New-Object System.Net.WebClient).DownloadString(&apos;https://chocolatey.org/install.ps1&apos;))```  </span><br><span class="line">特别说明：一定注意都是在管理员用户权限下打开cmd或者是powershell 这里推荐win10系统下使用powershell，如图所示，右键开始菜单打开管理员用户下的powershell：  </span><br><span class="line">2、通过powershell安装bazel  </span><br><span class="line">2.1、输入指令：  </span><br><span class="line">`choco install bazel`  </span><br><span class="line"></span><br><span class="line">&lt;hr/&gt;  </span><br><span class="line">离线安装  </span><br><span class="line">从官网上下载目前最新的bazel压缩包  </span><br><span class="line">先运行choco install bazel指令  </span><br><span class="line">如图所示等待选择阶段，这个时候不要打y 或者 n，让命令行停留于此:  </span><br><span class="line">![upload successful](/images/pasted-9.png)    </span><br><span class="line">在命令行停留之际，修改C:\ProgramData\chocolatey\lib\bazel\tools目录下的params.txt文件内容，将网络版本指定地址修改为本地地址  </span><br><span class="line">修改之前的：  </span><br><span class="line">``` </span><br><span class="line">https://github.com/bazelbuild/bazel/releases/download/0.12.0/bazel-0.12.0-windows-x86_64.zip</span><br><span class="line"></span><br><span class="line">// 此处是文件哈希，禁止修改，原来系统给予是怎样的就是怎样的。</span><br><span class="line">86f84e2c870ed14e4d2e599c309614298b9e08a049657e860d218d56873111bc</span><br></pre></td></tr></table></figure>

<p>修改之后的： 【由于我这里直接下载到桌面上，所以指向桌面地址，如果下载到其他位置，请将绝对地址替换，请勿复制粘贴此段】    </p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">C:</span><span class="hljs-regexp">/Users/</span>ke_li<span class="hljs-regexp">/Desktop/</span>bazel<span class="hljs-number">-0.12</span><span class="hljs-number">.0</span>-windows-x86_64.zip</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 此处是文件哈希，禁止修改，仅修改了上面文件目录，下面未修改，注意保留哈希的意思</span></span><br><span class="line"><span class="hljs-number">86</span>f84e2c870ed14e4d2e599c309614298b9e08a049657e860d218d56873111bc</span><br></pre></td></tr></table></figure>

<p>接下来输入y，回车进行下一阶段，等待一段时间后，结果：</p>
<p><img src="/images/pasted-10.png" alt="upload successful"></p>
<p>可调试bazel，在命令行输入bazel 检查安装是否成功，如图所示即为成功安装</p>
<p><img src="/images/pasted-11.png" alt="upload successful"></p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-18T00:00:00.000Z">2019-07-18</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    30 分钟 read (About 4560 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/18/RestTemplate/">RestTemplate</a>
            
        </h1>
        <div class="content">
            <p>SpringBoot26 RestTemplate、WebClient<br>Springboot — 用更优雅的方式发HTTP请求(RestTemplate详解)<br>RestTemplate是Spring提供的用于访问Rest服务的客户端，RestTemplate提供了多种便捷访问远程Http服务的方法,能够大大提高客户端的编写效率。</p>
<p>我之前的HTTP开发是用apache的HttpClient开发，代码复杂，还得操心资源回收等。代码很复杂，冗余代码多，稍微截个图，这是我封装好的一个post请求工具：</p>
<p>本教程将带领大家实现Spring生态内RestTemplate的Get请求和Post请求还有exchange指定请求类型的实践和RestTemplate核心方法源码的分析，看完你就会用优雅的方式来发HTTP请求。</p>
<p>1.简述RestTemplate</p>
<p>是Spring用于同步client端的核心类，简化了与http服务的通信，并满足RestFul原则，程序代码可以给它提供URL，并提取结果。默认情况下，RestTemplate默认依赖jdk的HTTP连接工具。当然你也可以 通过setRequestFactory属性切换到不同的HTTP源，比如Apache HttpComponents、Netty和OkHttp。</p>
<p>RestTemplate能大幅简化了提交表单数据的难度，并且附带了自动转换JSON数据的功能，但只有理解了HttpEntity的组成结构（header与body），且理解了与uriVariables之间的差异，才能真正掌握其用法。这一点在Post请求更加突出，下面会介绍到。</p>
<p>该类的入口主要是根据HTTP的六个方法制定：</p>
<p>此外，exchange和excute可以通用上述方法。</p>
<p>在内部，RestTemplate默认使用HttpMessageConverter实例将HTTP消息转换成POJO或者从POJO转换成HTTP消息。默认情况下会注册主mime类型的转换器，但也可以通过setMessageConverters注册其他的转换器。</p>
<p>其实这点在使用的时候是察觉不到的，很多方法有一个responseType 参数，它让你传入一个响应体所映射成的对象，然后底层用HttpMessageConverter将其做映射</p>
<figure class="highlight lisp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HttpMessageConverterExtractor&lt;T&gt; responseExtractor =</span><br><span class="line">                new HttpMessageConverterExtractor&lt;&gt;(<span class="hljs-name">responseType</span>, getMessageConverters(), logger)<span class="hljs-comment">;</span></span><br></pre></td></tr></table></figure>

<p>HttpMessageConverter.java源码：</p>
<figure class="highlight gradle hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> HttpMessageConverter&lt;T&gt; &#123;</span><br><span class="line">        <span class="hljs-comment">//指示此转换器是否可以读取给定的类。</span></span><br><span class="line">    <span class="hljs-keyword">boolean</span> canRead(<span class="hljs-keyword">Class</span>&lt;?&gt; clazz, @Nullable MediaType mediaType);</span><br><span class="line"> </span><br><span class="line">        <span class="hljs-comment">//指示此转换器是否可以写给定的类。</span></span><br><span class="line">    <span class="hljs-keyword">boolean</span> canWrite(<span class="hljs-keyword">Class</span>&lt;?&gt; clazz, @Nullable MediaType mediaType);</span><br><span class="line"> </span><br><span class="line">        <span class="hljs-comment">//返回List&lt;MediaType&gt;</span></span><br><span class="line">    List&lt;MediaType&gt; getSupportedMediaTypes();</span><br><span class="line"> </span><br><span class="line">        <span class="hljs-comment">//读取一个inputMessage</span></span><br><span class="line">    T <span class="hljs-keyword">read</span>(<span class="hljs-keyword">Class</span>&lt;? <span class="hljs-keyword">extends</span> T&gt; clazz, HttpInputMessage inputMessage)</span><br><span class="line">            <span class="hljs-keyword">throws</span> IOException, HttpMessageNotReadableException;</span><br><span class="line"> </span><br><span class="line">        <span class="hljs-comment">//往output message写一个Object</span></span><br><span class="line">    <span class="hljs-keyword">void</span> <span class="hljs-keyword">write</span>(T t, @Nullable MediaType contentType, HttpOutputMessage outputMessage)</span><br><span class="line">            <span class="hljs-keyword">throws</span> IOException, HttpMessageNotWritableException;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在内部，RestTemplate默认使用SimpleClientHttpRequestFactory和DefaultResponseErrorHandler来分别处理HTTP的创建和错误，但也可以通过setRequestFactory和setErrorHandler来覆盖。</p>
<p>2.get请求实践</p>
<p>2.1.getForObject()方法</p>
<figure class="highlight vbscript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> &lt;T&gt; T getForObject(<span class="hljs-built_in">String</span> url, <span class="hljs-keyword">Class</span>&lt;T&gt; responseType, Object... uriVariables)&#123;&#125;</span><br><span class="line"><span class="hljs-keyword">public</span> &lt;T&gt; T getForObject(<span class="hljs-built_in">String</span> url, <span class="hljs-keyword">Class</span>&lt;T&gt; responseType, Map&lt;<span class="hljs-built_in">String</span>, ?&gt; uriVariables)</span><br><span class="line"><span class="hljs-keyword">public</span> &lt;T&gt; T getForObject(URI url, <span class="hljs-keyword">Class</span>&lt;T&gt; responseType)</span><br><span class="line">``` </span><br><span class="line">getForObject()其实比getForEntity()多包含了将HTTP转成POJO的功能，但是getForObject没有处理<span class="hljs-built_in">response</span>的能力。因为它拿到手的就是成型的pojo。省略了很多<span class="hljs-built_in">response</span>的信息。</span><br><span class="line"></span><br><span class="line"><span class="hljs-number">2.1</span><span class="hljs-number">.1</span> POJO:</span><br></pre></td></tr></table></figure>

<p>public class Notice {<br>    private int status;<br>    private Object msg;<br>    private List<databean> data;<br>}
public  class DataBean {<br>  private int noticeId;<br>  private String noticeTitle;<br>  private Object noticeImg;<br>  private long noticeCreateTime;<br>  private long noticeUpdateTime;<br>  private String noticeContent;<br>}</databean></p>
<figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">示例：2<span class="hljs-selector-class">.1</span><span class="hljs-selector-class">.2</span> 不带参的<span class="hljs-selector-tag">get</span>请求</span><br></pre></td></tr></table></figure>

<p>/**
     * 不带参的get请求<br>     */<br>    @Test<br>    public void restTemplateGetTest(){<br>        RestTemplate restTemplate = new RestTemplate();<br>        Notice notice = restTemplate.getForObject(“<a href="http://xxx.top/notice/list/1/5&quot;" target="_blank" rel="noopener">http://xxx.top/notice/list/1/5&quot;</a><br>                , Notice.class);<br>        System.out.println(notice);<br>    }
　　</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">控制台打印：</span><br></pre></td></tr></table></figure>

<dl><dt>INFO 19076 — [           main] c.w.s.c.w.c.HelloControllerTest</dt><dd>Started HelloControllerTest in 5.532 seconds (JVM running for 7.233)</dd></dl><p>Notice{status=200, msg=null, data=[DataBean{noticeId=21, noticeTitle=’aaa’, noticeImg=null,<br>noticeCreateTime=1525292723000, noticeUpdateTime=1525292723000, noticeContent=’</p><p>aaa</p>‘},<br>DataBean{noticeId=20, noticeTitle=’ahaha’, noticeImg=null, noticeCreateTime=1525291492000,<br>noticeUpdateTime=1525291492000, noticeContent=’<p>ah…….’</p>
<p>　</p>
<figure class="highlight lsl hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">示例：<span class="hljs-number">2.1</span><span class="hljs-number">.3</span> 带参数的get请求<span class="hljs-number">1</span></span><br></pre></td></tr></table></figure>

<p>Notice notice = restTemplate.getForObject(“<a href="http://fantj.top/notice/list/{1}/{2}&quot;" target="_blank" rel="noopener">http://fantj.top/notice/list/{1}/{2}&quot;</a><br>                , Notice.class,1,5);</p>
<figure class="highlight lsl hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">明眼人一眼能看出是用了占位符&#123;<span class="hljs-number">1</span>&#125;。</span><br><span class="line"></span><br><span class="line">示例：<span class="hljs-number">2.1</span><span class="hljs-number">.4</span> 带参数的get请求<span class="hljs-number">2</span></span><br></pre></td></tr></table></figure>

<p>Map&lt;String,String&gt; map = new HashMap();<br>        map.put(“start”,”1”);<br>        map.put(“page”,”5”);<br>        Notice notice = restTemplate.getForObject(“<a href="http://fantj.top/notice/list/&quot;" target="_blank" rel="noopener">http://fantj.top/notice/list/&quot;</a><br>                , Notice.class,map);
　　</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">明眼人一看就是利用<span class="hljs-built_in">map</span>装载参数，不过它默认解析的是PathVariable的url形式。</span><br><span class="line"></span><br><span class="line"><span class="hljs-number">2.2</span> getForEntity()方法</span><br></pre></td></tr></table></figure>

<p>public <t> ResponseEntity<t> getForEntity(String url, Class<t> responseType, Object… uriVariables){}<br>public <t> ResponseEntity<t> getForEntity(String url, Class<t> responseType, Map&lt;String, ?&gt; uriVariables){}<br>public <t> ResponseEntity<t> getForEntity(URI url, Class<t> responseType){}<br> <figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">与getForObject()方法不同的是返回的是ResponseEntity对象，如果需要转换成pojo，还需要json工具类的引入，这个按个人喜好用。不会解析json的可以百度FastJson或者Jackson等工具类。然后我们就研究一下ResponseEntity下面有啥方法。</span><br><span class="line"></span><br><span class="line">ResponseEntity、HttpStatus、BodyBuilder结构</span><br><span class="line"></span><br><span class="line">ResponseEntity.java</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> HttpStatus <span class="hljs-title">getStatusCode</span><span class="hljs-params">()</span></span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getStatusCodeValue</span><span class="hljs-params">()</span></span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(@Nullable Object other)</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> BodyBuilder <span class="hljs-title">status</span><span class="hljs-params">(HttpStatus status)</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> BodyBuilder <span class="hljs-title">ok</span><span class="hljs-params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">ResponseEntity&lt;T&gt; <span class="hljs-title">ok</span><span class="hljs-params">(T body)</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> BodyBuilder <span class="hljs-title">created</span><span class="hljs-params">(URI location)</span> </span>&#123;&#125;</span><br><span class="line">...</span><br><span class="line">　　</span><br><span class="line"></span><br><span class="line">HttpStatus.java</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> HttpStatus &#123;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">is1xxInformational</span><span class="hljs-params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">is2xxSuccessful</span><span class="hljs-params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">is3xxRedirection</span><span class="hljs-params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">is4xxClientError</span><span class="hljs-params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">is5xxServerError</span><span class="hljs-params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isError</span><span class="hljs-params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">　　</span><br><span class="line"></span><br><span class="line">BodyBuilder.java</span><br></pre></td></tr></table></figure></t></t></t></t></t></t></t></t></t></p>
<p>public interface BodyBuilder extends HeadersBuilder<bodybuilder> {<br>    //设置正文的长度，以字节为单位，由Content-Length标头<br>      BodyBuilder contentLength(long contentLength);<br>    //设置body的MediaType 类型<br>      BodyBuilder contentType(MediaType contentType);<br>    //设置响应实体的主体并返回它。<br>      <t> ResponseEntity<t> body(@Nullable T body);<br>｝
 <figure class="highlight armasm hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">可以看出来，ResponseEntity包含了HttpStatus和<span class="hljs-keyword">BodyBuilder的这些信息，这更方便我们处理response原生的东西。</span></span><br><span class="line"><span class="hljs-keyword"></span></span><br><span class="line"><span class="hljs-keyword">示例：</span></span><br></pre></td></tr></table></figure></t></t></bodybuilder></p>
<p>@Test<br>public void rtGetEntity(){<br>        RestTemplate restTemplate = new RestTemplate();<br>        ResponseEntity<notice> entity = restTemplate.getForEntity(“<a href="http://fantj.top/notice/list/1/5&quot;" target="_blank" rel="noopener">http://fantj.top/notice/list/1/5&quot;</a><br>                , Notice.class);</notice></p>
<pre><code>    HttpStatus statusCode = entity.getStatusCode();
    System.out.println(&quot;statusCode.is2xxSuccessful()&quot;+statusCode.is2xxSuccessful());

    Notice body = entity.getBody();
    System.out.println(&quot;entity.getBody()&quot;+body);


    ResponseEntity.BodyBuilder status = ResponseEntity.status(statusCode);
    status.contentLength(100);
    status.body(&quot;我在这里添加一句话&quot;);
    ResponseEntity&lt;Class&lt;Notice&gt;&gt; body1 = status.body(Notice.class);
    Class&lt;Notice&gt; body2 = body1.getBody();
    System.out.println(&quot;body1.toString()&quot;+body1.toString());
}</code></pre> <figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">statusCode.is2xxSuccessful()<span class="hljs-literal">true</span></span><br><span class="line">entity.getBody()Notice&#123;<span class="hljs-attribute">status</span>=200, <span class="hljs-attribute">msg</span>=<span class="hljs-literal">null</span>, data=[DataBean&#123;<span class="hljs-attribute">noticeId</span>=21, <span class="hljs-attribute">noticeTitle</span>=<span class="hljs-string">'aaa'</span>, <span class="hljs-built_in">..</span>.</span><br><span class="line">body1.toString()&lt;200 OK,class com.waylau.spring.cloud.weather.pojo.Notice,&#123;Content-Length=[100]&#125;&gt;</span><br><span class="line"></span><br><span class="line">　</span><br><span class="line"></span><br><span class="line">当然，还有getHeaders()等方法没有举例。</span><br><span class="line"></span><br><span class="line">3. post请求实践</span><br><span class="line"></span><br><span class="line">同样的,post请求也有postForObject和postForEntity。</span><br></pre></td></tr></table></figure>

<p>public <t> T postForObject(String url, @Nullable Object request, Class<t> responseType, Object… uriVariables)<br>            throws RestClientException {}<br>public <t> T postForObject(String url, @Nullable Object request, Class<t> responseType, Map&lt;String, ?&gt; uriVariables)<br>            throws RestClientException {}<br>public <t> T postForObject(URI url, @Nullable Object request, Class<t> responseType) throws RestClientException {}</t></t></t></t></t></t></p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">示例</span><br><span class="line"></span><br><span class="line">我用一个验证邮箱的接口来测试。</span><br></pre></td></tr></table></figure>

<p>@Test<br>public void rtPostObject(){<br>    RestTemplate restTemplate = new RestTemplate();<br>    String url = “<a href="http://47.xxx.xxx.96/register/checkEmail&quot;" target="_blank" rel="noopener">http://47.xxx.xxx.96/register/checkEmail&quot;</a>;
    HttpHeaders headers = new HttpHeaders();<br>    headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);<br>    MultiValueMap&lt;String, String&gt; map= new LinkedMultiValueMap&lt;&gt;();<br>    map.add(“email”, “<a href="mailto:844072586@qq.com" target="_blank" rel="noopener">844072586@qq.com</a>“);</p>
<pre><code>HttpEntity&lt;MultiValueMap&lt;String, String&gt;&gt; request = new HttpEntity&lt;&gt;(map, headers);
ResponseEntity&lt;String&gt; response = restTemplate.postForEntity( url, request , String.class );
System.out.println(response.getBody());</code></pre><p>}
　</p>
<figure class="highlight dart hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">执行结果：</span><br><span class="line"></span><br><span class="line">&#123;<span class="hljs-string">"status"</span>:<span class="hljs-number">500</span>,<span class="hljs-string">"msg"</span>:<span class="hljs-string">"该邮箱已被注册"</span>,<span class="hljs-string">"data"</span>:<span class="hljs-keyword">null</span>&#125;</span><br><span class="line">Springboot -- 用更优雅的方式发HTTP请求(RestTemplate详解)</span><br><span class="line"></span><br><span class="line">代码中，MultiValueMap是<span class="hljs-built_in">Map</span>的一个子类，它的一个key可以存储多个value，简单的看下这个接口：</span><br><span class="line"></span><br><span class="line">public <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MultiValueMap</span>&lt;<span class="hljs-title">K</span>, <span class="hljs-title">V</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">Map</span>&lt;<span class="hljs-title">K</span>, <span class="hljs-title">List</span>&lt;<span class="hljs-title">V</span>&gt;&gt; </span>&#123;...&#125;</span><br><span class="line"> </span><br><span class="line">为什么用MultiValueMap?因为HttpEntity接受的request类型是它。</span><br><span class="line"></span><br><span class="line">public HttpEntity(<span class="hljs-meta">@Nullable</span> T body, <span class="hljs-meta">@Nullable</span> MultiValueMap&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt; headers)&#123;&#125;</span><br><span class="line"><span class="hljs-comment">//我这里只展示它的一个construct,从它可以看到我们传入的map是请求体，headers是请求头。</span></span><br><span class="line">　　</span><br><span class="line"></span><br><span class="line">为什么用HttpEntity是因为restTemplate.postForEntity方法虽然表面上接收的request是<span class="hljs-meta">@Nullable</span> <span class="hljs-built_in">Object</span> request类型，但是你追踪下去会发现，这个request是用HttpEntity来解析。核心代码如下：</span><br></pre></td></tr></table></figure>

<p>if (requestBody instanceof HttpEntity) {<br>    this.requestEntity = (HttpEntity&lt;?&gt;) requestBody;<br>}else if (requestBody != null) {<br>    this.requestEntity = new HttpEntity&lt;&gt;(requestBody);<br>}else {<br>    this.requestEntity = HttpEntity.EMPTY;<br>}
　</p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">我曾尝试用<span class="hljs-selector-tag">map</span>来传递参数，编译不会报错，但是执行不了，是无效的<span class="hljs-selector-tag">url</span> <span class="hljs-selector-tag">request</span>请求(<span class="hljs-number">400</span> ERROR)。其实这样的请求方式已经满足<span class="hljs-selector-tag">post</span>请求了，<span class="hljs-selector-tag">cookie</span>也是属于<span class="hljs-selector-tag">header</span>的一部分。可以按需求设置请求头和请求体。其它方法与之类似。</span><br><span class="line"></span><br><span class="line"><span class="hljs-selector-tag">4</span>.使用<span class="hljs-selector-tag">exchange</span>指定调用方式</span><br><span class="line"></span><br><span class="line"><span class="hljs-selector-tag">exchange</span>()方法跟上面的<span class="hljs-selector-tag">getForObject</span>()、<span class="hljs-selector-tag">getForEntity</span>()、<span class="hljs-selector-tag">postForObject</span>()、<span class="hljs-selector-tag">postForEntity</span>()等方法不同之处在于它可以指定请求的<span class="hljs-selector-tag">HTTP</span>类型。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">但是你会发现<span class="hljs-selector-tag">exchange</span>的方法中似乎都有@<span class="hljs-selector-tag">Nullable</span> <span class="hljs-selector-tag">HttpEntity</span> <span class="hljs-selector-tag">requestEntity</span>这个参数，这就意味着我们至少要用<span class="hljs-selector-tag">HttpEntity</span>来传递这个请求体，之前说过源码所以建议就使用<span class="hljs-selector-tag">HttpEntity</span>提高性能。</span><br><span class="line"></span><br><span class="line">示例</span><br></pre></td></tr></table></figure>

<p>@Test<br>    public void rtExchangeTest() throws JSONException {<br>        RestTemplate restTemplate = new RestTemplate();<br>        String url = “<a href="http://xxx.top/notice/list&quot;" target="_blank" rel="noopener">http://xxx.top/notice/list&quot;</a>;
        HttpHeaders headers = new HttpHeaders();<br>        headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);<br>        JSONObject jsonObj = new JSONObject();<br>        jsonObj.put(“start”,1);<br>        jsonObj.put(“page”,5);</p>
<pre><code>    HttpEntity&lt;String&gt; entity = new HttpEntity&lt;&gt;(jsonObj.toString(), headers);
    ResponseEntity&lt;JSONObject&gt; exchange = restTemplate.exchange(url,
                                      HttpMethod.GET, entity, JSONObject.class);
    System.out.println(exchange.getBody());
}</code></pre> <figure class="highlight dart hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">这次可以看到，我使用了JSONObject对象传入和返回。</span><br><span class="line">当然，HttpMethod方法还有很多，用法类似。</span><br><span class="line"></span><br><span class="line"><span class="hljs-number">5.</span>excute()指定调用方式</span><br><span class="line"></span><br><span class="line">excute()的用法与exchange()大同小异了，它同样可以指定不同的HttpMethod，不同的是它返回的对象是响应体所映射成的对象，而不是ResponseEntity。</span><br><span class="line"></span><br><span class="line">需要强调的是，execute()方法是以上所有方法的底层调用。随便看一个：</span><br><span class="line"></span><br><span class="line">```    </span><br><span class="line"><span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-meta">@Nullable</span></span><br><span class="line">    public &lt;T&gt; T postForObject(<span class="hljs-built_in">String</span> url, <span class="hljs-meta">@Nullable</span> <span class="hljs-built_in">Object</span> request, Class&lt;T&gt; responseType, <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, ?&gt; uriVariables)</span><br><span class="line">            throws RestClientException &#123;</span><br><span class="line"> </span><br><span class="line">        RequestCallback requestCallback = httpEntityCallback(request, responseType);</span><br><span class="line">        HttpMessageConverterExtractor&lt;T&gt; responseExtractor =</span><br><span class="line">                <span class="hljs-keyword">new</span> HttpMessageConverterExtractor&lt;&gt;(responseType, getMessageConverters(), logger);</span><br><span class="line">        <span class="hljs-keyword">return</span> execute(url, HttpMethod.POST, requestCallback, responseExtractor, uriVariables);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<h3 id="1-RestTemplate"><a href="#1-RestTemplate" class="headerlink" title="1 RestTemplate"></a>1 RestTemplate</h3><p>　　RestTemplate是在客户端访问 Restful 服务的一个核心类；RestTemplate通过提供回调方法和允许配置信息转换器来实现个性化定制RestTemplate的功能，通过RestTemplate可以封装请求对象，也可以对响应对象进行解析。</p>
<p><img src="/images/rst.png" alt="upload successful"><br>技巧01：RestTemplate默认使用JDK提供的包去建立HTTP连接，当然，开发者也可以使用诸如 Apache HttpComponents, Netty, and OkHttp 去建立HTTP连接。<br>　　技巧02：RestTemplate内部默认使用HttpMessageConverter来实现HTTTP messages 和 POJO 之间的转换，可以通过RestTemplate的成员方  法 setMessageConverters(java.util.List&lt;org.springframework.http.converter.HttpMessageConverter&lt;?&gt;&gt;). 去修改默认的转换器。<br>　　技巧03：RestTemplate内部默认使用SimpleClientHttpRequestFactory and DefaultResponseErrorHandler 去创建HTTP连接和处理HTTP错误，可以通过HttpAccessor.setRequestFactory(org.springframework.http.client.ClientHttpRequestFactory) and setErrorHandler(org.springframework.web.client.ResponseErrorHandler)去做相应的修改。<br>　　##### 1.1 RestTemplate中方法概览<br>　　　　RestTemplate为每种HTTP请求都实现了相关的请求封装方法<br>技巧01：这些方法的命名是有讲究的，方法名的第一部分表示HTTP请求类型，方法名的第二部分表示响应类型<br>  例如：getForObject 表示执行GET请求并将响应转化成一个Object类型的对象　</p>
<p>技巧02：利用RestTemplate封装客户端发送HTTP请求时，如果出现异常就会抛出 RestClientException 类型的异常；可以通过在创建RestTemplate对象的时候指定一个ResponseErrorHandler类型的异常处理类来处理这个异常 </p>
<p>技巧03：exchange 和 excute 这两个方法是通用的HTTP请求方法，而且这两个方法还支持额外的HTTP请求类型【PS: 前提是使用的HTTP连接包也支持这些额外的HTTP请求类型】  </p>
<p><img src="/images/htt.png" alt="upload successful"><br>　技巧04：每种方法都有3个重载方法，其中两个接收String类型的请求路径和响应类型、参数；另外一个接收URI类型的请求路径和响应类型。  </p>
<p><img src="/images/ty.png" alt="upload successful"><br>技巧05：使用String类型的请求路径时，RestTemplate会自动进行一次编码，所以为了避免重复编码问题最好使用URI类型的请求路径<br>例如：restTemplate.getForObject(“<a href="http://example.com/hotel" target="_blank" rel="noopener">http://example.com/hotel</a> list”) becomes”<a href="http://example.com/hotel%20list&quot;" target="_blank" rel="noopener">http://example.com/hotel%20list&quot;</a><br>技巧06：URI 和URL 知识点扫盲</p>
<p><img src="/images/ecd.png" alt="upload successful"><br>技巧06：利用接收URI参数的RestTemplate.getForObject方法发送Get请求</p>
<p><img src="/images/gt.png" alt="upload successful"><br>　##### 1.2 常用构造器<br>　　　　技巧01：利用无参构造器创建RestTemplate实例时，什么都是使用默认的【即：使用HttpMessageConverter来实现HTTTP messages 和 POJO 之间的转换、使用SimpleClientHttpRequestFactory and DefaultResponseErrorHandler 去创建HTTP连接和处理HTTP错误】<br>　　　　技巧02：利用 RestTemplate(ClientHttpRequestFactory requestFactory) 创建RestTemplate实例时使用自定义的requestFactory去创建HTTP连接<br>　　　　技巧03：利用 RestTemplate(java.util.List&lt;HttpMessageConverter&lt;?&gt;&gt; messageConverters)  创建RestTemplate实例时使用自定义的转换器列表实现HTTTP messages 和 POJO 之间的转换  </p>
<p><img src="/images/cnst.png" alt="upload successful"></p>
<h5 id="1-3-GET相关方法"><a href="#1-3-GET相关方法" class="headerlink" title="1.3 GET相关方法"></a>1.3 GET相关方法</h5><p>　　　　技巧01：本博文使用的是SpringBoot项目，利用了一个配置文件来将RestTemplate注入的容器中 </p>
<p> #######1.3.1 public <t> T getForObject(String url, Class<t> responseType, Object… uriVariables)<br>1》远程服务代码【不带请求参数的】</t></t></p>
<p><img src="/images/rm.png" alt="upload successful"><br>1》模拟客户端代码【不带请求参数的】</p>
<p><img src="/images/cl.png" alt="upload successful"><br>2》远程服务代码【带请求参数的】<br>　技巧01：HTTP请求中url路径？后面的参数就是请求参数格式以 key=value 的形式传递；后台需要用@RequestParam注解，如果前端的 key 和 后台方法的参数名称一致时可以不用@RequestParam注解【因为@RequestParam注解时默认的参数注解】<br>　技巧02：对于请求参数，最好在服务端利用@RequestParam注解设置该请求参数为非必传参数并设定默认值  </p>
<p><img src="/images/dc.png" alt="upload successful"><br>2》模拟客户端代码【带请求参数的】</p>
<p><img src="/images/mn.png" alt="upload successful"><br>3》远程服务代码【带路径参数的】<br>　技巧01：HTTP请求的路径可以成为路径参数，前提是服务端进行路径配置【即：需要配合@RequestMapping和@PathVariable一起使用】<br>　技巧02：由于路径参数不能设置默认是，所以在后台通过@PathVariable将路径参数设置成必传可以减少出错率<br>　技巧03：@PathVariable可以设置正则表达式【详情参见：<a href="https://www.cnblogs.com/NeverCtrl-C/p/8185576.html】" target="_blank" rel="noopener">https://www.cnblogs.com/NeverCtrl-C/p/8185576.html】</a>  </p>
<p><img src="/images/lj.png" alt="upload successful"><br>3》模拟客户端代码【带路径参数的】</p>
<p><img src="/images/lj2.png" alt="upload successful"><br>4》远程服务代码【带路径参数和请求参数的】<br>　技巧01： @PathVariable和@RequestParam都可以设定是否必传【默认必传】<br>　技巧02：@PathVariable不可以设定默认值，@RequestParam可以设定默认值【默认值就是不传入的时候代替的值】<br>　技巧03： @PathVariable如果设置必传为true，前端不传入时就会报错【技巧：开启必传】<br>　技巧04：@RequestParam如果设置必传为true，前端不传入还是也会报错【技巧：关闭必传，开启默认值】<br>　技巧05：@PathVariable可以设置正则表达式【详情参见：<a href="https://www.cnblogs.com/NeverCtrl-C/p/8185576.html】" target="_blank" rel="noopener">https://www.cnblogs.com/NeverCtrl-C/p/8185576.html】</a>  </p>
<p><img src="/images/dlhc.png" alt="upload successful"><br>4》模拟客户端代码【带路径参数和请求参数的】</p>
<p><img src="/images/lc.png" alt="upload successful">  </p>
<p>#######     1.3.2  public <t> T getForObject(String url, Class<t> responseType, Map&lt;String, ?&gt; uriVariables)<br> 　　　　　　1》远程服务代码【带请求参数的】</t></t></p>
<p><img src="/images/dqcs.png" alt="upload successful"><br>1》模拟客户端代码【带请求参数的】</p>
<p><img src="/images/kc.png" alt="upload successful"></p>
<p>#######　1.3.3 public <t> ResponseEntity<t> getForEntity(String url, Class<t> responseType, Object… uriVariables)<br>技巧01：getForObject 和 getForEntity 的区别：后者可以获取到更多的响应信息，前者这可以获取到响应体的数据<br>1》远程服务代码【不带请求参数的】</t></t></t></p>
<p><img src="/images/bdc.png" alt="upload successful"><br>　1》模拟客户端代码【不带请求参数的】</p>
<p><img src="/images/mncbd.png" alt="upload successful"><br>  2》远程服务代码【带请求参数的】</p>
<p><img src="/images/pasted-0.png" alt="filename already exists, renamed"><br>2》模拟客户端代码【带请求参数的】</p>
<p><img src="/images/pasted-1.png" alt="upload successful"><br>3》远程服务代码【带路径参数的】<br><img src="/images/pasted-2.png" alt="upload successful"><br>3》模拟客户端代码【带路径参数的】<br><img src="/images/pasted-3.png" alt="upload successful"><br>4》远程服务代码【带路径参数和请求参数的】<br><img src="/images/pasted-4.png" alt="upload successful"><br>4》模拟客户端代码【带路径参数和请求参数的】<br><img src="/images/pasted-5.png" alt="upload successful"></p>
<p>#######　　1.3.4 public <t> ResponseEntity<t> getForEntity(String url, Class<t> responseType, Map&lt;String, ?&gt; uriVariables)<br>1》远程服务代码【带请求参数的】  </t></t></t></p>
<p><img src="/images/pasted-6.png" alt="upload successful"><br> 1》模拟客户端代码【带请求参数的】</p>
<p><img src="/images/pasted-7.png" alt="upload successful"></p>
<p>#####　1.4 POST<br>服务端源代码：点击前往</p>
<p>#######　1.4.1 public <t> T postForObject(String url, @Nullable Object request, Class<t> responseType, Object… uriVariables)<br>　　　　　　参数解释：<br>　　　　　　　　url -&gt; String类型的请求路径<br>　　　　　　　　request -&gt; 请求体对象<br>　　　　　　　　responseType -&gt; 响应数据类型<br>　　　　　　　　uriVariables -&gt; 请求参数  </t></t></p>
<p>#######　　　　1.4.2 public <t> T postForObject(String url, @Nullable Object request, Class<t> responseType, Map&lt;String, ?&gt; uriVariables)<br>　　　　　　参数解释：<br>　　　　　　　　url -&gt; String类型的请求路径<br>　　　　　　　　request -&gt; 请求体对象<br>　　　　　　　　responseType -&gt; 响应数据类型<br>　　　　　　　　uriVariables -&gt; 请求参数  </t></t></p>
<p>#######　　　　1.4.3 public <t> T postForObject(URI url, @Nullable Object request, Class<t> responseType)<br>　　　　　　参数解释：<br>　　　　　　　　url -&gt; URI类型的请求路径<br>　　　　　　　　request -&gt; 请求体对象<br>　　　　　　　　responseType -&gt; 响应数据类型  </t></t></p>
<p>#######　　　　1.4.4 请求体对象说明<br>　技巧01：请求体对象（@Nullable Object request）可以直接传一个实体，服务端利用@RequestBody接收这个实体即可<br>　技巧02：请求体对象（@Nullable Object request）也可以传入一个  HttpEntity 的实例，服务端的代码不变；创建 HttpEntity 实例时可以设定请求体数据和请求头数据（详情请参见 HttpEntity 的相关构造函数）  </p>
<p><img src="/images/pasted-8.png" alt="upload successful"></p>
<h5 id="1-5-其他请求和GET、POST类似"><a href="#1-5-其他请求和GET、POST类似" class="headerlink" title="1.5 其他请求和GET、POST类似"></a>1.5 其他请求和GET、POST类似</h5><p>　　　　待更新……  </p>
<h3 id="2-WebClient"><a href="#2-WebClient" class="headerlink" title="2 WebClient"></a>2 WebClient</h3><p>　　WebClient 是一个非阻塞、响应式的HTTP客户端，它以响应式被压流的方式执行HTTP请求；WebClient默认使用 Reactor Netty 作为HTTP连接器，当然也可以通过 ClientHttpConnector修改其它的HTTP连接器。<br>　　技巧01：使用WebClient需要进入Spring5的相关依赖，如果使用的是SpringBoot项目的话直接引入下面的依赖就可以啦<br>  <figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p> WebClient源码<br>　　##### 2.1 创建WebClient实例的方式<br>　　　　技巧01：从WebClient的源码中可以看出，WebClient接口提供了三个静态方法来创建WebClient实例</p>
<p>@Bean注入</p>
<figure class="highlight haxe hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">   <span class="hljs-keyword">public</span> RestTemplate restTemplate()&#123;</span><br><span class="line">       RestTemplate restTemplate = <span class="hljs-keyword">new</span> <span class="hljs-type">RestTemplate</span>();;</span><br><span class="line">       restTemplate.setRequestFactory(<span class="hljs-keyword">new</span> <span class="hljs-type">HttpComponentsClientHttpRequestFactory</span>());</span><br><span class="line">       MappingJackson2HttpMessageConverter converter = <span class="hljs-keyword">new</span> <span class="hljs-type">MappingJackson2HttpMessageConverter</span>();</span><br><span class="line">       converter.setSupportedMediaTypes(Collections.singletonList(MediaType.ALL));</span><br><span class="line">       restTemplate.getMessageConverters().add(converter);</span><br><span class="line">       <span class="hljs-keyword">return</span> restTemplate;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<p> 使用：</p>
 <figure class="highlight processing hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> MultiValueMap&lt;<span class="hljs-keyword">String</span>, <span class="hljs-keyword">Object</span>&gt; headers = <span class="hljs-keyword">new</span> LinkedMultiValueMap&lt;<span class="hljs-keyword">String</span>, <span class="hljs-keyword">Object</span>&gt;();</span><br><span class="line">headers.<span class="hljs-built_in">add</span>(<span class="hljs-string">"Accept"</span>, <span class="hljs-string">"application/json"</span>);</span><br><span class="line">headers.<span class="hljs-built_in">add</span>(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>);</span><br><span class="line">HttpEntity request = <span class="hljs-keyword">new</span> HttpEntity(requestBody, headers);</span><br><span class="line"><span class="hljs-keyword">Object</span> sqlResult = restTemplate.postForObject(logConf.getAccessAddr() + <span class="hljs-string">"/_sql"</span>, request, <span class="hljs-keyword">Object</span>.class);</span><br></pre></td></tr></table></figure>


        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-17T21:12:00.000Z">2019-07-17</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    10 分钟 read (About 1556 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/18/registry/">registry center compare Eureka or ZooKeeper</a>
            
        </h1>
        <div class="content">
            <p>Eureka的工作原理以及它与ZooKeeper的区别<br>1、Eureka 简介：  </p>
<p>Eureka 是 Netflix 出品的用于实现服务注册和发现的工具。 Spring Cloud 集成了 Eureka，并提供了开箱即用的支持。其中， Eureka 又可细分为 Eureka Server 和 Eureka Client。  </p>
<p>1.基本原理<br>上图是来自eureka的官方架构图，这是基于集群配置的eureka；   </p>
<ul>
<li>处于不同节点的eureka通过Replicate进行数据同步   </li>
<li>Application Service为服务提供者   </li>
<li>Application Client为服务消费者   </li>
<li>Make Remote Call完成一次服务调用  </li>
</ul>
<p>服务启动后向Eureka注册，Eureka Server会将注册信息向其他Eureka Server进行同步，当服务消费者要调用服务提供者，则向服务注册中心获取服务提供者地址，然后会将服务提供者地址缓存在本地，下次再调用时，则直接从本地缓存中取，完成一次调用。  </p>
<p>当服务注册中心Eureka Server检测到服务提供者因为宕机、网络原因不可用时，则在服务注册中心将服务置为DOWN状态，并把当前服务提供者状态向订阅者发布，订阅过的服务消费者更新本地缓存。  </p>
<p>服务提供者在启动后，周期性（默认30秒）向Eureka Server发送心跳，以证明当前服务是可用状态。Eureka Server在一定的时间（默认90秒）未收到客户端的心跳，则认为服务宕机，注销该实例。  </p>
<p>2.Eureka的自我保护机制<br>在默认配置中，Eureka Server在默认90s没有得到客户端的心跳，则注销该实例，但是往往因为微服务跨进程调用，网络通信往往会面临着各种问题，比如微服务状态正常，但是因为网络分区故障时，Eureka Server注销服务实例则会让大部分微服务不可用，这很危险，因为服务明明没有问题。  </p>
<p>为了解决这个问题，Eureka 有自我保护机制，通过在Eureka Server配置如下参数，可启动保护机制  </p>
<p>eureka.server.enable-self-preservation=true<br>它的原理是，当Eureka Server节点在短时间内丢失过多的客户端时（可能发送了网络故障），那么这个节点将进入自我保护模式，不再注销任何微服务，当网络故障回复后，该节点会自动退出自我保护模式。  </p>
<p>自我保护模式的架构哲学是宁可放过一个，决不可错杀一千  </p>
<ol start="3">
<li>作为服务注册中心，Eureka比Zookeeper好在哪里<br>著名的CAP理论指出，一个分布式系统不可能同时满足C(一致性)、A(可用性)和P(分区容错性)。由于分区容错性在是分布式系统中必须要保证的，因此我们只能在A和C之间进行权衡。在此Zookeeper保证的是CP, 而Eureka则是AP。  </li>
</ol>
<p>3.1 Zookeeper保证CP<br>当向注册中心查询服务列表时，我们可以容忍注册中心返回的是几分钟以前的注册信息，但不能接受服务直接down掉不可用。也就是说，服务注册功能对可用性的要求要高于一致性。但是zk会出现这样一种情况，当master节点因为网络故障与其他节点失去联系时，剩余节点会重新进行leader选举。问题在于，选举leader的时间太长，30 ~ 120s, 且选举期间整个zk集群都是不可用的，这就导致在选举期间注册服务瘫痪。在云部署的环境下，因网络问题使得zk集群失去master节点是较大概率会发生的事，虽然服务能够最终恢复，但是漫长的选举时间导致的注册长期不可用是不能容忍的。  </p>
<p>3.2 Eureka保证AP<br>Eureka看明白了这一点，因此在设计时就优先保证可用性。Eureka各个节点都是平等的，几个节点挂掉不会影响正常节点的工作，剩余的节点依然可以提供注册和查询服务。而Eureka的客户端在向某个Eureka注册或时如果发现连接失败，则会自动切换至其它节点，只要有一台Eureka还在，就能保证注册服务可用(保证可用性)，只不过查到的信息可能不是最新的(不保证强一致性)。除此之外，Eureka还有一种自我保护机制，如果在15分钟内超过85%的节点都没有正常的心跳，那么Eureka就认为客户端与注册中心出现了网络故障，此时会出现以下几种情况：   </p>
<ol>
<li>Eureka不再从注册列表中移除因为长时间没收到心跳而应该过期的服务   </li>
<li>Eureka仍然能够接受新服务的注册和查询请求，但是不会被同步到其它节点上(即保证当前节点依然可用)   </li>
<li>当网络稳定时，当前实例新的注册信息会被同步到其它节点中  </li>
</ol>
<p>因此， Eureka可以很好的应对因网络故障导致部分节点失去联系的情况，而不会像zookeeper那样使整个注册服务瘫痪。  </p>
<ol start="4">
<li>总结<br>Eureka作为单纯的服务注册中心来说要比zookeeper更加“专业”，因为注册服务更重要的是可用性，我们可以接受短期内达不到一致性的状况。不过Eureka目前1.X版本的实现是基于servlet的Java web应用，它的极限性能肯定会受到影响。期待正在开发之中的2.X版本能够从servlet中独立出来成为单独可部署执行的服务。  </li>
</ol>

        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous">
            <a class="is-flex-grow has-text-black-ter" href="/tags/JAVAEE/page/4/">Previous</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/tags/JAVAEE/page/6/">Next</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link has-text-black-ter" href="/tags/JAVAEE/">1</a></li>
            
            <li><span class="pagination-ellipsis has-text-black-ter">&hellip;</span></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/tags/JAVAEE/page/4/">4</a></li>
            
            <li><a class="pagination-link is-current" href="/tags/JAVAEE/page/5/">5</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/tags/JAVAEE/page/6/">6</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/tags/JAVAEE/page/7/">7</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2020/05/29/@Select注解时使用in/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="文档标题">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-29T15:53:20.000Z">2020-05-29</time></div>
                    <a href="/2020/05/29/@Select注解时使用in/" class="title has-link-black-ter is-size-6 has-text-weight-normal">文档标题</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/JAVAEE/">JAVAEE</a> / <a class="has-link-grey -link" href="/categories/JAVAEE/MYBATIS/">MYBATIS</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/29/mysql共享锁和排它锁/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="mysql共享锁和排它锁">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-29T15:35:53.000Z">2020-05-29</time></div>
                    <a href="/2020/05/29/mysql共享锁和排它锁/" class="title has-link-black-ter is-size-6 has-text-weight-normal">mysql共享锁和排它锁</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/JAVAEE/">JAVAEE</a> / <a class="has-link-grey -link" href="/categories/JAVAEE/MYSQL/">MYSQL</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/29/邮箱找回密码与二次认证/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-29T14:40:15.741Z">2020-05-29</time></div>
                    <a href="/2020/05/29/邮箱找回密码与二次认证/" class="title has-link-black-ter is-size-6 has-text-weight-normal"></a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/29/可视化面板/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-29T14:40:15.601Z">2020-05-29</time></div>
                    <a href="/2020/05/29/可视化面板/" class="title has-link-black-ter is-size-6 has-text-weight-normal"></a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/29/CS应用配置/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-29T14:40:15.581Z">2020-05-29</time></div>
                    <a href="/2020/05/29/CS应用配置/" class="title has-link-black-ter is-size-6 has-text-weight-normal"></a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/avatar.png" alt="Joe">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Joe
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Learning
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Your location</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Posts
                    </p>
                    <p class="title has-text-weight-normal">
                        220
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categories
                    </p>
                    <p class="title has-text-weight-normal">
                        15
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Tags
                    </p>
                    <p class="title has-text-weight-normal">
                        100
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/ppoffice" target="_blank">
                Follow</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Github" href="https://github.com/joeithub">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Facebook" href="https://facebook.com">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Twitter" href="https://twitter.com">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Dribbble" href="https://dribbble.com">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
        
            
        
            
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categories
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/ES/">
            <span class="level-start">
                <span class="level-item">ES</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/GIT/">
            <span class="level-start">
                <span class="level-item">GIT</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/IT/">
            <span class="level-start">
                <span class="level-item">IT</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">194</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JAVAEE/">
            <span class="level-start">
                <span class="level-item">JAVAEE</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/JAVAEE/DESIGN-PATTERNS/">
            <span class="level-start">
                <span class="level-item">DESIGN PATTERNS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JAVAEE/MYBATIS/">
            <span class="level-start">
                <span class="level-item">MYBATIS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JAVAEE/MYSQL/">
            <span class="level-start">
                <span class="level-item">MYSQL</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/SPRINGBOOT/">
            <span class="level-start">
                <span class="level-item">SPRINGBOOT</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/SPRINGBOOT/SECURITY/">
            <span class="level-start">
                <span class="level-item">SECURITY</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/SYSTEM/">
            <span class="level-start">
                <span class="level-item">SYSTEM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/VIM/">
            <span class="level-start">
                <span class="level-item">VIM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/WORK/">
            <span class="level-start">
                <span class="level-item">WORK</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/office/">
            <span class="level-start">
                <span class="level-item">office</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/分类1/">
            <span class="level-start">
                <span class="level-item">分类1</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/电商/">
            <span class="level-start">
                <span class="level-item">电商</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Tag Cloud
        </h3>
        <a href="/tags/AOP/" style="font-size: 10px;">AOP</a> <a href="/tags/CI-CD/" style="font-size: 10px;">CI/CD</a> <a href="/tags/ELASTICSEARCH/" style="font-size: 10px;">ELASTICSEARCH</a> <a href="/tags/EXCEL/" style="font-size: 10px;">EXCEL</a> <a href="/tags/Eureka/" style="font-size: 10.91px;">Eureka</a> <a href="/tags/GO/" style="font-size: 10px;">GO</a> <a href="/tags/IDEA/" style="font-size: 10.91px;">IDEA</a> <a href="/tags/IT/" style="font-size: 14.55px;">IT</a> <a href="/tags/JAVAEE/" style="font-size: 20px;">JAVAEE</a> <a href="/tags/JAVASCRIPT/" style="font-size: 11.82px;">JAVASCRIPT</a> <a href="/tags/JAVASE/" style="font-size: 10.91px;">JAVASE</a> <a href="/tags/LINUX/" style="font-size: 10px;">LINUX</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/MAC/" style="font-size: 10px;">MAC</a> <a href="/tags/MQ/" style="font-size: 11.82px;">MQ</a> <a href="/tags/ONOS/" style="font-size: 15.45px;">ONOS</a> <a href="/tags/OSGI/" style="font-size: 14.55px;">OSGI</a> <a href="/tags/OSI/" style="font-size: 10px;">OSI</a> <a href="/tags/PROTOCAL/" style="font-size: 10px;">PROTOCAL</a> <a href="/tags/PYTHON/" style="font-size: 10.91px;">PYTHON</a> <a href="/tags/Quartz/" style="font-size: 10px;">Quartz</a> <a href="/tags/RPM/" style="font-size: 10px;">RPM</a> <a href="/tags/Ribbon/" style="font-size: 10px;">Ribbon</a> <a href="/tags/SECURITY/" style="font-size: 10px;">SECURITY</a> <a href="/tags/SPRING-BOOT/" style="font-size: 10px;">SPRING-BOOT</a> <a href="/tags/SQL/" style="font-size: 12.73px;">SQL</a> <a href="/tags/SQLAlert/" style="font-size: 18.18px;">SQLAlert</a> <a href="/tags/SSO/" style="font-size: 10px;">SSO</a> <a href="/tags/StringRedisTemplate/" style="font-size: 10px;">StringRedisTemplate</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/TK-MYBATIS/" style="font-size: 10px;">TK.MYBATIS</a> <a href="/tags/UDP/" style="font-size: 10px;">UDP</a> <a href="/tags/annotation/" style="font-size: 15.45px;">annotation</a> <a href="/tags/bazel/" style="font-size: 10px;">bazel</a> <a href="/tags/beanutils/" style="font-size: 10px;">beanutils</a> <a href="/tags/centos/" style="font-size: 10px;">centos</a> <a href="/tags/classloader/" style="font-size: 10px;">classloader</a> <a href="/tags/computer/" style="font-size: 10px;">computer</a> <a href="/tags/cron/" style="font-size: 10px;">cron</a> <a href="/tags/debug/" style="font-size: 10px;">debug</a> <a href="/tags/docker/" style="font-size: 12.73px;">docker</a> <a href="/tags/druid/" style="font-size: 10px;">druid</a> <a href="/tags/elasticsearch/" style="font-size: 13.64px;">elasticsearch</a> <a href="/tags/enlink/" style="font-size: 10.91px;">enlink</a> <a href="/tags/fastjson/" style="font-size: 10px;">fastjson</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/gitlab/" style="font-size: 10px;">gitlab</a> <a href="/tags/go/" style="font-size: 10px;">go</a> <a href="/tags/hexo/" style="font-size: 12.73px;">hexo</a> <a href="/tags/idea/" style="font-size: 10.91px;">idea</a> <a href="/tags/interceptor/" style="font-size: 11.82px;">interceptor</a> <a href="/tags/jetty/" style="font-size: 10px;">jetty</a> <a href="/tags/jpa/" style="font-size: 10.91px;">jpa</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/karaf/" style="font-size: 11.82px;">karaf</a> <a href="/tags/keepalived/" style="font-size: 10px;">keepalived</a> <a href="/tags/linux-shell/" style="font-size: 15.45px;">linux-shell</a> <a href="/tags/listener/" style="font-size: 10px;">listener</a> <a href="/tags/loadbalanced/" style="font-size: 10px;">loadbalanced</a> <a href="/tags/logback/" style="font-size: 10px;">logback</a> <a href="/tags/login/" style="font-size: 10.91px;">login</a> <a href="/tags/lombok/" style="font-size: 11.82px;">lombok</a> <a href="/tags/mac/" style="font-size: 15.45px;">mac</a> <a href="/tags/markdown/" style="font-size: 11.82px;">markdown</a> <a href="/tags/mybatis/" style="font-size: 17.27px;">mybatis</a> <a href="/tags/mycat/" style="font-size: 10.91px;">mycat</a> <a href="/tags/mysql/" style="font-size: 16.36px;">mysql</a> <a href="/tags/network/" style="font-size: 12.73px;">network</a> <a href="/tags/oauth2/" style="font-size: 10px;">oauth2</a> <a href="/tags/pagehelper/" style="font-size: 10px;">pagehelper</a> <a href="/tags/postman/" style="font-size: 10px;">postman</a> <a href="/tags/python/" style="font-size: 11.82px;">python</a> <a href="/tags/rabbitMq/" style="font-size: 11.82px;">rabbitMq</a> <a href="/tags/redis/" style="font-size: 11.82px;">redis</a> <a href="/tags/redisTemplate/" style="font-size: 10px;">redisTemplate</a> <a href="/tags/reflection/" style="font-size: 11.82px;">reflection</a> <a href="/tags/registry-center/" style="font-size: 10px;">registry center</a> <a href="/tags/restTemplate/" style="font-size: 10px;">restTemplate</a> <a href="/tags/ribbon/" style="font-size: 10px;">ribbon</a> <a href="/tags/serialVersionUID/" style="font-size: 10px;">serialVersionUID</a> <a href="/tags/servlet/" style="font-size: 10.91px;">servlet</a> <a href="/tags/session/" style="font-size: 10.91px;">session</a> <a href="/tags/spring/" style="font-size: 15.45px;">spring</a> <a href="/tags/spring-task/" style="font-size: 12.73px;">spring task</a> <a href="/tags/springboot/" style="font-size: 19.09px;">springboot</a> <a href="/tags/swagger/" style="font-size: 10px;">swagger</a> <a href="/tags/webClient/" style="font-size: 10px;">webClient</a> <a href="/tags/yaml/" style="font-size: 10.91px;">yaml</a> <a href="/tags/事物/" style="font-size: 10px;">事物</a> <a href="/tags/全局异常/" style="font-size: 10px;">全局异常</a> <a href="/tags/分布式/" style="font-size: 10px;">分布式</a> <a href="/tags/抖音/" style="font-size: 10px;">抖音</a> <a href="/tags/文件服务器/" style="font-size: 10.91px;">文件服务器</a> <a href="/tags/日志/" style="font-size: 10px;">日志</a> <a href="/tags/时间转化/" style="font-size: 10px;">时间转化</a> <a href="/tags/标签1/" style="font-size: 10px;">标签1</a> <a href="/tags/消息队列/" style="font-size: 10px;">消息队列</a> <a href="/tags/淘宝/" style="font-size: 10px;">淘宝</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a> <a href="/tags/高可用/" style="font-size: 10px;">高可用</a>
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">五月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">10</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">四月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">三月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">二月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">一月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">13</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">十月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">28</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">九月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">40</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">八月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">13</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">七月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">66</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">六月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">22</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Tags
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/AOP/">
                        <span class="tag">AOP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/CI-CD/">
                        <span class="tag">CI/CD</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ELASTICSEARCH/">
                        <span class="tag">ELASTICSEARCH</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/EXCEL/">
                        <span class="tag">EXCEL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Eureka/">
                        <span class="tag">Eureka</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/GO/">
                        <span class="tag">GO</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/IDEA/">
                        <span class="tag">IDEA</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/IT/">
                        <span class="tag">IT</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JAVAEE/">
                        <span class="tag">JAVAEE</span>
                        <span class="tag is-grey">130</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JAVASCRIPT/">
                        <span class="tag">JAVASCRIPT</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JAVASE/">
                        <span class="tag">JAVASE</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/LINUX/">
                        <span class="tag">LINUX</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux/">
                        <span class="tag">Linux</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MAC/">
                        <span class="tag">MAC</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MQ/">
                        <span class="tag">MQ</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ONOS/">
                        <span class="tag">ONOS</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/OSGI/">
                        <span class="tag">OSGI</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/OSI/">
                        <span class="tag">OSI</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/PROTOCAL/">
                        <span class="tag">PROTOCAL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/PYTHON/">
                        <span class="tag">PYTHON</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Quartz/">
                        <span class="tag">Quartz</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/RPM/">
                        <span class="tag">RPM</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Ribbon/">
                        <span class="tag">Ribbon</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SECURITY/">
                        <span class="tag">SECURITY</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SPRING-BOOT/">
                        <span class="tag">SPRING-BOOT</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SQL/">
                        <span class="tag">SQL</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SQLAlert/">
                        <span class="tag">SQLAlert</span>
                        <span class="tag is-grey">13</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SSO/">
                        <span class="tag">SSO</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/StringRedisTemplate/">
                        <span class="tag">StringRedisTemplate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/TCP/">
                        <span class="tag">TCP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/TK-MYBATIS/">
                        <span class="tag">TK.MYBATIS</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/UDP/">
                        <span class="tag">UDP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/annotation/">
                        <span class="tag">annotation</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/bazel/">
                        <span class="tag">bazel</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/beanutils/">
                        <span class="tag">beanutils</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/centos/">
                        <span class="tag">centos</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/classloader/">
                        <span class="tag">classloader</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/computer/">
                        <span class="tag">computer</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/cron/">
                        <span class="tag">cron</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/debug/">
                        <span class="tag">debug</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/docker/">
                        <span class="tag">docker</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/druid/">
                        <span class="tag">druid</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/elasticsearch/">
                        <span class="tag">elasticsearch</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/enlink/">
                        <span class="tag">enlink</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/fastjson/">
                        <span class="tag">fastjson</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/git/">
                        <span class="tag">git</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/gitlab/">
                        <span class="tag">gitlab</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/go/">
                        <span class="tag">go</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/hexo/">
                        <span class="tag">hexo</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/idea/">
                        <span class="tag">idea</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/interceptor/">
                        <span class="tag">interceptor</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/jetty/">
                        <span class="tag">jetty</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/jpa/">
                        <span class="tag">jpa</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/json/">
                        <span class="tag">json</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/karaf/">
                        <span class="tag">karaf</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/keepalived/">
                        <span class="tag">keepalived</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/linux-shell/">
                        <span class="tag">linux-shell</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/listener/">
                        <span class="tag">listener</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/loadbalanced/">
                        <span class="tag">loadbalanced</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/logback/">
                        <span class="tag">logback</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/login/">
                        <span class="tag">login</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/lombok/">
                        <span class="tag">lombok</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mac/">
                        <span class="tag">mac</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/markdown/">
                        <span class="tag">markdown</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mybatis/">
                        <span class="tag">mybatis</span>
                        <span class="tag is-grey">11</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mycat/">
                        <span class="tag">mycat</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mysql/">
                        <span class="tag">mysql</span>
                        <span class="tag is-grey">9</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/network/">
                        <span class="tag">network</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/oauth2/">
                        <span class="tag">oauth2</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pagehelper/">
                        <span class="tag">pagehelper</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/postman/">
                        <span class="tag">postman</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/python/">
                        <span class="tag">python</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/rabbitMq/">
                        <span class="tag">rabbitMq</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/redis/">
                        <span class="tag">redis</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/redisTemplate/">
                        <span class="tag">redisTemplate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/reflection/">
                        <span class="tag">reflection</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/registry-center/">
                        <span class="tag">registry center</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/restTemplate/">
                        <span class="tag">restTemplate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ribbon/">
                        <span class="tag">ribbon</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/serialVersionUID/">
                        <span class="tag">serialVersionUID</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/servlet/">
                        <span class="tag">servlet</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/session/">
                        <span class="tag">session</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spring/">
                        <span class="tag">spring</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spring-task/">
                        <span class="tag">spring task</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/springboot/">
                        <span class="tag">springboot</span>
                        <span class="tag is-grey">43</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/swagger/">
                        <span class="tag">swagger</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/webClient/">
                        <span class="tag">webClient</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/yaml/">
                        <span class="tag">yaml</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/事物/">
                        <span class="tag">事物</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/全局异常/">
                        <span class="tag">全局异常</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分布式/">
                        <span class="tag">分布式</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/抖音/">
                        <span class="tag">抖音</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/文件服务器/">
                        <span class="tag">文件服务器</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/日志/">
                        <span class="tag">日志</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/时间转化/">
                        <span class="tag">时间转化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/标签1/">
                        <span class="tag">标签1</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/消息队列/">
                        <span class="tag">消息队列</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/淘宝/">
                        <span class="tag">淘宝</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/设计模式/">
                        <span class="tag">设计模式</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/高可用/">
                        <span class="tag">高可用</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/avatar.png" alt="Joe">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Joe
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Learning
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Your location</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Posts
                    </p>
                    <p class="title has-text-weight-normal">
                        220
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categories
                    </p>
                    <p class="title has-text-weight-normal">
                        15
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Tags
                    </p>
                    <p class="title has-text-weight-normal">
                        100
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/ppoffice" target="_blank">
                Follow</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Github" href="https://github.com/joeithub">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Facebook" href="https://facebook.com">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Twitter" href="https://twitter.com">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Dribbble" href="https://dribbble.com">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categories
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/ES/">
            <span class="level-start">
                <span class="level-item">ES</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/GIT/">
            <span class="level-start">
                <span class="level-item">GIT</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/IT/">
            <span class="level-start">
                <span class="level-item">IT</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">194</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JAVAEE/">
            <span class="level-start">
                <span class="level-item">JAVAEE</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/JAVAEE/DESIGN-PATTERNS/">
            <span class="level-start">
                <span class="level-item">DESIGN PATTERNS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JAVAEE/MYBATIS/">
            <span class="level-start">
                <span class="level-item">MYBATIS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JAVAEE/MYSQL/">
            <span class="level-start">
                <span class="level-item">MYSQL</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/SPRINGBOOT/">
            <span class="level-start">
                <span class="level-item">SPRINGBOOT</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/SPRINGBOOT/SECURITY/">
            <span class="level-start">
                <span class="level-item">SECURITY</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/SYSTEM/">
            <span class="level-start">
                <span class="level-item">SYSTEM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/VIM/">
            <span class="level-start">
                <span class="level-item">VIM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/WORK/">
            <span class="level-start">
                <span class="level-item">WORK</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/office/">
            <span class="level-start">
                <span class="level-item">office</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/分类1/">
            <span class="level-start">
                <span class="level-item">分类1</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/电商/">
            <span class="level-start">
                <span class="level-item">电商</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Tag Cloud
        </h3>
        <a href="/tags/AOP/" style="font-size: 10px;">AOP</a> <a href="/tags/CI-CD/" style="font-size: 10px;">CI/CD</a> <a href="/tags/ELASTICSEARCH/" style="font-size: 10px;">ELASTICSEARCH</a> <a href="/tags/EXCEL/" style="font-size: 10px;">EXCEL</a> <a href="/tags/Eureka/" style="font-size: 10.91px;">Eureka</a> <a href="/tags/GO/" style="font-size: 10px;">GO</a> <a href="/tags/IDEA/" style="font-size: 10.91px;">IDEA</a> <a href="/tags/IT/" style="font-size: 14.55px;">IT</a> <a href="/tags/JAVAEE/" style="font-size: 20px;">JAVAEE</a> <a href="/tags/JAVASCRIPT/" style="font-size: 11.82px;">JAVASCRIPT</a> <a href="/tags/JAVASE/" style="font-size: 10.91px;">JAVASE</a> <a href="/tags/LINUX/" style="font-size: 10px;">LINUX</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/MAC/" style="font-size: 10px;">MAC</a> <a href="/tags/MQ/" style="font-size: 11.82px;">MQ</a> <a href="/tags/ONOS/" style="font-size: 15.45px;">ONOS</a> <a href="/tags/OSGI/" style="font-size: 14.55px;">OSGI</a> <a href="/tags/OSI/" style="font-size: 10px;">OSI</a> <a href="/tags/PROTOCAL/" style="font-size: 10px;">PROTOCAL</a> <a href="/tags/PYTHON/" style="font-size: 10.91px;">PYTHON</a> <a href="/tags/Quartz/" style="font-size: 10px;">Quartz</a> <a href="/tags/RPM/" style="font-size: 10px;">RPM</a> <a href="/tags/Ribbon/" style="font-size: 10px;">Ribbon</a> <a href="/tags/SECURITY/" style="font-size: 10px;">SECURITY</a> <a href="/tags/SPRING-BOOT/" style="font-size: 10px;">SPRING-BOOT</a> <a href="/tags/SQL/" style="font-size: 12.73px;">SQL</a> <a href="/tags/SQLAlert/" style="font-size: 18.18px;">SQLAlert</a> <a href="/tags/SSO/" style="font-size: 10px;">SSO</a> <a href="/tags/StringRedisTemplate/" style="font-size: 10px;">StringRedisTemplate</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/TK-MYBATIS/" style="font-size: 10px;">TK.MYBATIS</a> <a href="/tags/UDP/" style="font-size: 10px;">UDP</a> <a href="/tags/annotation/" style="font-size: 15.45px;">annotation</a> <a href="/tags/bazel/" style="font-size: 10px;">bazel</a> <a href="/tags/beanutils/" style="font-size: 10px;">beanutils</a> <a href="/tags/centos/" style="font-size: 10px;">centos</a> <a href="/tags/classloader/" style="font-size: 10px;">classloader</a> <a href="/tags/computer/" style="font-size: 10px;">computer</a> <a href="/tags/cron/" style="font-size: 10px;">cron</a> <a href="/tags/debug/" style="font-size: 10px;">debug</a> <a href="/tags/docker/" style="font-size: 12.73px;">docker</a> <a href="/tags/druid/" style="font-size: 10px;">druid</a> <a href="/tags/elasticsearch/" style="font-size: 13.64px;">elasticsearch</a> <a href="/tags/enlink/" style="font-size: 10.91px;">enlink</a> <a href="/tags/fastjson/" style="font-size: 10px;">fastjson</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/gitlab/" style="font-size: 10px;">gitlab</a> <a href="/tags/go/" style="font-size: 10px;">go</a> <a href="/tags/hexo/" style="font-size: 12.73px;">hexo</a> <a href="/tags/idea/" style="font-size: 10.91px;">idea</a> <a href="/tags/interceptor/" style="font-size: 11.82px;">interceptor</a> <a href="/tags/jetty/" style="font-size: 10px;">jetty</a> <a href="/tags/jpa/" style="font-size: 10.91px;">jpa</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/karaf/" style="font-size: 11.82px;">karaf</a> <a href="/tags/keepalived/" style="font-size: 10px;">keepalived</a> <a href="/tags/linux-shell/" style="font-size: 15.45px;">linux-shell</a> <a href="/tags/listener/" style="font-size: 10px;">listener</a> <a href="/tags/loadbalanced/" style="font-size: 10px;">loadbalanced</a> <a href="/tags/logback/" style="font-size: 10px;">logback</a> <a href="/tags/login/" style="font-size: 10.91px;">login</a> <a href="/tags/lombok/" style="font-size: 11.82px;">lombok</a> <a href="/tags/mac/" style="font-size: 15.45px;">mac</a> <a href="/tags/markdown/" style="font-size: 11.82px;">markdown</a> <a href="/tags/mybatis/" style="font-size: 17.27px;">mybatis</a> <a href="/tags/mycat/" style="font-size: 10.91px;">mycat</a> <a href="/tags/mysql/" style="font-size: 16.36px;">mysql</a> <a href="/tags/network/" style="font-size: 12.73px;">network</a> <a href="/tags/oauth2/" style="font-size: 10px;">oauth2</a> <a href="/tags/pagehelper/" style="font-size: 10px;">pagehelper</a> <a href="/tags/postman/" style="font-size: 10px;">postman</a> <a href="/tags/python/" style="font-size: 11.82px;">python</a> <a href="/tags/rabbitMq/" style="font-size: 11.82px;">rabbitMq</a> <a href="/tags/redis/" style="font-size: 11.82px;">redis</a> <a href="/tags/redisTemplate/" style="font-size: 10px;">redisTemplate</a> <a href="/tags/reflection/" style="font-size: 11.82px;">reflection</a> <a href="/tags/registry-center/" style="font-size: 10px;">registry center</a> <a href="/tags/restTemplate/" style="font-size: 10px;">restTemplate</a> <a href="/tags/ribbon/" style="font-size: 10px;">ribbon</a> <a href="/tags/serialVersionUID/" style="font-size: 10px;">serialVersionUID</a> <a href="/tags/servlet/" style="font-size: 10.91px;">servlet</a> <a href="/tags/session/" style="font-size: 10.91px;">session</a> <a href="/tags/spring/" style="font-size: 15.45px;">spring</a> <a href="/tags/spring-task/" style="font-size: 12.73px;">spring task</a> <a href="/tags/springboot/" style="font-size: 19.09px;">springboot</a> <a href="/tags/swagger/" style="font-size: 10px;">swagger</a> <a href="/tags/webClient/" style="font-size: 10px;">webClient</a> <a href="/tags/yaml/" style="font-size: 10.91px;">yaml</a> <a href="/tags/事物/" style="font-size: 10px;">事物</a> <a href="/tags/全局异常/" style="font-size: 10px;">全局异常</a> <a href="/tags/分布式/" style="font-size: 10px;">分布式</a> <a href="/tags/抖音/" style="font-size: 10px;">抖音</a> <a href="/tags/文件服务器/" style="font-size: 10.91px;">文件服务器</a> <a href="/tags/日志/" style="font-size: 10px;">日志</a> <a href="/tags/时间转化/" style="font-size: 10px;">时间转化</a> <a href="/tags/标签1/" style="font-size: 10px;">标签1</a> <a href="/tags/消息队列/" style="font-size: 10px;">消息队列</a> <a href="/tags/淘宝/" style="font-size: 10px;">淘宝</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a> <a href="/tags/高可用/" style="font-size: 10px;">高可用</a>
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">五月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">10</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">四月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">三月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">二月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">一月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">13</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">十月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">28</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">九月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">40</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">八月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">13</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">七月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">66</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">六月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">22</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Tags
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/AOP/">
                        <span class="tag">AOP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/CI-CD/">
                        <span class="tag">CI/CD</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ELASTICSEARCH/">
                        <span class="tag">ELASTICSEARCH</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/EXCEL/">
                        <span class="tag">EXCEL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Eureka/">
                        <span class="tag">Eureka</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/GO/">
                        <span class="tag">GO</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/IDEA/">
                        <span class="tag">IDEA</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/IT/">
                        <span class="tag">IT</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JAVAEE/">
                        <span class="tag">JAVAEE</span>
                        <span class="tag is-grey">130</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JAVASCRIPT/">
                        <span class="tag">JAVASCRIPT</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JAVASE/">
                        <span class="tag">JAVASE</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/LINUX/">
                        <span class="tag">LINUX</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux/">
                        <span class="tag">Linux</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MAC/">
                        <span class="tag">MAC</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MQ/">
                        <span class="tag">MQ</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ONOS/">
                        <span class="tag">ONOS</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/OSGI/">
                        <span class="tag">OSGI</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/OSI/">
                        <span class="tag">OSI</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/PROTOCAL/">
                        <span class="tag">PROTOCAL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/PYTHON/">
                        <span class="tag">PYTHON</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Quartz/">
                        <span class="tag">Quartz</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/RPM/">
                        <span class="tag">RPM</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Ribbon/">
                        <span class="tag">Ribbon</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SECURITY/">
                        <span class="tag">SECURITY</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SPRING-BOOT/">
                        <span class="tag">SPRING-BOOT</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SQL/">
                        <span class="tag">SQL</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SQLAlert/">
                        <span class="tag">SQLAlert</span>
                        <span class="tag is-grey">13</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SSO/">
                        <span class="tag">SSO</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/StringRedisTemplate/">
                        <span class="tag">StringRedisTemplate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/TCP/">
                        <span class="tag">TCP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/TK-MYBATIS/">
                        <span class="tag">TK.MYBATIS</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/UDP/">
                        <span class="tag">UDP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/annotation/">
                        <span class="tag">annotation</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/bazel/">
                        <span class="tag">bazel</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/beanutils/">
                        <span class="tag">beanutils</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/centos/">
                        <span class="tag">centos</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/classloader/">
                        <span class="tag">classloader</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/computer/">
                        <span class="tag">computer</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/cron/">
                        <span class="tag">cron</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/debug/">
                        <span class="tag">debug</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/docker/">
                        <span class="tag">docker</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/druid/">
                        <span class="tag">druid</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/elasticsearch/">
                        <span class="tag">elasticsearch</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/enlink/">
                        <span class="tag">enlink</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/fastjson/">
                        <span class="tag">fastjson</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/git/">
                        <span class="tag">git</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/gitlab/">
                        <span class="tag">gitlab</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/go/">
                        <span class="tag">go</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/hexo/">
                        <span class="tag">hexo</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/idea/">
                        <span class="tag">idea</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/interceptor/">
                        <span class="tag">interceptor</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/jetty/">
                        <span class="tag">jetty</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/jpa/">
                        <span class="tag">jpa</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/json/">
                        <span class="tag">json</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/karaf/">
                        <span class="tag">karaf</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/keepalived/">
                        <span class="tag">keepalived</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/linux-shell/">
                        <span class="tag">linux-shell</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/listener/">
                        <span class="tag">listener</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/loadbalanced/">
                        <span class="tag">loadbalanced</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/logback/">
                        <span class="tag">logback</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/login/">
                        <span class="tag">login</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/lombok/">
                        <span class="tag">lombok</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mac/">
                        <span class="tag">mac</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/markdown/">
                        <span class="tag">markdown</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mybatis/">
                        <span class="tag">mybatis</span>
                        <span class="tag is-grey">11</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mycat/">
                        <span class="tag">mycat</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mysql/">
                        <span class="tag">mysql</span>
                        <span class="tag is-grey">9</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/network/">
                        <span class="tag">network</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/oauth2/">
                        <span class="tag">oauth2</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pagehelper/">
                        <span class="tag">pagehelper</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/postman/">
                        <span class="tag">postman</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/python/">
                        <span class="tag">python</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/rabbitMq/">
                        <span class="tag">rabbitMq</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/redis/">
                        <span class="tag">redis</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/redisTemplate/">
                        <span class="tag">redisTemplate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/reflection/">
                        <span class="tag">reflection</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/registry-center/">
                        <span class="tag">registry center</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/restTemplate/">
                        <span class="tag">restTemplate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ribbon/">
                        <span class="tag">ribbon</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/serialVersionUID/">
                        <span class="tag">serialVersionUID</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/servlet/">
                        <span class="tag">servlet</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/session/">
                        <span class="tag">session</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spring/">
                        <span class="tag">spring</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spring-task/">
                        <span class="tag">spring task</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/springboot/">
                        <span class="tag">springboot</span>
                        <span class="tag is-grey">43</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/swagger/">
                        <span class="tag">swagger</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/webClient/">
                        <span class="tag">webClient</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/yaml/">
                        <span class="tag">yaml</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/事物/">
                        <span class="tag">事物</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/全局异常/">
                        <span class="tag">全局异常</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分布式/">
                        <span class="tag">分布式</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/抖音/">
                        <span class="tag">抖音</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/文件服务器/">
                        <span class="tag">文件服务器</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/日志/">
                        <span class="tag">日志</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/时间转化/">
                        <span class="tag">时间转化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/标签1/">
                        <span class="tag">标签1</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/消息队列/">
                        <span class="tag">消息队列</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/淘宝/">
                        <span class="tag">淘宝</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/设计模式/">
                        <span class="tag">设计模式</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/高可用/">
                        <span class="tag">高可用</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="Learning" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 Joe Tong&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh_CN");</script>

<script>
var IcarusThemeSettings = {
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>



    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>