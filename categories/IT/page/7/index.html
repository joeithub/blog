<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 3.9.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>Categoria: IT - Learning</title>


    <meta name="description" content="private learning">
<meta property="og:type" content="website">
<meta property="og:title" content="Learning">
<meta property="og:url" content="http://yoursite.com/categories/IT/page/7/index.html">
<meta property="og:site_name" content="Learning">
<meta property="og:description" content="private learning">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/images/og_image.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Learning">
<meta name="twitter:description" content="private learning">
<meta name="twitter:image" content="http://yoursite.com/images/og_image.png">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="Learning" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
                <a class="navbar-item"
                href="/">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card">
    <div class="card-content">
        <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="/categories">Categorias</a></li>
            
            <li class="is-active"><a href="#" aria-current="page">IT</a></li>
        </ul>
        </nav>
    </div>
</div>

    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-24T19:18:00.000Z">2019-07-24</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    1 小时 read (About 9747 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/25/KARAF/">KARAF</a>
            
        </h1>
        <div class="content">
            <p>Karaf：简述对Karaf的认识</p>
<p>Karaf是基于OSGI之上建立的应用容器，能方便部署各种选定的组件，简化打包和安装应用的操作难度。Open DayLight项目发布之初，后台框架仅采用OSG技术，但自从第三版氦He版本至今， Open Daylight项目就采用了Kaaf作为后台的框架，明显提升了项目的可用性和灵活性。<br>Karaf是一个 Apache软件基金会项目，具有 Apache v2许可证。是一个基于实时运行的轻量级的基于OSGI的容器，各种组件和应用都能部署到这个容器中。<br>一、Karaf 的架构图<br><img src="/images/pasted-27.png" alt="upload successful"><br>二、Karaf 的安装目录结构  </p>
<p>/bin: 启动脚本<br>/etc: 初始化文件<br>/data: 工作目录<br>/cache: OSGi框架包缓存<br>/generated-bundles: 部署使用的临时文件夹<br>/log: 日志文件<br>/deploy: 热部署目录<br>/instances: 含有子实例的目录<br>/lib: 包含引导库<br>/lib/ext:JRE扩展目录<br>/lib/endorsed: 赞同库目录<br>/system: OSGi包库，作为一个Maven2存储库  </p>
<p>三、Karaf的基本特性<br>Karaf典型的特性有:<br>热部署： Karaf支持 OSGI bundles的热部署。实现这个支持的关键在于 Karaf持续监测[home]/deply目录内的jar文件。每次当一个jar文件被复制到这个文件夹内，它将在运行时被安装。可以更新或删除它，这个改动将被自动处理。此外， Karaf也支持 exploded bundles和自定义的部署(默认包含 blueprint和 spring)<br>动态配置：服务通常通过OsGi服务的配置管理来进行配置。这样的配置可在 Karaf中的[home]/ec目录使用合适的文件进行定义。这样配置被监控，并且属性的改变将传播给服务。<br>日志系统：使用Log4J支持的集中日志后端，Kaaf能支持许多不同的APls(JDK14、JCL、SLF4J、 Avalon、 Tomcat、OSGi)。<br>供应：库或应用的供应( Provisioning)能通过不同的方式完成。供应在本地下载、安装、启动。<br>原生OS整合：Karaf能以服务的方式整合到一个操作系统OS中，这样生命周期就和这个OS相绑定。<br>扩展的内核控制台：Karaf的内核控制台可管理服务，安装新应用或库，并且管理它们的状态。这个内核能通过部署新命令以安装新功能或应用实现动态扩展。<br>远程访问：使用任何的SSH客户端以连接Karaf并且在控制台发出命令。<br>基于JAAS的安全框架。<br>管理实例：Karaf提供简单的命令以管理多实例。通过控制台能简单地创建、删除、启动、终止 Karaf的实例。<br>四、karaf在 Open Daylight使用中的一些常用命令<br>[cmd]-help：获取一个指定命令的相关帮助。<br><code>若需要了解 bundle: list命令，则输入:bundle: list --help; Karat将返回有关这个命令的帮助。</code><br>features: list：查看已安装的 features。<br><code>feature: install my_feature：安装本地 feature的命令。</code><br>如 <code>feature: install odl-reston。</code><br><code>feature:uninstall my_feature</code>:卸载已经安装的fm的命令。<br>如  
<code>feature uninstall odl-restconf</code> </p>
<p><code>feature: repo-add my repo：将库安装至本地。</code><br>如 <code>feature: repo-add camel2.152</code></p>
<p>log: display：显示系统日志，可配合grep来筛选需要查看的内容。<br>system: shutdown：关闭系统，退出 Karaf。同样也可运行halt命令退出 Karaf。<br>注意:<br>进入 Karaf的控制台后，按&lt; Tab &gt;键即可显示目前所有可用的命令。<br>控制台支持&lt; Tab &gt;键的输入辅助完成功能，当输入一个命令的前面一些字符时，按&lt; Tab &gt;键后，控制台将自动列出所有可能的命令，并且在只有一个提示命令时自动完成该命令的输入。</p>
<p>Karaf教程之安装和应用开发</p>
<p>概览</p>
<p>安装和启动</p>
<p>一些便利的命令</p>
<p>Tasklist - 一个小的OSGI应用</p>
<p>父pom和通用工程的设置</p>
<p>Tasklist-model</p>
<p>Tasklist-persistence</p>
<p>Tasklist-ui</p>
<p>Tasklist-features</p>
<p>在Karaf中安装应用</p>
<p>总结</p>
<p>概览</p>
<p>以这篇文章为起点，我将开始写一系列关于Apache Karaf的文章，Apache Karaf是一个基于Equinox或者Felix框架开发的一个OSGI容器。<br>与这些框架最大的不同在于它带来了优秀的管理功能。</p>
<p>Karaf突出的特性如下: </p>
<ul>
<li>可扩展控制台和Bash相似的命令补齐功能 </li>
<li>ssh控制台 </li>
<li>从maven仓库中获取bundles和features的部署文件 </li>
<li>可以在命令行中轻松的创建一个新的实例</li>
</ul>
<p>所有这些特性使开发服务端OSGi应用和开发一般的java应用几乎一样的简单。<br>从某个层面上，部署和管理比目前我知道所有应用服务器都好。所有这些karaf特性的结合带来了最终的程序。在我看来，Karaf允许轻量级的开发风格就像J2EE结合spring应用程序的灵活性一样。</p>
<p>安装和启动</p>
<p>从karaf官网下载Karaf4.0.7。<br>解压并运行bin/karaf。<br>一些便利的命令</p>
<table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">la</td>
<td align="left">显示所有安装的bundle</td>
</tr>
<tr>
<td align="left">list</td>
<td align="left">显示用户的bundle</td>
</tr>
<tr>
<td align="left">service:list</td>
<td align="left">显示active的OSGI服务。这个列表十分长。这里有一个方便的方法，就是你可以使用unix的管道，如 “ls</td>
</tr>
<tr>
<td align="left">exports</td>
<td align="left">显示导出的packages和bundles，这个命令可以帮助你查找出package是来自哪里</td>
</tr>
<tr>
<td align="left">feature:list</td>
<td align="left">显示所有feature包括已安装和未安装的</td>
</tr>
<tr>
<td align="left">feature:install webconsole</td>
<td align="left">访问<a href="http://localhost:8181/system/console，用karaf/karaf登录并花些时间看下它所提供的信息" target="_blank" rel="noopener">http://localhost:8181/system/console，用karaf/karaf登录并花些时间看下它所提供的信息</a></td>
</tr>
<tr>
<td align="left">diag</td>
<td align="left">显示那些无法启动的bundle的诊断信息</td>
</tr>
<tr>
<td align="left">log:tail</td>
<td align="left">显示日志。可以按ctrl-c返回控制台</td>
</tr>
<tr>
<td align="left">Ctrl-d</td>
<td align="left">退出控制台。如果是主控制台，则karaf被关闭</td>
</tr>
<tr>
<td align="left">重启后OSGI容器会保存状态</td>
<td align="left"></td>
</tr>
</tbody></table>
<p>注意Karaf和其他所有的OSGI容器一样会维护已安装和已启动的bundles的最后状态。所以如果有些组件再也不能工作，重启也不一定有所帮助。为了启动一个全新的Karaf，可以停止karaf然后删除data目录或者启动的时候加个clean参数bin/karaf clean。</p>
<p>检查日志</p>
<p>Karaf运行的时候非常安静。为了不错过错误消息，可以运行tail -f data/karaf.log让日志文件处于打开状态。</p>
<p>Tasklist - 一个小的OSGI应用</p>
<p>没有任何有用的应用，Karaf是一个很棒但是没用的容器。所以让我们来创建第一个应用吧。好消息是创建一个OSGI应用非常的简单，maven会处理很多事情。和一个正常的maven工程的差异是非常少的。我推荐使用Eclipse 4写应用程序，Eclipse 4默认已经安装m2eclipse插件。</p>
<p>从github的Karaf-Tutorial仓库中获取源码。</p>
<p><code>git clone https://github.com/cschneider/Karaf-Tutorial.git</code>  </p>
<p>或者从 <a href="https://github.com/cschneider/Karaf-Tutorial/zipball/master" target="_blank" rel="noopener">https://github.com/cschneider/Karaf-Tutorial/zipball/master</a> 下载示例工程，然后解压到某个目录下。  </p>
<p>导入到Eclipse   </p>
<ul>
<li>启动Eclipse Neon或者更新版本。   </li>
<li>在Eclipse中选择File -&gt; Import -&gt; Existing maven project -&gt; Browse到刚才解压的目录选择tasklist 子文件夹。   </li>
<li>Eclipse将显示所有它找到的maven工程。   </li>
<li>单击默认导入所有工程。  </li>
</ul>
<p>Eclipse将导入所有的工程并使用m2eclipse插件管理它们之间所有的依赖。  </p>
<p>tasklist有以下这些工程组成。  </p>
<table>
<thead>
<tr>
<th align="left">模块</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">tasklist-model</td>
<td align="left">服务接口和Task类</td>
</tr>
<tr>
<td align="left">tasklist-persistence</td>
<td align="left">提供了一个TaskService接口的简单持久化实现</td>
</tr>
<tr>
<td align="left">tasklist-ui</td>
<td align="left">使用TaskService显示任务列表的servlet</td>
</tr>
<tr>
<td align="left">tasklist-features</td>
<td align="left">为应用提供features的描述信息，使应用能够很容易的安装到Karaf容器中</td>
</tr>
<tr>
<td align="left">父pom和通用工程的设置</td>
<td align="left"></td>
</tr>
</tbody></table>
<p>pom.xml打包bundle，而maven-bundle-plugin创建具有OSGi Manifest信息的jar包。默认情况，插件导入java文件import的或者在bluneprint上下文引用的所有的包。同时导出不包含内部实现的所有包。在我们的例子中我们想要model包被导入，但是persistence的实现包不导入。按照命名约定，我们不需要额外的配置。</p>
<p>Tasklist-model</p>
<p>这个工程包含domain model，这里指Task类和TaskService接口。model同时被persistence工程和用户界面工程使用。任意TaskService服务的使用者只需要依赖model工程。所以不用直接绑定到当前的实现。</p>
<p>Tasklist-persistence</p>
<p>简单持久化实现的TaskServiceImpl类用一个简单的HashMap管理task。类用@Singleton注解标记自己为blueprint bean。注解@OsgiServiceProvider用于标记为自己是一个OSGi服务，而@Properties注解允许添加服务属性。在这个例子中我们设置的属性service.exported.interfaces可以被我们在后续的教程要介绍的CXF-DOSGI使用。目前该教程这个属性可以删除。</p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@OsgiServiceProvider</span></span><br><span class="line"><span class="hljs-variable">@Properties</span>(<span class="hljs-variable">@Property</span>(name = <span class="hljs-string">"service.exported.interfaces"</span>, value = <span class="hljs-string">"*"</span>))</span><br><span class="line"><span class="hljs-variable">@Singleton</span></span><br><span class="line">public class TaskServiceImpl implements TaskService &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>blueprint-maven-plugin插件将处理上面的类，且自动创建合适的blueprint xml文件。这样可以帮我们节省手动写blueprint xml文件的时间。</p>
<p>自动创建的blueprint xml文件位于target/generated-resources文件夹下</p>
<figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;blueprint xmlns=<span class="hljs-string">"http://www.osgi.org/xmlns/blueprint/v1.0.0"</span>&gt;</span><br><span class="line">    &lt;bean id=<span class="hljs-string">"taskService"</span> <span class="hljs-keyword">class</span>=<span class="hljs-string">"net.lr.tasklist.persistence.impl.TaskServiceImpl"</span> /&gt;</span><br><span class="line">    &lt;service <span class="hljs-keyword">ref</span>=<span class="hljs-string">"taskService"</span> <span class="hljs-keyword">interface</span>=<span class="hljs-string">"net.lr.tasklist.model.TaskService"</span> /&gt;</span><br><span class="line">&lt;/blueprint&gt;</span><br></pre></td></tr></table></figure>

<p>Tasklist-ui</p>
<p>UI工程使用一个TaskServlet显示任务列表和单独的任务。为了和tasks任务协作，这个servlet需要TaskService服务。我们通过使用注解@Inject和@OsgiService注入TaskService服务，@Inject注解能够根据类型注入任意的实例。而注解@OsgiService将创建一个指定类型的OSGiSerivce服务的blueprint引用。（译注：这里我是这么理解的，@OsgiService表示从Karaf中获取一个bean，@Inject则负责注入）<br>这个类被暴露为一个OSGi服务,该类是一个有特别属性alias=/tasklist的接口java.http.Servlet实现。这样做触发了pax web的whiteboard扩展器接收这个服务，并使用url /tasklist映射到该servlet。</p>
<p>相关代码小片段</p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@OsgiServiceProvider</span>(classes = Servlet.class)</span><br><span class="line"><span class="hljs-variable">@Properties</span>(<span class="hljs-variable">@Property</span>(name = <span class="hljs-string">"alias"</span>, value = <span class="hljs-string">"/tasklist"</span>))</span><br><span class="line"><span class="hljs-variable">@Singleton</span></span><br><span class="line">public class TaskListServlet extends HttpServlet &#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-variable">@Inject</span> <span class="hljs-variable">@OsgiService</span></span><br><span class="line">    TaskService taskService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自动创建的blueprint xml文件位于target/generated-resources文件夹下</p>
<figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">blueprint</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.osgi.org/xmlns/blueprint/v1.0.0"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">reference</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"taskService"</span> <span class="hljs-attr">availability</span>=<span class="hljs-string">"mandatory"</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"net.lr.tasklist.model.TaskService"</span> /&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"taskServlet"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"net.lr.tasklist.ui.TaskListServlet"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"taskService"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"taskService"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"taskServlet"</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"javax.servlet.http.HttpServlet"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">service-properties</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"alias"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"/tasklist"</span> /&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">service-properties</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">blueprint</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Tasklist-features</p>
<p>最后一个工程仅安装一个feature描述信息文件到一个maven仓库，这样我们可以很容易的安装应用到Karaf。描述信息定义了一个叫tasklist的feature和将从maven仓库下载安装的bundles</p>
<figure class="highlight dust hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">feature</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"example-tasklist-persistence"</span> <span class="hljs-attr">version</span>=<span class="hljs-string">"$</span></span></span><span class="hljs-template-variable">&#123;pom.version&#125;</span><span class="hljs-xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">bundle</span>&gt;</span>mvn:net.lr.tasklist/tasklist-model/$</span><span class="hljs-template-variable">&#123;pom.version&#125;</span><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">bundle</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">bundle</span>&gt;</span>mvn:net.lr.tasklist/tasklist-persistence/$</span><span class="hljs-template-variable">&#123;pom.version&#125;</span><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">bundle</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">feature</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">feature</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"example-tasklist-ui"</span> <span class="hljs-attr">version</span>=<span class="hljs-string">"$</span></span></span><span class="hljs-template-variable">&#123;pom.version&#125;</span><span class="hljs-xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">feature</span>&gt;</span>http<span class="hljs-tag">&lt;/<span class="hljs-name">feature</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">feature</span>&gt;</span>http-whiteboard<span class="hljs-tag">&lt;/<span class="hljs-name">feature</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">bundle</span>&gt;</span>mvn:net.lr.tasklist/tasklist-model/$</span><span class="hljs-template-variable">&#123;pom.version&#125;</span><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">bundle</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">bundle</span>&gt;</span>mvn:net.lr.tasklist/tasklist-ui/$</span><span class="hljs-template-variable">&#123;pom.version&#125;</span><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">bundle</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">feature</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>一个feature可以由其他features和bundles组成，这些features和bundles也应该被安装。一般bundles使用mvn urls。这也意味着它们从配置好的仓库或者你的本地maven仓库~/.m2/repository中加载。</p>
<p>在Karaf中安装应用</p>
<figure class="highlight maxima hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">feature</span>:repo-add mvn:net.lr.tasklist/tasklist-<span class="hljs-built_in">features</span>/<span class="hljs-number">1.0</span>.0-SNAPSHOT/xml</span><br><span class="line"><span class="hljs-built_in">feature</span>:install <span class="hljs-built_in">example</span>-tasklist-persistence <span class="hljs-built_in">example</span>-tasklist-ui</span><br></pre></td></tr></table></figure>

<p>添加features描述信息文件到Karaf，所以它被添加到可用的features列表中，然后安装和启动tasklist feature。运行命令之后tasklist应用应该运行了。</p>
<p>list</p>
<p>检查tasklist的所有bundles是在active状态。如果没有，尝试启动它们和检查日志。</p>
<p>http:list</p>
<figure class="highlight asciidoc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ID | Servlet         | Servlet-Name   | State       | Alias     | Url</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">56 | TaskListServlet | ServletModel-2 | Deployed    | /tasklist | [/tasklist/<span class="hljs-strong">*]</span></span><br></pre></td></tr></table></figure>

<p>应该显示TaskListServlet。默认情况下这个例子应该运行在<a href="http://localhost:8181/tasklist。" target="_blank" rel="noopener">http://localhost:8181/tasklist。</a></p>
<p>你可以通过创建一个文本文件”etc/org.ops4j.pax.web.cfg”改变端口。文本内容为”org.osgi.service.http.port=8080”。这个方式将告诉HttpService使用这个端口8080. 现在tasklist应用应该运行在<a href="http://localhost:8080/tasklist地址。" target="_blank" rel="noopener">http://localhost:8080/tasklist地址。</a></p>
<p>总结</p>
<p>在该教程中我们已经安装了Karaf和学习了一些命令。然后我们创建了一个小的OSGi应用，这个应用涉及到servlets，OSGi服务，blueprint和whiteboard模式。下一个教程我们看下在OSGi中Apache Camel和Apache CXF的使用。</p>
<p>Apache Karaf用户指导  </p>
<p>一 安装karaf  </p>
<p>本章讲述如何在windows和unix平台安装Apache Karaf，这里你将知道预先要安装什么软件，如何下载并且安装Karaf。  </p>
<p>预安装需求<br>硬件：  </p>
<ul>
<li>20M磁盘剩余空间。<br>操作系统：<br>Windows：Windows vista，Windows XP sp2，windows2000。- Unix：Ubuntu Linux，Powerdog Linux,MacOS，AIX,HP-UX,Solaris，任何支持java的unix平台。<br>环境：<br>Java SE 1.5x或者更高。- 环境变量JAVAHOME必须设置为java运行时的安装目录，比如C:\Program Files\Java\jdk1.6.026。按住windows和break键切换到高级选项，点击环境变量，把上面的路径加入到变量中。<br>从源码构建<br>如果你想从源码构建KARAF，需求会有点不同：  </li>
</ul>
<p>硬件：  </p>
<ul>
<li>200M磁盘空间便于apache karaf源码展开或者是SVN的验证，以及maven构建和依赖maven组件的下载。<br>环境：<br>JDK 1.5或者是更高。- Apache maven 2.2.1.<br>在windows上构建<br>这过程说明如何下载和安装windows上的源码文件。注：Karaf需要java5编译，构建和运行。  </li>
</ul>
<p>在浏览器输入<a href="http://karaf.apache.org/index/community/download.html" target="_blank" rel="noopener">http://karaf.apache.org/index/community/download.html</a>.  
滚动到“Apache Karaf”区域选择需要的链接。源码文件名称类似于：apache-karaf-x.y-src.zip.<br>解压缩zip文件到你选择的目录中，请记住非法java路径的限制，比如！，%等。<br>用maven 2.2.1 或者更高的java5来构建karaf。 构建karaf的方法如下：<br>Cd [karaf安装路径]\src- Mvn<br>这两个步骤均需要10到15分钟。<br>用zip工具加压文件，windows的路径是 [karaf安装路径]\assembly\target\apache-karaf-x.y.zip<br>转到开始karaf一节<br>在Unix上构建<br>本过程将讲述如何在unix系统上下载和安装源码文件。这里假定unix机器上有浏览器，没有浏览器的请参照前面二进制unix安装区域。注：Karaf需要java5编译，构建和运行。  </p>
<p>在浏览器输入<a href="http://karaf.apache.org/" target="_blank" rel="noopener">http://karaf.apache.org/</a> download.html.<br>滚动到“Apache Karaf”区域选择需要的链接。源码文件名称类似于：apache-karaf-x.y-src.zip.<br>解压缩zip文件到你选择的目录中，例如：gunzip apache-karaf-x.y-src.tar.gz tar xvf apache-karaf-x.y-src.tar请记住非法java路径的限制，比如！，%等<br>用maven构建karaf建议方法如下: cd [karaf安装路径]\src cvn 5.解压缩刚刚创建的文件 cd [karaf安装路径]/assembly/target gunzip apache-karaf-x.y.tar.gz tar xvf apache-karaf-x.y.tar<br>转到开始karaf一节<br>Windows安装过程<br>这里说明如何在windows系统上下载和安装二进制文件。  </p>
<p>在浏览器输入 <a href="http://karaf.apache.org/index/community/download.html" target="_blank" rel="noopener">http://karaf.apache.org/index/community/download.html</a>.  
滚动到“Apache Karaf”区域选择需要的链接。源码文件名称类似于：apache-karaf-x.y-src.zip.<br>解压缩zip文件到你选择的目录中，请记住非法java路径的限制，比如！，%等。<br>转到开始karaf一节<br>可选：在Windows中启用彩色控制台输出  </p>
<ul>
<li>提示：如果你安装karaf到很深的路径或者是非法的java路径，！，%等，你可以创建一个bat文件来执行：subst S: “C:\your very % problematic path!\KARAF” 这样karaf的路径是 s: 这样的短类型。<br>Unix安装过程<br>这里属于如何在unix系统上下载和安装二进制文件。  </li>
</ul>
<p>在浏览器输入<a href="http://karaf.apache.org/" target="_blank" rel="noopener">http://karaf.apache.org/</a> download.html.<br>滚动到“Apache Karaf”区域选择需要的链接。源码文件名称类似于：apache-karaf-x.y.tar.gz<br>解压缩zip文件到你选择的目录中，例如：gunzip apache-karaf-x.y.tar.gz tar xvf apache-karaf-x.y.tar 请记住非法java路径的限制，比如！，%等。<br>转到开始karaf一节<br>安装后的步骤<br>在开始使用karaf之前强烈建议设置指向JDK的JAVA_HOME用来定位java可执行文件，并且应该配置为指向已安装java se5或者6的根目录。  </p>
<p>二 目录结构  </p>
<p>Karaf安装目录结构如下：  </p>
<p>/bin: 启动脚本<br>/etc: 初始化文件<br>/data: 工作目录<br>/cache: OSGi框架包缓存<br>/generated-bundles: 部署使用的临时文件夹<br>/log: 日志文件<br>/deploy: 热部署目录<br>/instances: 含有子实例的目录<br>/lib: 包含引导库<br>/lib/ext:JRE扩展目录<br>/lib/endorsed: 赞同库目录<br>/system: OSGi包库，作为一个Maven2存储库<br>Data文件夹包括karaf所有的工作和临时文件，如果你想从一个初始状态重启，你可以清空这个目录，这和“恢复初始化设置”一样的效果。  </p>
<p>三 启动和停止karaf  </p>
<p>本章介绍如何启动和停止Apache Karaf和各种可用的选项。  </p>
<p>启动karaf<br>Windows下：打开一个控制台窗口，更改到安装目录，并运行Karaf。对于二进制文件，运行 Cd [karaf安装目录] 然后输入：bin\karaf.bat  </p>
<p>Linux下：打开一个控制台窗口，更改到安装目录，并运行Karaf。运行 Cd [karaf安装目录] 然后输入：bin\karaf 警告：karaf运行后不要关闭控制台，否则会终止karaf（除非用非控制台启动karaf）。  </p>
<p>非控制台启动karaf<br>没有控制台也可以启动karaf，它总可以是用远程SSH访问，是用下面的命令： bin\karaf.bat server 或者是unix下：bin/karaf server  </p>
<p>在后台启动karaf<br>采用以下命令可以轻易地在后台进程启动karaf：   Bin\start.bat 或者在unix下：bin/start  </p>
<p>重置模式启动karaf<br>清空[karaf安装目录]\data文件夹就可以简单的在重置模式启动karaf，为方便起见，在karaf启动脚本使用以下参数也可以实现重置启动： bin/start clean  </p>
<p>停止karaf<br>无论是windows还是unix，你都可以在karaf控制台采用以下命令来停止它： <code>osgi:shutdown</code>, 或者简单的是：<code>shutdown</code>。    </p>
<p>Shutdown命令会询问你是否真的想要停止，如果你确认停止并且拒绝确认信息，你可以用-f或者-force选项： osgi：shutdown –f， 也可以用时间参数来延迟停止，时间参数有不同的形式。  </p>
<p>首先，可以是绝对时间各式hh：mm。第二，也可以是+m，其中m是等待的分。现在就是+0。  </p>
<p>下面的命令可以在10:35am关闭karaf:  </p>
<p>osgi:shutdown 10:35。  </p>
<p>下面的命令在10分钟后关闭karaf：  </p>
<p>osgi:shutdown +10。  </p>
<p>如果你在主控制台运行，用注销或者Ctrl+D退出控制台也可以终止karaf实例。 在控制台你可以运行如下命令：  </p>
<p>bin\stop.bat  </p>
<p>或者在unix下：  </p>
<p>bin/stop。  </p>
<p>四 使用控制台  </p>
<p>查看可用的命令<br>按提示键tab可以在控制台看到可用的命令列表：    </p>
<figure class="highlight vim hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">root@root&gt; <span class="hljs-symbol">&lt;tab&gt;</span>Display <span class="hljs-keyword">all</span> <span class="hljs-number">182</span> possibilities? (<span class="hljs-keyword">y</span> <span class="hljs-built_in">or</span> n)</span><br><span class="line">*:<span class="hljs-keyword">help</span>                           addurl                           admin:<span class="hljs-keyword">change</span>-opts</span><br><span class="line">admin:<span class="hljs-keyword">change</span>-rmi-registry-port   admin:<span class="hljs-keyword">change</span>-ssh-port            admin:connect</span><br><span class="line">admin:create                     admin:destroy                    admin:<span class="hljs-keyword">list</span></span><br><span class="line">admin:<span class="hljs-built_in">rename</span>                     admin:start                      admin:<span class="hljs-keyword">stop</span></span><br><span class="line">bundle-level                     cancel                           <span class="hljs-keyword">cat</span></span><br><span class="line"><span class="hljs-keyword">change</span>-opts                      <span class="hljs-keyword">change</span>-rmi-registry-port         <span class="hljs-keyword">change</span>-ssh-port</span><br><span class="line">clear                            commandlist                      confi<span class="hljs-variable">g:cancel</span></span><br><span class="line">confi<span class="hljs-variable">g:edit</span>                      confi<span class="hljs-variable">g:list</span>                      confi<span class="hljs-variable">g:propappend</span></span><br><span class="line">confi<span class="hljs-variable">g:propdel</span>                   confi<span class="hljs-variable">g:proplist</span>                  confi<span class="hljs-variable">g:propset</span></span><br><span class="line">confi<span class="hljs-variable">g:update</span>                    connect                          create</span><br><span class="line">create-dump                      destroy                          de<span class="hljs-variable">v:create</span>-dump</span><br><span class="line">de<span class="hljs-variable">v:dynamic</span>-import               de<span class="hljs-variable">v:framework</span>                    de<span class="hljs-variable">v:print</span>-stack-traces</span><br><span class="line">de<span class="hljs-variable">v:restart</span>                      de<span class="hljs-variable">v:show</span>-tree                    de<span class="hljs-variable">v:watch</span></span><br><span class="line"><span class="hljs-keyword">display</span>                          <span class="hljs-keyword">display</span>-exception                dynamic-import</span><br><span class="line">each                             <span class="hljs-keyword">echo</span>                             <span class="hljs-keyword">edit</span></span><br><span class="line">exec                             exports                          feature<span class="hljs-variable">s:addurl</span></span><br><span class="line">feature<span class="hljs-variable">s:info</span>                    feature<span class="hljs-variable">s:install</span>                 feature<span class="hljs-variable">s:list</span></span><br><span class="line">feature<span class="hljs-variable">s:listrepositories</span>        feature<span class="hljs-variable">s:listurl</span>                 feature<span class="hljs-variable">s:listversions</span></span><br><span class="line">feature<span class="hljs-variable">s:refreshurl</span>              feature<span class="hljs-variable">s:removerepository</span>        feature<span class="hljs-variable">s:removeurl</span></span><br><span class="line">feature<span class="hljs-variable">s:uninstall</span>               framework                        <span class="hljs-built_in">get</span></span><br><span class="line"><span class="hljs-keyword">grep</span>                             head                             headers</span><br><span class="line"><span class="hljs-keyword">help</span>                             <span class="hljs-keyword">history</span>                          <span class="hljs-keyword">if</span></span><br><span class="line">imports                          info                             install</span><br><span class="line">jaa<span class="hljs-variable">s:cancel</span>                      jaa<span class="hljs-variable">s:commandlist</span>                 jaa<span class="hljs-variable">s:list</span></span><br><span class="line">jaa<span class="hljs-variable">s:manage</span>                      jaa<span class="hljs-variable">s:roleadd</span>                     jaa<span class="hljs-variable">s:roledel</span></span><br><span class="line">jaa<span class="hljs-variable">s:update</span>                      jaa<span class="hljs-variable">s:useradd</span>                     jaa<span class="hljs-variable">s:userdel</span></span><br><span class="line">jaa<span class="hljs-variable">s:userlist</span>                    java                             <span class="hljs-keyword">list</span></span><br><span class="line">listrepositories                 listurl                          listversions</span><br><span class="line"><span class="hljs-keyword">lo</span><span class="hljs-variable">g:clear</span>                        <span class="hljs-keyword">lo</span><span class="hljs-variable">g:display</span>                      <span class="hljs-keyword">lo</span><span class="hljs-variable">g:display</span>-exception</span><br><span class="line"><span class="hljs-keyword">lo</span><span class="hljs-variable">g:get</span>                          <span class="hljs-keyword">lo</span><span class="hljs-variable">g:set</span>                          <span class="hljs-keyword">lo</span><span class="hljs-variable">g:tail</span></span><br><span class="line">logout                           <span class="hljs-keyword">ls</span>                               manage</span><br><span class="line">more                             <span class="hljs-keyword">new</span>                              osgi:bundle-level</span><br><span class="line">osgi:headers                     osgi:info                        osgi:install</span><br><span class="line">osgi:<span class="hljs-keyword">list</span>                        osgi:<span class="hljs-keyword">ls</span>                          osgi:refresh</span><br><span class="line">osgi:<span class="hljs-built_in">resolve</span>                     osgi:restart                     osgi:shutdown</span><br><span class="line">osgi:start                       osgi:start-level                 osgi:<span class="hljs-keyword">stop</span></span><br><span class="line">osgi:uninstall                   osgi:<span class="hljs-keyword">update</span>                      package<span class="hljs-variable">s:exports</span></span><br><span class="line">package<span class="hljs-variable">s:imports</span>                 <span class="hljs-keyword">print</span>-stack-traces               <span class="hljs-built_in">printf</span></span><br><span class="line">propappend                       propdel                          proplist</span><br><span class="line">propset                          refresh                          refreshurl</span><br><span class="line">removerepository                 removeurl                        <span class="hljs-built_in">rename</span></span><br><span class="line"><span class="hljs-built_in">resolve</span>                          restart                          roleadd</span><br><span class="line">roledel                          <span class="hljs-keyword">set</span>                              shel<span class="hljs-variable">l:cat</span></span><br><span class="line">shel<span class="hljs-variable">l:clear</span>                      shel<span class="hljs-variable">l:each</span>                       shel<span class="hljs-variable">l:echo</span></span><br><span class="line">shel<span class="hljs-variable">l:exec</span>                       shel<span class="hljs-variable">l:grep</span>                       shel<span class="hljs-variable">l:head</span></span><br><span class="line">shel<span class="hljs-variable">l:history</span>                    shel<span class="hljs-variable">l:if</span>                         shel<span class="hljs-variable">l:info</span></span><br><span class="line">shel<span class="hljs-variable">l:java</span>                       shel<span class="hljs-variable">l:logout</span>                     shel<span class="hljs-variable">l:more</span></span><br><span class="line">shel<span class="hljs-variable">l:new</span>                        shel<span class="hljs-variable">l:printf</span>                     shel<span class="hljs-variable">l:sleep</span></span><br><span class="line">shel<span class="hljs-variable">l:sort</span>                       shel<span class="hljs-variable">l:tac</span>                        shel<span class="hljs-variable">l:tail</span></span><br><span class="line">show-tree                        shutdown                         <span class="hljs-keyword">sleep</span></span><br><span class="line"><span class="hljs-keyword">sort</span>                             ssh                              ssh:ssh</span><br><span class="line">ssh:sshd                         sshd                             start</span><br><span class="line">start-level                      <span class="hljs-keyword">stop</span>                             tac</span><br><span class="line">tail                             uninstall                        <span class="hljs-keyword">update</span></span><br><span class="line">useradd                          userdel                          userlist</span><br><span class="line">watch</span><br><span class="line">root@root&gt;</span><br></pre></td></tr></table></figure>

<p>获得命令的帮助<br>要查看一个特定的命令的帮助，在命令后加–help或使用help命令加上命令的名称：</p>
<p><code>karaf@root&gt; feature:list --help</code><br>描述</p>
<p>   <code>feature:list       列出库中定义的所有功能。</code><br>语法</p>
<pre><code>`feature:list [options]`</code></pre><p>选项</p>
<p>   <code>--help               显示此帮助信息</code><br>   <code>-i, --installed      只列出已安装的功能列表</code><br>更多…<br>所有可用命令列表和它们的用法，也可以在一个专门的章节。  </p>
<p>你在开发指南会获得更多的shell语法的深入引导。  </p>
<p>如开发指南解释的那样，控制台可以很容易的被新命令扩展。  </p>
<p>五 网络控制台  </p>
<p>Karaf Web控制台提供了一个运行时的图形概述。  </p>
<p>你可以是用它来：  </p>
<p>安装和卸载功能<br>启动，停止，安装捆绑<br>创建子实例<br>配置Karaf<br>查看日志信息<br>安装web控制台<br>默认情况下web控制台是不安装的，安装请在karaf提示中运行以下命令： root@karaf&gt; features:install webconsole  </p>
<p>访问Web控制台<br>访问本地运行的一个karaf实例，在浏览器输入：   <a href="http://localhost:8181/system/console" target="_blank" rel="noopener">http://localhost:8181/system/console</a> 使用karaf用户名和karaf密码来登录系统，如果你修改过用户名或密码，请是用修改后的。  </p>
<p>改变web控制台端口号<br>默认情况下，控制台在8181端口运行，你可以通过创建属性文件etc/org.ops4j.pax.web.cfg并在后面添加如下属性设置（改成任意你想要的端口号）来改变端口：  </p>
<p><code>org.osgi.service.http.port=8181</code>    </p>
<p>六 远程控制台  </p>
<p>使用远程实例<br>初始化远程实例<br>用它本地控制台管理karaf实例不总是有意义的，你可以用远程控制台远程管理karaf。  </p>
<p>当你启动karaf时，它使任何其他Karaf控制台或纯SSH客户端可以通过SSH访问远程控制台。远程控制台提供本地控制台的所有功能，并通过运行它里面的容器和服务给远程用户完全控制。  </p>
<p>SSH主机名和端口号在配置文件[karaf安装目录]/etc/org.apache.karaf.shell.cfg用以下默认值配置：  </p>
<p>sshPort=8101<br>sshHost=0.0.0.0<br>sshRealm=karaf<br>hostKey=${karaf.base}/etc/host.key<br>你可以用初始化命令或者编辑上面的文件更改这个配置，但是需要重启ssh控制台以便它是用新的参数。  </p>
<figure class="highlight stata hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># define helper functions  </span><br><span class="line">bundle-<span class="hljs-keyword">by</span>-sn = &#123; bm = new java.util.HashMap ;  each (bundles) &#123; <span class="hljs-variable">$bm</span> put (<span class="hljs-variable">$it</span> symbolicName) <span class="hljs-variable">$it</span> &#125; ; <span class="hljs-variable">$bm</span> get <span class="hljs-variable">$1</span> &#125;</span><br><span class="line">bundle-id-<span class="hljs-keyword">by</span>-sn = &#123; b = (bundle-<span class="hljs-keyword">by</span>-sn <span class="hljs-variable">$1</span>) ; <span class="hljs-keyword">if</span> &#123; <span class="hljs-variable">$b</span> &#125; &#123; <span class="hljs-variable">$b</span> bundleId &#125; &#123; -1 &#125; &#125;</span><br><span class="line"># <span class="hljs-keyword">edit</span> config</span><br><span class="line">config:<span class="hljs-keyword">edit</span> org.apache.karaf.<span class="hljs-keyword">shell</span></span><br><span class="line">config:propset sshPort 8102</span><br><span class="line">config:<span class="hljs-keyword">update</span> </span><br><span class="line"># force a restart</span><br><span class="line">osgi:restart --force (bundle-id-<span class="hljs-keyword">by</span>-sn org.apache.karaf.<span class="hljs-keyword">shell</span>.ssh)</span><br></pre></td></tr></table></figure>

<p>远程连接和断开<br>使用ssh：ssh命令</p>
<p>你可以使用ssh：ssh命令来连接远程karaf控制台。 <code>karaf@root&gt; ssh:ssh -l karaf -P karaf -p 8101 hostname</code></p>
<p>注意：默认的密码是karaf，但是我们强烈建议个更改。在安全模块查看更多信息。 为了确定你已经连接到正确的karaf实例，输入ssh：info在karaf提示符。返回当前连接的实例的信息，如下所示。</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Karaf</span><br><span class="line">  Karaf home  /local/apache-karaf-2.0.0</span><br><span class="line">  Karaf base  /local/apache-karaf-2.0.0</span><br><span class="line">  OSGi Framework  org.eclipse.osgi - 3.5.1.R35x_v20090827</span><br><span class="line">JVM</span><br><span class="line">  Java Virtual MachineJava HotSpot(TM)<span class="hljs-built_in"> Server </span>VM version 14.1-b02</span><br><span class="line">  <span class="hljs-built_in">..</span>.</span><br></pre></td></tr></table></figure>

<p>使用karaf客户端<br>Karaf允许你安全的连接到远程karaf实例而不必运行本地karaf实例。</p>
<p>例如，在同一台机器上快速连接在server模式下运行的karaf实例，在karaf安装目录运行以下命令：<code>bin/client</code>。 通常情况下，你需要提供主机名，端口，用户名和密码来连接到远程实例。如果你使用的客户端在一个较大的脚本，你可以附加控制台命令如下： <code>bin/client -a 8101 -h hostname -u karaf -p karaf features:install wrapper</code></p>
<p>显示可用的客户端选项，输入：</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; bin<span class="hljs-built_in">/client </span>--help</span><br><span class="line">Apache Karaf client</span><br><span class="line">  -a [port] specify the<span class="hljs-built_in"> port </span><span class="hljs-keyword">to</span> connect <span class="hljs-keyword">to</span></span><br><span class="line">  -h [host] specify the host <span class="hljs-keyword">to</span> connect <span class="hljs-keyword">to</span></span><br><span class="line">  -u [user] specify the<span class="hljs-built_in"> user </span>name</span><br><span class="line">  -p [password] specify the password</span><br><span class="line">  --helpshows this help message</span><br><span class="line">  -vraise verbosity</span><br><span class="line">  -r [attempts] retry<span class="hljs-built_in"> connection </span>establishment (up <span class="hljs-keyword">to</span> attempts times)</span><br><span class="line">  -d [delay]intra-retry delay (defaults <span class="hljs-keyword">to</span> 2 seconds)</span><br><span class="line">  [commands]commands <span class="hljs-keyword">to</span> run</span><br></pre></td></tr></table></figure>

<p>如果没有指定的命令，客户端将在互动模式。</p>
<p>使用纯SSH客户端<br>你也可以使用你的unix系统中的纯SSH客户端或者windows SSH客户端像putty来连接。 <code>~$ ssh -p 8101 karaf@localhost karaf@localhost&#39;s password:</code></p>
<p>从远程控制台断开<br>按Ctrl+D，shell：logout或者简单的在karaf提示符输入logout就可以断开远程控制台。</p>
<p>关闭远程实例<br>使用远程控制台<br>如果你已经用ssh:ssh命令或者karaf客户端连接到远程控制台，你可以用使用osgi:shutdown命令来停止远程实例。 注意：在远程控制台按Ctrl + D键，简单地关闭远程连接并返回到本地shell。</p>
<p>使用karaf客户端<br>使用karaf客户端停止远程实例，在karaf安装目录/lib目录运行以下命令： <code>bin/client -u karaf -p karaf -a 8101 hostname osgi:shutdown</code></p>
<p>七 子实例</p>
<p>管理子实例<br>一个Karaf的子实例是一个副本，你可以分别启动和部署应用程序。实例不包含的完整副本Karaf，但只有一个配置文件和数据文件夹的副本，其中包含了所有运行中的信息，日志文件和临时文件。</p>
<p>使用管理控制台命令<br>管理控制台命令允许您在同一台机器创建和管理Karaf实例。每一个新的运行时是运行时创建的子实例。您可以轻松地使用的名称管理子实例，而不是网络地址。有关管理命令的详细信息，请参阅管理命令。</p>
<p>创建子实例<br>你可以在karaf控制台输入admin:create创建新的运行时实例.</p>
<p>如下例子所示，admin:create将使运行时在活动的运行时{实例/名称}目录创建新的运行时安装。新的实例是一个新的karaf实例并且分配一个SSH端口号基于始于8101的增量和一个RMI注册端口号基于始于1099的增量。</p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">karaf<span class="hljs-meta">@root</span>&gt;<span class="hljs-string">admin:</span>create finn</span><br><span class="line">Creating <span class="hljs-keyword">new</span> instance on SSH port <span class="hljs-number">8106</span> and RMI port <span class="hljs-number">1100</span> <span class="hljs-string">at:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances/finn</span><br><span class="line">Creating <span class="hljs-string">dir:</span>  <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>bin</span><br><span class="line">Creating <span class="hljs-string">dir:</span>  <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc</span><br><span class="line">Creating <span class="hljs-string">dir:</span>  <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>system</span><br><span class="line">Creating <span class="hljs-string">dir:</span>  <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>deploy</span><br><span class="line">Creating <span class="hljs-string">dir:</span>  <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>data</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/config.properties</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/java.util.logging.properties</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/org.apache.felix.fileinstall-deploy.cfg</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/org.apache.karaf.log.cfg</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/org.apache.karaf.features.cfg</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/org.ops4j.pax.logging.cfg</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/org.ops4j.pax.url.mvn.cfg</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/startup.properties</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/system.properties</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/org.apache.karaf.shell.cfg</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>etc/org.apache.karaf.management.cfg</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>bin/karaf</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>bin/start</span><br><span class="line">Creating <span class="hljs-string">file:</span> <span class="hljs-regexp">/home/</span>fuse<span class="hljs-regexp">/esb4/</span>instances<span class="hljs-regexp">/finn/</span>bin/stop</span><br><span class="line">karaf<span class="hljs-meta">@root</span>&gt;</span><br></pre></td></tr></table></figure>

<p>改变子实例端口号<br>你可以使用admin:change-ssh-port命令来改变分配给子实例的SSH端口号。命令语法是： admin:change-ssh-port 实例 端口号，需要注意的必须停止子实例才能运行此命令。  </p>
<p>同样，你可以使用admin:change-rmi-registry-port命令改变分配给子实例的RMI注册端口号。命令的语法是：   admin:change-rmi-registry-port instance port，需要注意的必须停止子实例才能运行此命令。  </p>
<p>启动子实例<br>新的子实例在停止状态下被创建，用admin:start命令来启动子实例并使之准备主机应用。这个命令需要一个标识你想启动的子实例的instance-name参数。  </p>
<p>列出所有容器实例<br>要查看一个特定的安装下运行的所有Karaf实例的列表，使用admin:list命令。  </p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">karaf@root&gt;admin:list</span><br><span class="line">  SSH<span class="hljs-built_in"> Port </span>  RMI<span class="hljs-built_in"> Port </span>  State   Pid  Name</span><br><span class="line">[8107] [  1106] [Started ] [10628] harry</span><br><span class="line">[8101] [  1099] [Started ] [20076] root</span><br><span class="line">[8106] [  1105] [Stopped ] [15924] dick</span><br><span class="line">[8105] [  1104] [Started ] [18224] tom</span><br><span class="line">karaf@root&gt;</span><br></pre></td></tr></table></figure>

<p>连接到子实例<br>你可以使用admin:connect命令连接到开始的子实例远程控制台，这需要三个参数： admin:connect [-u username] [-p password] instance, 一旦你连接到子实例，karaf提示符显示现在实例的名字，如下： karaf@harry&gt;</p>
<p>停止一个子实例<br>在实例自己内部停止一个子实例，输入osgi:shutdown或者简单的shutdown。 远程停止子实例，换句话说，从父或者兄弟实例，使用<code>admin:stop： admin:stop instance</code></p>
<p>注销一个子实例<br>你可以使用<code>admin:destroy</code>命令永久的删除一个停止的子实例：</p>
<p><code>*admin:destroy instance*</code><br>请注意只有停止的实例可以被注销。</p>
<p>使用管理脚本<br>你也可以管理本地的karaf实例，在karaf安装目录/bin目录下的管理员脚本提供了像管理员控制台相同的命令，除了admin:connect。</p>
<figure class="highlight livecodeserver hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; bin/admin</span><br><span class="line">Available commands:</span><br><span class="line">  change-ssh-port - Changes <span class="hljs-keyword">the</span> secure <span class="hljs-built_in">shell</span> port <span class="hljs-keyword">of</span> <span class="hljs-keyword">an</span> existing container instance.</span><br><span class="line">  change-rmi-registry-port - Changes <span class="hljs-keyword">the</span> RMI registry port (used <span class="hljs-keyword">by</span> management layer) <span class="hljs-keyword">of</span> <span class="hljs-keyword">an</span> existing container instance.</span><br><span class="line">  <span class="hljs-built_in">create</span> - Creates <span class="hljs-keyword">a</span> <span class="hljs-built_in">new</span> container instance.</span><br><span class="line">  destroy - Destroys <span class="hljs-keyword">an</span> existing container instance.</span><br><span class="line">  list - List all existing container instances.</span><br><span class="line">  <span class="hljs-built_in">start</span> - Starts <span class="hljs-keyword">an</span> existing container instance.</span><br><span class="line">  <span class="hljs-built_in">stop</span> - Stops <span class="hljs-keyword">an</span> existing container instance.</span><br><span class="line">Type <span class="hljs-string">'command --help'</span> <span class="hljs-keyword">for</span> more help <span class="hljs-keyword">on</span> <span class="hljs-title">the</span> <span class="hljs-title">specified</span> <span class="hljs-title">command</span>.</span><br></pre></td></tr></table></figure>

<p>例如，列出所有本机器的karaf实例，输入：</p>
<p>bin/admin list<br>八 安全</p>
<p>管理用户名和密码<br>默认安全配置使用一个位于 karaf安装目录/etc/users.properties属性文件存储授权的用户和他们的密码。</p>
<p>默认的用户名是karaf，与之相关联的密码也是karaf。我们强烈建议在将karaf转移到产品前通过编辑上面的文件修改默认密码。</p>
<p>在karaf中用户现在被使用在三个地方：</p>
<p>访问SSH控制台<br>访问JMX管理层<br>访问web控制台<br>这三种方式的全部委托基于安全认证的相同的JAAS。 users.properties文件包含一或者多行，每行都定义了一个用户，密码和相关的角色。 user=password[,role][,role]…</p>
<p>管理角色<br>JAAS角色可以被各种组件使用。三个管理层（SSH,JMX和web控制台）都使用用基于认证系统的全局角色。默认的角色名称在etc/system.properties中使用karaf.admin.role系统属性配置，并且默认值是admin。对管理层进行身份验证的所有用户必须有这个角色的定义。</p>
<p>这个值的语法如下： [classname:]principal</p>
<p>其中classname是主要对象的类名（默认以org.apache.karaf.jaas.modules.RolePrincipal），主要是这一类（默认为admin）的主要的名称。 注意，可以使用以下配置ConfigAdmin对于一个给定的层改变角色：</p>
<p>Layer    PID    Value<br>SSH    org.apache.karaf.shell    sshRole<br>JMX    org.apache.karaf.management    jmxRole<br>Web    org.apache.karaf.webconsole    role<br>启用密码加密<br>为了避免密码是纯文本，密码可以加密存储在配置文件中。 这可以通过以下命令轻易的实现：</p>
<figure class="highlight yaml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># edit config</span></span><br><span class="line"><span class="hljs-attr">config:</span><span class="hljs-string">edit</span> <span class="hljs-string">org.apache.karaf.jaas</span></span><br><span class="line"><span class="hljs-attr">config:</span><span class="hljs-string">propset</span> <span class="hljs-string">encryption.enabled</span> <span class="hljs-literal">true</span></span><br><span class="line"><span class="hljs-attr">config:</span><span class="hljs-string">update</span> </span><br><span class="line"><span class="hljs-comment"># force a restart</span></span><br><span class="line"><span class="hljs-attr">dev:</span><span class="hljs-string">restart</span></span><br></pre></td></tr></table></figure>

<p>用户第一次登录，密码将在 etc/users.properties 配置文件中被自动的加密。加密密码在前面加上{CRYPT}，因此很容易识别。</p>
<p>管理领域<br>更多关于更改默认领域或者部署新领域信息将会在开发者指南中被提供。</p>
<p>部署安全供应商<br>有些应用程序需要特定的安全性提供者可用，如BouncyCastle。JVM在这些jar包的使用上施加一些限制：他们必须签署和引导类路径上可用。部署这些供应商的方法之一是把他们放在位于$ JAVAHOME/ JRE/ lib / ext的JRE文件夹中并且修改安全策略配置（$JAVAHOME/jre/lib/security/java.security）以登记等供应商。</p>
<p>虽然这种方法工作的很好，他将会有全局的影响并且需要你配置所有相应的服务器。</p>
<p>Karaf提供了一个简单的方式来配置额外的安全性提供者：</p>
<p>把你的供应商jar放在karaf-install-dir/lib/ext中<br>修改初始化文件 karaf-install-dir/etc/config.properties ，添加如下属性： org.apache.karaf.security.providers = xxx,yyy 这个属性的值是一个逗号分隔的提供商类名的注册名单。 例如：org.apache.karaf.security.providers = org.bouncycastle.jce.provider.BouncyCastleProvider 此外，你可能想向系统中捆绑的供应商的类提供访问，使所有束可以访问那些。它可以通过在相同的配置文件中修改org.osgi.framework.bootdelegation 属性来实现： </p>
<figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org<span class="hljs-selector-class">.osgi</span><span class="hljs-selector-class">.framework</span><span class="hljs-selector-class">.bootdelegation</span> = ...,org.bouncycastle*</span><br></pre></td></tr></table></figure>

<p>九 故障转移部署</p>
<p>Karaf提供故障转移功能，使用一个简单的锁定文件系统或JDBC锁定机制。在这两种情况下，一个容器级锁系统允许绑定预装到副Karaf实例，以提供更快的故障转移性能。</p>
<p>简单文件锁定<br>简单文件锁定机制用于驻留在同一台主机的实例故障转移配置。 要使用这个功能，按照如下形式编辑<code>$KARAF_HOME/etc/system.properties</code>文件中的每个系统上的主/从设置：  </p>
<figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">karaf.lock=true</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.class</span>=org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.felix</span><span class="hljs-selector-class">.karaf</span><span class="hljs-selector-class">.main</span><span class="hljs-selector-class">.SimpleFileLock</span></span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.dir</span>=&lt;PathToLockFileDirectory&gt;</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.delay</span>=<span class="hljs-number">10</span></span><br></pre></td></tr></table></figure>

<p>说明：确保karaf.lock.dir属性指向相同的主从实例目录，以便当主释放从，从只能获得锁定。  </p>
<p>JDBC锁定<br>JDBC锁定机制的目的就是为了存在单独机器上的故障转移配置。在此部署中，主实例拥有一个Karaf锁定数据库上的表上的锁，如果主失去了锁，等待从进程获得锁定表，并全面启动它的容器。  </p>
<p>要使用这个功能，按照如下形式设置每个系统上的主/从设置：  </p>
<p>更新CLASSPATH包含JDBC驱动程序  </p>
<p>更新KARAF_HOME/bin/ karaf脚本有独特的JMX远程端口设置，如果实例驻留在同一主机上  </p>
<p>更新KARAF_HOME的/ etc/ system.properties文件如下：  </p>
<figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">karaf.lock=true</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.class</span>=org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.felix</span><span class="hljs-selector-class">.karaf</span><span class="hljs-selector-class">.main</span><span class="hljs-selector-class">.DefaultJDBCLock</span></span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.level</span>=<span class="hljs-number">50</span></span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.delay</span>=<span class="hljs-number">10</span></span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.url</span>=jdbc:derby:<span class="hljs-comment">//dbserver:1527/sample</span></span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.driver</span>=org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.derby</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.ClientDriver</span></span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.user</span>=user</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.password</span>=password</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.table</span>=KARAF_LOCK</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.clustername</span>=karaf</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.timeout</span>=<span class="hljs-number">30</span></span><br></pre></td></tr></table></figure>

<p>说明：</p>
<p>如果JDBC驱动程序不在classpath中会失败。<br>将创建数据库名称“sample”，如果它不存在于数据库。<br>Karaf的第一个实例来获得锁定表的是主实例。<br>如果数据库连接丢失，主实例尝试正常关闭，主数据库服务恢复时允许一个从的实例成为主，前主将需要手动重新启动。<br>Oracle的JDBC锁定<br>在JDBC锁定情况下如果你采用oracle作为你的数据库，在$KARAF_HOME/etc/system.properties 文件中的karaf.lock.class 属性必须指向org.apache.felix.karaf.main.OracleJDBCLock。 否则，对于你的设置初始化system.properties文件是正常的，例如：</p>
<figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">karaf.lock=true</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.class</span>=org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.felix</span><span class="hljs-selector-class">.karaf</span><span class="hljs-selector-class">.main</span><span class="hljs-selector-class">.OracleJDBCLock</span></span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.url</span>=jdbc:oracle:thin:@hostname:<span class="hljs-number">1521</span>:XE</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.driver</span>=oracle<span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.OracleDriver</span></span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.user</span>=user</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.password</span>=password</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.table</span>=KARAF_LOCK</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.clustername</span>=karaf</span><br><span class="line">karaf<span class="hljs-selector-class">.lock</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.timeout</span>=<span class="hljs-number">30</span></span><br></pre></td></tr></table></figure>

<p>正如默认的JDBC锁定设置，Oracle JDBC驱动包必须在calsspath中，为了确保如此你可以在karaf启动之前复制ojdbc14.jar到karaf的lib文件夹下。 说明：karaf.lock.jdbc.url 需要活动的SID，这意味着在使用这个特定的锁之前你必须手动创建数据库实例。</p>
<p>容器级锁定<br>容器级锁定允许绑定预装到从内核的实例，以提供更快的故障转移性能。容器级锁被简单的文件和JDBC锁定机制支持。 为了实现容器及说定，添加如下内容到  <code>$KARAF_HOME/etc/system.properties</code> 文件中在每个系统的主从设置上：  </p>
<figure class="highlight ini hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-attr">karaf.lock</span>=<span class="hljs-literal">true</span></span><br><span class="line"><span class="hljs-attr">karaf.lock.level</span>=<span class="hljs-number">50</span></span><br><span class="line"><span class="hljs-attr">karaf.lock.delay</span>=<span class="hljs-number">10</span></span><br></pre></td></tr></table></figure>

<p>Karaf.log.level属性告诉karaf实例引导过程带来的OSGI容器有多远。分配相同级别的绑定或者是更低的也会在那个karaf实例中被启动。  </p>
<p>绑定开始级别在$KARAF_HOME/etc/startup.properties指定，以jar.name=levle的形式。核心系统绑定级数低于50，用户绑定级别大于50。  </p>
<p>级别    行为<br>1    一个“冷”的备用实例，核心绑定不会被加载到容器中，从实例将等待指导锁定需要启动服务器。<br>&lt;50    一个“热”的备用实例，核心捆绑将被加载到容器，从实例等待指导锁需要启动用户级别绑定。控制台对于每个从实例可以在这个级别访问。  </p>
<blockquote>
<p>50    这个设置不建议作为用户捆绑被启动。<br>注意：挡在同一主机上使用“热”备用，你需要设置JMX远程端口为唯一值以避免绑定冲突，你可以编辑karaf启动脚本以包括以下内容：</p>
</blockquote>
<figure class="highlight haml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DEFAULT_JAVA_OPTS="-server $DEFAULT_JAVA_OPTS </span><br><span class="line">-<span class="hljs-ruby">Dcom.sun.management.jmxremote.port=<span class="hljs-number">1100</span> </span></span><br><span class="line"><span class="hljs-ruby">-Dcom.sun.management.jmxremote.authenticate=<span class="hljs-literal">false</span></span></span><br></pre></td></tr></table></figure>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-24T18:29:00.000Z">2019-07-24</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    1 分钟 read (About 128 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/25/markdown-目录/">markdown 目录</a>
            
        </h1>
        <div class="content">
            <p>markdown 实现页内跳转和自动生成目录</p>
<p>接上一篇 markdown 基本语法继续：</p>
<ul>
<li>实现页内跳转</li>
</ul>
<ol>
<li><p>定义锚点<br><code>&lt;span id=&quot;jump&quot;&gt;请点击跳转&lt;/span&gt;</code>  </p>
</li>
<li><p>使用markdown语法<br><code>[要跳转到的内容](#jump)</code>  </p>
</li>
</ol>
<ul>
<li>实现目录</li>
</ul>
<p>在要生成目录的地方写：<code>[TOC]</code> 即可按照标题生成目录<br>有些markdown编辑器需要写： <code>@[TOC]</code></p>
<p>案例：</p>
<pre><code>
[TOC]

#  马什么梅
## 马冬梅
### 马冬什么
#### 马冬梅
##### 什么冬梅
###### 马冬梅</code></pre><p>生成的效果图：</p>
<p><img src="/images/pasted-29.png" alt="upload successful"></p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-24T16:54:00.000Z">2019-07-24</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    9 分钟 read (About 1377 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/25/springboot-osgi-系统监控/">springboot osgi 系统监控</a>
            
        </h1>
        <div class="content">
            <p>Springboot 集成osgi 实现本机性能监控</p>
<!-- 获取系统信息 -->
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.github.oshi&lt;/groupId&gt;
    &lt;artifactId&gt;oshi-core&lt;/artifactId&gt;
    &lt;version&gt;3.9.1&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;net.java.dev.jna&lt;/groupId&gt;
    &lt;artifactId&gt;jna&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;net.java.dev.jna&lt;/groupId&gt;
    &lt;artifactId&gt;jna-platform&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre><p>第二步：CPU、内存、虚拟机、系统、系统文件属性基础封装</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">package com.zzg.monit.domain.server;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.util.Arith;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="hljs-keyword">import</span> lombok.Setter;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cpu</span> &#123;</span></span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 核心数</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Getter</span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> cpuNum;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * CPU总的使用率</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> total;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * CPU系统使用率</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> sys;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * CPU用户使用率</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> used;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * CPU当前等待率</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> wait;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * CPU当前空闲率</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> <span class="hljs-built_in">free</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getTotal</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.round(Arith.mul(total, <span class="hljs-number">100</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getSys</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.round(Arith.mul(sys / total, <span class="hljs-number">100</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getUsed</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.round(Arith.mul(used / total, <span class="hljs-number">100</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getWait</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.round(Arith.mul(wait / total, <span class="hljs-number">100</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getFree</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.round(Arith.mul(<span class="hljs-built_in">free</span> / total, <span class="hljs-number">100</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">package com.zzg.monit.domain.server;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> java.lang.management.ManagementFactory;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.util.Arith;</span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.util.DateUtils;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="hljs-keyword">import</span> lombok.Setter;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * 虚拟机相关设置</span></span><br><span class="line"><span class="hljs-comment"> * @author zzg</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Jvm</span> &#123;</span></span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 当前JVM占用的内存总数(M)</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> total;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * JVM最大可用内存总数(M)</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> max;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * JVM空闲内存(M)</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> <span class="hljs-built_in">free</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * JDK版本</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Getter</span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> String version;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * JDK路径</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Getter</span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> String home;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getTotal</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.div(total, (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getMax</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.div(max, (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getFree</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.div(<span class="hljs-built_in">free</span>, (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getUsed</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.div(total - <span class="hljs-built_in">free</span>, (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getUsage</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.mul(Arith.div(total - <span class="hljs-built_in">free</span>, total, <span class="hljs-number">4</span>), <span class="hljs-number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 获取JDK名称</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> ManagementFactory.getRuntimeMXBean().getVmName();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * JDK启动时间</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getStartTime</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> DateUtils.parseDateToStr(DateUtils.YYYY_MM_DD_HH_MM_SS, DateUtils.getServerStartDate());</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * JDK运行时间</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getRunTime</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> DateUtils.getDatePoor(DateUtils.getNowDate(), DateUtils.getServerStartDate());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">package com.zzg.monit.domain.server;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.util.Arith;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> lombok.Setter;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * 内存相关信息</span></span><br><span class="line"><span class="hljs-comment"> * @author zzg</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Mem</span> &#123;</span></span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 内存总量</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> total;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 已用内存</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> used;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 剩余内存</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	@Setter</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> <span class="hljs-built_in">free</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getTotal</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.div(total, (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getUsed</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.div(used, (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getFree</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.div(<span class="hljs-built_in">free</span>, (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>), <span class="hljs-number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getUsage</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Arith.mul(Arith.div(used, total, <span class="hljs-number">4</span>), <span class="hljs-number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.zzg</span><span class="hljs-selector-class">.monit</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.server</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">lombok</span><span class="hljs-selector-class">.Getter</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">lombok</span><span class="hljs-selector-class">.Setter</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * 系统相关信息</span></span><br><span class="line"><span class="hljs-comment"> * @author zzg</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">Sys</span> &#123;</span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 服务器名称</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String computerName;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 服务器Ip</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String computerIp;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 项目路径</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String userDir;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 操作系统</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String osName;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 系统架构</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String osArch;		</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.zzg</span><span class="hljs-selector-class">.monit</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.server</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">lombok</span><span class="hljs-selector-class">.Getter</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">lombok</span><span class="hljs-selector-class">.Setter</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * 系统文件相关信息</span></span><br><span class="line"><span class="hljs-comment"> * @author zzg</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">SysFile</span> &#123;</span><br><span class="line">	 <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 盘符路径</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String dirName;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 盘符类型</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String sysTypeName;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 文件类型</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String typeName;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 总大小</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String total;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 剩余大小</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String free;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 已经使用量</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private String used;</span><br><span class="line"> </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 资源的使用率</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">	<span class="hljs-variable">@Getter</span></span><br><span class="line">	<span class="hljs-variable">@Setter</span></span><br><span class="line">    private double usage;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight processing hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> com.zzg.monit.domain;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="hljs-keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.List;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.monit.domain.server.Cpu;</span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.monit.domain.server.Jvm;</span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.monit.domain.server.Mem;</span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.monit.domain.server.Sys;</span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.monit.domain.server.SysFile;</span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.util.Arith;</span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.util.IpUtils;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="hljs-keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="hljs-keyword">import</span> oshi.SystemInfo;</span><br><span class="line"><span class="hljs-keyword">import</span> oshi.hardware.CentralProcessor;</span><br><span class="line"><span class="hljs-keyword">import</span> oshi.hardware.GlobalMemory;</span><br><span class="line"><span class="hljs-keyword">import</span> oshi.hardware.HardwareAbstractionLayer;</span><br><span class="line"><span class="hljs-keyword">import</span> oshi.hardware.CentralProcessor.TickType;</span><br><span class="line"><span class="hljs-keyword">import</span> oshi.software.os.FileSystem;</span><br><span class="line"><span class="hljs-keyword">import</span> oshi.software.os.OSFileStore;</span><br><span class="line"><span class="hljs-keyword">import</span> oshi.software.os.OperatingSystem;</span><br><span class="line"><span class="hljs-keyword">import</span> oshi.util.Util;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">public</span> class Server implements Serializable &#123;</span><br><span class="line"> </span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	 * </span></span><br><span class="line"><span class="hljs-comment">	 */</span></span><br><span class="line">	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1</span>L;</span><br><span class="line"> </span><br><span class="line">	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> OSHI_WAIT_SECOND = <span class="hljs-number">1000</span>;</span><br><span class="line"> </span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	 * CPU相关信息</span></span><br><span class="line"><span class="hljs-comment">	 */</span></span><br><span class="line">	@Getter</span><br><span class="line">	@Setter</span><br><span class="line">	<span class="hljs-keyword">private</span> Cpu cpu = <span class="hljs-keyword">new</span> Cpu();</span><br><span class="line"> </span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	 * 內存相关信息</span></span><br><span class="line"><span class="hljs-comment">	 */</span></span><br><span class="line">	@Getter</span><br><span class="line">	@Setter</span><br><span class="line">	<span class="hljs-keyword">private</span> Mem mem = <span class="hljs-keyword">new</span> Mem();</span><br><span class="line"> </span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	 * JVM相关信息</span></span><br><span class="line"><span class="hljs-comment">	 */</span></span><br><span class="line">	@Getter</span><br><span class="line">	@Setter</span><br><span class="line">	<span class="hljs-keyword">private</span> Jvm jvm = <span class="hljs-keyword">new</span> Jvm();</span><br><span class="line"> </span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	 * 服务器相关信息</span></span><br><span class="line"><span class="hljs-comment">	 */</span></span><br><span class="line">	@Getter</span><br><span class="line">	@Setter</span><br><span class="line">	<span class="hljs-keyword">private</span> Sys sys = <span class="hljs-keyword">new</span> Sys();</span><br><span class="line"> </span><br><span class="line">	<span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	 * 磁盘相关信息</span></span><br><span class="line"><span class="hljs-comment">	 */</span></span><br><span class="line">	@Getter</span><br><span class="line">	@Setter</span><br><span class="line">	<span class="hljs-keyword">private</span> List&lt;SysFile&gt; sysFiles = <span class="hljs-keyword">new</span> LinkedList&lt;SysFile&gt;();</span><br><span class="line">	</span><br><span class="line"> </span><br><span class="line">	 <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> copyTo() <span class="hljs-keyword">throws</span> Exception &#123;</span><br><span class="line">	        SystemInfo si = <span class="hljs-keyword">new</span> SystemInfo();</span><br><span class="line">	        HardwareAbstractionLayer hal = si.getHardware();</span><br><span class="line"> </span><br><span class="line">	        setCpuInfo(hal.getProcessor());</span><br><span class="line"> </span><br><span class="line">	        setMemInfo(hal.getMemory());</span><br><span class="line"> </span><br><span class="line">	        setSysInfo();</span><br><span class="line"> </span><br><span class="line">	        setJvmInfo();</span><br><span class="line"> </span><br><span class="line">	        setSysFiles(si.getOperatingSystem());</span><br><span class="line">	    &#125;</span><br><span class="line"> </span><br><span class="line">	    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	     * 设置CPU信息</span></span><br><span class="line"><span class="hljs-comment">	     */</span></span><br><span class="line">	    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> setCpuInfo(CentralProcessor processor) &#123;</span><br><span class="line">	        <span class="hljs-comment">// CPU信息</span></span><br><span class="line">	        <span class="hljs-keyword">long</span>[] prevTicks = processor.getSystemCpuLoadTicks();</span><br><span class="line">	        Util.sleep(OSHI_WAIT_SECOND);</span><br><span class="line">	        <span class="hljs-keyword">long</span>[] ticks = processor.getSystemCpuLoadTicks();</span><br><span class="line">	        <span class="hljs-keyword">long</span> nice = ticks[TickType.NICE.getIndex()] - prevTicks[TickType.NICE.getIndex()];</span><br><span class="line">	        <span class="hljs-keyword">long</span> irq = ticks[TickType.IRQ.getIndex()] - prevTicks[TickType.IRQ.getIndex()];</span><br><span class="line">	        <span class="hljs-keyword">long</span> softirq = ticks[TickType.SOFTIRQ.getIndex()] - prevTicks[TickType.SOFTIRQ.getIndex()];</span><br><span class="line">	        <span class="hljs-keyword">long</span> steal = ticks[TickType.STEAL.getIndex()] - prevTicks[TickType.STEAL.getIndex()];</span><br><span class="line">	        <span class="hljs-keyword">long</span> cSys = ticks[TickType.SYSTEM.getIndex()] - prevTicks[TickType.SYSTEM.getIndex()];</span><br><span class="line">	        <span class="hljs-keyword">long</span> user = ticks[TickType.USER.getIndex()] - prevTicks[TickType.USER.getIndex()];</span><br><span class="line">	        <span class="hljs-keyword">long</span> iowait = ticks[TickType.IOWAIT.getIndex()] - prevTicks[TickType.IOWAIT.getIndex()];</span><br><span class="line">	        <span class="hljs-keyword">long</span> idle = ticks[TickType.IDLE.getIndex()] - prevTicks[TickType.IDLE.getIndex()];</span><br><span class="line">	        <span class="hljs-keyword">long</span> totalCpu = user + nice + cSys + idle + iowait + irq + softirq + steal;</span><br><span class="line">	        cpu.setCpuNum(processor.getLogicalProcessorCount());</span><br><span class="line">	        cpu.setTotal(totalCpu);</span><br><span class="line">	        cpu.setSys(cSys);</span><br><span class="line">	        cpu.setUsed(user);</span><br><span class="line">	        cpu.setWait(iowait);</span><br><span class="line">	        cpu.setFree(idle);</span><br><span class="line">	    &#125;</span><br><span class="line"> </span><br><span class="line">	    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	     * 设置内存信息</span></span><br><span class="line"><span class="hljs-comment">	     */</span></span><br><span class="line">	    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> setMemInfo(GlobalMemory memory) &#123;</span><br><span class="line">	        mem.setTotal(memory.getTotal());</span><br><span class="line">	        mem.setUsed(memory.getTotal() - memory.getAvailable());</span><br><span class="line">	        mem.setFree(memory.getAvailable());</span><br><span class="line">	    &#125;</span><br><span class="line"> </span><br><span class="line">	    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	     * 设置服务器信息</span></span><br><span class="line"><span class="hljs-comment">	     */</span></span><br><span class="line">	    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> setSysInfo() &#123;</span><br><span class="line">	        Properties props = System.getProperties();</span><br><span class="line">	        sys.setComputerName(IpUtils.getHostName());</span><br><span class="line">	        sys.setComputerIp(IpUtils.getHostIp());</span><br><span class="line">	        sys.setOsName(props.getProperty(<span class="hljs-string">"os.name"</span>));</span><br><span class="line">	        sys.setOsArch(props.getProperty(<span class="hljs-string">"os.arch"</span>));</span><br><span class="line">	        sys.setUserDir(props.getProperty(<span class="hljs-string">"user.dir"</span>));</span><br><span class="line">	    &#125;</span><br><span class="line"> </span><br><span class="line">	    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	     * 设置Java虚拟机</span></span><br><span class="line"><span class="hljs-comment">	     */</span></span><br><span class="line">	    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> setJvmInfo() <span class="hljs-keyword">throws</span> UnknownHostException &#123;</span><br><span class="line">	        Properties props = System.getProperties();</span><br><span class="line">	        jvm.setTotal(Runtime.getRuntime().totalMemory());</span><br><span class="line">	        jvm.setMax(Runtime.getRuntime().maxMemory());</span><br><span class="line">	        jvm.setFree(Runtime.getRuntime().freeMemory());</span><br><span class="line">	        jvm.setVersion(props.getProperty(<span class="hljs-string">"java.version"</span>));</span><br><span class="line">	        jvm.setHome(props.getProperty(<span class="hljs-string">"java.home"</span>));</span><br><span class="line">	    &#125;</span><br><span class="line"> </span><br><span class="line">	    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	     * 设置磁盘信息</span></span><br><span class="line"><span class="hljs-comment">	     */</span></span><br><span class="line">	    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> setSysFiles(OperatingSystem os) &#123;</span><br><span class="line">	        FileSystem fileSystem = os.getFileSystem();</span><br><span class="line">	        OSFileStore[] fsArray = fileSystem.getFileStores();</span><br><span class="line">	        <span class="hljs-keyword">for</span> (OSFileStore fs : fsArray) &#123;</span><br><span class="line">	            <span class="hljs-keyword">long</span> free = fs.getUsableSpace();</span><br><span class="line">	            <span class="hljs-keyword">long</span> total = fs.getTotalSpace();</span><br><span class="line">	            <span class="hljs-keyword">long</span> used = total - free;</span><br><span class="line">	            SysFile sysFile = <span class="hljs-keyword">new</span> SysFile();</span><br><span class="line">	            sysFile.setDirName(fs.getMount());</span><br><span class="line">	            sysFile.setSysTypeName(fs.getType());</span><br><span class="line">	            sysFile.setTypeName(fs.getName());</span><br><span class="line">	            sysFile.setTotal(convertFileSize(total));</span><br><span class="line">	            sysFile.setFree(convertFileSize(free));</span><br><span class="line">	            sysFile.setUsed(convertFileSize(used));</span><br><span class="line">	            sysFile.setUsage(Arith.mul(Arith.div(used, total, <span class="hljs-number">4</span>), <span class="hljs-number">100</span>));</span><br><span class="line">	            sysFiles.<span class="hljs-built_in">add</span>(sysFile);</span><br><span class="line">	        &#125;</span><br><span class="line">	    &#125;</span><br><span class="line"> </span><br><span class="line">	    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">	     * 字节转换</span></span><br><span class="line"><span class="hljs-comment">	     *</span></span><br><span class="line"><span class="hljs-comment">	     * @param size 字节大小</span></span><br><span class="line"><span class="hljs-comment">	     * @return 转换后值</span></span><br><span class="line"><span class="hljs-comment">	     */</span></span><br><span class="line">	    <span class="hljs-keyword">public</span> <span class="hljs-keyword">String</span> convertFileSize(<span class="hljs-keyword">long</span> <span class="hljs-built_in">size</span>) &#123;</span><br><span class="line">	        <span class="hljs-keyword">long</span> kb = <span class="hljs-number">1024</span>;</span><br><span class="line">	        <span class="hljs-keyword">long</span> mb = kb * <span class="hljs-number">1024</span>;</span><br><span class="line">	        <span class="hljs-keyword">long</span> gb = mb * <span class="hljs-number">1024</span>;</span><br><span class="line">	        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">size</span> &gt;= gb) &#123;</span><br><span class="line">	            <span class="hljs-keyword">return</span> <span class="hljs-keyword">String</span>.format(<span class="hljs-string">"%.1f GB"</span> , (<span class="hljs-built_in">float</span>) <span class="hljs-built_in">size</span> / gb);</span><br><span class="line">	        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">size</span> &gt;= mb) &#123;</span><br><span class="line">	            <span class="hljs-built_in">float</span> f = (<span class="hljs-built_in">float</span>) <span class="hljs-built_in">size</span> / mb;</span><br><span class="line">	            <span class="hljs-keyword">return</span> <span class="hljs-keyword">String</span>.format(f &gt; <span class="hljs-number">100</span> ? <span class="hljs-string">"%.0f MB"</span> : <span class="hljs-string">"%.1f MB"</span> , f);</span><br><span class="line">	        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">size</span> &gt;= kb) &#123;</span><br><span class="line">	            <span class="hljs-built_in">float</span> f = (<span class="hljs-built_in">float</span>) <span class="hljs-built_in">size</span> / kb;</span><br><span class="line">	            <span class="hljs-keyword">return</span> <span class="hljs-keyword">String</span>.format(f &gt; <span class="hljs-number">100</span> ? <span class="hljs-string">"%.0f KB"</span> : <span class="hljs-string">"%.1f KB"</span> , f);</span><br><span class="line">	        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">	            <span class="hljs-keyword">return</span> <span class="hljs-keyword">String</span>.format(<span class="hljs-string">"%d B"</span> , <span class="hljs-built_in">size</span>);</span><br><span class="line">	        &#125;</span><br><span class="line">	    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第三步：控制层编写：</p>
<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> com.zzg.controller;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RequestMapping;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="hljs-keyword">import</span> com.zzg.monit.domain.Server;</span><br><span class="line"><span class="hljs-keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * 服务器监控</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> zzg</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-meta">@Api(value = <span class="hljs-meta-string">"服务器监控"</span>, description = <span class="hljs-meta-string">"服务器监控管理"</span>)</span></span><br><span class="line"><span class="hljs-meta">@Controller</span></span><br><span class="line"><span class="hljs-meta">@RequestMapping(<span class="hljs-meta-string">"/server"</span>)</span></span><br><span class="line"><span class="hljs-meta">@Slf4j</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServerController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="hljs-comment">/**服务器监控首页</span></span><br><span class="line"><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> Exception **/</span></span><br><span class="line">    <span class="hljs-meta">@ApiOperation(value = <span class="hljs-meta-string">"服务器监控首页"</span>, notes = <span class="hljs-meta-string">"服务器监控首页"</span>)</span></span><br><span class="line">    <span class="hljs-meta">@GetMapping(<span class="hljs-meta-string">"/server"</span>)</span></span><br><span class="line">    <span class="hljs-keyword">public</span> ModelAndView user() throws Exception&#123;</span><br><span class="line">    	Server server = new Server();</span><br><span class="line">        server.copyTo();</span><br><span class="line">    	ModelAndView modelAndView = new ModelAndView();</span><br><span class="line">    	modelAndView.setViewName(<span class="hljs-string">"admin/server/server"</span>);</span><br><span class="line">    	modelAndView.addObject(<span class="hljs-string">"server"</span>, server);</span><br><span class="line">        <span class="hljs-keyword">return</span> modelAndView;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/images/pasted-28.png" alt="upload successful"></p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-24T16:42:00.000Z">2019-07-24</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    4 分钟 read (About 575 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/25/karaf-cmd-develop/">karaf cmd develop</a>
            
        </h1>
        <div class="content">
            <p>Karaf命令行辅助开发</p>
<p>在命令行中，要实现如上常用的help,通过ArgumentParsers，则可以容易实现,参考代码</p>
<pre><code>package com.zte.sunquan.demo.param;

import java.io.File;
import java.util.ArrayList;
import net.sourceforge.argparse4j.ArgumentParsers;
import net.sourceforge.argparse4j.annotation.Arg;
import net.sourceforge.argparse4j.inf.ArgumentParser;
import net.sourceforge.argparse4j.inf.ArgumentParserException;

/**
 * Created by sunquan on 2018/1/10.
 */
public class ParamTest {
    public static class Params {

        @Arg(dest = &quot;type&quot;)
        public String type;

        @Arg(dest = &quot;num1&quot;)
        public String num;

        @Arg(dest = &quot;auth&quot;)
        public ArrayList&lt;String&gt; auth;

        @Arg(dest = &quot;schemas-dir&quot;)
        public File schemasDir;

        public String getType() {
            return type;
        }

        public String getNum() {
            return num;
        }

        public ArrayList&lt;String&gt; getAuth() {
            return auth;
        }

        public File getSchemasDir() {
            return schemasDir;
        }
    }

    public static void main(String[] args) throws ArgumentParserException {
        //指定命令gcs
        final ArgumentParser parser = ArgumentParsers.newArgumentParser(&quot;gcs&quot;)
                .defaultHelp(true)
                .description(&quot;alculate checksum of given String.&quot;);//描述命令功能

        parser.addArgument(&quot;-t&quot;, &quot;--type&quot;)//参数选项,第二个参数默认对应@Arg中dest
                .type(String.class)//默认值
                .choices(&quot;SHA-256&quot;, &quot;SHA-512&quot;, &quot;SHA1&quot;)//可选项
                .setDefault(&quot;SHA-256&quot;)//默认值
                .help(&quot;Specify hash function to use&quot;);//选项描述
        parser.addArgument(&quot;-c&quot;, &quot;--content&quot;)
                .type(String.class)
                .help(&quot;content which need calculate&quot;)
                .dest(&quot;num1&quot;);//指定对应的@Arg 定义属性
        parser.addArgument(&quot;-a&quot;, &quot;--auth&quot;)
                .nargs(2)
                .help(&quot;Username and password for HTTP basic authentication in order username password.&quot;)
                .dest(&quot;auth&quot;);

        parser.addArgument(&quot;-f&quot;, &quot;--schemas-dir&quot;)
                .type(File.class)
                .help(&quot;Directory containing yang schemas to describe simulated devices. Some schemas e.g. netconf monitoring and inet types are included by default&quot;)
                .dest(&quot;schemas-dir&quot;);

        parser.printHelp();//打印help信息

        Params params = new Params();//命令包装对象
        try {
            //命令行参数--&gt;自动转包装对象
            parser.parseArgs(new String[]{&quot;-t&quot;, &quot;SHA-256&quot;,
                    &quot;--content&quot;, &quot;sunquan&quot;,
                    &quot;-a&quot;, &quot;sunquan&quot;, &quot;password&quot;,
                    &quot;-f&quot;, &quot;C:/Users/Administrator/.m2/settings.xml&quot;}, params);//字符串转命令包装对象
        } catch (final ArgumentParserException e) {
            parser.handleError(e);
        }
        System.out.println(&quot;type:\t&quot; + params.getType());
        System.out.println(&quot;num:\t&quot; + params.getNum());
        System.out.println(&quot;userName:\t&quot; + params.getAuth().get(0));
        System.out.println(&quot;password:\t&quot; + params.getAuth().get(1));
        if (params.getSchemasDir().exists())
            System.out.println(&quot;file:\t&quot; + params.getSchemasDir().getName());

    }
}</code></pre><p>再介绍org.apache.karaf.shell.table.ShellTable</p>
<pre><code>    public static void main(String[] args) {

        ShellTable table = new ShellTable();
        table.size(40);//设置显示列宽（从最后一列开始计数），不设置
        table.column(&quot;name&quot;).alignLeft();//设置1列标题靠左
        table.column(&quot;age&quot;).alignCenter();//设置1列标题居中
        Col gender = new Col(&quot;gender&quot;);
        gender.alignRight();
        gender.maxSize(10);//设置该列长度，多余字符会被截断，不设置
        table.column(gender);
//        table.column(&quot;gender&quot;).alignRight();//设置1列标题靠右
        table.separator(&quot; % &quot;);//设置分隔符
        table.addRow().addContent(&quot;sunquan111111111111111111&quot;, &quot;291111111111&quot;, &quot;boy456789&quot;);
        table.addRow().addContent(&quot;sunquan&quot;, &quot;29&quot;, &quot;boy&quot;);
        table.addRow().addContent(&quot;sunquan&quot;, &quot;29&quot;, &quot;boy&quot;);
//        table.noHeaders();//不显示头，不设置
        table.print(System.out);

        table = new ShellTable();
        table.column(&quot;name&quot;).alignLeft();//设置1列标题靠左
        table.emptyTableText(&quot;null&quot;);//表示一个空表，用null替代
        table.print(System.out, true);

    }</code></pre>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-24T10:23:00.000Z">2019-07-24</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    16 分钟 read (About 2346 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/24/OSGI/">OSGI</a>
            
        </h1>
        <div class="content">
            <p>OSGI （面向Java的动态模型系统）   </p>
<p>OSGi（开放服务网关协议，Open Service Gateway Initiative）技术是Java动态化模块化系统的一系列规范。OSGi一方面指维护OSGi规范的OSGI官方联盟，另一方面指的是该组织维护的基于Java语言的服务（业务）规范。简单来说，OSGi可以认为是Java平台的模块层。OSGi服务平台向Java提供服务，这些服务使Java成为软件集成和软件开发的首选环境。SGi技术提供允许应用程序使用精炼、可重用和可协作的组件构建的标准化原语，这些组件能够组装进一个应用和部署中。<br>开放服务网关协议有双重含义。一方面它指OSGi Alliance组织；另一方面指该组织制定的一个基于Java语言的服务规范——OSGi服务平台。 OSGi Alliance是一个由Sun Microsystems、IBM、爱立信等于1999年3月成立的开放的标准化组织，最初名为Connected Alliance。该组织及其标准原本主要目的在于使服务提供商通过住宅网关，为各种家庭智能设备提供各种服务。该平台逐渐成为一个为室内、交通工具、移动电话和其他环境下的所有类型的网络设备的应用程序和服务进行传递和远程管理的开放式服务平台。<br>该规范和核心部分是一个框架，其中定义了应用程序的生命周期模式和服务注册。基于这个框架定义了大量的OSGi服务：日志、配置管理、偏好，HTTP（运行servlet）、XML分析、设备访问、软件包管理、许可管理、星级、用户管理、IO连接、连线管理、Jini和UPnP。<br>这个框架实现了一个优雅、完整和动态的组件模型。应用程序（称为bundle）无需重新引导可以被远程安装、启动、升级和卸载（其中Java包/类的管理被详细定义）。API中还定义了运行远程下载管理政策的生命周期管理。<font color="red">服务注册允许bundles去检测新服务和取消的服务，然后相应配合。 </font>OSGI框架一般具备的基础功能：<br>支持模块化的动态部署。基于OSGI而构建的系统可以以模块化的方式动态地部署至框架中，从而增加、扩展或改变系统的功能。支持模块化的封装和交互。每个工程（模块）可通过声明Export-Package对外提供访问此工程的类和接口。<br>支持模块的动态扩展。基于OSGI提供的面向服务的组件模型的设计方法，以及OSGI实现框架提供的扩展点方法可实现模块的动态扩展。模块化的设计。在OSGI中模块由一个或多个bundle构成，模块之间的交互通过Import-Package、Export-Package以及OSGI Service的方式实现。<br>动态化的设计。动态化的设计是指系统中所有的模块必须支持动态的插拔和修改，“即插即用，即删即无”。<br>可扩展的设计。通常使用定义扩展点的方式。按照Eclipse推荐的扩展点插件的标准格式定义bundle中的扩展点，其它要扩展的bundle可通过实现相应的扩展点来扩展该bundle的功能。<font color="red">每个bundle拥有独立的class loader，通过它来完成本bundle类的加载。 </font><br>稳定、高效的系统。基于OSGI的系统采用的是微核机制，微核机制保证了系统的稳定性，微核机制的系统只要微核是稳定运行的，那么系统就不会崩溃，也就是说基于OSGI的系统不会受到运行在其中的bundle的影响，不会因为bundle的崩溃而导致整个系统的崩溃。 [1]<br>OSGi服务平台提供在多种网络设备上无需重启的动态改变构造的功能。为了最小化耦合度和促使这些耦合度可管理，OSGi技术提供一种面向服务的架构，它能使这些组件动态地发现对方。OSGi联盟已经开发了例如像HTTP服务器、配置、日志、安全、用户管理、XML等很多公共功能标准组件接口。这些组件的兼容性插件实现可以从进行了不同优化和使用代价的不同计算机服务提供商得到。然而，服务接口能够基于专有权基础上开发。<br>因为OSGi技术为集成提供了预建立和预测试的组件子系统，所以OSGi技术使你从改善产品上市时间和降低开发成本上获益。因为这些组件能够动态发布到设备上，所以OSGi技术也能降低维护成本和拥有新的配件市场机会。 </p>
<p>OSGI规范的核心组件是OSGI框架。这个框架为应用程序（被叫做组件（bundle））提供了一个标准环境。整个框架可以划分为一些层次：</p>
<p>OSGI<br>L0：运行环境<br>L1：模块<br>L2：生命周期管理<br>L3：服务注册<br>还有一个无处不在的安全系统渗透到所有层。</p>
<p>L0层执行环境是Java环境的规范。Java2配置和子规范，像J2SE，CDC，CLDC，MIDP等等，都是有效的执行环境。OSGi平台已经标准化了一个执行环境，它是基于基础轮廓和在一个执行环境上确定了最小需求的一个小一些的变种，该执行环境对OSGi组件是有用的。<br>L1模块层定义类的装载策略。OSGi框架是一个强大的具有严格定义的类装载模型。它基于Java之上，但是增加了模块化。在Java中，正常情况下有一个包含所有类和资源的类路径。OSGi模块层为一个模块增加了私有类同时有可控模块间链接。模块层同安全架构完全集成，可以选择部署到部署封闭系统，防御系统，或者由厂商决定的完全由用户管理的系统。<br>L2生命周期层增加了能够被动态安装、开启、关闭、更新和卸载的bundles。这些bundles依赖于于具有类装载功能的模块层，但是增加了在运行时管理这些模块的API。生命周期层引入了正常情况下不属于一个应用程序的动态性。扩展依赖机制用于确保环境的操作正确。生命周期操作在安全架构保护之下，使其不受到病毒的攻击。<br>L3层增加了服务注册。服务注册提供了一个面向bundles的考虑到动态性的协作模型。bundles能通过传统的类共享进行协作，但是类共享同动态安装和卸载代码不兼容。服务注册提供了一个在bundles间分享对象的完整模型。定义了大量的事件来处理服务的注册和删除。这些服务仅仅是能代表任何事物的Java对象。很多服务类似服务器对象，例如HTTP服务器，而另一些服务表示的是一个真实世界的对象，例如附近的一个蓝牙手机。这个服务模块提供了完整安全保障。该服务安全模块使用了一个很聪明的方式来保障bundles之间通信安全。</p>
<p>标准服务<br>在该框架之上，OSGi联盟定义了很多服务。这些服务通过一个Java接口指定。bundles能够实  </p>
<p>OSGI<br>现这个接口，并在注册服务层注册该服务。服务的客户端在注册库中找到它，或者当它出现或者消失时做出响应。这个同SOA架构使用Web服务进行发布的方式相似。<br>两者主要不同是Web服务总是需要传输层，这个使它比采用直接方法调用的OSGi服务慢几千倍。同时，OSGi组件能够对这些服务的出现和消失做出响应。更多的信息可以从OSGi服务平台发行版本4手册或者PDF下载中找到。需要注意的是每一种服务都是抽象定义的，与不同计算机服务商的实现相独立。  </p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-24T06:17:00.000Z">2019-07-24</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    1 分钟 read (About 192 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/24/docker-onos/">docker onos</a>
            
        </h1>
        <div class="content">
            <p>在Docker中运行ONOS  </p>
<p>下载镜像：  </p>
<p><code>docker pull onosproject/onos</code></p>
<p><img src="/images/pasted-19.png" alt="upload successful"></p>
<p> 查看上一步下载的镜像</p>
<p><code>docker images</code></p>
<p><img src="/images/pasted-20.png" alt="upload successful"></p>
<p>创建docker容器实例<br><code>docker run -t -d --name onos1 onosproject/onos</code></p>
<p><img src="/images/pasted-21.png" alt="upload successful"></p>
<p> 查看上一步创建的docker实例  </p>
<p><img src="/images/pasted-22.png" alt="upload successful"></p>
<p>修改~/.bashrc文件，获取容器实例的IP  </p>
<figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-title">docker-ip</span><span class="hljs-params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">sudo docker inspect --format <span class="hljs-string">'&#123;&#123; .NetworkSettings.IPAddress &#125;&#125;'</span> <span class="hljs-string">"$@"</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>. ~/.bashrc</code></p>
<p>用SSH连接一个容器实例，密码是karaf  </p>
<figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">ssh</span> <span class="hljs-selector-tag">-p</span> 8101 <span class="hljs-selector-tag">karaf</span>@`<span class="hljs-keyword">docker</span>-<span class="hljs-keyword">ip</span> onos1`</span><br></pre></td></tr></table></figure>

<p><img src="/images/pasted-23.png" alt="upload successful"></p>
<p> 激活Openflow</p>
<p>onos&gt; app activate org.onosproject.openflow</p>
<p>onos&gt; app activate org.onosproject.fwd</p>
<p><img src="/images/pasted-24.png" alt="upload successful"></p>
<p>如果上述命令报错，则SSH连接到其它docker实例,直至成功激活Openflow</p>
<p>测试<br><code>apt install mininet</code></p>
<figure class="highlight armasm hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-symbol">mn</span> --topo tree,<span class="hljs-number">2</span> --controller remote,<span class="hljs-built_in">ip</span>=`docker-<span class="hljs-built_in">ip</span> onos3`</span><br></pre></td></tr></table></figure>

<p><img src="/images/pasted-25.png" alt="upload successful"></p>
<p><img src="/images/pasted-26.png" alt="upload successful"></p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-21T23:04:00.000Z">2019-07-21</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    9 分钟 read (About 1323 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/22/TCP-UDP/">TCP UDP</a>
            
        </h1>
        <div class="content">
            <p>1、TCP和UDP的区别<br>（1）TCP面向连接；UDP面向无连接<br>（2）TCP保证数据正确性；UDP可能丢包<br>（3）TCP传输速度慢；UDP速度快<br>（4）每一条TCP连接只能是点到点的；UDP支持一对一，一对多，多对一和多对多的交互通信<br>（5）TCP对系统资源要求较多，UDP对系统资源要求较少。<br>2、三次握手<br>三次握手的目的是建立可靠的通信信道。确认自己与对方的发送与接收机能正常。<br>TCP三次握手过程:<br>1、主机A通过向主机B 发送一个含有同步序列号的标志位的数据段给主机B ，向主机B请求建立连接,通过这个数据段,主机A告诉主机B两件事：我想要和你通信、你可以用哪个序列号作为起始数据段来回应我。<br>2、主机B收到主机A的请求后,用一个带有确认应答(ACK)和同步序列号(SYN)标志位的数据段响应主机A,也告诉主机A两件事：我已经收到你的请求了,你可以传输数据了、你要用哪个序列号作为起始数据段来回应我。<br>3、主机A收到这个数据段后，再发送一个确认应答，确认已收到主机B的数据段：我已收到回复，我现在要开始传输实际数据了。<br>这样3次握手就完成了,主机A和主机B 就可以传输数据了.<br>这里写图片描述<br>为什么需要三次握手：<br>三次握手能确认双发收发功能都正常，缺一不可。<br>第一次握手：Client什么都不能确认；Server确认了对方发送正常。<br>第二次握手：Client确认了：自己发送、接收正常，对方发送、接收正常；Server确认了：自己接收正常，对方发送正常。<br>第三次握手：Client确认了：自己发送、接收正常，对方发送、接收正常；Server确认了：自己发送、接收正常，对方发送接收正常。<br>三次握手的另一个目标是确认确认双方都支持TCP，告知对方用TCP传输。<br>第一次握手：Server猜测Client可能要建立TCP请求，但不确定，因为也可能是Client乱发了一个数据包给自己。<br>第二次握手：通过ack=J+1，Client知道Server是支持TCP的，且理解了自己要建立TCP连接的意图。<br>第三次握手：通过ack=K+1，Server知道Client是支持TCP的，且确实是要建立TCP连接。<br>3、四次挥手<br>1、第一次挥手：主机1（可以使客户端，也可以是服务器端），设置Sequence Number和Acknowledgment Number，向主机2发送一个FIN报文段；此时，主机1进入FIN_WAIT_1状态；这表示主机1没有数据要发送给主机2了。<br>2、第二次挥手：主机2收到了主机1发送的FIN报文段，向主机1回一个ACK报文段，Acknowledgment Number为Sequence Number加1；主机1进入FIN_WAIT_2状态；主机2告诉主机1，我“同意”你的关闭请求。<br>3、第三次挥手：主机2向主机1发送FIN报文段，请求关闭连接，同时主机2进入LAST_ACK状态。<br>4、第四次挥手：主机1收到主机2发送的FIN报文段，向主机2发送ACK报文段，然后主机1进入TIME_WAIT状态；主机2收到主机1的ACK报文段以后，就关闭连接；此时，主机1等待2MSL后依然没有收到回复，则证明Server端已正常关闭，那好，主机1也可以关闭连接了。<br>为什么要time wait，为什么是2msl<br>这里写图片描述<br>为了保证A发送的最后一个ACK报文能够到达B。这个ACK报文段有可能丢失，因而使处在LAST-ACK状态的B收不到对已发送的FIN+ACK报文段的确认。B会超时重传这个FIN+ACK报文段，而A就能在2MSL时间内收到这个重传的FIN+ACK报文段。如果A在TIME-WAIT状态不等待一段时间，而是在发送完ACK报文段后就立即释放连接，就无法收到B重传的FIN+ACK报文段，因而也不会再发送一次确认报文段。这样，B就无法按照正常的步骤进入CLOSED状态。<br>MSL指的是任何IP数据报能够在因特网上存活的最长时间。假设现在一个MSL的时候，接收端需要发送一个应答，这时候，我们也必须等待这个应答的消失，这个应答的消失也是需要一个MSL，所以我们需要等待2MSL。  </p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-21T15:53:00.000Z">2019-07-21</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    5 分钟 read (About 804 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/21/网络体系机构/">网络体系机构</a>
            
        </h1>
        <div class="content">
            <p>网络的体系结构分为哪五层，每层分别有哪些协议(阿里面试题)<br>面试题：讲一下OSI七层模型，每层的作用，问了wifi属于哪一层(百度面试题)<br>一、OSI七层模型<br><img src="/images/pasted-14.png" alt="upload successful"></p>
<p>应用层<br>是最靠近用户的OSI层。这一层为用户的应用程序（例如电子邮件、文件传输和终端仿真）提供网络服务。<br>表示层<br>表示提供各种用于应用层数据编码和转换功能，确保一个系统的应用层发送的数据能被另一个系统的应用层识别。如果必要该层可提供一种标准表示形式，用于将计算机内部的多种数据格式转换成通信中采用的标准表示形式。数据压缩和加密也是表示层可提供的转换功能之一。<br>会话层<br>会话层负载建立、管理和终止表示层实体之间的通信会话。该层的通信由不同设备中的应用程序之间的服务请求和响应组成。<br>传输层<br>传输层建立了主机端到端的链接，传输层的作用是为上层协议提供端到端的可靠和透明的数据传输服务，包括处理差错控制和流量控制等问题。该层向高层屏蔽了下层数据通信的细节，是高层用户看到的只是在两个传输实体建的一个主机到主机的、可由用户控制和设定、可靠的数据通路。通常说的TCP UDP就是在这层。端口号即是这里的“端”。<br>网络层<br>本层通过IP寻址来建立两点之间的连接，为源端的运输层来的分组，选择合适的路由和交换节点，正确无误地按照地址传送给目的端的运输层。就是通常说的ip层。这一层就是我们经常说的IP协议层。IP协议是Internet的基础。<br>数据链路层<br>将比特组合成字节，再将字节组成帧，使用链路层地址（以太网mac地址）来访问介质，并进行差错检测。数据链路层又分为2个子层：逻辑链路控制子层（LLC）和媒体访问控制子层（MAC）。<br>物理层<br>主要定义物理设备标准，如网线的接口类型、光纤的接口类型、各种传输介质的传输速率等。它的主要作用是传输比特流（就是由1、0转化为电流强弱来进行传输,到达目的地后在转化为1、0，也就是我们常说的数模转换与模数转换）。这一层的数据叫做比特。<br>二、TCP/IP五层模型<br><img src="/images/pasted-15.png" alt="upload successful"></p>
<p>三、Wifi和zigbee<br>zigbee和wifi符合局域网标准，是工作在OSI数据链路层和物理层的。  </p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-21T07:19:00.000Z">2019-07-21</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    4 分钟 read (About 529 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/21/Oauth2/">Oauth2</a>
            
        </h1>
        <div class="content">
            <p>Oauth2授权模式</p>
<h6 id="授权码模式（Authorization-Code）"><a href="#授权码模式（Authorization-Code）" class="headerlink" title="授权码模式（Authorization Code）"></a>授权码模式（Authorization Code）</h6><h6 id="隐士授权模式（Implicit）"><a href="#隐士授权模式（Implicit）" class="headerlink" title="隐士授权模式（Implicit）"></a>隐士授权模式（Implicit）</h6><h6 id="密码模式（Resource-Owner-Password-Credentials）"><a href="#密码模式（Resource-Owner-Password-Credentials）" class="headerlink" title="密码模式（Resource Owner Password Credentials）"></a>密码模式（Resource Owner Password Credentials）</h6><h6 id="客户端模式（Client-Credentials）"><a href="#客户端模式（Client-Credentials）" class="headerlink" title="客户端模式（Client Credentials）"></a>客户端模式（Client Credentials）</h6><p>授权码授权流程</p>
<p><img src="/images/pasted-12.png" alt="upload successful"><br>客户端请求第三方授权<br>用户（资源有者）同意给客户端授权<br>客户端获取到授权码，请求认证服务器申请令牌<br>认证服务器向客户端响应令牌<br>客户端请求资源服务器的资源<br>资源服务器返回受保护资源</p>
<p>申请授权码<br>请求认证服务获取授权码<br>get请求：</p>
<p><img src="/images/pasted-13.png" alt="upload successful"></p>
<p>客户端ID就是存到数据库里的client_id的值</p>
<p>Spring security 会去数据库中查有没有这个服务</p>
<p>校验令牌token<br>刷新令牌refresh_token </p>
<p>JWT  (json web token)简化认证流程  </p>
<p><img src="/images/pasted-16.png" alt="upload successful">      </p>
<p>实现方式是通过RSA(公钥/私钥)完成签名<br>资源服务器和认证服务器之间通过公钥私钥的方式<br>jwt格式包含三个部分：</p>
<ul>
<li>Header部分<figure class="highlight json hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="hljs-attr">""</span>:<span class="hljs-string">""</span>,</span><br><span class="line"> <span class="hljs-attr">"typ"</span>:<span class="hljs-string">""</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>他会用base64url进行编码成字符串</p>
<ul>
<li>Payload部分（内容部分）<figure class="highlight clojure hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>也会进行base64url进行编码  </p>
<ul>
<li>signature部分签名部分<br>防止篡改  <figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(</span><br><span class="line">  base64urlEncode(header) + <span class="hljs-string">"."</span> + </span><br><span class="line">  base64UrlEncode(payload),</span><br><span class="line">  secret</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>secret:签名使用的密钥<br>整个再进行加密</p>
<p>生成密钥证书，采用rsa算法每个证书包含公钥和私钥<br>生成私钥：</p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">keytool</span> <span class="hljs-selector-tag">-genkeypair</span> <span class="hljs-selector-tag">-alias</span> <span class="hljs-selector-tag">xxx</span>(密钥的别名) <span class="hljs-selector-tag">-keyalg</span> <span class="hljs-selector-tag">RSA</span>（采用的算法） <span class="hljs-selector-tag">-keypass</span> <span class="hljs-selector-tag">xxx</span>(密匙的访问密码) <span class="hljs-selector-tag">-keystore</span> <span class="hljs-selector-tag">xxx</span><span class="hljs-selector-class">.keystore</span>(密钥库文件即存储密钥的文件) <span class="hljs-selector-tag">-storepass</span> <span class="hljs-selector-tag">xxx</span>(密钥库的访问密码)</span><br></pre></td></tr></table></figure>

<p>参数解析：<br>-alias 密钥的别名<br>-alias 密钥的别名<br>-keyalg 使用的hash算法<br>-keypass 密匙的访问密码<br>-keystore 密匙库文件名<br>-storepass 密匙库的访问密码  </p>
<p>导出公钥：<br>需要openssl来导出公钥信息<br>安装openssl<br>到证书所在目录执行如下命令：</p>
<figure class="highlight applescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -<span class="hljs-built_in">list</span> rfc <span class="hljs-comment">--keystore xxx.keystore（密钥库文件名）| openssl x509 -inform pem -pubkey</span></span><br></pre></td></tr></table></figure>

<p>springsecurityoauth2流程</p>
<p><img src="/images/pasted-18.png" alt="upload successful"></p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-20T17:26:00.000Z">2019-07-20</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    几秒 read (About 98 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/21/find/">find </a>
            
        </h1>
        <div class="content">
            <p><code># find &lt;directory&gt; -type f -name &quot;*.c&quot; | xargs grep &quot;&lt;strings&gt;&quot;&lt;directory&gt;</code><br>是你要找的文件夹；如果是当前文件夹可以省略-type f 说明，只找文件-name “*.c”  表示只找C语言写的代码，从而避免去查binary；也可以不写，表示找所有文件<strings>是你要找的某个字符串  </strings></p>
<figure class="highlight dos hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">find</span> /your/<span class="hljs-built_in">path</span> -<span class="hljs-built_in">type</span> f -<span class="hljs-built_in">print</span> | xargs grep MASQUERADEgrep -F MASQUERADE -R /<span class="hljs-built_in">path</span></span><br></pre></td></tr></table></figure>

<p>  <code>find -name &quot;.git&quot;</code></p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-20T12:26:00.000Z">2019-07-20</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 分钟 read (About 462 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/20/crontab-another-form/">crontab another form</a>
            
        </h1>
        <div class="content">
            <p>@hourly /usr/local/www/awstats/cgi-bin/awstats.sh<br>使用 @hourly 对应的是 0 * * * *, 还有下述可以使用:  </p>
<p>复制代码<br>string meaning<br>—— ——-<br>@reboot Run once, at startup.<br>@yearly Run once a year, “0 0 1 1 *”.<br>@annually (same as @yearly)<br>@monthly Run once a month, “0 0 1 * *”.<br>@weekly Run once a week, “0 0 * * 0”.<br>@daily Run once a day, “0 0 * * *”.<br>@midnight (same as @daily)<br>@hourly Run once an hour, “0 * * * *”. </p>
<p>特別是看到 @reboot, 所以写 rc.local 的東西, 也可以使用 @reboot 寫在 crontab 里面。  </p>
<p>1.每分钟定时执行一次规则：<br>每1分钟执行： <em>/1 * * * *或者</em> * * * *
每5分钟执行： */5 * * * *</p>
<p>2.每小时定时执行一次规则：<br>每小时执行： 0 * * * *或者0 */1 * * *
每天上午7点执行：0 7 * * *
每天上午7点10分执行：10 7 * * *</p>
<p>3.每天定时执行一次规则：<br>每天执行 0 0 * * *</p>
<p>4.每周定时执行一次规则：<br>每周执行 0 0 * * 0</p>
<p>5.每月定时执行一次规则：<br>每月执行 0 0 1 * *</p>
<p>6.每年定时执行一次规则：<br>每年执行 0 0 1 1 *</p>
<p>7.其他例子<br>5 * * * * 指定每小时的第5分钟执行一次ls命令<br>30 5 * * * ls 指定每天的 5:30 执行ls命令<br>30 7 8 * * ls 指定每月8号的7：30分执行ls命令<br>30 5 8 6 * ls 指定每年的6月8日5：30执行ls命令<br>30 6 * * 0 ls 指定每星期日的6:30执行ls命令[注：0表示星期天，1表示星期1，以此类推，也可以用英文来表示，sun表示星期天，mon表示星期一等。]<br>30 3 10,20 * * ls 每月10号及20号的3：30执行ls命令[注：“，”用来连接多个不连续的时段]<br>25 8-11 * * * ls 每天8-11点的第25分钟执行ls命令[注：“-”用来连接连续的时段]<br>*/15 * * * * ls 每15分钟执行一次ls命令 [即每个小时的第0 15 30 45 60分钟执行ls命令 ]<br>30 6 */10 * * ls 每个月中，每隔10天6:30执行一次ls命令[即每月的1、11、21、31日是的6：30执行一次ls命令。 ]</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-20T02:29:00.000Z">2019-07-20</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 分钟 read (About 519 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/20/onos-源码编译安装/">onos-buck 源码编译安装</a>
            
        </h1>
        <div class="content">
            <p>老版本  onos-buck<br>ONOS新版本源码安装方式<br>发表于 2017-03-08   |   分类于 项目展示   |     |    访问量:<br>1.安装JDK（从Oracle官网下载，不要用OpenJDK）<br>1.Download and Extract JDK package, such as jdk-8u121-linux-x64.tar.gz.<br><code>tar -xzf jdk-8u121-linux-x64.tar.gz</code></p>
<p>and you can see new directory /home/yourname/jdk1.8.0_121.<br>2.Add two environment variables into ~/.bashrc or /etc/profile:</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">JAVA_HOME</span>=/home/yourname/jdk1.8.0_121</span><br><span class="line"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">PATH</span>=<span class="hljs-variable">$&#123;JAVA_HOME&#125;</span>/bin:$PATH</span><br></pre></td></tr></table></figure>

<p>3.Save and open a new terminal, go on next step.</p>
<figure class="highlight sql hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get <span class="hljs-keyword">install</span> software-properties-common -y &amp;&amp; \</span><br><span class="line">sudo <span class="hljs-keyword">add</span>-apt-repository ppa:webupd8team/<span class="hljs-keyword">java</span> -y &amp;&amp; \</span><br><span class="line">sudo apt-<span class="hljs-keyword">get</span> <span class="hljs-keyword">update</span> &amp;&amp; \</span><br><span class="line">echo <span class="hljs-string">"oracle-java8-installer shared/accepted-oracle-license-v1-1 select true"</span> | sudo debconf-<span class="hljs-keyword">set</span>-selections &amp;&amp; \</span><br><span class="line">sudo apt-<span class="hljs-keyword">get</span> <span class="hljs-keyword">install</span> <span class="hljs-keyword">oracle</span>-java8-installer <span class="hljs-keyword">oracle</span>-java8-<span class="hljs-keyword">set</span>-<span class="hljs-keyword">default</span> -y</span><br></pre></td></tr></table></figure>

<p>2.下载源码并编译</p>
<figure class="highlight crmsh hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="hljs-keyword">clone</span> <span class="hljs-title">https</span>://gerrit.onosproject.org/onos</span><br><span class="line">cd onos <span class="hljs-comment">#之后的命令均在此目录下</span></span><br><span class="line">tools/build/onos-buck build onos --show-output</span><br></pre></td></tr></table></figure>

<p>正常的话，会打印出.tar.gz目录，这个就是二进制安装文件。<br>3.本地运行ONOS<br><code>tools/build/onos-buck run onos-local -- clean debug</code><br>以上命令将会从本地的 onos.tar.gz文件中进行本地安装，并在后台开启ONOS服务。在终端上将会持续打出ONOS的日志内容。clean选项会使其进行ONOS的清洁安装，而debug选项意为默认调试端口5005将会开启。<br>4.设置环境变量<br>在/etc/profile中添加： </p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">ONOS_ROOT</span>=/home/yourname/onos</span><br><span class="line">source <span class="hljs-variable">$ONOS_ROOT</span>/tools/dev/bash_profile</span><br></pre></td></tr></table></figure>

<p>5.开启ONOS的CLI控制台<br>在本地开启ONOS之后，在新的终端执行以下命令：<br><code>tools/test/bin/onos localhost</code><br>6.开启ONOS的GUI界面<br>在本地开启ONOS之后，在新的终端执行以下命令：<br><code>tools/test/bin/onos-gui localhost</code></p>
<p>#（实际执行了open http://$host:8181/onos/ui，Ubuntu不支持，</p>
<p>#出错Couldn’t get a file descriptor referring to the console）<br>或者访问<a href="http://localhost:8181/onos/ui" target="_blank" rel="noopener">http://localhost:8181/onos/ui</a> （推荐）<br>默认用户名onos，密码rocks<br>7.ONOS单元测试<br>To execute ONOS unit tests, including code Checkstyle validation, run the following command:<br><code>tools/build/onos-buck test</code><br>8.导入工程到IDE<code>If you want to import the project into IntelliJ, you can generate the hierarchical module structure via the following command:</code><br><code>tools/build/onos-buck project</code></p>
<p>Then simply open the onos directory from IntelliJ IDEA.</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-19T10:45:00.000Z">2019-07-19</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    1 小时 read (About 7700 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/19/dockerfile-command/">dockerfile command</a>
            
        </h1>
        <div class="content">
            <p>docker reference <a href="https://docs.docker.com/v17.09/engine/reference/builder" target="_blank" rel="noopener">https://docs.docker.com/v17.09/engine/reference/builder</a></p>
<h4 id="docker-build-创建镜像"><a href="#docker-build-创建镜像" class="headerlink" title="docker build 创建镜像"></a>docker build 创建镜像</h4><p>   -f 路径 指定用哪个dockerfile文件 创建镜像<br>  <code>$ docker build -f /path/to/a/Dockerfile</code><br>   -t 标签 给指定镜像打标签<br>   <code>$ docker build -t shykes/myapp</code><br>   给某个镜像指定多个标签<br>  <code>$ docker build -t shykes/myapp:1.0.2 -t shykes/myapp:latest</code><br>  如果Dockerfile中有语法错误docker 会报错<br>  docker会根据Dockerfile 逐条执行命令<br>  如果有必要的花docker 会在生成image ID 前 将每一条执行结果都提交到新的镜像中，守护进程自动清理发送给他的文本，注意每一条指令都是独立的无关的，因此一个新的镜像会被创建，所以运行 Run cd/tmp 不回对下条命令产生任何的影响<br>  只要有可能docker都会复用中间镜像的缓存来加速构建，这可以通过输出台Using cache 来表示<br>  构建缓存只用于有本地父关系链的场景，这也表示这些镜像是前面构建的时候已经创建的，或者也可用docker load 命令加载所有的父关连镜像，如果想使用指定的特定镜像缓存来构建可以用 –cache-from ，用这个命令就不需要父关系镜像<br>  <table><td><br>  格式：<br>  虽然大小写不敏感，但是指令用大写 可以与参数很好的区分开<br>  必须以FROM 指令开头，它指定了基础镜像  </td></table></p>
<p> #作为注释只可以放在开头，其他地方插入都只作为参数<br>  <table></table></p>
<h4 id="解析器指令"><a href="#解析器指令" class="headerlink" title="解析器指令"></a>解析器指令</h4><p> 解析器指令是可选的，并且影响Dockerfile中后续行的处理方式。解析器指令不向构建中添加层，也不会显示为构建步骤。解析器指令被编写为一种特殊类型的注释，形式为</p>
<p> #directive=value。<br> 一个指令只能使用一次。一旦注释、空行或构建器指令被处理，Docker就不再寻找解析器指令。相反，它将格式化为解析器指令的任何东西都视为注释，并且不尝试验证它是否可能是解析器指令。<br> 因此，所有解析器指令都必须位于Dockerfile的最顶端。解析器指令不区分大小写。然而，习惯上它们都是小写的。约定还包括任何解析器指令后面的空行。解析器指令不支持行延续字符。<br> 一下指令是允许的<br> <figure class="highlight vala hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> escape</span><br><span class="line"><span class="hljs-meta"># escape=\ (backslash)</span></span><br><span class="line">Or</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta"># escape=` (backtick)</span></span><br></pre></td></tr></table></figure></p>
<h4 id="环境替换"><a href="#环境替换" class="headerlink" title="环境替换"></a>环境替换</h4><p>环境变量(用ENV语句声明)也可以在某些指令中用作Dockerfile要解释的变量。转义还处理将类似变量的语法按字面意思包含到语句中。</p>
<p>环境变量在Dockerfile中以$变量名 或 ${变量名} 标注。它们被同等对待，大括号语法通常用于处理变量名没有空格的问题，比如${foo} bar。</p>
<p>${variable_name}语法还支持以下指定的几个标准bash修饰符${Z}表示，如果设置了变量，那么结果将是该值。如果没有设置变量，那么word将是结果。${variable:+word}表示如果设置了变量，那么word将是结果，否则结果是空字符串。在所有情况下，word可以是任何字符串，包括附加的环境变量。<br>可以通过在变量前面添加\来转义:例如，$foo或${foo}将分别转换为$foo和${foo}文本。</p>
<p>举个例子：（#后表示解析后的结果）</p>
<figure class="highlight dockerfile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">FROM</span> busybox</span><br><span class="line"><span class="hljs-keyword">ENV</span> foo /bar</span><br><span class="line"><span class="hljs-keyword">WORKDIR</span><span class="hljs-bash"> <span class="hljs-variable">$&#123;foo&#125;</span>   <span class="hljs-comment"># WORKDIR /bar</span></span></span><br><span class="line"><span class="hljs-keyword">ADD</span><span class="hljs-bash"> . <span class="hljs-variable">$foo</span>       <span class="hljs-comment"># ADD . /bar</span></span></span><br><span class="line"><span class="hljs-keyword">COPY</span><span class="hljs-bash"> \<span class="hljs-variable">$foo</span> /quux <span class="hljs-comment"># COPY $foo /quux</span></span></span><br></pre></td></tr></table></figure>

<p>Dockerfile中以下环境变量是被允许的：</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ADD</span><br><span class="line">COPY</span><br><span class="line">ENV</span><br><span class="line">EXPOSE</span><br><span class="line"><span class="hljs-keyword">FROM</span></span><br><span class="line">LABEL</span><br><span class="line">STOPSIGNAL</span><br><span class="line">USER</span><br><span class="line">VOLUME</span><br><span class="line">WORKDIR</span><br><span class="line">ONBUILD(1.4之后支持)</span><br></pre></td></tr></table></figure>

<p>环境变量替换将在整个指令中对每个变量使用相同的值</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ENV <span class="hljs-attribute">abc</span>=hello</span><br><span class="line">ENV <span class="hljs-attribute">abc</span>=bye <span class="hljs-attribute">def</span>=<span class="hljs-variable">$abc</span></span><br><span class="line">ENV <span class="hljs-attribute">ghi</span>=<span class="hljs-variable">$abc</span></span><br></pre></td></tr></table></figure>

<p>将导致def的值为hello，而不是bye。但是，ghi将有一个值bye，因为它不是将abc设置为bye的同一条指令的一部分。</p>
<h4 id="dockerignore-file"><a href="#dockerignore-file" class="headerlink" title=".dockerignore file"></a>.dockerignore file</h4><p>在docker CLI将上下文发送到docker守护进程之前，它在上下文的根目录中查找一个名为.dockerignore的文件。如果该文件存在，CLI将修改上下文，以排除匹配其中模式的文件和目录。这有助于避免不必要地向守护进程发送大型或敏感的文件和目录，并可能使用ADD或COPY将它们添加到镜像中</p>
<p>CLI将.dockerignore文件解释为一个新行分隔的模式列表，类似于Unix shell的文件globs。为了进行匹配，上下文的根被认为是工作目录和根目录。例子：</p>
<figure class="highlight markdown hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-section"># comment</span></span><br><span class="line"><span class="hljs-emphasis">*/temp*</span></span><br><span class="line"><span class="hljs-emphasis">*/*</span>/temp*</span><br><span class="line">temp?</span><br></pre></td></tr></table></figure>

<p>This file causes the following build behavior:</p>
<table>
<thead>
<tr>
<th align="left">Rule</th>
<th align="left">Behavior</th>
</tr>
</thead>
<tbody><tr>
<td align="left"># comment</td>
<td align="left">Ignored.</td>
</tr>
<tr>
<td align="left"><em>/temp</em></td>
<td align="left">Exclude files and directories whose names start with temp in any immediate subdirectory of the root. For example, the plain file /somedir/temporary.txt is excluded, as is the directory /somedir/temp.</td>
</tr>
<tr>
<td align="left"><em>/</em>/temp*</td>
<td align="left">Exclude files and directories starting with temp from any subdirectory that is two levels below the root. For example, /somedir/subdir/temporary.txt is excluded.</td>
</tr>
<tr>
<td align="left">temp?</td>
<td align="left">Exclude files and directories in the root directory whose names are a one-character extension of temp. For example, /tempa and /tempb are excluded.</td>
</tr>
</tbody></table>
<p>匹配是使用Go’s filepath完成的。匹配规则。预处理步骤删除前导和后置空格并消除.和. .使用Go’s filepath.Clean的元素。预处理后为空的行将被忽略。<br>超越Go’s filepath。匹配规则Docker还支持一个特殊的通配符字符串**，它匹配任意数量的目录(包括0),例如 **/*.go将排除在所有目录中以.go结尾的所有文件，包括构建上下文的根目录。<br>以!(感叹号)开头可以用来排除例外。下面是一个使用此机制的.dockerignore文件示例</p>
<figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*<span class="hljs-selector-class">.md</span></span><br><span class="line">!<span class="hljs-selector-tag">README</span><span class="hljs-selector-class">.md</span></span><br></pre></td></tr></table></figure>

<p>所有的标记文件被排除在上下文之外，除了README.md。<br>!的位置异常规则影响行为:.dockerignore中匹配特定文件的最后一行决定是否包含或排除该文件。考虑下面的例子</p>
<figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    *.md</span><br><span class="line">README-secret.md</span><br><span class="line">!README*.md</span><br></pre></td></tr></table></figure>

<p>所有的README文件都包括在内。中间的行没有效果，因为!README*.md匹配 README-secret。而且在最后一行。<br>您甚至可以使用.dockerignore文件来排除Dockerfile和.dockerignore文件。这些文件仍然被发送到守护进程，因为守护进程需要它们来完成它的工作。但是添加和复制指令不会将它们复制到镜像中。</p>
<p>最后，您可能希望指定要在上下文中包含哪些文件，而不是要排除哪些文件。要实现这一点，请将*指定为第一个模式(把<em>.md它放在前面)，然后是一个或多个模式 !异常模式（!README</em>.md放在后面）。</p>
<h4 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h4><figure class="highlight sqf hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">FROM</span> &lt;<span class="hljs-built_in">image</span>&gt; [AS &lt;<span class="hljs-built_in">name</span>&gt;]</span><br><span class="line"><span class="hljs-built_in">Or</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">FROM</span> &lt;<span class="hljs-built_in">image</span>&gt;[:&lt;tag&gt;] [AS &lt;<span class="hljs-built_in">name</span>&gt;]</span><br><span class="line"><span class="hljs-built_in">Or</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">FROM</span> &lt;<span class="hljs-built_in">image</span>&gt;[@&lt;digest&gt;] [AS &lt;<span class="hljs-built_in">name</span>&gt;]</span><br></pre></td></tr></table></figure>

<p>FROM指令初始化一个新的构建阶段，并为后续指令设置基本镜像。因此，一个有效的Dockerfile必须从FROM指令开始。镜像可以是任何有效的镜像，这是特别容易的从公共仓库拉一个镜像开始<br>ARG是Dockerfile中唯一可能在前面的指令。参见了解ARG和FROM如何交互。</p>
<p>FROM可以在一个Dockerfile中出现多次，以创建多个镜像，或者使用一个构建阶段作为另一个构建阶段的依赖项。只需在每条新的FROM指令之前，记录提交最后一个镜像ID。每个FROM指令清除以前的指令创建的任何状态。</p>
<p>可以通过<code>AS名称</code> 添加到<code>FROM</code>指令中，为新的构建阶段指定一个名称。可以在后续FROM和<code>COPY——FROM =&lt;name|index&gt;</code>指令中使用该名称，以引用此阶段构建的镜像。</p>
<p><code>tag</code>标记或<code>digest</code>摘要值是可选的。如果您省略了它们中的任何一个，构建器将默认使用最新的标记。如果构建器无法找到标记值，则返回一个错误。  </p>
<p>理解ARG和FROM之间是如何交互的</p>
<p>FROM指令支持由第一个FROM之前的任何ARG指令声明的变量。</p>
<figure class="highlight dockerfile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">ARG</span>  CODE_VERSION=latest</span><br><span class="line"><span class="hljs-keyword">FROM</span> base:$&#123;CODE_VERSION&#125;</span><br><span class="line"><span class="hljs-keyword">CMD</span><span class="hljs-bash">  /code/run-app</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">FROM</span> extras:$&#123;CODE_VERSION&#125;</span><br><span class="line"><span class="hljs-keyword">CMD</span><span class="hljs-bash">  /code/run-extras</span></span><br></pre></td></tr></table></figure>

<p>在FROM之前声明的ARG位于构建阶段之外，因此不能在FROM之后的任何指令中使用它。若要使用第一个FROM之前声明的ARG的默认值，请使用构建阶段中没有值的ARG指令<br> To use the default value of an ARG declared before the first FROM use an ARG instruction without a value inside of a build stage:</p>
<figure class="highlight dockerfile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">ARG</span> VERSION=latest</span><br><span class="line"><span class="hljs-keyword">FROM</span> busybox:$VERSION</span><br><span class="line"><span class="hljs-keyword">ARG</span> VERSION</span><br><span class="line"><span class="hljs-keyword">RUN</span><span class="hljs-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$VERSION</span> &gt; image_version</span></span><br></pre></td></tr></table></figure>

<p>RUN<br>run有两中形式：</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-builtin-name">RUN</span> &lt;command&gt; (shell form, the command is <span class="hljs-builtin-name">run</span> <span class="hljs-keyword">in</span> a shell, which by<span class="hljs-built_in"> default </span>is /bin/sh -c on Linux <span class="hljs-keyword">or</span> cmd /S /C on Windows)</span><br><span class="line"><span class="hljs-builtin-name">RUN</span> [<span class="hljs-string">"executable"</span>, <span class="hljs-string">"param1"</span>, <span class="hljs-string">"param2"</span>] (exec form)</span><br></pre></td></tr></table></figure>

<p>RUN指令将在当前映像之上的新层中执行任何命令并提交结果。生成的提交映像将用于Dockerfile中的下一步。<br>分层运行指令和生成提交符合Docker的核心概念，其中提交很便宜，可以从镜像历史中的任何位置创建容器，就像源代码控制一样。<br>exec形式可以避免shell字符串阻塞，并使用不包含指定的shell可执行文件的基本镜像运行命令。<br>可以使用shell命令更改shell形式的默认shell。<br>在shell形式中，您可以使用(反斜杠)将单个运行指令延续到下一行</p>
<figure class="highlight nginx hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-attribute">RUN</span> /bin/bash -c <span class="hljs-string">'source <span class="hljs-variable">$HOME</span>/.bashrc; \</span></span><br><span class="line"><span class="hljs-string">echo <span class="hljs-variable">$HOME</span>'</span></span><br></pre></td></tr></table></figure>

<p>它们加起来等于这一行<br><code>RUN /bin/bash -c &#39;source $HOME/.bashrc; echo $HOME&#39;</code><br>注意:与shell不同，exec不调用命令shell。这意味着不会发生正常的shell处理。例如，<code>RUN [&quot;echo&quot;， &quot;$HOME&quot;]</code>不会对$HOME执行变量替换。如果您想要shell处理，那么要么使用shell表单，要么直接执行shell，<code>RUN [ &quot;sh&quot;, &quot;-c&quot;, &quot;echo $HOME&quot; ]</code><br>当使用exec并直接执行shell时(就像shell的情况一样)，执行环境变量展开的是shell，而不是docker。<br>在JSON格式中，有必要转义反斜杠<br>这在以反斜杠作为路径分隔符的窗口中特别相关。否则，由于不是有效的JSON，以下行将被视为shell形式，并以一种意外的方式失败:<code>RUN [&quot;c:\windows\system32\tasklist.exe&quot;]</code>这个例子的正确语法是<code>RUN [&quot;c:\\windows\\system32\\tasklist.exe&quot;]</code><br>运行指令的缓存不会在下一次构建期间自动失效。像RUN apt-get distd -upgrade -y这样的指令的缓存将在下一个构建过程中重用。运行指令的缓存可以通过使用–no-cache来失效<br>for example <code>docker build --no-cache</code><br>运行指令的缓存可以通过添加指令失效。详见下文。  </p>
<p>CMD<br>有三种格式：</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CMD [<span class="hljs-string">"executable"</span>,<span class="hljs-string">"param1"</span>,<span class="hljs-string">"param2"</span>] (exec form, this is the preferred form)</span><br><span class="line">CMD [<span class="hljs-string">"param1"</span>,<span class="hljs-string">"param2"</span>] (as<span class="hljs-built_in"> default </span>parameters <span class="hljs-keyword">to</span> ENTRYPOINT)</span><br><span class="line">CMD command param1 param2 (shell form)</span><br></pre></td></tr></table></figure>

<p>Dockerfile中只能有一条CMD指令。如果您列出一个以上的CMD，那么只有最后一个CMD将生效<br>CMD的主要目的是为执行容器提供默认值。这些默认值可以包括可执行文件，也可以省略可执行文件，在这种情况下，还必须指定一个入口点指令。<br>注意:如果CMD用于为ENTRYPOINT指令提供默认参数，那么CMD和ENTRYPOINT指令都应该使用JSON数组格式指定。<br>注意:exec表单被解析为JSON数组，这意味着必须在单词周围使用双引号(“)，而不是单引号(‘)。<br>与shell不同，exec不调用命令shell。这意味着不会发生正常的shell处理。例如，<code>CMD [&quot;echo&quot;， &quot;$HOME&quot;]</code>不会对$HOME执行变量替换。如果您想要shell处理，那么要么使用shell表单，要么直接执行shell.例如<code>CMD [ &quot;sh&quot;, &quot;-c&quot;, &quot;echo $HOME&quot; ]</code></p>
<p>当使用exec并直接执行shell时(就像shell的情况一样)，执行环境变量展开的是shell，而不是docker。<br>当在shell或exec格式中使用时，CMD指令设置要在运行镜像时执行的命令。<br>如果使用CMD的shell形式，那么&lt;命令&gt;将在<code>/bin/sh -c</code>中执行</p>
<figure class="highlight dockerfile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">FROM</span> ubuntu</span><br><span class="line"><span class="hljs-keyword">CMD</span><span class="hljs-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">"This is a test."</span> | wc -</span></span><br></pre></td></tr></table></figure>

<p>如果您想在没有shell的情况下运行<code>&lt;command&gt;</code>，那么必须将该命令表示为JSON数组，并给出可执行文件的完整路径。这种数组形式是CMD的首选格式。任何附加参数都必须单独表示为字符串</p>
<figure class="highlight dockerfile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">FROM</span> ubuntu</span><br><span class="line"><span class="hljs-keyword">CMD</span><span class="hljs-bash"> [<span class="hljs-string">"/usr/bin/wc"</span>,<span class="hljs-string">"--help"</span>]</span></span><br></pre></td></tr></table></figure>

<p>如果您希望您的容器每次运行相同的可执行文件，那么您应该考虑将ENTRYPOINT与CMD结合使用。看到入口点。</p>
<p>如果用户指定要运行docker run的参数，那么它们将覆盖CMD中指定的默认值</p>
<p><strong>注意:不要将RUN与CMD混淆。RUN实际运行命令并提交结果;CMD在构建时不执行任何操作，但是为镜像指定了预期的命令。</strong></p>
<p>LABEL<br><code>LABEL &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...</code><br>标签指令向镜像添加元数据。标签是键值对。要在标签值中包含空格，可以像在命令行解析中那样使用引号和反斜杠。一些使用示例</p>
<figure class="highlight dockerfile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">LABEL</span><span class="hljs-bash"> <span class="hljs-string">"com.example.vendor"</span>=<span class="hljs-string">"ACME Incorporated"</span></span></span><br><span class="line"><span class="hljs-keyword">LABEL</span><span class="hljs-bash"> com.example.label-with-value=<span class="hljs-string">"foo"</span></span></span><br><span class="line"><span class="hljs-keyword">LABEL</span><span class="hljs-bash"> version=<span class="hljs-string">"1.0"</span></span></span><br><span class="line"><span class="hljs-keyword">LABEL</span><span class="hljs-bash"> description=<span class="hljs-string">"This text illustrates \</span></span></span><br><span class="line"><span class="hljs-bash">that label-values can span multiple lines.<span class="hljs-string">"</span></span></span><br></pre></td></tr></table></figure>

<p>一个镜像可以有多个标签。要指定多个标签，Docker建议在可能的情况下将标签组合成单个标签指令。每条标签指令都会生成一个新层，如果使用多个标签，则会导致图镜像效率低下<br><code>LABEL multi.label1=&quot;value1&quot; multi.label2=&quot;value2&quot; other=&quot;value3&quot;</code><br>也可以写成</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LABEL multi.<span class="hljs-attribute">label1</span>=<span class="hljs-string">"value1"</span> \</span><br><span class="line">      multi.<span class="hljs-attribute">label2</span>=<span class="hljs-string">"value2"</span> \</span><br><span class="line">      <span class="hljs-attribute">other</span>=<span class="hljs-string">"value3"</span></span><br></pre></td></tr></table></figure>

<p>标签是附加的，包括来自镜像的标签。<br>要查看镜像的标签，请使用<code>docker inspect</code>命令。</p>
<figure class="highlight 1c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">"Labels"</span>: &#123;</span><br><span class="line">    <span class="hljs-string">"com.example.vendor"</span>: <span class="hljs-string">"ACME Incorporated"</span></span><br><span class="line">    <span class="hljs-string">"com.example.label-with-value"</span>: <span class="hljs-string">"foo"</span>,</span><br><span class="line">    <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0"</span>,</span><br><span class="line">    <span class="hljs-string">"description"</span>: <span class="hljs-string">"This text illustrates that label-values can span multiple lines."</span>,</span><br><span class="line">    <span class="hljs-string">"multi.label1"</span>: <span class="hljs-string">"value1"</span>,</span><br><span class="line">    <span class="hljs-string">"multi.label2"</span>: <span class="hljs-string">"value2"</span>,</span><br><span class="line">    <span class="hljs-string">"other"</span>: <span class="hljs-string">"value3"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>MAINTAINER (deprecated) 过时<br><code>MAINTAINER &lt;name&gt;</code><br><code>LABEL maintainer=&quot;SvenDowideit@home.org.au&quot;</code><br>EXPOSE<br><code>EXPOSE &lt;port&gt; [&lt;port&gt;/&lt;protocol&gt;...]</code><br>ENV  </p>
<figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ENV <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span></span><br><span class="line">ENV <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>=<span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span> ...</span><br></pre></td></tr></table></figure>

<p>ENV指令将环境变量<code>&lt;key&gt;</code>设置为值<code>&lt;value&gt;</code>。此值将位于所有Dockerfile后代命令的环境中，并且可以在许多命令中内联替换。</p>
<p>ENV指令有两种形式。第一种形式<code>ENV &lt;key&gt; &lt;value&gt;</code>将把单个变量设置为一个值。第一个空格之后的整个字符串将被视为<code>&lt;value&gt;</code>—包括空格和引号等字符。</p>
<p>第二种形式是<code>ENV &lt;key&gt;=&lt;value&gt;…</code>，允许一次设置多个变量。注意，第二种形式在语法中使用等号(=)，而第一种形式没有。与命令行解析类似，可以使用引号和反斜杠在值中包含空格。</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ENV <span class="hljs-attribute">myName</span>=<span class="hljs-string">"John Doe"</span> <span class="hljs-attribute">myDog</span>=Rex\ The\ Dog \</span><br><span class="line">    <span class="hljs-attribute">myCat</span>=fluffy</span><br></pre></td></tr></table></figure>

<p>AND</p>
<figure class="highlight dockerfile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">ENV</span> myName John Doe</span><br><span class="line"><span class="hljs-keyword">ENV</span> myDog Rex The Dog</span><br><span class="line"><span class="hljs-keyword">ENV</span> myCat fluffy</span><br></pre></td></tr></table></figure>

<p>将在最终镜像中生成相同的净结果，但首选第一种形式，因为它生成一个缓存层。</p>
<p>当容器从生成的映像运行时，使用ENV设置的环境变量将保持不变。您可以使用<code>docker inspect</code>查看这些值，并使用<code>docker run——env &lt;key&gt;=&lt;value&gt;</code>更改它们。</p>
<p>ADD<br>ADD有两种形式：</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-builtin-name">ADD</span> &lt;src&gt;<span class="hljs-built_in">..</span>. &lt;dest&gt;</span><br><span class="line"><span class="hljs-builtin-name">ADD</span> [<span class="hljs-string">"&lt;src&gt;"</span>,<span class="hljs-built_in">..</span>. <span class="hljs-string">"&lt;dest&gt;"</span>] (this form is required <span class="hljs-keyword">for</span> paths containing whitespace)</span><br></pre></td></tr></table></figure>

<p>ADD指令从<code>&lt;src&gt;</code>复制新的文件、目录或远程文件url，并将它们添加到路径<code>&lt;dest&gt;</code>的映像文件系统中<br>可以指定多个<code>&lt;src&gt;</code>资源，但如果它们是文件或目录，则必须相对于正在构建的源目录(构建的上下文)。<br>每个<code>&lt;src&gt;</code>可能包含通配符，匹配将使用Go’s filepath完成。匹配规则。例如</p>
<figure class="highlight dockerfile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">ADD</span><span class="hljs-bash"> hom* /mydir/        <span class="hljs-comment"># adds all files starting with "hom"</span></span></span><br><span class="line"><span class="hljs-keyword">ADD</span><span class="hljs-bash"> hom?.txt /mydir/    <span class="hljs-comment"># ? is replaced with any single character, e.g., "home.txt"</span></span></span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">`&lt;dest&gt;`是绝对路径，或相对于<span class="hljs-keyword">WORKDIR</span><span class="hljs-bash">的路径，源文件将复制到目标容器中。</span></span><br></pre></td></tr></table></figure>

<p>ADD test relativeDir/          # adds “test” to <code>WORKDIR</code>/relativeDir/<br>ADD test /absoluteDir/         # adds “test” to /absoluteDir/</p>
<figure class="highlight autohotkey hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">当添加包含特殊字符(如`[<span class="hljs-literal">and</span>]`)的文件或目录时，需要转义那些遵循Golang规则的路径，以防止将它们视为匹配模式。例如，添加一个名为`arr[<span class="hljs-number">0</span>].txt`的文件。  </span><br><span class="line">`ADD arr[[]<span class="hljs-number">0</span>].txt /mydir/    # copy <span class="hljs-literal">a</span> file named <span class="hljs-string">"arr[0].txt"</span> to /mydir/`</span><br><span class="line"></span><br><span class="line">所有新文件和目录都是用UID和GID为<span class="hljs-number">0</span>创建的。</span><br><span class="line">在`&lt;src&gt;`是远程文件URL的情况下，目标的权限将为<span class="hljs-number">600</span>。如果正在检索的远程文件具有HTTP Last-Modified头，则来自该头的时间戳将用于设置目标文件的时间。然而,与添加过程中处理的任何其他文件一样，在确定文件是否更改、缓存是否应该更新时，并不包括mtime。</span><br><span class="line"></span><br><span class="line">COPY</span><br><span class="line"><span class="hljs-symbol">COPY 有两种形式:</span></span><br></pre></td></tr></table></figure>

<p>COPY <src>… <dest><br>COPY [“<src>“,… “<dest>“] (this form is required for paths containing whitespace)</dest></src></dest></src></p>
<figure class="highlight autohotkey hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">每个`&lt;src&gt;`可能包含通配符，匹配将使用Go's filepath完成。匹配规则。例如</span><br></pre></td></tr></table></figure>

<p>COPY hom* /mydir/        # adds all files starting with “hom”<br>COPY hom?.txt /mydir/    # ? is replaced with any single character, e.g., “home.txt”</p>
<figure class="highlight autohotkey hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`&lt;dest&gt;`是绝对路径，或相对于WORKDIR的路径，源文件将复制到目标容器中。</span><br></pre></td></tr></table></figure>

<p>COPY test relativeDir/   # adds “test” to <code>WORKDIR</code>/relativeDir/<br>COPY test /absoluteDir/  # adds “test” to /absoluteDir/</p>
<figure class="highlight dockerfile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">ENTRYPOINT</span><span class="hljs-bash"></span></span><br><span class="line"><span class="hljs-bash">ENTRYPOINT 有两种形式:</span></span><br></pre></td></tr></table></figure>

<p>ENTRYPOINT [“executable”, “param1”, “param2”] (exec form, preferred)<br>ENTRYPOINT command param1 param2 (shell form)</p>
<figure class="highlight autohotkey hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">入口点允许您配置容器作为可执行文件运行。</span><br><span class="line">`docker run -i -t --rm -p <span class="hljs-number">80</span>:<span class="hljs-number">80</span> nginx`</span><br><span class="line"></span><br><span class="line">VOLUME</span><br><span class="line">`VOLUME [<span class="hljs-string">"/data"</span>]`</span><br><span class="line">卷指令创建具有指定名称的挂载点，并将其标记为持有来自本机主机或其他容器的外部挂载卷。值可以是个json数组`VOLUME [<span class="hljs-string">"/var/log/"</span>]`,或具有多个参数的纯字符串，例如`VOLUME /var/log`或者`VOLUME /var/log /var/db`</span><br><span class="line">docker run命令使用存在于基本映像中指定位置的任何数据初始化新创建的卷。例如，考虑下面的Dockerfile片段</span><br></pre></td></tr></table></figure>

<p>FROM ubuntu<br>RUN mkdir /myvol<br>RUN echo “hello world” &gt; /myvol/greeting<br>VOLUME /myvol</p>
<figure class="highlight dockerfile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-keyword">USER</span></span><br></pre></td></tr></table></figure>

<p>USER <user>[:<group>] or<br>USER <uid>[:<gid>]</gid></uid></group></user></p>
<figure class="highlight livecodeserver hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">用户指令设置用户名(或UID)和可选的用户组(或GID)，以便在运行镜像时使用，以及在Dockerfile中对其后面的任何运行、CMD和ENTRYPOINT指令进行设置。</span><br><span class="line">警告:当用户没有主组时，映像(或下一个指令)将与根组一起运行。</span><br><span class="line">WORKDIR</span><br><span class="line">`WORKDIR /path/<span class="hljs-built_in">to</span>/workdir`</span><br><span class="line">The WORKDIR instruction sets <span class="hljs-keyword">the</span> working <span class="hljs-built_in">directory</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">any</span> RUN, CMD, ENTRYPOINT, COPY <span class="hljs-keyword">and</span> ADD instructions that follow <span class="hljs-keyword">it</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> Dockerfile. If <span class="hljs-keyword">the</span> WORKDIR doesn’t exist, <span class="hljs-keyword">it</span> will be created even <span class="hljs-keyword">if</span> <span class="hljs-keyword">it</span>’s <span class="hljs-keyword">not</span> used <span class="hljs-keyword">in</span> <span class="hljs-keyword">any</span> subsequent Dockerfile instruction.</span><br><span class="line"></span><br><span class="line">The WORKDIR instruction can be used multiple times <span class="hljs-keyword">in</span> <span class="hljs-keyword">a</span> Dockerfile. If <span class="hljs-keyword">a</span> <span class="hljs-built_in">relative</span> path is provided, <span class="hljs-keyword">it</span> will be <span class="hljs-built_in">relative</span> <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> path <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> previous WORKDIR instruction. For example:</span><br></pre></td></tr></table></figure>

<p>WORKDIR /a<br>WORKDIR b<br>WORKDIR c<br>RUN pwd</p>
<figure class="highlight livecodeserver hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The output <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> final pwd <span class="hljs-keyword">command</span> <span class="hljs-title">in</span> <span class="hljs-title">this</span> <span class="hljs-title">Dockerfile</span> <span class="hljs-title">would</span> <span class="hljs-title">be</span> /<span class="hljs-title">a</span>/<span class="hljs-title">b</span>/<span class="hljs-title">c</span>.</span><br><span class="line"></span><br><span class="line">The WORKDIR instruction can <span class="hljs-built_in">resolve</span> environment variables previously <span class="hljs-built_in">set</span> <span class="hljs-keyword">using</span> ENV. You can only use environment variables explicitly <span class="hljs-built_in">set</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> Dockerfile. For example:</span><br></pre></td></tr></table></figure>

<p>ENV DIRPATH /path<br>WORKDIR $DIRPATH/$DIRNAME<br>RUN pwd</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">The output of the final pwd command <span class="hljs-keyword">in</span> this Dockerfile would be /path/<span class="hljs-variable">$DIRNAME</span></span><br><span class="line"></span><br><span class="line">ARG</span><br><span class="line">`ARG &lt;name&gt;[=&lt;default value&gt;]`</span><br><span class="line">The ARG instruction defines a variable that<span class="hljs-built_in"> users </span>can pass at build-time <span class="hljs-keyword">to</span> the builder with the docker build command using the --build-arg &lt;varname&gt;=&lt;value&gt; flag. <span class="hljs-keyword">If</span> a<span class="hljs-built_in"> user </span>specifies a build argument that was <span class="hljs-keyword">not</span> defined <span class="hljs-keyword">in</span> the Dockerfile, the build outputs a warning.</span><br><span class="line"></span><br><span class="line">[<span class="hljs-builtin-name">Warning</span>] One <span class="hljs-keyword">or</span> more build-args [foo] were <span class="hljs-keyword">not</span> consumed.</span><br><span class="line">A Dockerfile may include one <span class="hljs-keyword">or</span> more ARG instructions. <span class="hljs-keyword">For</span> example, the following is a valid Dockerfile:</span><br></pre></td></tr></table></figure>

<p>FROM busybox<br>ARG user1<br>ARG buildno<br>…</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Warning: It is <span class="hljs-keyword">not</span> recommended <span class="hljs-keyword">to</span> use build-time variables <span class="hljs-keyword">for</span> passing secrets like github keys,<span class="hljs-built_in"> user </span>credentials etc. Build-time variable values are visible <span class="hljs-keyword">to</span> any<span class="hljs-built_in"> user </span>of the image with the docker history command.</span><br><span class="line"></span><br><span class="line">Default values</span><br><span class="line">An ARG instruction can optionally include a<span class="hljs-built_in"> default </span>value:</span><br></pre></td></tr></table></figure>

<p>FROM busybox<br>ARG user1=someuser<br>ARG buildno=1<br>…</p>
<figure class="highlight sql hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line">If an ARG instruction has a default value and if there is no value passed at build-time, the builder uses the default.</span><br><span class="line">Scope</span><br><span class="line">An ARG variable definition comes into effect from the line on which it is defined in the Dockerfile not from the argument’s <span class="hljs-keyword">use</span> <span class="hljs-keyword">on</span> the command-line <span class="hljs-keyword">or</span> elsewhere. <span class="hljs-keyword">For</span> example, <span class="hljs-keyword">consider</span> this Dockerfile:</span><br><span class="line"></span><br><span class="line"><span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> busybox</span><br><span class="line"><span class="hljs-number">2</span> <span class="hljs-keyword">USER</span> $&#123;<span class="hljs-keyword">user</span>:-some_user&#125;</span><br><span class="line"><span class="hljs-number">3</span> ARG <span class="hljs-keyword">user</span></span><br><span class="line"><span class="hljs-number">4</span> <span class="hljs-keyword">USER</span> $<span class="hljs-keyword">user</span></span><br><span class="line">...</span><br><span class="line">A <span class="hljs-keyword">user</span> builds this <span class="hljs-keyword">file</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">calling</span>:</span><br><span class="line"></span><br><span class="line">$ docker <span class="hljs-keyword">build</span> <span class="hljs-comment">--build-arg user=what_user .</span></span><br><span class="line">The <span class="hljs-keyword">USER</span> <span class="hljs-keyword">at</span> line <span class="hljs-number">2</span> evaluates <span class="hljs-keyword">to</span> some_user <span class="hljs-keyword">as</span> the <span class="hljs-keyword">user</span> <span class="hljs-keyword">variable</span> <span class="hljs-keyword">is</span> defined <span class="hljs-keyword">on</span> the subsequent line <span class="hljs-number">3.</span> The <span class="hljs-keyword">USER</span> <span class="hljs-keyword">at</span> line <span class="hljs-number">4</span> evaluates <span class="hljs-keyword">to</span> what_user <span class="hljs-keyword">as</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">is</span> defined <span class="hljs-keyword">and</span> the what_user <span class="hljs-keyword">value</span> was passed <span class="hljs-keyword">on</span> the command line. <span class="hljs-keyword">Prior</span> <span class="hljs-keyword">to</span> its definition <span class="hljs-keyword">by</span> an ARG instruction, <span class="hljs-keyword">any</span> <span class="hljs-keyword">use</span> <span class="hljs-keyword">of</span> a <span class="hljs-keyword">variable</span> results <span class="hljs-keyword">in</span> an <span class="hljs-keyword">empty</span> string.</span><br><span class="line"></span><br><span class="line">An ARG instruction goes <span class="hljs-keyword">out</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">scope</span> <span class="hljs-keyword">at</span> the <span class="hljs-keyword">end</span> <span class="hljs-keyword">of</span> the <span class="hljs-keyword">build</span> stage <span class="hljs-keyword">where</span> it was defined. <span class="hljs-keyword">To</span> <span class="hljs-keyword">use</span> an arg <span class="hljs-keyword">in</span> multiple stages, <span class="hljs-keyword">each</span> stage must <span class="hljs-keyword">include</span> the ARG instruction.</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">FROM</span> busybox</span><br><span class="line">ARG <span class="hljs-keyword">SETTINGS</span></span><br><span class="line">RUN ./run/setup $<span class="hljs-keyword">SETTINGS</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">FROM</span> busybox</span><br><span class="line">ARG <span class="hljs-keyword">SETTINGS</span></span><br><span class="line">RUN ./run/other $<span class="hljs-keyword">SETTINGS</span></span><br><span class="line"><span class="hljs-keyword">Using</span> ARG <span class="hljs-keyword">variables</span></span><br><span class="line">You can <span class="hljs-keyword">use</span> an ARG <span class="hljs-keyword">or</span> an ENV instruction <span class="hljs-keyword">to</span> specify <span class="hljs-keyword">variables</span> that <span class="hljs-keyword">are</span> available <span class="hljs-keyword">to</span> the RUN instruction. Environment <span class="hljs-keyword">variables</span> defined <span class="hljs-keyword">using</span> the ENV instruction <span class="hljs-keyword">always</span> override an ARG instruction <span class="hljs-keyword">of</span> the same name. <span class="hljs-keyword">Consider</span> this Dockerfile <span class="hljs-keyword">with</span> an ENV <span class="hljs-keyword">and</span> ARG instruction.</span><br><span class="line"></span><br><span class="line"><span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> ubuntu</span><br><span class="line"><span class="hljs-number">2</span> ARG CONT_IMG_VER</span><br><span class="line"><span class="hljs-number">3</span> ENV CONT_IMG_VER v1<span class="hljs-number">.0</span><span class="hljs-number">.0</span></span><br><span class="line"><span class="hljs-number">4</span> RUN echo $CONT_IMG_VER</span><br><span class="line"><span class="hljs-keyword">Then</span>, assume this image <span class="hljs-keyword">is</span> built <span class="hljs-keyword">with</span> this command:</span><br><span class="line"></span><br><span class="line">$ docker <span class="hljs-keyword">build</span> <span class="hljs-comment">--build-arg CONT_IMG_VER=v2.0.1 .</span></span><br><span class="line"><span class="hljs-keyword">In</span> this <span class="hljs-keyword">case</span>, the RUN instruction uses v1<span class="hljs-number">.0</span><span class="hljs-number">.0</span> instead <span class="hljs-keyword">of</span> the ARG setting passed <span class="hljs-keyword">by</span> the <span class="hljs-keyword">user</span>:v2<span class="hljs-number">.0</span><span class="hljs-number">.1</span> This behavior <span class="hljs-keyword">is</span> similar <span class="hljs-keyword">to</span> a shell script <span class="hljs-keyword">where</span> a locally scoped <span class="hljs-keyword">variable</span> overrides the <span class="hljs-keyword">variables</span> passed <span class="hljs-keyword">as</span> arguments <span class="hljs-keyword">or</span> inherited <span class="hljs-keyword">from</span> environment, <span class="hljs-keyword">from</span> its point <span class="hljs-keyword">of</span> definition.</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">Using</span> the example above but a different ENV specification you can <span class="hljs-keyword">create</span> more useful interactions <span class="hljs-keyword">between</span> ARG <span class="hljs-keyword">and</span> ENV instructions:</span><br><span class="line"></span><br><span class="line"><span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> ubuntu</span><br><span class="line"><span class="hljs-number">2</span> ARG CONT_IMG_VER</span><br><span class="line"><span class="hljs-number">3</span> ENV CONT_IMG_VER $&#123;CONT_IMG_VER:-v1<span class="hljs-number">.0</span><span class="hljs-number">.0</span>&#125;</span><br><span class="line"><span class="hljs-number">4</span> RUN echo $CONT_IMG_VER</span><br><span class="line">Unlike an ARG instruction, ENV <span class="hljs-keyword">values</span> <span class="hljs-keyword">are</span> <span class="hljs-keyword">always</span> persisted <span class="hljs-keyword">in</span> the built image. <span class="hljs-keyword">Consider</span> a docker <span class="hljs-keyword">build</span> <span class="hljs-keyword">without</span> the <span class="hljs-comment">--build-arg flag:</span></span><br><span class="line"></span><br><span class="line">$ docker <span class="hljs-keyword">build</span> .</span><br><span class="line"><span class="hljs-keyword">Using</span> this Dockerfile example, CONT_IMG_VER <span class="hljs-keyword">is</span> still persisted <span class="hljs-keyword">in</span> the image but its <span class="hljs-keyword">value</span> would be v1<span class="hljs-number">.0</span><span class="hljs-number">.0</span> <span class="hljs-keyword">as</span> it <span class="hljs-keyword">is</span> the <span class="hljs-keyword">default</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">in</span> line <span class="hljs-number">3</span> <span class="hljs-keyword">by</span> the ENV instruction.</span><br><span class="line"></span><br><span class="line">The <span class="hljs-keyword">variable</span> expansion technique <span class="hljs-keyword">in</span> this example allows you <span class="hljs-keyword">to</span> pass arguments <span class="hljs-keyword">from</span> the command line <span class="hljs-keyword">and</span> persist them <span class="hljs-keyword">in</span> the <span class="hljs-keyword">final</span> image <span class="hljs-keyword">by</span> leveraging the ENV instruction. <span class="hljs-keyword">Variable</span> expansion <span class="hljs-keyword">is</span> <span class="hljs-keyword">only</span> supported <span class="hljs-keyword">for</span> a limited <span class="hljs-keyword">set</span> <span class="hljs-keyword">of</span> Dockerfile instructions.</span><br><span class="line"></span><br><span class="line">Predefined ARGs</span><br><span class="line">Docker has a <span class="hljs-keyword">set</span> <span class="hljs-keyword">of</span> predefined ARG <span class="hljs-keyword">variables</span> that you can <span class="hljs-keyword">use</span> <span class="hljs-keyword">without</span> a <span class="hljs-keyword">corresponding</span> ARG instruction <span class="hljs-keyword">in</span> the Dockerfile.</span><br><span class="line"></span><br><span class="line">HTTP_PROXY</span><br><span class="line">http_proxy</span><br><span class="line">HTTPS_PROXY</span><br><span class="line">https_proxy</span><br><span class="line">FTP_PROXY</span><br><span class="line">ftp_proxy</span><br><span class="line">NO_PROXY</span><br><span class="line">no_proxy</span><br><span class="line"><span class="hljs-keyword">To</span> <span class="hljs-keyword">use</span> these, simply pass them <span class="hljs-keyword">on</span> the command line <span class="hljs-keyword">using</span> the flag:</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">--build-arg &lt;varname&gt;=&lt;value&gt;</span></span><br><span class="line"><span class="hljs-keyword">By</span> <span class="hljs-keyword">default</span>, these pre-defined <span class="hljs-keyword">variables</span> <span class="hljs-keyword">are</span> excluded <span class="hljs-keyword">from</span> the <span class="hljs-keyword">output</span> <span class="hljs-keyword">of</span> docker history. <span class="hljs-keyword">Excluding</span> them reduces the risk <span class="hljs-keyword">of</span> accidentally leaking sensitive <span class="hljs-keyword">authentication</span> information <span class="hljs-keyword">in</span> an HTTP_PROXY variable.</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">For</span> example, <span class="hljs-keyword">consider</span> building the <span class="hljs-keyword">following</span> Dockerfile <span class="hljs-keyword">using</span> <span class="hljs-comment">--build-arg HTTP_PROXY=http://user:pass@proxy.lon.example.com</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">FROM</span> ubuntu</span><br><span class="line">RUN echo <span class="hljs-string">"Hello World"</span></span><br><span class="line"><span class="hljs-keyword">In</span> this <span class="hljs-keyword">case</span>, the <span class="hljs-keyword">value</span> <span class="hljs-keyword">of</span> the HTTP_PROXY <span class="hljs-keyword">variable</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> available <span class="hljs-keyword">in</span> the docker history <span class="hljs-keyword">and</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> cached. <span class="hljs-keyword">If</span> you were <span class="hljs-keyword">to</span> <span class="hljs-keyword">change</span> location, <span class="hljs-keyword">and</span> your proxy <span class="hljs-keyword">server</span> <span class="hljs-keyword">changed</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">http</span>://<span class="hljs-keyword">user</span>:pass@proxy.sfo.example.com, a subsequent <span class="hljs-keyword">build</span> does <span class="hljs-keyword">not</span> <span class="hljs-keyword">result</span> <span class="hljs-keyword">in</span> a <span class="hljs-keyword">cache</span> miss.</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">If</span> you need <span class="hljs-keyword">to</span> override this behaviour <span class="hljs-keyword">then</span> you may <span class="hljs-keyword">do</span> so <span class="hljs-keyword">by</span> adding an ARG <span class="hljs-keyword">statement</span> <span class="hljs-keyword">in</span> the Dockerfile <span class="hljs-keyword">as</span> <span class="hljs-keyword">follows</span>:</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">FROM</span> ubuntu</span><br><span class="line">ARG HTTP_PROXY</span><br><span class="line">RUN echo <span class="hljs-string">"Hello World"</span></span><br><span class="line"><span class="hljs-keyword">When</span> building this Dockerfile, the HTTP_PROXY <span class="hljs-keyword">is</span> preserved <span class="hljs-keyword">in</span> the docker history, <span class="hljs-keyword">and</span> changing its <span class="hljs-keyword">value</span> invalidates the <span class="hljs-keyword">build</span> cache.</span><br><span class="line"></span><br><span class="line">Impact <span class="hljs-keyword">on</span> <span class="hljs-keyword">build</span> <span class="hljs-keyword">caching</span></span><br><span class="line">ARG <span class="hljs-keyword">variables</span> <span class="hljs-keyword">are</span> <span class="hljs-keyword">not</span> persisted <span class="hljs-keyword">into</span> the built image <span class="hljs-keyword">as</span> ENV <span class="hljs-keyword">variables</span> are. However, ARG <span class="hljs-keyword">variables</span> <span class="hljs-keyword">do</span> impact the <span class="hljs-keyword">build</span> <span class="hljs-keyword">cache</span> <span class="hljs-keyword">in</span> similar ways. <span class="hljs-keyword">If</span> a Dockerfile defines an ARG <span class="hljs-keyword">variable</span> whose <span class="hljs-keyword">value</span> <span class="hljs-keyword">is</span> different <span class="hljs-keyword">from</span> a previous <span class="hljs-keyword">build</span>, <span class="hljs-keyword">then</span> a “<span class="hljs-keyword">cache</span> miss” occurs upon its <span class="hljs-keyword">first</span> <span class="hljs-keyword">usage</span>, <span class="hljs-keyword">not</span> its definition. <span class="hljs-keyword">In</span> particular, <span class="hljs-keyword">all</span> RUN instructions <span class="hljs-keyword">following</span> an ARG instruction <span class="hljs-keyword">use</span> the ARG <span class="hljs-keyword">variable</span> implicitly (<span class="hljs-keyword">as</span> an environment <span class="hljs-keyword">variable</span>), thus can cause a <span class="hljs-keyword">cache</span> miss. <span class="hljs-keyword">All</span> predefined ARG <span class="hljs-keyword">variables</span> <span class="hljs-keyword">are</span> <span class="hljs-keyword">exempt</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">caching</span> unless there <span class="hljs-keyword">is</span> a matching ARG <span class="hljs-keyword">statement</span> <span class="hljs-keyword">in</span> the Dockerfile.</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">For</span> example, <span class="hljs-keyword">consider</span> these two Dockerfile:</span><br><span class="line"></span><br><span class="line"><span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> ubuntu</span><br><span class="line"><span class="hljs-number">2</span> ARG CONT_IMG_VER</span><br><span class="line"><span class="hljs-number">3</span> RUN echo $CONT_IMG_VER</span><br><span class="line"><span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> ubuntu</span><br><span class="line"><span class="hljs-number">2</span> ARG CONT_IMG_VER</span><br><span class="line"><span class="hljs-number">3</span> RUN echo hello</span><br><span class="line"><span class="hljs-keyword">If</span> you specify <span class="hljs-comment">--build-arg CONT_IMG_VER=&lt;value&gt; on the command line, in both cases, the specification on line 2 does not cause a cache miss; line 3 does cause a cache miss.ARG CONT_IMG_VER causes the RUN line to be identified as the same as running CONT_IMG_VER=&lt;value&gt; echo hello, so if the &lt;value&gt; changes, we get a cache miss.</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">Consider</span> another example <span class="hljs-keyword">under</span> the same command line:</span><br><span class="line"></span><br><span class="line"><span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> ubuntu</span><br><span class="line"><span class="hljs-number">2</span> ARG CONT_IMG_VER</span><br><span class="line"><span class="hljs-number">3</span> ENV CONT_IMG_VER $CONT_IMG_VER</span><br><span class="line"><span class="hljs-number">4</span> RUN echo $CONT_IMG_VER</span><br><span class="line"><span class="hljs-keyword">In</span> this example, the <span class="hljs-keyword">cache</span> miss occurs <span class="hljs-keyword">on</span> line <span class="hljs-number">3.</span> The miss happens because the <span class="hljs-keyword">variable</span>’s <span class="hljs-keyword">value</span> <span class="hljs-keyword">in</span> the ENV <span class="hljs-keyword">references</span> the ARG <span class="hljs-keyword">variable</span> <span class="hljs-keyword">and</span> that <span class="hljs-keyword">variable</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">changed</span> <span class="hljs-keyword">through</span> the command line. <span class="hljs-keyword">In</span> this example, the ENV command causes the image <span class="hljs-keyword">to</span> <span class="hljs-keyword">include</span> the value.</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">If</span> an ENV instruction overrides an ARG instruction <span class="hljs-keyword">of</span> the same <span class="hljs-keyword">name</span>, <span class="hljs-keyword">like</span> this Dockerfile:</span><br><span class="line"></span><br><span class="line"><span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> ubuntu</span><br><span class="line"><span class="hljs-number">2</span> ARG CONT_IMG_VER</span><br><span class="line"><span class="hljs-number">3</span> ENV CONT_IMG_VER hello</span><br><span class="line"><span class="hljs-number">4</span> RUN echo $CONT_IMG_VER</span><br><span class="line">Line <span class="hljs-number">3</span> does <span class="hljs-keyword">not</span> cause a <span class="hljs-keyword">cache</span> miss because the <span class="hljs-keyword">value</span> <span class="hljs-keyword">of</span> CONT_IMG_VER <span class="hljs-keyword">is</span> a <span class="hljs-keyword">constant</span> (hello). <span class="hljs-keyword">As</span> a <span class="hljs-keyword">result</span>, the environment <span class="hljs-keyword">variables</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">values</span> used <span class="hljs-keyword">on</span> the RUN (line <span class="hljs-number">4</span>) doesn’t <span class="hljs-keyword">change</span> <span class="hljs-keyword">between</span> builds.</span><br><span class="line"></span><br><span class="line">ONBUILD</span><br><span class="line"><span class="hljs-string">`ONBUILD [INSTRUCTION]`</span></span><br><span class="line">The ONBUILD instruction adds <span class="hljs-keyword">to</span> the image a <span class="hljs-keyword">trigger</span> instruction <span class="hljs-keyword">to</span> be executed <span class="hljs-keyword">at</span> a later <span class="hljs-built_in">time</span>, <span class="hljs-keyword">when</span> the image <span class="hljs-keyword">is</span> used <span class="hljs-keyword">as</span> the base <span class="hljs-keyword">for</span> another build. The <span class="hljs-keyword">trigger</span> will be executed <span class="hljs-keyword">in</span> the <span class="hljs-keyword">context</span> <span class="hljs-keyword">of</span> the downstream <span class="hljs-keyword">build</span>, <span class="hljs-keyword">as</span> <span class="hljs-keyword">if</span> it had been inserted immediately <span class="hljs-keyword">after</span> the <span class="hljs-keyword">FROM</span> instruction <span class="hljs-keyword">in</span> the downstream Dockerfile.</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">Any</span> <span class="hljs-keyword">build</span> instruction can be registered <span class="hljs-keyword">as</span> a trigger.</span><br><span class="line"></span><br><span class="line">This <span class="hljs-keyword">is</span> useful <span class="hljs-keyword">if</span> you <span class="hljs-keyword">are</span> building an image which will be used <span class="hljs-keyword">as</span> a base <span class="hljs-keyword">to</span> <span class="hljs-keyword">build</span> other images, <span class="hljs-keyword">for</span> example an application <span class="hljs-keyword">build</span> environment <span class="hljs-keyword">or</span> a daemon which may be customized <span class="hljs-keyword">with</span> <span class="hljs-keyword">user</span>-specific configuration.</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">For</span> example, <span class="hljs-keyword">if</span> your image <span class="hljs-keyword">is</span> a reusable Python application builder, it will require application <span class="hljs-keyword">source</span> code <span class="hljs-keyword">to</span> be added <span class="hljs-keyword">in</span> a particular <span class="hljs-keyword">directory</span>, <span class="hljs-keyword">and</span> it might require a <span class="hljs-keyword">build</span> script <span class="hljs-keyword">to</span> be called <span class="hljs-keyword">after</span> that. You can’t just <span class="hljs-keyword">call</span> <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">and</span> RUN <span class="hljs-keyword">now</span>, because you don’t yet have <span class="hljs-keyword">access</span> <span class="hljs-keyword">to</span> the application <span class="hljs-keyword">source</span> code, <span class="hljs-keyword">and</span> it will be different <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> application build. You could simply provide application developers <span class="hljs-keyword">with</span> a boilerplate Dockerfile <span class="hljs-keyword">to</span> copy-paste <span class="hljs-keyword">into</span> their application, but that <span class="hljs-keyword">is</span> inefficient, <span class="hljs-keyword">error</span>-prone <span class="hljs-keyword">and</span> difficult <span class="hljs-keyword">to</span> <span class="hljs-keyword">update</span> because it mixes <span class="hljs-keyword">with</span> application-specific code.</span><br><span class="line"></span><br><span class="line">The solution <span class="hljs-keyword">is</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">use</span> ONBUILD <span class="hljs-keyword">to</span> <span class="hljs-keyword">register</span> advance instructions <span class="hljs-keyword">to</span> run later, during the <span class="hljs-keyword">next</span> <span class="hljs-keyword">build</span> stage.</span><br><span class="line"></span><br><span class="line">Here’s how it works:</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">When</span> it encounters an ONBUILD instruction, the builder adds a <span class="hljs-keyword">trigger</span> <span class="hljs-keyword">to</span> the metadata <span class="hljs-keyword">of</span> the image being built. The instruction does <span class="hljs-keyword">not</span> otherwise affect the <span class="hljs-keyword">current</span> build.</span><br><span class="line"><span class="hljs-keyword">At</span> the <span class="hljs-keyword">end</span> <span class="hljs-keyword">of</span> the <span class="hljs-keyword">build</span>, a <span class="hljs-keyword">list</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">triggers</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">stored</span> <span class="hljs-keyword">in</span> the image manifest, <span class="hljs-keyword">under</span> the <span class="hljs-keyword">key</span> OnBuild. They can be inspected <span class="hljs-keyword">with</span> the docker inspect command.</span><br><span class="line">Later the image may be used <span class="hljs-keyword">as</span> a base <span class="hljs-keyword">for</span> a <span class="hljs-keyword">new</span> <span class="hljs-keyword">build</span>, <span class="hljs-keyword">using</span> the <span class="hljs-keyword">FROM</span> instruction. <span class="hljs-keyword">As</span> part <span class="hljs-keyword">of</span> processing the <span class="hljs-keyword">FROM</span> instruction, the downstream builder looks <span class="hljs-keyword">for</span> ONBUILD <span class="hljs-keyword">triggers</span>, <span class="hljs-keyword">and</span> executes them <span class="hljs-keyword">in</span> the same <span class="hljs-keyword">order</span> they were registered. <span class="hljs-keyword">If</span> <span class="hljs-keyword">any</span> <span class="hljs-keyword">of</span> the <span class="hljs-keyword">triggers</span> fail, the <span class="hljs-keyword">FROM</span> instruction <span class="hljs-keyword">is</span> aborted which <span class="hljs-keyword">in</span> turn causes the <span class="hljs-keyword">build</span> <span class="hljs-keyword">to</span> fail. <span class="hljs-keyword">If</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">triggers</span> succeed, the <span class="hljs-keyword">FROM</span> instruction completes <span class="hljs-keyword">and</span> the <span class="hljs-keyword">build</span> continues <span class="hljs-keyword">as</span> usual.</span><br><span class="line"><span class="hljs-keyword">Triggers</span> <span class="hljs-keyword">are</span> cleared <span class="hljs-keyword">from</span> the <span class="hljs-keyword">final</span> image <span class="hljs-keyword">after</span> being executed. <span class="hljs-keyword">In</span> other words they <span class="hljs-keyword">are</span> <span class="hljs-keyword">not</span> inherited <span class="hljs-keyword">by</span> “grand-children” builds.</span><br><span class="line"><span class="hljs-keyword">For</span> example you might <span class="hljs-keyword">add</span> something <span class="hljs-keyword">like</span> this:</span><br><span class="line"></span><br><span class="line">[...]</span><br><span class="line">ONBUILD <span class="hljs-keyword">ADD</span> . /app/src</span><br><span class="line">ONBUILD RUN /usr/<span class="hljs-keyword">local</span>/<span class="hljs-keyword">bin</span>/python-<span class="hljs-keyword">build</span> <span class="hljs-comment">--dir /app/src</span></span><br><span class="line">[...]</span><br><span class="line"><span class="hljs-keyword">Warning</span>: Chaining ONBUILD instructions <span class="hljs-keyword">using</span> ONBUILD ONBUILD isn’t allowed.</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">Warning</span>: The ONBUILD instruction may <span class="hljs-keyword">not</span> <span class="hljs-keyword">trigger</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">or</span> MAINTAINER instructions.</span><br><span class="line"></span><br><span class="line">STOPSIGNAL</span><br><span class="line">STOPSIGNAL signal</span><br><span class="line">The STOPSIGNAL instruction <span class="hljs-keyword">sets</span> the <span class="hljs-keyword">system</span> <span class="hljs-keyword">call</span> signal that will be sent <span class="hljs-keyword">to</span> the <span class="hljs-keyword">container</span> <span class="hljs-keyword">to</span> exit. This signal can be a valid <span class="hljs-keyword">unsigned</span> <span class="hljs-built_in">number</span> that matches a <span class="hljs-keyword">position</span> <span class="hljs-keyword">in</span> the kernel’s syscall <span class="hljs-keyword">table</span>, <span class="hljs-keyword">for</span> <span class="hljs-keyword">instance</span> <span class="hljs-number">9</span>, <span class="hljs-keyword">or</span> a signal <span class="hljs-keyword">name</span> <span class="hljs-keyword">in</span> the <span class="hljs-keyword">format</span> SIGNAME, <span class="hljs-keyword">for</span> <span class="hljs-keyword">instance</span> SIGKILL.</span><br><span class="line"></span><br><span class="line">HEALTHCHECK</span><br><span class="line"></span><br><span class="line">The HEALTHCHECK instruction has two forms:</span><br></pre></td></tr></table></figure>

<p>HEALTHCHECK [OPTIONS] CMD command (check container health by running a command inside the container)<br>HEALTHCHECK NONE (disable any healthcheck inherited from the base image)</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">The HEALTHCHECK instruction tells Docker how <span class="hljs-keyword">to</span> test a container <span class="hljs-keyword">to</span> check that it is still working. This can detect cases such as a web<span class="hljs-built_in"> server </span>that is stuck <span class="hljs-keyword">in</span> an infinite loop <span class="hljs-keyword">and</span> unable <span class="hljs-keyword">to</span> handle new connections, even though the<span class="hljs-built_in"> server </span>process is still running.</span><br><span class="line"></span><br><span class="line">When a container has a healthcheck specified, it has a<span class="hljs-built_in"> health </span>status <span class="hljs-keyword">in</span> addition <span class="hljs-keyword">to</span> its normal status. This status is initially starting. Whenever a<span class="hljs-built_in"> health </span>check passes, it becomes healthy (whatever state it was previously <span class="hljs-keyword">in</span>). After a certain number of consecutive failures, it becomes unhealthy.</span><br><span class="line"></span><br><span class="line">The options that can appear before CMD are:</span><br></pre></td></tr></table></figure>

<p>–interval=DURATION (default: 30s)<br>–timeout=DURATION (default: 30s)<br>–start-period=DURATION (default: 0s)<br>–retries=N (default: 3)</p>
<figure class="highlight smali hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">The health<span class="hljs-built_in"> check </span>will first run interval seconds after the container is started,<span class="hljs-built_in"> and </span>then again interval seconds after each previous<span class="hljs-built_in"> check </span>completes.</span><br><span class="line"></span><br><span class="line">If a single run of the<span class="hljs-built_in"> check </span>takes longer than timeout seconds then the<span class="hljs-built_in"> check </span>is considered to have failed.</span><br><span class="line"></span><br><span class="line">It takes retries consecutive failures of the health<span class="hljs-built_in"> check </span>for the container to be considered unhealthy.</span><br><span class="line"></span><br><span class="line">start period provides initialization time for containers that need time to bootstrap. Probe failure during that period will<span class="hljs-built_in"> not </span>be counted towards the maximum number of retries. However,<span class="hljs-built_in"> if </span>a health<span class="hljs-built_in"> check </span>succeeds during the start period, the container is considered started<span class="hljs-built_in"> and </span>all consecutive failures will be counted towards the maximum number of retries.</span><br><span class="line"></span><br><span class="line">There can only be one HEALTHCHECK instruction in a Dockerfile. If you list more than one then only the last HEALTHCHECK will take effect.</span><br><span class="line"></span><br><span class="line">The command after the CMD keyword can be either a shell command (e.g. HEALTHCHECK CMD /bin/check-running)<span class="hljs-built_in"> or </span>an exec<span class="hljs-built_in"> array </span>(as with other Dockerfile commands; see e.g. ENTRYPOINT for details).</span><br><span class="line"></span><br><span class="line">The command’s exit status indicates the health status of the container. The possible values are:</span><br></pre></td></tr></table></figure>

<p>0: success - the container is healthy and ready for use<br>1: unhealthy - the container is not working correctly<br>2: reserved - do not use this exit code</p>
<figure class="highlight sql hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">For example, to <span class="hljs-keyword">check</span> every five <span class="hljs-keyword">minutes</span> <span class="hljs-keyword">or</span> so that a web-<span class="hljs-keyword">server</span> <span class="hljs-keyword">is</span> able <span class="hljs-keyword">to</span> serve the site’s <span class="hljs-keyword">main</span> page <span class="hljs-keyword">within</span> three <span class="hljs-keyword">seconds</span>:</span><br><span class="line"><span class="hljs-string">`</span></span><br><span class="line"><span class="hljs-string">HEALTHCHECK --interval=5m --timeout=3s \</span></span><br><span class="line"><span class="hljs-string">  CMD curl -f http://localhost/ || exit 1`</span></span><br><span class="line"><span class="hljs-keyword">To</span> <span class="hljs-keyword">help</span> debug failing probes, <span class="hljs-keyword">any</span> <span class="hljs-keyword">output</span> <span class="hljs-built_in">text</span> (UTF<span class="hljs-number">-8</span> encoded) that the command writes <span class="hljs-keyword">on</span> stdout <span class="hljs-keyword">or</span> stderr will be <span class="hljs-keyword">stored</span> <span class="hljs-keyword">in</span> the health <span class="hljs-keyword">status</span> <span class="hljs-keyword">and</span> can be queried <span class="hljs-keyword">with</span> docker inspect. Such <span class="hljs-keyword">output</span> should be kept <span class="hljs-keyword">short</span> (<span class="hljs-keyword">only</span> the <span class="hljs-keyword">first</span> <span class="hljs-number">4096</span> <span class="hljs-keyword">bytes</span> <span class="hljs-keyword">are</span> <span class="hljs-keyword">stored</span> currently).</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">When</span> the health <span class="hljs-keyword">status</span> <span class="hljs-keyword">of</span> a <span class="hljs-keyword">container</span> changes, a health_status <span class="hljs-keyword">event</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">generated</span> <span class="hljs-keyword">with</span> the <span class="hljs-keyword">new</span> status.</span><br><span class="line"></span><br><span class="line">The HEALTHCHECK feature was added <span class="hljs-keyword">in</span> Docker <span class="hljs-number">1.12</span>.</span><br><span class="line">SHELL</span><br><span class="line"><span class="hljs-string">`SHELL ["executable", "parameters"]`</span></span><br><span class="line">The SHELL instruction allows the <span class="hljs-keyword">default</span> shell used <span class="hljs-keyword">for</span> the shell <span class="hljs-keyword">form</span> <span class="hljs-keyword">of</span> commands <span class="hljs-keyword">to</span> be overridden. The <span class="hljs-keyword">default</span> shell <span class="hljs-keyword">on</span> Linux <span class="hljs-keyword">is</span><span class="hljs-string">` ["/bin/sh", "-c"]`</span>, <span class="hljs-keyword">and</span> <span class="hljs-keyword">on</span> Windows <span class="hljs-keyword">is</span> <span class="hljs-string">`["cmd", "/S", "/C"]`</span>. The SHELL instruction must be written <span class="hljs-keyword">in</span> <span class="hljs-keyword">JSON</span> <span class="hljs-keyword">form</span> <span class="hljs-keyword">in</span> a Dockerfile.</span><br><span class="line"></span><br><span class="line">The SHELL instruction <span class="hljs-keyword">is</span> particularly useful <span class="hljs-keyword">on</span> Windows <span class="hljs-keyword">where</span> there <span class="hljs-keyword">are</span> two commonly used <span class="hljs-keyword">and</span> quite different <span class="hljs-keyword">native</span> shells: cmd <span class="hljs-keyword">and</span> powershell, <span class="hljs-keyword">as</span> well <span class="hljs-keyword">as</span> alternate shells available <span class="hljs-keyword">including</span> sh.</span><br><span class="line"></span><br><span class="line">The SHELL instruction can appear multiple times. <span class="hljs-keyword">Each</span> SHELL instruction overrides <span class="hljs-keyword">all</span> previous SHELL instructions, <span class="hljs-keyword">and</span> affects <span class="hljs-keyword">all</span> subsequent instructions. <span class="hljs-keyword">For</span> example:</span><br></pre></td></tr></table></figure>

<p>FROM microsoft/windowsservercore</p>
<h1 id="Executed-as-cmd-S-C-echo-default"><a href="#Executed-as-cmd-S-C-echo-default" class="headerlink" title="Executed as cmd /S /C echo default"></a>Executed as cmd /S /C echo default</h1><p>RUN echo default</p>
<h1 id="Executed-as-cmd-S-C-powershell-command-Write-Host-default"><a href="#Executed-as-cmd-S-C-powershell-command-Write-Host-default" class="headerlink" title="Executed as cmd /S /C powershell -command Write-Host default"></a>Executed as cmd /S /C powershell -command Write-Host default</h1><p>RUN powershell -command Write-Host default</p>
<h1 id="Executed-as-powershell-command-Write-Host-hello"><a href="#Executed-as-powershell-command-Write-Host-hello" class="headerlink" title="Executed as powershell -command Write-Host hello"></a>Executed as powershell -command Write-Host hello</h1><p>SHELL [“powershell”, “-command”]<br>RUN Write-Host hello</p>
<h1 id="Executed-as-cmd-S-C-echo-hello"><a href="#Executed-as-cmd-S-C-echo-hello" class="headerlink" title="Executed as cmd /S /C echo hello"></a>Executed as cmd /S /C echo hello</h1><p>SHELL [“cmd”, “/S””, “/C”]<br>RUN echo hello</p>
<figure class="highlight livecodeserver hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The following instructions can be affected <span class="hljs-keyword">by</span> <span class="hljs-keyword">the</span> SHELL instruction when <span class="hljs-keyword">the</span> <span class="hljs-built_in">shell</span> form <span class="hljs-keyword">of</span> them is used <span class="hljs-keyword">in</span> <span class="hljs-keyword">a</span> Dockerfile: RUN, CMD <span class="hljs-keyword">and</span> ENTRYPOINT.</span><br><span class="line"></span><br><span class="line">The following example is <span class="hljs-keyword">a</span> common pattern found <span class="hljs-keyword">on</span> <span class="hljs-title">Windows</span> <span class="hljs-title">which</span> <span class="hljs-title">can</span> <span class="hljs-title">be</span> <span class="hljs-title">streamlined</span> <span class="hljs-title">by</span> <span class="hljs-title">using</span> <span class="hljs-title">the</span> <span class="hljs-title">SHELL</span> <span class="hljs-title">instruction</span>:</span><br></pre></td></tr></table></figure>

<p>…<br>RUN powershell -command Execute-MyCmdlet -param1 “c:\foo.txt”<br>…</p>
<figure class="highlight livecodeserver hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">The <span class="hljs-keyword">command</span> <span class="hljs-title">invoked</span> <span class="hljs-title">by</span> <span class="hljs-title">docker</span> <span class="hljs-title">will</span> <span class="hljs-title">be</span>:</span><br><span class="line">`</span><br><span class="line">cmd /S /C powershell -<span class="hljs-keyword">command</span> <span class="hljs-title">Execute-MyCmdlet</span> -<span class="hljs-title">param1</span> <span class="hljs-string">"c:\foo.txt"</span>`</span><br><span class="line">This is inefficient <span class="hljs-keyword">for</span> <span class="hljs-literal">two</span> reasons. First, there is <span class="hljs-keyword">an</span> un-necessary cmd.exe <span class="hljs-keyword">command</span> <span class="hljs-title">processor</span> (<span class="hljs-title">aka</span> <span class="hljs-title">shell</span>) <span class="hljs-title">being</span> <span class="hljs-title">invoked</span>. <span class="hljs-title">Second</span>, <span class="hljs-title">each</span> <span class="hljs-title">RUN</span> <span class="hljs-title">instruction</span> <span class="hljs-title">in</span> <span class="hljs-title">the</span> <span class="hljs-title">shell</span> <span class="hljs-title">form</span> <span class="hljs-title">requires</span> <span class="hljs-title">an</span> <span class="hljs-title">extra</span> <span class="hljs-title">powershell</span> -<span class="hljs-title">command</span> <span class="hljs-title">prefixing</span> <span class="hljs-title">the</span> <span class="hljs-title">command</span>.</span><br><span class="line"></span><br><span class="line">To make this more efficient, <span class="hljs-literal">one</span> <span class="hljs-keyword">of</span> <span class="hljs-literal">two</span> mechanisms can be employed. One is <span class="hljs-built_in">to</span> use <span class="hljs-keyword">the</span> JSON form <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> RUN <span class="hljs-keyword">command</span> <span class="hljs-title">such</span> <span class="hljs-title">as</span>:</span><br></pre></td></tr></table></figure>

<p>…<br>RUN [“powershell”, “-command”, “Execute-MyCmdlet”, “-param1 &quot;c:\foo.txt&quot;“]<br>…</p>
<figure class="highlight livecodeserver hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">While <span class="hljs-keyword">the</span> JSON form is unambiguous <span class="hljs-keyword">and</span> does <span class="hljs-keyword">not</span> use <span class="hljs-keyword">the</span> un-necessary cmd.exe, <span class="hljs-keyword">it</span> does <span class="hljs-built_in">require</span> more verbosity through double-quoting <span class="hljs-keyword">and</span> escaping. The alternate mechanism is <span class="hljs-built_in">to</span> use <span class="hljs-keyword">the</span> SHELL instruction <span class="hljs-keyword">and</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">shell</span> form, making <span class="hljs-keyword">a</span> more natural syntax <span class="hljs-keyword">for</span> Windows users, especially when combined <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> escape parser directive:</span><br></pre></td></tr></table></figure>

<h1 id="escape"><a href="#escape" class="headerlink" title="escape=`"></a>escape=`</h1><p>FROM microsoft/nanoserver<br>SHELL [“powershell”,”-command”]<br>RUN New-Item -ItemType Directory C:\Example<br>ADD Execute-MyCmdlet.ps1 c:\example<br>RUN c:\example\Execute-MyCmdlet -sample ‘hello world’</p>
<figure class="highlight actionscript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Resulting <span class="hljs-keyword">in</span>:</span><br></pre></td></tr></table></figure>

<p>PS E:\docker\build\shell&gt; docker build -t shell .<br>Sending build context to Docker daemon 4.096 kB<br>Step 1/5 : FROM microsoft/nanoserver<br> —&gt; 22738ff49c6d<br>Step 2/5 : SHELL powershell -command<br> —&gt; Running in 6fcdb6855ae2<br> —&gt; 6331462d4300<br>Removing intermediate container 6fcdb6855ae2<br>Step 3/5 : RUN New-Item -ItemType Directory C:\Example<br> —&gt; Running in d0eef8386e97</p>
<pre><code>Directory: C:\</code></pre><p>Mode                LastWriteTime         Length Name</p>
<hr>
<p>d—–       10/28/2016  11:26 AM                Example</p>
<p> —&gt; 3f2fbf1395d9<br>Removing intermediate container d0eef8386e97<br>Step 4/5 : ADD Execute-MyCmdlet.ps1 c:\example<br> —&gt; a955b2621c31<br>Removing intermediate container b825593d39fc<br>Step 5/5 : RUN c:\example\Execute-MyCmdlet ‘hello world’<br> —&gt; Running in be6d8e63fe75<br>hello world<br> —&gt; 8e559e9bf424<br>Removing intermediate container be6d8e63fe75<br>Successfully built 8e559e9bf424<br>PS E:\docker\build\shell&gt;</p>
<figure class="highlight stata hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">The <span class="hljs-keyword">SHELL</span> instruction could also be used to modify the way <span class="hljs-keyword">in</span> <span class="hljs-keyword">which</span> a <span class="hljs-keyword">shell</span> operates. <span class="hljs-keyword">For</span> example, using <span class="hljs-keyword">SHELL</span> cmd /S /C /V:<span class="hljs-keyword">ON</span>|OFF <span class="hljs-keyword">on</span> Windows, delayed environment variable expansion semantics could be modified.</span><br><span class="line"></span><br><span class="line">The <span class="hljs-keyword">SHELL</span> instruction can also be used <span class="hljs-keyword">on</span> Linux should <span class="hljs-keyword">an</span> alternate <span class="hljs-keyword">shell</span> be required such <span class="hljs-keyword">as</span> zsh, csh, tcsh and others.</span><br><span class="line"></span><br><span class="line">The <span class="hljs-keyword">SHELL</span> feature was added <span class="hljs-keyword">in</span> Docker 1.12.</span><br><span class="line"></span><br><span class="line">Dockerfile examples</span><br><span class="line">Below you can see some examples of Dockerfile <span class="hljs-keyword">syntax</span>. <span class="hljs-keyword">If</span> you’re interested <span class="hljs-keyword">in</span> something <span class="hljs-keyword">more</span> realistic, take a look at the <span class="hljs-keyword">list</span> of Dockerization examples.</span><br></pre></td></tr></table></figure>

<h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><p>#</p>
<h1 id="VERSION-0-0-1"><a href="#VERSION-0-0-1" class="headerlink" title="VERSION               0.0.1"></a>VERSION               0.0.1</h1><p>FROM      ubuntu<br>LABEL Description=”This image is used to start the foobar executable” Vendor=”ACME Products” Version=”1.0”<br>RUN apt-get update &amp;&amp; apt-get install -y inotify-tools nginx apache2 openssh-server</p>
<figure class="highlight dockerfile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"><span class="hljs-comment"># Firefox over VNC</span></span><br><span class="line"><span class="hljs-comment">#</span></span><br><span class="line"><span class="hljs-comment"># VERSION               0.3</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">FROM</span> ubuntu</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Install vnc, xvfb in order to create a 'fake' display and firefox</span></span><br><span class="line"><span class="hljs-keyword">RUN</span><span class="hljs-bash"> apt-get update &amp;&amp; apt-get install -y x11vnc xvfb firefox</span></span><br><span class="line"><span class="hljs-keyword">RUN</span><span class="hljs-bash"> mkdir ~/.vnc</span></span><br><span class="line"><span class="hljs-comment"># Setup a password</span></span><br><span class="line"><span class="hljs-keyword">RUN</span><span class="hljs-bash"> x11vnc -storepasswd 1234 ~/.vnc/passwd</span></span><br><span class="line"><span class="hljs-comment"># Autostart firefox (might not be the best way, but it does the trick)</span></span><br><span class="line"><span class="hljs-keyword">RUN</span><span class="hljs-bash"> bash -c <span class="hljs-string">'echo "firefox" &gt;&gt; /.bashrc'</span></span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">5900</span></span><br><span class="line"><span class="hljs-keyword">CMD</span><span class="hljs-bash">    [<span class="hljs-string">"x11vnc"</span>, <span class="hljs-string">"-forever"</span>, <span class="hljs-string">"-usepw"</span>, <span class="hljs-string">"-create"</span>]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight dockerfile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># Multiple images example</span></span><br><span class="line"><span class="hljs-comment">#</span></span><br><span class="line"><span class="hljs-comment"># VERSION               0.1</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">FROM</span> ubuntu</span><br><span class="line"><span class="hljs-keyword">RUN</span><span class="hljs-bash"> <span class="hljs-built_in">echo</span> foo &gt; bar</span></span><br><span class="line"><span class="hljs-comment"># Will output something like ===&gt; 907ad6c2736f</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">FROM</span> ubuntu</span><br><span class="line"><span class="hljs-keyword">RUN</span><span class="hljs-bash"> <span class="hljs-built_in">echo</span> moo &gt; oink</span></span><br><span class="line"><span class="hljs-comment"># Will output something like ===&gt; 695d7793cbe4</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># You'll now have two images, 907ad6c2736f with /bar, and 695d7793cbe4 with</span></span><br><span class="line"><span class="hljs-comment"># /oink.</span></span><br></pre></td></tr></table></figure>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-19T09:30:00.000Z">2019-07-19</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    1 小时 read (About 7486 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/19/CI-CD/">CI/CD</a>
            
        </h1>
        <div class="content">
            <p><img src="/images/cicd.png" alt="upload successful"></p>
<p>在软件开发中经常会提到持续集成<br>Continuous Integration<br>（CI）和持续交付<br>Continuous Delivery<br>（CD）这几个术语。但它们真正的意思是什么呢？<br>在谈论软件开发时，经常会提到持续集成<br>Continuous Integration<br>（CI）和持续交付<br>Continuous Delivery<br>（CD）这几个术语。但它们真正的意思是什么呢？在本文中，我将解释这些和相关术语背后的含义和意义，例如持续测试<br>Continuous Testing<br>和持续部署<br>Continuous Deployment<br>概览<br>工厂里的装配线以快速、自动化、可重复的方式从原材料生产出消费品。同样，软件交付管道以快速、自动化和可重复的方式从源代码生成发布版本。如何完成这项工作的总体设计称为“持续交付”（CD）。启动装配线的过程称为“持续集成”（CI）。确保质量的过程称为“持续测试”，将最终产品提供给用户的过程称为“持续部署”。一些专家让这一切简单、顺畅、高效地运行，这些人被称为运维开发<br>DevOps<br>践行者。<br>“持续”是什么意思？<br>“持续”用于描述遵循我在此提到的许多不同流程实践。这并不意味着“一直在运行”，而是“随时可运行”。在软件开发领域，它还包括几个核心概念/最佳实践。这些是：<br>频繁发布：持续实践背后的目标是能够频繁地交付高质量的软件。此处的交付频率是可变的，可由开发团队或公司定义。对于某些产品，一季度、一个月、一周或一天交付一次可能已经足够频繁了。对于另一些来说，一天可能需要多次交付也是可行的。所谓持续也有“偶尔、按需”的方面。最终目标是相同的：在可重复、可靠的过程中为最终用户提供高质量的软件更新。通常，这可以通过很少甚至无需用户的交互或掌握的知识来完成（想想设备更新）。<br>自动化流程：实现此频率的关键是用自动化流程来处理软件生产中的方方面面。这包括构建、测试、分析、版本控制，以及在某些情况下的部署。<br>可重复：如果我们使用的自动化流程在给定相同输入的情况下始终具有相同的行为，则这个过程应该是可重复的。也就是说，如果我们把某个历史版本的代码作为输入，我们应该得到对应相同的可交付产出。这也假设我们有相同版本的外部依赖项（即我们不创建该版本代码使用的其它交付物）。理想情况下，这也意味着可以对管道中的流程进行版本控制和重建（请参阅稍后的 DevOps 讨论）。<br>快速迭代：“快速”在这里是个相对术语，但无论软件更新/发布的频率如何，预期的持续过程都会以高效的方式将源代码转换为交付物。自动化负责大部分工作，但自动化处理的过程可能仍然很慢。例如，对于每天需要多次发布候选版更新的产品来说，一轮集成测试<br>integrated testing<br>下来耗时就要大半天可能就太慢了。<br>什么是“持续交付管道”？<br>将源代码转换为可发布产品的多个不同的任务<br>task<br>和作业<br>job<br>通常串联成一个软件“管道”，一个自动流程成功完成后会启动管道中的下一个流程。这些管道有许多不同的叫法，例如持续交付管道、部署管道和软件开发管道。大体上讲，程序管理者在管道执行时管理管道各部分的定义、运行、监控和报告。<br>持续交付管道是如何工作的？<br>软件交付管道的实际实现可以有很大不同。有许多程序可用在管道中，用于源代码跟踪、构建、测试、指标采集，版本管理等各个方面。但整体工作流程通常是相同的。单个业务流程/工作流应用程序管理整个管道，每个流程作为独立的作业运行或由该应用程序进行阶段管理。通常，在业务流程中，这些独立作业是以应用程序可理解并可作为工作流程管理的语法和结构定义的。<br>这些作业被用于一个或多个功能（构建、测试、部署等）。每个作业可能使用不同的技术或多种技术。关键是作业是自动化的、高效的，并且可重复的。如果作业成功，则工作流管理器将触发管道中的下一个作业。如果作业失败，工作流管理器会向开发人员、测试人员和其他人发出警报，以便他们尽快纠正问题。这个过程是自动化的，所以比手动运行一组过程可更快地找到错误。这种快速排错称为快速失败<br>fail fast<br>，并且在抵达管道端点方面同样有价值。<br>“快速失败”是什么意思？<br>管道的工作之一就是快速处理变更。另一个是监视创建发布的不同任务/作业。由于编译失败或测试未通过的代码可以阻止管道继续运行，因此快速通知用户此类情况非常重要。快速失败指的是在管道流程中尽快发现问题并快速通知用户的方式，这样可以及时修正问题并重新提交代码以便使管道再次运行。通常在管道流程中可通过查看历史记录来确定是谁做了那次修改并通知此人及其团队。<br>所有持续交付管道都应该被自动化吗？<br>管道的几乎所有部分都是应该自动化的。对于某些部分，有一些人为干预/互动的地方可能是有意义的。一个例子可能是用户验收测试<br>user-acceptance testing<br>（让最终用户试用软件并确保它能达到他们想要/期望的水平）。另一种情况可能是部署到生产环境时用户希望拥有更多的人为控制。当然，如果代码不正确或不能运行，则需要人工干预。<br>有了对“持续”含义理解的背景，让我们看看不同类型的持续流程以及它们在软件管道上下文中的含义。<br>什么是“持续集成”？<br>持续集成（CI）是在源代码变更后自动检测、拉取、构建和（在大多数情况下）进行单元测试的过程。持续集成是启动管道的环节（尽管某些预验证 —— 通常称为上线前检查<br>pre-flight checks<br>—— 有时会被归在持续集成之前）。<br>持续集成的目标是快速确保开发人员新提交的变更是好的，并且适合在代码库中进一步使用。<br>持续集成是如何工作的？<br>持续集成的基本思想是让一个自动化过程监测一个或多个源代码仓库是否有变更。当变更被推送到仓库时，它会监测到更改、下载副本、构建并运行任何相关的单元测试。<br>持续集成如何监测变更？<br>目前，监测程序通常是像 Jenkins 这样的应用程序，它还协调管道中运行的所有（或大多数）进程，监视变更是其功能之一。监测程序可以以几种不同方式监测变更。这些包括：<br>轮询：监测程序反复询问代码管理系统，“代码仓库里有什么我感兴趣的新东西吗？”当代码管理系统有新的变更时，监测程序会“唤醒”并完成其工作以获取新代码并构建/测试它。<br>定期：监测程序配置为定期启动构建，无论源码是否有变更。理想情况下，如果没有变更，则不会构建任何新内容，因此这不会增加额外的成本。<br>推送：这与用于代码管理系统检查的监测程序相反。在这种情况下，代码管理系统被配置为提交变更到仓库时将“推送”一个通知到监测程序。最常见的是，这可以以 webhook 的形式完成 —— 在新代码被推送时一个挂勾<br>hook<br>的程序通过互联网向监测程序发送通知。为此，监测程序必须具有可以通过网络接收 webhook 信息的开放端口。<br>什么是“预检查”（又称“上线前检查”）？<br>在将代码引入仓库并触发持续集成之前，可以进行其它验证。这遵循了最佳实践，例如测试构建<br>test build<br>和代码审查<br>code review<br>。它们通常在代码引入管道之前构建到开发过程中。但是一些管道也可能将它们作为其监控流程或工作流的一部分。<br>例如，一个名为 Gerrit 的工具允许在开发人员推送代码之后但在允许进入（Git 远程）仓库之前进行正式的代码审查、验证和测试构建。Gerrit 位于开发人员的工作区和 Git 远程仓库之间。它会“接收”来自开发人员的推送，并且可以执行通过/失败验证以确保它们在被允许进入仓库之前的检查是通过的。这可以包括检测新变更并启动构建测试（CI 的一种形式）。它还允许开发者在那时进行正式的代码审查。这种方式有一种额外的可信度评估机制，即当变更的代码被合并到代码库中时不会破坏任何内容。<br>什么是“单元测试” ？<br>单元测试（也称为“提交测试”），是由开发人员编写的小型的专项测试，以确保新代码独立工作。“独立”这里意味着不依赖或调用其它不可直接访问的代码，也不依赖外部数据源或其它模块。如果运行代码需要这样的依赖关系，那么这些资源可以用模拟<br>mock<br>来表示。模拟是指使用看起来像资源的代码存根<br>code stub<br>，可以返回值，但不实现任何功能。<br>在大多数组织中，开发人员负责创建单元测试以证明其代码正确。事实上，一种称为测试驱动开发<br>test-driven develop<br>（TDD）的模型要求将首先设计单元测试作为清楚地验证代码功能的基础。因为这样的代码可以更改速度快且改动量大，所以它们也必须执行很快。<br>由于这与持续集成工作流有关，因此开发人员在本地工作环境中编写或更新代码，并通单元测试来确保新开发的功能或方法正确。通常，这些测试采用断言形式，即函数或方法的给定输入集产生给定的输出集。它们通常进行测试以确保正确标记和处理出错条件。有很多单元测试框架都很有用，例如用于 Java 开发的 JUnit。<br>什么是“持续测试”？<br>持续测试是指在代码通过持续交付管道时运行扩展范围的自动化测试的实践。单元测试通常与构建过程集成，作为持续集成阶段的一部分，并专注于和其它与之交互的代码隔离的测试。<br>除此之外，可以有或者应该有各种形式的测试。这些可包括：<br>集成测试 验证组件和服务组合在一起是否正常。<br>功能测试 验证产品中执行功能的结果是否符合预期。<br>验收测试 根据可接受的标准验证产品的某些特征。如性能、可伸缩性、抗压能力和容量。<br>所有这些可能不存在于自动化的管道中，并且一些不同类型的测试分类界限也不是很清晰。但是，在交付管道中持续测试的目标始终是相同的：通过持续的测试级别证明代码的质量可以在正在进行的发布中使用。在持续集成快速的原则基础上，第二个目标是快速发现问题并提醒开发团队。这通常被称为快速失败。<br>除了测试之外，还可以对管道中的代码进行哪些其它类型的验证？<br>除了测试是否通过之外，还有一些应用程序可以告诉我们测试用例执行（覆盖）的源代码行数。这是一个可以衡量代码量指标的例子。这个指标称为代码覆盖率<br>code-coverage<br>，可以通过工具（例如用于 Java 的 JaCoCo）进行统计。<br>还有很多其它类型的指标统计，例如代码行数、复杂度以及代码结构对比分析等。诸如 SonarQube 之类的工具可以检查源代码并计算这些指标。此外，用户还可以为他们可接受的“合格”范围的指标设置阈值。然后可以在管道中针对这些阈值设置一个检查，如果结果不在可接受范围内，则流程终端上。SonarQube 等应用程序具有很高的可配置性，可以设置仅检查团队感兴趣的内容。<br>什么是“持续交付”？<br>持续交付（CD）通常是指整个流程链（管道），它自动监测源代码变更并通过构建、测试、打包和相关操作运行它们以生成可部署的版本，基本上没有任何人为干预。<br>持续交付在软件开发过程中的目标是自动化、效率、可靠性、可重复性和质量保障（通过持续测试）。<br>持续交付包含持续集成（自动检测源代码变更、执行构建过程、运行单元测试以验证变更），持续测试（对代码运行各种测试以保障代码质量），和（可选）持续部署（通过管道发布版本自动提供给用户）。<br>如何在管道中识别/跟踪多个版本？<br>版本控制是持续交付和管道的关键概念。持续意味着能够经常集成新代码并提供更新版本。但这并不意味着每个人都想要“最新、最好的”。对于想要开发或测试已知的稳定版本的内部团队来说尤其如此。因此，管道创建并轻松存储和访问的这些版本化对象非常重要。<br>在管道中从源代码创建的对象通常可以称为工件<br>artifact<br>。工件在构建时应该有应用于它们的版本。将版本号分配给工件的推荐策略称为语义化版本控制<br>semantic versioning<br>。（这也适用于从外部源引入的依赖工件的版本。）<br>语义版本号有三个部分：主要版本<br>major<br>、次要版本<br>minor<br>和 补丁版本<br>patch<br>。（例如，1.4.3 反映了主要版本 1，次要版本 4 和补丁版本 3。）这个想法是，其中一个部分的更改表示工件中的更新级别。主要版本仅针对不兼容的 API 更改而递增。当以向后兼容<br>backward-compatible<br>的方式添加功能时，次要版本会增加。当进行向后兼容的版本 bug 修复时，补丁版本会增加。这些是建议的指导方针，但只要团队在整个组织内以一致且易于理解的方式这样做，团队就可以自由地改变这种方法。例如，每次为发布完成构建时增加的数字可以放在补丁字段中。<br>如何“分销”工件？<br>团队可以为工件分配分销<br>promotion<br>级别以指示适用于测试、生产等环境或用途。有很多方法。可以用 Jenkins 或 Artifactory 等应用程序进行分销。或者一个简单的方案可以在版本号字符串的末尾添加标签。例如，-snapshot 可以指示用于构建工件的代码的最新版本（快照）。可以使用各种分销策略或工具将工件“提升”到其它级别，例如 -milestone 或 -production，作为工件稳定性和完备性版本的标记。<br>如何存储和访问多个工件版本？<br>从源代码构建的版本化工件可以通过管理工件仓库<br>artifact repository<br>的应用程序进行存储。工件仓库就像构建工件的版本控制工具一样。像 Artifactory 或 Nexus 这类应用可以接受版本化工件，存储和跟踪它们，并提供检索的方法。<br>管道用户可以指定他们想要使用的版本，并在这些版本中使用管道。<br>什么是“持续部署”？<br>持续部署（CD）是指能够自动提供持续交付管道中发布版本给最终用户使用的想法。根据用户的安装方式，可能是在云环境中自动部署、app 升级（如手机上的应用程序）、更新网站或只更新可用版本列表。<br>这里的一个重点是，仅仅因为可以进行持续部署并不意味着始终部署来自管道的每组可交付成果。它实际上指，通过管道每套可交付成果都被证明是“可部署的”。这在很大程度上是由持续测试的连续级别完成的（参见本文中的持续测试部分）。<br>管道构建的发布成果是否被部署可以通过人工决策，或利用在完全部署之前“试用”发布的各种方法来进行控制。<br>在完全部署到所有用户之前，有哪些方法可以测试部署？<br>由于必须回滚/撤消对所有用户的部署可能是一种代价高昂的情况（无论是技术上还是用户的感知），已经有许多技术允许“尝试”部署新功能并在发现问题时轻松“撤消”它们。这些包括：<br>蓝/绿测试/部署<br>在这种部署软件的方法中，维护了两个相同的主机环境 —— 一个“蓝色” 和一个“绿色”。（颜色并不重要，仅作为标识。）对应来说，其中一个是“生产环境”，另一个是“预发布环境”。<br>在这些实例的前面是调度系统，它们充当产品或应用程序的客户“网关”。通过将调度系统指向蓝色或绿色实例，可以将客户流量引流到期望的部署环境。通过这种方式，切换指向哪个部署实例（蓝色或绿色）对用户来说是快速，简单和透明的。<br>当新版本准备好进行测试时，可以将其部署到非生产环境中。在经过测试和批准后，可以更改调度系统设置以将传入的线上流量指向它（因此它将成为新的生产站点）。现在，曾作为生产环境实例可供下一次候选发布使用。<br>同理，如果在最新部署中发现问题并且之前的生产实例仍然可用，则简单的更改可以将客户流量引流回到之前的生产实例 —— 有效地将问题实例“下线”并且回滚到以前的版本。然后有问题的新实例可以在其它区域中修复。<br>金丝雀测试/部署<br>在某些情况下，通过蓝/绿发布切换整个部署可能不可行或不是期望的那样。另一种方法是为金丝雀<br>canary<br>测试/部署。在这种模型中，一部分客户流量被重新引流到新的版本部署中。例如，新版本的搜索服务可以与当前服务的生产版本一起部署。然后，可以将 10％ 的搜索查询引流到新版本，以在生产环境中对其进行测试。<br>如果服务那些流量的新版本没问题，那么可能会有更多的流量会被逐渐引流过去。如果仍然没有问题出现，那么随着时间的推移，可以对新版本增量部署，直到 100％ 的流量都调度到新版本。这有效地“更替”了以前版本的服务，并让新版本对所有客户生效。<br>功能开关<br>对于可能需要轻松关掉的新功能（如果发现问题），开发人员可以添加功能开关<br>feature toggles<br>。这是代码中的 if-then 软件功能开关，仅在设置数据值时才激活新代码。此数据值可以是全局可访问的位置，部署的应用程序将检查该位置是否应执行新代码。如果设置了数据值，则执行代码；如果没有，则不执行。<br>这为开发人员提供了一个远程“终止开关”，以便在部署到生产环境后发现问题时关闭新功能。<br>暗箱发布<br>在暗箱发布<br>dark launch<br>中，代码被逐步测试/部署到生产环境中，但是用户不会看到更改（因此名称中有暗箱<br>dark<br>一词）。例如，在生产版本中，网页查询的某些部分可能会重定向到查询新数据源的服务。开发人员可收集此信息进行分析，而不会将有关接口，事务或结果的任何信息暴露给用户。<br>这个想法是想获取候选版本在生产环境负载下如何执行的真实信息，而不会影响用户或改变他们的经验。随着时间的推移，可以调度更多负载，直到遇到问题或认为新功能已准备好供所有人使用。实际上功能开关标志可用于这种暗箱发布机制。<br>什么是“运维开发”？<br>运维开发<br>DevOps<br>是关于如何使开发和运维团队更容易合作开发和发布软件的一系列想法和推荐的实践。从历史上看，开发团队研发了产品，但没有像客户那样以常规、可重复的方式安装/部署它们。在整个周期中，这组安装/部署任务（以及其它支持任务）留给运维团队负责。这经常导致很多混乱和问题，因为运维团队在后期才开始介入，并且必须在短时间内完成他们的工作。同样，开发团队经常处于不利地位 —— 因为他们没有充分测试产品的安装/部署功能，他们可能会对该过程中出现的问题感到惊讶。<br>这往往导致开发和运维团队之间严重脱节和缺乏合作。DevOps 理念主张是贯穿整个开发周期的开发和运维综合协作的工作方式，就像持续交付那样。<br>持续交付如何与运维开发相交？<br>持续交付管道是几个 DevOps 理念的实现。产品开发的后期阶段（如打包和部署）始终可以在管道的每次运行中完成，而不是等待产品开发周期中的特定时间。同样，从开发到部署过程中，开发和运维都可以清楚地看到事情何时起作用，何时不起作用。要使持续交付管道循环成功，不仅要通过与开发相关的流程，还要通过与运维相关的流程。<br>说得更远一些，DevOps 建议实现管道的基础架构也会被视为代码。也就是说，它应该自动配置、可跟踪、易于修改，并在管道发生变化时触发新一轮运行。这可以通过将管道实现为代码来完成。<br>什么是“管道即代码”？<br>管道即代码<br>pipeline-as-code<br>是通过编写代码创建管道作业/任务的通用术语，就像开发人员编写代码一样。它的目标是将管道实现表示为代码，以便它可以与代码一起存储、评审、跟踪，如果出现问题并且必须终止管道，则可以轻松地重建。有几个工具允许这样做，如 Jenkins 2。<br>DevOps 如何影响生产软件的基础设施？<br>传统意义上，管道中使用的各个硬件系统都有配套的软件（操作系统、应用程序、开发工具等）。在极端情况下，每个系统都是手工设置来定制的。这意味着当系统出现问题或需要更新时，这通常也是一项自定义任务。这种方法违背了持续交付的基本理念，即具有易于重现和可跟踪的环境。<br>多年来，很多应用被开发用于标准化交付（安装和配置）系统。同样，虚拟机<br>virtual machine<br>被开发为模拟在其它计算机之上运行的计算机程序。这些 VM 要有管理程序才能在底层主机系统上运行，并且它们需要自己的操作系统副本才能运行。<br>后来有了容器<br>container<br>。容器虽然在概念上与 VM 类似，但工作方式不同。它们只需使用一些现有的操作系统结构来划分隔离空间，而不需要运行单独的程序和操作系统的副本。因此，它们的行为类似于 VM 以提供隔离但不需要过多的开销。<br>VM 和容器是根据配置定义创建的，因此可以轻易地销毁和重建，而不会影响运行它们的主机系统。这允许运行管道的系统也可重建。此外，对于容器，我们可以跟踪其构建定义文件的更改 —— 就像对源代码一样。<br>因此，如果遇到 VM 或容器中的问题，我们可以更容易、更快速地销毁和重建它们，而不是在当前环境尝试调试和修复。<br>这也意味着对管道代码的任何更改都可以触发管道新一轮运行（通过 CI），就像对代码的更改一样。这是 DevOps 关于基础架构的核心理念之一。</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-18T19:48:00.000Z">2019-07-18</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    8 分钟 read (About 1199 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/19/bazel/">bazel</a>
            
        </h1>
        <div class="content">
            <p>bazel<br>演变一: Carthage<br>将整个工程拆分成多个仓库.每个仓库都是一个Framework.<br>每个小组维护一个仓库.<br>每个小组也只需关心这一个仓库.对其他仓库的依赖都用二进制依赖.<br>大大加快编译速度.<br>代表工具: Carthage.<br>演变二: bazel<br>不把每个库拆分成小仓库了.<br>所有库都在一个Git仓库中.<br>通过bazel拆分成多个package.<br>每个package的编译缓存都是独立的.<br>解决了编译过慢的问题.<br>虽然在同一个大仓库里.<br>但是每组各自维护自己的package.<br>所以不会导致不同组之间的git冲突  </p>
<p>bazel :<br>解决了编译过慢问题<br>解决了库之间依赖问题<br>解决了多人协作导致的git冲突  </p>
<p>安装<br>安装过程请参考: <a href="http://bazel.io/docs/install.html" target="_blank" rel="noopener">http://bazel.io/docs/install.html</a><br>使用工作区（workspace）<br>所有的Bazel构建都是基于一个 工作区（workspace） 概念，它是文件系统中一个保存了全部源代码的目录，同时还将包含一些构建后的输出目录的符号链接（例如：bazel-bin和 bazel-out 等输出目录）。工作区目录可以随意放在哪里，但是工作区的根目录必须包含一个名为 WORKSPACE 的工作区配置文件。工作区配置文件可以是一个空文件，也可以包含引用外部构建输出所需的 依赖关系。<br>在一个工作区内，可以根据需要共享多个项目。为了简单，我们先从只有一个项目的工作区开始介绍。<br>先假设你已经有了一个项目，对应 ~/gitroot/my-project/ 目录。我们先创建一个空的 ~/gitroot/my-project/WORKSPACE 工作区配置文件，用于表示这是Bazel项目对应的根目录。<br>创建自己的Build构建文件<br>使用下面的命令创建一个简单的Java项目：<br>$ # If you’re not already there, move to your workspace directory.<br>$ cd ~/gitroot/my-project<br>$ mkdir -p src/main/java/com/example<br>$ cat &gt; src/main/java/com/example/ProjectRunner.java &lt;&lt;EOF<br>package com.example;  </p>
<p>public class ProjectRunner {<br>public static void main(String args[]) {<br>Greeting.sayHi();<br>}  
}<br>EOF<br>$ cat &gt; src/main/java/com/example/Greeting.java &lt;&lt;EOF<br>package com.example;  </p>
<p>public class Greeting {<br>public static void sayHi() {<br>System.out.println(“Hi!”);<br>}  
}<br>EOF  </p>
<p>Bazel通过工作区中所有名为 BUILD 的文件来解析需要构建的项目信息，因此，我们需要先在 ~/gitroot/my-project 目录创建一个 BUILD 构建文件。下面是BUILD构建文件的内容：  </p>
<h4 id="gitroot-my-project-BUILD"><a href="#gitroot-my-project-BUILD" class="headerlink" title="~/gitroot/my-project/BUILD"></a>~/gitroot/my-project/BUILD</h4><figure class="highlight makefile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java_binary(</span><br><span class="line">name = <span class="hljs-string">"my-runner"</span>,</span><br><span class="line">srcs = glob([<span class="hljs-string">"**/*.java"</span>]),</span><br><span class="line">main_class = <span class="hljs-string">"com.example.ProjectRunner"</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>BUILD文件采用类似Python的语法。虽然不能包含任意的Python语法，但是BUILD文件中的每个构建规则看起来都象是一个Python函数调用，而且你也可以用 “#” 开头来添加单行注释。<br>java_binary 是一个构建规则。其中 name 对应一个构建目标的标识符，可用用它来向Bazel指定构建哪个项目。srcs 对应一个源文件列表，Bazel需要将这些源文件编译为二进制文件。其中 glob([“<em>*/</em>.java”]) 表示递归包含每个子目录中以每个 .java 为后缀名的文件。com.example.ProjectRunner 指定包含main方法的类。</p>
<p>现在可以用下面的命令构建这个Java程序了：</p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ cd <span class="hljs-regexp">~/gitroot/</span>my-project</span><br><span class="line">$ bazel build <span class="hljs-comment">//:my-runner</span></span><br><span class="line"><span class="hljs-string">INFO:</span> Found <span class="hljs-number">1</span> target...</span><br><span class="line">Target <span class="hljs-comment">//:my-runner up-to-date:</span></span><br><span class="line">bazel-bin/my-runner.jar</span><br><span class="line">bazel-bin/my-runner</span><br><span class="line"><span class="hljs-string">INFO:</span> Elapsed <span class="hljs-string">time:</span> <span class="hljs-number">1.021</span>s, Critical <span class="hljs-string">Path:</span> <span class="hljs-number">0.83</span>s</span><br><span class="line">$ bazel-bin/my-runner</span><br><span class="line">Hi!</span><br></pre></td></tr></table></figure>

<p>恭喜，你已经成功构建了第一个Bazel项目了！<br>添加依赖关系<br>对于小项目创建一个规则是可以的，但是随着项目的变大，则需要分别构建项目的不同的部件，最终再组装成产品。这种构建方式可以避免因为局部细小的修改儿导致重现构建整个应用，同时不同的构建步骤可以很好地并发执行以提高构建效率。<br>我们现在将一个项目拆分为两个部分独立构建，同时设置它们之间的依赖关系。基于上面的例子，我们重写了BUILD构建文件：</p>
<figure class="highlight makefile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">java_binary(</span><br><span class="line">name = <span class="hljs-string">"my-other-runner"</span>,</span><br><span class="line">srcs = [<span class="hljs-string">"src/main/java/com/example/ProjectRunner.java"</span>],</span><br><span class="line">main_class = <span class="hljs-string">"com.example.ProjectRunner"</span>,</span><br><span class="line">deps = [<span class="hljs-string">":greeter"</span>],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">java_library(</span><br><span class="line">name = <span class="hljs-string">"greeter"</span>,</span><br><span class="line">srcs = [<span class="hljs-string">"src/main/java/com/example/Greeting.java"</span>],</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>虽然源文件是一样的，但是现在Bazel将采用不同的方式来构建：首先是构建 greeter库，然后是构建 my-other-runner。可以在构建成功后立刻运行 //:my-other-runner：</p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ bazel run <span class="hljs-comment">//:my-other-runner</span></span><br><span class="line"><span class="hljs-string">INFO:</span> Found <span class="hljs-number">1</span> target...</span><br><span class="line">Target <span class="hljs-comment">//:my-other-runner up-to-date:</span></span><br><span class="line">bazel-bin/my-other-runner.jar</span><br><span class="line">bazel-bin/my-other-runner</span><br><span class="line"><span class="hljs-string">INFO:</span> Elapsed <span class="hljs-string">time:</span> <span class="hljs-number">2.454</span>s, Critical <span class="hljs-string">Path:</span> <span class="hljs-number">1.58</span>s</span><br><span class="line"></span><br><span class="line"><span class="hljs-string">INFO:</span> Running command <span class="hljs-string">line:</span> bazel-bin/my-other-runner</span><br><span class="line">Hi!</span><br></pre></td></tr></table></figure>

<p>现在如果你改动ProjectRunner.java代码并重新构建my-other-runner目标，Greeting.java文件因为没有变化而不会重现编译。<br>使用多个包（Packages）<br>对于更大的项目，我们通常需要将它们拆分到多个目录中。你可以用类似//path/to/directory:target-name的名字引用在其他BUILD文件定义的目标。假设src/main/java/com/example/有一个cmdline/子目录，包含下面的文件：</p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p src<span class="hljs-regexp">/main/</span>java<span class="hljs-regexp">/com/</span>example/cmdline</span><br><span class="line">$ cat &gt; src<span class="hljs-regexp">/main/</span>java<span class="hljs-regexp">/com/</span>example<span class="hljs-regexp">/cmdline/</span>Runner.java &lt;&lt;EOF</span><br><span class="line"><span class="hljs-keyword">package</span> com.example.cmdline;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> com.example.Greeting;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Runner</span> &#123;</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> main(String args[]) &#123;</span><br><span class="line">Greeting.sayHi();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>Runner.java依赖com.example.Greeting，因此我们需要在src/main/java/com/example/cmdline/BUILD构建文件中添加相应的依赖规则：  </p>
<h5 id="gitroot-my-project-src-main-java-com-example-cmdline-BUILD"><a href="#gitroot-my-project-src-main-java-com-example-cmdline-BUILD" class="headerlink" title="~/gitroot/my-project/src/main/java/com/example/cmdline/BUILD"></a>~/gitroot/my-project/src/main/java/com/example/cmdline/BUILD</h5><figure class="highlight makefile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">java_binary(</span><br><span class="line">name = <span class="hljs-string">"runner"</span>,</span><br><span class="line">srcs = [<span class="hljs-string">"Runner.java"</span>],</span><br><span class="line">main_class = <span class="hljs-string">"com.example.cmdline.Runner"</span>,</span><br><span class="line">deps = [<span class="hljs-string">"//:greeter"</span>]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>然而，默认情况下构建目标都是 私有 的。也就是说，我们只能在同一个BUILD文件中被引用。这可以避免将很多实现的细节暴漏给公共的接口，但是也意味着我们需要手工允许runner所依赖的//:greeter目标。就是类似下面这个在构建runner目标时遇到的错误：  </p>
<figure class="highlight subunit hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ bazel build //src/main/java/com/example/cmdline:runner</span><br><span class="line"><span class="hljs-keyword">ERROR: </span>/home/user/gitroot/my-project/src/main/java/com/example/cmdline/BUILD:2:1:</span><br><span class="line">Target '//:greeter' is not visible from target '//src/main/java/com/example/cmdline:runner'.</span><br><span class="line">Check the visibility declaration of the former target if you think the dependency is legitimate.</span><br><span class="line"><span class="hljs-keyword">ERROR: </span>Analysis of target '//src/main/java/com/example/cmdline:runner' failed; build aborted.</span><br><span class="line">INFO: Elapsed time: 0.091s</span><br></pre></td></tr></table></figure>

<p>可用通过在BUILD文件增加visibility = level属性来改变目标的可间范围。下面是通过在~/gitroot/my-project/BUILD文件增加可见规则，来改变greeter目标的可见范围：</p>
<figure class="highlight makefile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java_library(</span><br><span class="line">name = <span class="hljs-string">"greeter"</span>,</span><br><span class="line">srcs = [<span class="hljs-string">"src/main/java/com/example/Greeting.java"</span>],</span><br><span class="line">visibility = [<span class="hljs-string">"//src/main/java/com/example/cmdline:__pkg__"</span>],</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>这个规则表示//:greeter目标对于//src/main/java/com/example/cmdline包是可见的。现在我们可以重新构建runner目标程序：</p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ bazel run <span class="hljs-comment">//src/main/java/com/example/cmdline:runner</span></span><br><span class="line"><span class="hljs-string">INFO:</span> Found <span class="hljs-number">1</span> target...</span><br><span class="line">Target <span class="hljs-comment">//src/main/java/com/example/cmdline:runner up-to-date:</span></span><br><span class="line">bazel-bin<span class="hljs-regexp">/src/</span>main<span class="hljs-regexp">/java/</span>com<span class="hljs-regexp">/example/</span>cmdline/runner.jar</span><br><span class="line">bazel-bin<span class="hljs-regexp">/src/</span>main<span class="hljs-regexp">/java/</span>com<span class="hljs-regexp">/example/</span>cmdline/runner</span><br><span class="line"><span class="hljs-string">INFO:</span> Elapsed <span class="hljs-string">time:</span> <span class="hljs-number">1.576</span>s, Critical <span class="hljs-string">Path:</span> <span class="hljs-number">0.81</span>s</span><br><span class="line"><span class="hljs-string">INFO:</span> Running command <span class="hljs-string">line:</span> bazel-bin<span class="hljs-regexp">/src/</span>main<span class="hljs-regexp">/java/</span>com<span class="hljs-regexp">/example/</span>cmdline/runner</span><br><span class="line">Hi!</span><br></pre></td></tr></table></figure>

<p>参考文档 中有可见性配置说明。<br>部署<br>如果你查看 bazel-bin/src/main/java/com/example/cmdline/runner.jar 的内容，可以看到里面只包含了Runner.class，并没有保护所依赖的Greeting.class：</p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ jar tf bazel-bin<span class="hljs-regexp">/src/</span>main<span class="hljs-regexp">/java/</span>com<span class="hljs-regexp">/example/</span>cmdline/runner.jar</span><br><span class="line">META-INF/</span><br><span class="line">META-INF/MANIFEST.MF</span><br><span class="line">com/</span><br><span class="line">com<span class="hljs-regexp">/example/</span></span><br><span class="line">com<span class="hljs-regexp">/example/</span>cmdline/</span><br><span class="line">com<span class="hljs-regexp">/example/</span>cmdline/Runner.<span class="hljs-keyword">class</span></span><br></pre></td></tr></table></figure>

<p>这只能在本机正常工作（因为Bazel的runner脚本已经将greeter jar添加到了classpath），但是如果将runner.jar单独复制到另一台机器上讲不能正常运行。如果想要构建可用于部署发布的自包含所有依赖的目标，可以构建runner_deploy.jar目标（类似<target-name>_deploy.jar以_deploy为后缀的名字对应可部署目标）。</target-name></p>
<figure class="highlight elixir hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">$ </span>bazel build /<span class="hljs-regexp">/src/main</span><span class="hljs-regexp">/java/com</span><span class="hljs-regexp">/example/cmdline</span><span class="hljs-symbol">:runner_deploy</span>.jar</span><br><span class="line"><span class="hljs-symbol">INFO:</span> Found <span class="hljs-number">1</span> target...</span><br><span class="line">Target /<span class="hljs-regexp">/src/main</span><span class="hljs-regexp">/java/com</span><span class="hljs-regexp">/example/cmdline</span><span class="hljs-symbol">:runner_deploy</span>.jar up-to-<span class="hljs-symbol">date:</span></span><br><span class="line">bazel-bin/src/main/java/com/example/cmdline/runner_deploy.jar</span><br><span class="line"><span class="hljs-symbol">INFO:</span> Elapsed <span class="hljs-symbol">time:</span> <span class="hljs-number">1.700</span>s, Critical <span class="hljs-symbol">Path:</span> <span class="hljs-number">0</span>.<span class="hljs-number">23</span>s</span><br></pre></td></tr></table></figure>

<p>win环境下 Bazel 离线安装教程<br>对于bazel谷歌的开发脚手架，发现用windows系统下powershell下载速度特别慢，在刨坑过程中发现了一种捷径，就是离线安装，接下来将简单介绍离线安装过程<br>1、安装choco<br>cmd安装指令：  </p>
<figure class="highlight plain hljs"><figcaption><span>-NoProfile -InputFormat None -ExecutionPolicy Bypass -Command "iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))" && SET "PATH</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">powershell安装指令：  </span><br><span class="line">```Set-ExecutionPolicy Bypass -Scope Process -Force; iex ((New-Object System.Net.WebClient).DownloadString(&apos;https://chocolatey.org/install.ps1&apos;))```  </span><br><span class="line">特别说明：一定注意都是在管理员用户权限下打开cmd或者是powershell 这里推荐win10系统下使用powershell，如图所示，右键开始菜单打开管理员用户下的powershell：  </span><br><span class="line">2、通过powershell安装bazel  </span><br><span class="line">2.1、输入指令：  </span><br><span class="line">`choco install bazel`  </span><br><span class="line"></span><br><span class="line">&lt;hr/&gt;  </span><br><span class="line">离线安装  </span><br><span class="line">从官网上下载目前最新的bazel压缩包  </span><br><span class="line">先运行choco install bazel指令  </span><br><span class="line">如图所示等待选择阶段，这个时候不要打y 或者 n，让命令行停留于此:  </span><br><span class="line">![upload successful](/images/pasted-9.png)    </span><br><span class="line">在命令行停留之际，修改C:\ProgramData\chocolatey\lib\bazel\tools目录下的params.txt文件内容，将网络版本指定地址修改为本地地址  </span><br><span class="line">修改之前的：  </span><br><span class="line">``` </span><br><span class="line">https://github.com/bazelbuild/bazel/releases/download/0.12.0/bazel-0.12.0-windows-x86_64.zip</span><br><span class="line"></span><br><span class="line">// 此处是文件哈希，禁止修改，原来系统给予是怎样的就是怎样的。</span><br><span class="line">86f84e2c870ed14e4d2e599c309614298b9e08a049657e860d218d56873111bc</span><br></pre></td></tr></table></figure>

<p>修改之后的： 【由于我这里直接下载到桌面上，所以指向桌面地址，如果下载到其他位置，请将绝对地址替换，请勿复制粘贴此段】    </p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">C:</span><span class="hljs-regexp">/Users/</span>ke_li<span class="hljs-regexp">/Desktop/</span>bazel<span class="hljs-number">-0.12</span><span class="hljs-number">.0</span>-windows-x86_64.zip</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 此处是文件哈希，禁止修改，仅修改了上面文件目录，下面未修改，注意保留哈希的意思</span></span><br><span class="line"><span class="hljs-number">86</span>f84e2c870ed14e4d2e599c309614298b9e08a049657e860d218d56873111bc</span><br></pre></td></tr></table></figure>

<p>接下来输入y，回车进行下一阶段，等待一段时间后，结果：</p>
<p><img src="/images/pasted-10.png" alt="upload successful"></p>
<p>可调试bazel，在命令行输入bazel 检查安装是否成功，如图所示即为成功安装</p>
<p><img src="/images/pasted-11.png" alt="upload successful"></p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-18T00:00:00.000Z">2019-07-18</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    30 分钟 read (About 4560 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/18/RestTemplate/">RestTemplate</a>
            
        </h1>
        <div class="content">
            <p>SpringBoot26 RestTemplate、WebClient<br>Springboot — 用更优雅的方式发HTTP请求(RestTemplate详解)<br>RestTemplate是Spring提供的用于访问Rest服务的客户端，RestTemplate提供了多种便捷访问远程Http服务的方法,能够大大提高客户端的编写效率。</p>
<p>我之前的HTTP开发是用apache的HttpClient开发，代码复杂，还得操心资源回收等。代码很复杂，冗余代码多，稍微截个图，这是我封装好的一个post请求工具：</p>
<p>本教程将带领大家实现Spring生态内RestTemplate的Get请求和Post请求还有exchange指定请求类型的实践和RestTemplate核心方法源码的分析，看完你就会用优雅的方式来发HTTP请求。</p>
<p>1.简述RestTemplate</p>
<p>是Spring用于同步client端的核心类，简化了与http服务的通信，并满足RestFul原则，程序代码可以给它提供URL，并提取结果。默认情况下，RestTemplate默认依赖jdk的HTTP连接工具。当然你也可以 通过setRequestFactory属性切换到不同的HTTP源，比如Apache HttpComponents、Netty和OkHttp。</p>
<p>RestTemplate能大幅简化了提交表单数据的难度，并且附带了自动转换JSON数据的功能，但只有理解了HttpEntity的组成结构（header与body），且理解了与uriVariables之间的差异，才能真正掌握其用法。这一点在Post请求更加突出，下面会介绍到。</p>
<p>该类的入口主要是根据HTTP的六个方法制定：</p>
<p>此外，exchange和excute可以通用上述方法。</p>
<p>在内部，RestTemplate默认使用HttpMessageConverter实例将HTTP消息转换成POJO或者从POJO转换成HTTP消息。默认情况下会注册主mime类型的转换器，但也可以通过setMessageConverters注册其他的转换器。</p>
<p>其实这点在使用的时候是察觉不到的，很多方法有一个responseType 参数，它让你传入一个响应体所映射成的对象，然后底层用HttpMessageConverter将其做映射</p>
<figure class="highlight lisp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HttpMessageConverterExtractor&lt;T&gt; responseExtractor =</span><br><span class="line">                new HttpMessageConverterExtractor&lt;&gt;(<span class="hljs-name">responseType</span>, getMessageConverters(), logger)<span class="hljs-comment">;</span></span><br></pre></td></tr></table></figure>

<p>HttpMessageConverter.java源码：</p>
<figure class="highlight gradle hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> HttpMessageConverter&lt;T&gt; &#123;</span><br><span class="line">        <span class="hljs-comment">//指示此转换器是否可以读取给定的类。</span></span><br><span class="line">    <span class="hljs-keyword">boolean</span> canRead(<span class="hljs-keyword">Class</span>&lt;?&gt; clazz, @Nullable MediaType mediaType);</span><br><span class="line"> </span><br><span class="line">        <span class="hljs-comment">//指示此转换器是否可以写给定的类。</span></span><br><span class="line">    <span class="hljs-keyword">boolean</span> canWrite(<span class="hljs-keyword">Class</span>&lt;?&gt; clazz, @Nullable MediaType mediaType);</span><br><span class="line"> </span><br><span class="line">        <span class="hljs-comment">//返回List&lt;MediaType&gt;</span></span><br><span class="line">    List&lt;MediaType&gt; getSupportedMediaTypes();</span><br><span class="line"> </span><br><span class="line">        <span class="hljs-comment">//读取一个inputMessage</span></span><br><span class="line">    T <span class="hljs-keyword">read</span>(<span class="hljs-keyword">Class</span>&lt;? <span class="hljs-keyword">extends</span> T&gt; clazz, HttpInputMessage inputMessage)</span><br><span class="line">            <span class="hljs-keyword">throws</span> IOException, HttpMessageNotReadableException;</span><br><span class="line"> </span><br><span class="line">        <span class="hljs-comment">//往output message写一个Object</span></span><br><span class="line">    <span class="hljs-keyword">void</span> <span class="hljs-keyword">write</span>(T t, @Nullable MediaType contentType, HttpOutputMessage outputMessage)</span><br><span class="line">            <span class="hljs-keyword">throws</span> IOException, HttpMessageNotWritableException;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在内部，RestTemplate默认使用SimpleClientHttpRequestFactory和DefaultResponseErrorHandler来分别处理HTTP的创建和错误，但也可以通过setRequestFactory和setErrorHandler来覆盖。</p>
<p>2.get请求实践</p>
<p>2.1.getForObject()方法</p>
<figure class="highlight vbscript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> &lt;T&gt; T getForObject(<span class="hljs-built_in">String</span> url, <span class="hljs-keyword">Class</span>&lt;T&gt; responseType, Object... uriVariables)&#123;&#125;</span><br><span class="line"><span class="hljs-keyword">public</span> &lt;T&gt; T getForObject(<span class="hljs-built_in">String</span> url, <span class="hljs-keyword">Class</span>&lt;T&gt; responseType, Map&lt;<span class="hljs-built_in">String</span>, ?&gt; uriVariables)</span><br><span class="line"><span class="hljs-keyword">public</span> &lt;T&gt; T getForObject(URI url, <span class="hljs-keyword">Class</span>&lt;T&gt; responseType)</span><br><span class="line">``` </span><br><span class="line">getForObject()其实比getForEntity()多包含了将HTTP转成POJO的功能，但是getForObject没有处理<span class="hljs-built_in">response</span>的能力。因为它拿到手的就是成型的pojo。省略了很多<span class="hljs-built_in">response</span>的信息。</span><br><span class="line"></span><br><span class="line"><span class="hljs-number">2.1</span><span class="hljs-number">.1</span> POJO:</span><br></pre></td></tr></table></figure>

<p>public class Notice {<br>    private int status;<br>    private Object msg;<br>    private List<databean> data;<br>}
public  class DataBean {<br>  private int noticeId;<br>  private String noticeTitle;<br>  private Object noticeImg;<br>  private long noticeCreateTime;<br>  private long noticeUpdateTime;<br>  private String noticeContent;<br>}</databean></p>
<figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">示例：2<span class="hljs-selector-class">.1</span><span class="hljs-selector-class">.2</span> 不带参的<span class="hljs-selector-tag">get</span>请求</span><br></pre></td></tr></table></figure>

<p>/**
     * 不带参的get请求<br>     */<br>    @Test<br>    public void restTemplateGetTest(){<br>        RestTemplate restTemplate = new RestTemplate();<br>        Notice notice = restTemplate.getForObject(“<a href="http://xxx.top/notice/list/1/5&quot;" target="_blank" rel="noopener">http://xxx.top/notice/list/1/5&quot;</a><br>                , Notice.class);<br>        System.out.println(notice);<br>    }
　　</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">控制台打印：</span><br></pre></td></tr></table></figure>

<dl><dt>INFO 19076 — [           main] c.w.s.c.w.c.HelloControllerTest</dt><dd>Started HelloControllerTest in 5.532 seconds (JVM running for 7.233)</dd></dl><p>Notice{status=200, msg=null, data=[DataBean{noticeId=21, noticeTitle=’aaa’, noticeImg=null,<br>noticeCreateTime=1525292723000, noticeUpdateTime=1525292723000, noticeContent=’</p><p>aaa</p>‘},<br>DataBean{noticeId=20, noticeTitle=’ahaha’, noticeImg=null, noticeCreateTime=1525291492000,<br>noticeUpdateTime=1525291492000, noticeContent=’<p>ah…….’</p>
<p>　</p>
<figure class="highlight lsl hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">示例：<span class="hljs-number">2.1</span><span class="hljs-number">.3</span> 带参数的get请求<span class="hljs-number">1</span></span><br></pre></td></tr></table></figure>

<p>Notice notice = restTemplate.getForObject(“<a href="http://fantj.top/notice/list/{1}/{2}&quot;" target="_blank" rel="noopener">http://fantj.top/notice/list/{1}/{2}&quot;</a><br>                , Notice.class,1,5);</p>
<figure class="highlight lsl hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">明眼人一眼能看出是用了占位符&#123;<span class="hljs-number">1</span>&#125;。</span><br><span class="line"></span><br><span class="line">示例：<span class="hljs-number">2.1</span><span class="hljs-number">.4</span> 带参数的get请求<span class="hljs-number">2</span></span><br></pre></td></tr></table></figure>

<p>Map&lt;String,String&gt; map = new HashMap();<br>        map.put(“start”,”1”);<br>        map.put(“page”,”5”);<br>        Notice notice = restTemplate.getForObject(“<a href="http://fantj.top/notice/list/&quot;" target="_blank" rel="noopener">http://fantj.top/notice/list/&quot;</a><br>                , Notice.class,map);
　　</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">明眼人一看就是利用<span class="hljs-built_in">map</span>装载参数，不过它默认解析的是PathVariable的url形式。</span><br><span class="line"></span><br><span class="line"><span class="hljs-number">2.2</span> getForEntity()方法</span><br></pre></td></tr></table></figure>

<p>public <t> ResponseEntity<t> getForEntity(String url, Class<t> responseType, Object… uriVariables){}<br>public <t> ResponseEntity<t> getForEntity(String url, Class<t> responseType, Map&lt;String, ?&gt; uriVariables){}<br>public <t> ResponseEntity<t> getForEntity(URI url, Class<t> responseType){}<br> <figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">与getForObject()方法不同的是返回的是ResponseEntity对象，如果需要转换成pojo，还需要json工具类的引入，这个按个人喜好用。不会解析json的可以百度FastJson或者Jackson等工具类。然后我们就研究一下ResponseEntity下面有啥方法。</span><br><span class="line"></span><br><span class="line">ResponseEntity、HttpStatus、BodyBuilder结构</span><br><span class="line"></span><br><span class="line">ResponseEntity.java</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> HttpStatus <span class="hljs-title">getStatusCode</span><span class="hljs-params">()</span></span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getStatusCodeValue</span><span class="hljs-params">()</span></span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(@Nullable Object other)</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> BodyBuilder <span class="hljs-title">status</span><span class="hljs-params">(HttpStatus status)</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> BodyBuilder <span class="hljs-title">ok</span><span class="hljs-params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">ResponseEntity&lt;T&gt; <span class="hljs-title">ok</span><span class="hljs-params">(T body)</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> BodyBuilder <span class="hljs-title">created</span><span class="hljs-params">(URI location)</span> </span>&#123;&#125;</span><br><span class="line">...</span><br><span class="line">　　</span><br><span class="line"></span><br><span class="line">HttpStatus.java</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> HttpStatus &#123;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">is1xxInformational</span><span class="hljs-params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">is2xxSuccessful</span><span class="hljs-params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">is3xxRedirection</span><span class="hljs-params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">is4xxClientError</span><span class="hljs-params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">is5xxServerError</span><span class="hljs-params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isError</span><span class="hljs-params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">　　</span><br><span class="line"></span><br><span class="line">BodyBuilder.java</span><br></pre></td></tr></table></figure></t></t></t></t></t></t></t></t></t></p>
<p>public interface BodyBuilder extends HeadersBuilder<bodybuilder> {<br>    //设置正文的长度，以字节为单位，由Content-Length标头<br>      BodyBuilder contentLength(long contentLength);<br>    //设置body的MediaType 类型<br>      BodyBuilder contentType(MediaType contentType);<br>    //设置响应实体的主体并返回它。<br>      <t> ResponseEntity<t> body(@Nullable T body);<br>｝
 <figure class="highlight armasm hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">可以看出来，ResponseEntity包含了HttpStatus和<span class="hljs-keyword">BodyBuilder的这些信息，这更方便我们处理response原生的东西。</span></span><br><span class="line"><span class="hljs-keyword"></span></span><br><span class="line"><span class="hljs-keyword">示例：</span></span><br></pre></td></tr></table></figure></t></t></bodybuilder></p>
<p>@Test<br>public void rtGetEntity(){<br>        RestTemplate restTemplate = new RestTemplate();<br>        ResponseEntity<notice> entity = restTemplate.getForEntity(“<a href="http://fantj.top/notice/list/1/5&quot;" target="_blank" rel="noopener">http://fantj.top/notice/list/1/5&quot;</a><br>                , Notice.class);</notice></p>
<pre><code>    HttpStatus statusCode = entity.getStatusCode();
    System.out.println(&quot;statusCode.is2xxSuccessful()&quot;+statusCode.is2xxSuccessful());

    Notice body = entity.getBody();
    System.out.println(&quot;entity.getBody()&quot;+body);


    ResponseEntity.BodyBuilder status = ResponseEntity.status(statusCode);
    status.contentLength(100);
    status.body(&quot;我在这里添加一句话&quot;);
    ResponseEntity&lt;Class&lt;Notice&gt;&gt; body1 = status.body(Notice.class);
    Class&lt;Notice&gt; body2 = body1.getBody();
    System.out.println(&quot;body1.toString()&quot;+body1.toString());
}</code></pre> <figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">statusCode.is2xxSuccessful()<span class="hljs-literal">true</span></span><br><span class="line">entity.getBody()Notice&#123;<span class="hljs-attribute">status</span>=200, <span class="hljs-attribute">msg</span>=<span class="hljs-literal">null</span>, data=[DataBean&#123;<span class="hljs-attribute">noticeId</span>=21, <span class="hljs-attribute">noticeTitle</span>=<span class="hljs-string">'aaa'</span>, <span class="hljs-built_in">..</span>.</span><br><span class="line">body1.toString()&lt;200 OK,class com.waylau.spring.cloud.weather.pojo.Notice,&#123;Content-Length=[100]&#125;&gt;</span><br><span class="line"></span><br><span class="line">　</span><br><span class="line"></span><br><span class="line">当然，还有getHeaders()等方法没有举例。</span><br><span class="line"></span><br><span class="line">3. post请求实践</span><br><span class="line"></span><br><span class="line">同样的,post请求也有postForObject和postForEntity。</span><br></pre></td></tr></table></figure>

<p>public <t> T postForObject(String url, @Nullable Object request, Class<t> responseType, Object… uriVariables)<br>            throws RestClientException {}<br>public <t> T postForObject(String url, @Nullable Object request, Class<t> responseType, Map&lt;String, ?&gt; uriVariables)<br>            throws RestClientException {}<br>public <t> T postForObject(URI url, @Nullable Object request, Class<t> responseType) throws RestClientException {}</t></t></t></t></t></t></p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">示例</span><br><span class="line"></span><br><span class="line">我用一个验证邮箱的接口来测试。</span><br></pre></td></tr></table></figure>

<p>@Test<br>public void rtPostObject(){<br>    RestTemplate restTemplate = new RestTemplate();<br>    String url = “<a href="http://47.xxx.xxx.96/register/checkEmail&quot;" target="_blank" rel="noopener">http://47.xxx.xxx.96/register/checkEmail&quot;</a>;
    HttpHeaders headers = new HttpHeaders();<br>    headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);<br>    MultiValueMap&lt;String, String&gt; map= new LinkedMultiValueMap&lt;&gt;();<br>    map.add(“email”, “<a href="mailto:844072586@qq.com" target="_blank" rel="noopener">844072586@qq.com</a>“);</p>
<pre><code>HttpEntity&lt;MultiValueMap&lt;String, String&gt;&gt; request = new HttpEntity&lt;&gt;(map, headers);
ResponseEntity&lt;String&gt; response = restTemplate.postForEntity( url, request , String.class );
System.out.println(response.getBody());</code></pre><p>}
　</p>
<figure class="highlight dart hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">执行结果：</span><br><span class="line"></span><br><span class="line">&#123;<span class="hljs-string">"status"</span>:<span class="hljs-number">500</span>,<span class="hljs-string">"msg"</span>:<span class="hljs-string">"该邮箱已被注册"</span>,<span class="hljs-string">"data"</span>:<span class="hljs-keyword">null</span>&#125;</span><br><span class="line">Springboot -- 用更优雅的方式发HTTP请求(RestTemplate详解)</span><br><span class="line"></span><br><span class="line">代码中，MultiValueMap是<span class="hljs-built_in">Map</span>的一个子类，它的一个key可以存储多个value，简单的看下这个接口：</span><br><span class="line"></span><br><span class="line">public <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MultiValueMap</span>&lt;<span class="hljs-title">K</span>, <span class="hljs-title">V</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">Map</span>&lt;<span class="hljs-title">K</span>, <span class="hljs-title">List</span>&lt;<span class="hljs-title">V</span>&gt;&gt; </span>&#123;...&#125;</span><br><span class="line"> </span><br><span class="line">为什么用MultiValueMap?因为HttpEntity接受的request类型是它。</span><br><span class="line"></span><br><span class="line">public HttpEntity(<span class="hljs-meta">@Nullable</span> T body, <span class="hljs-meta">@Nullable</span> MultiValueMap&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt; headers)&#123;&#125;</span><br><span class="line"><span class="hljs-comment">//我这里只展示它的一个construct,从它可以看到我们传入的map是请求体，headers是请求头。</span></span><br><span class="line">　　</span><br><span class="line"></span><br><span class="line">为什么用HttpEntity是因为restTemplate.postForEntity方法虽然表面上接收的request是<span class="hljs-meta">@Nullable</span> <span class="hljs-built_in">Object</span> request类型，但是你追踪下去会发现，这个request是用HttpEntity来解析。核心代码如下：</span><br></pre></td></tr></table></figure>

<p>if (requestBody instanceof HttpEntity) {<br>    this.requestEntity = (HttpEntity&lt;?&gt;) requestBody;<br>}else if (requestBody != null) {<br>    this.requestEntity = new HttpEntity&lt;&gt;(requestBody);<br>}else {<br>    this.requestEntity = HttpEntity.EMPTY;<br>}
　</p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">我曾尝试用<span class="hljs-selector-tag">map</span>来传递参数，编译不会报错，但是执行不了，是无效的<span class="hljs-selector-tag">url</span> <span class="hljs-selector-tag">request</span>请求(<span class="hljs-number">400</span> ERROR)。其实这样的请求方式已经满足<span class="hljs-selector-tag">post</span>请求了，<span class="hljs-selector-tag">cookie</span>也是属于<span class="hljs-selector-tag">header</span>的一部分。可以按需求设置请求头和请求体。其它方法与之类似。</span><br><span class="line"></span><br><span class="line"><span class="hljs-selector-tag">4</span>.使用<span class="hljs-selector-tag">exchange</span>指定调用方式</span><br><span class="line"></span><br><span class="line"><span class="hljs-selector-tag">exchange</span>()方法跟上面的<span class="hljs-selector-tag">getForObject</span>()、<span class="hljs-selector-tag">getForEntity</span>()、<span class="hljs-selector-tag">postForObject</span>()、<span class="hljs-selector-tag">postForEntity</span>()等方法不同之处在于它可以指定请求的<span class="hljs-selector-tag">HTTP</span>类型。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">但是你会发现<span class="hljs-selector-tag">exchange</span>的方法中似乎都有@<span class="hljs-selector-tag">Nullable</span> <span class="hljs-selector-tag">HttpEntity</span> <span class="hljs-selector-tag">requestEntity</span>这个参数，这就意味着我们至少要用<span class="hljs-selector-tag">HttpEntity</span>来传递这个请求体，之前说过源码所以建议就使用<span class="hljs-selector-tag">HttpEntity</span>提高性能。</span><br><span class="line"></span><br><span class="line">示例</span><br></pre></td></tr></table></figure>

<p>@Test<br>    public void rtExchangeTest() throws JSONException {<br>        RestTemplate restTemplate = new RestTemplate();<br>        String url = “<a href="http://xxx.top/notice/list&quot;" target="_blank" rel="noopener">http://xxx.top/notice/list&quot;</a>;
        HttpHeaders headers = new HttpHeaders();<br>        headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);<br>        JSONObject jsonObj = new JSONObject();<br>        jsonObj.put(“start”,1);<br>        jsonObj.put(“page”,5);</p>
<pre><code>    HttpEntity&lt;String&gt; entity = new HttpEntity&lt;&gt;(jsonObj.toString(), headers);
    ResponseEntity&lt;JSONObject&gt; exchange = restTemplate.exchange(url,
                                      HttpMethod.GET, entity, JSONObject.class);
    System.out.println(exchange.getBody());
}</code></pre> <figure class="highlight dart hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">这次可以看到，我使用了JSONObject对象传入和返回。</span><br><span class="line">当然，HttpMethod方法还有很多，用法类似。</span><br><span class="line"></span><br><span class="line"><span class="hljs-number">5.</span>excute()指定调用方式</span><br><span class="line"></span><br><span class="line">excute()的用法与exchange()大同小异了，它同样可以指定不同的HttpMethod，不同的是它返回的对象是响应体所映射成的对象，而不是ResponseEntity。</span><br><span class="line"></span><br><span class="line">需要强调的是，execute()方法是以上所有方法的底层调用。随便看一个：</span><br><span class="line"></span><br><span class="line">```    </span><br><span class="line"><span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-meta">@Nullable</span></span><br><span class="line">    public &lt;T&gt; T postForObject(<span class="hljs-built_in">String</span> url, <span class="hljs-meta">@Nullable</span> <span class="hljs-built_in">Object</span> request, Class&lt;T&gt; responseType, <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, ?&gt; uriVariables)</span><br><span class="line">            throws RestClientException &#123;</span><br><span class="line"> </span><br><span class="line">        RequestCallback requestCallback = httpEntityCallback(request, responseType);</span><br><span class="line">        HttpMessageConverterExtractor&lt;T&gt; responseExtractor =</span><br><span class="line">                <span class="hljs-keyword">new</span> HttpMessageConverterExtractor&lt;&gt;(responseType, getMessageConverters(), logger);</span><br><span class="line">        <span class="hljs-keyword">return</span> execute(url, HttpMethod.POST, requestCallback, responseExtractor, uriVariables);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<h3 id="1-RestTemplate"><a href="#1-RestTemplate" class="headerlink" title="1 RestTemplate"></a>1 RestTemplate</h3><p>　　RestTemplate是在客户端访问 Restful 服务的一个核心类；RestTemplate通过提供回调方法和允许配置信息转换器来实现个性化定制RestTemplate的功能，通过RestTemplate可以封装请求对象，也可以对响应对象进行解析。</p>
<p><img src="/images/rst.png" alt="upload successful"><br>技巧01：RestTemplate默认使用JDK提供的包去建立HTTP连接，当然，开发者也可以使用诸如 Apache HttpComponents, Netty, and OkHttp 去建立HTTP连接。<br>　　技巧02：RestTemplate内部默认使用HttpMessageConverter来实现HTTTP messages 和 POJO 之间的转换，可以通过RestTemplate的成员方  法 setMessageConverters(java.util.List&lt;org.springframework.http.converter.HttpMessageConverter&lt;?&gt;&gt;). 去修改默认的转换器。<br>　　技巧03：RestTemplate内部默认使用SimpleClientHttpRequestFactory and DefaultResponseErrorHandler 去创建HTTP连接和处理HTTP错误，可以通过HttpAccessor.setRequestFactory(org.springframework.http.client.ClientHttpRequestFactory) and setErrorHandler(org.springframework.web.client.ResponseErrorHandler)去做相应的修改。<br>　　##### 1.1 RestTemplate中方法概览<br>　　　　RestTemplate为每种HTTP请求都实现了相关的请求封装方法<br>技巧01：这些方法的命名是有讲究的，方法名的第一部分表示HTTP请求类型，方法名的第二部分表示响应类型<br>  例如：getForObject 表示执行GET请求并将响应转化成一个Object类型的对象　</p>
<p>技巧02：利用RestTemplate封装客户端发送HTTP请求时，如果出现异常就会抛出 RestClientException 类型的异常；可以通过在创建RestTemplate对象的时候指定一个ResponseErrorHandler类型的异常处理类来处理这个异常 </p>
<p>技巧03：exchange 和 excute 这两个方法是通用的HTTP请求方法，而且这两个方法还支持额外的HTTP请求类型【PS: 前提是使用的HTTP连接包也支持这些额外的HTTP请求类型】  </p>
<p><img src="/images/htt.png" alt="upload successful"><br>　技巧04：每种方法都有3个重载方法，其中两个接收String类型的请求路径和响应类型、参数；另外一个接收URI类型的请求路径和响应类型。  </p>
<p><img src="/images/ty.png" alt="upload successful"><br>技巧05：使用String类型的请求路径时，RestTemplate会自动进行一次编码，所以为了避免重复编码问题最好使用URI类型的请求路径<br>例如：restTemplate.getForObject(“<a href="http://example.com/hotel" target="_blank" rel="noopener">http://example.com/hotel</a> list”) becomes”<a href="http://example.com/hotel%20list&quot;" target="_blank" rel="noopener">http://example.com/hotel%20list&quot;</a><br>技巧06：URI 和URL 知识点扫盲</p>
<p><img src="/images/ecd.png" alt="upload successful"><br>技巧06：利用接收URI参数的RestTemplate.getForObject方法发送Get请求</p>
<p><img src="/images/gt.png" alt="upload successful"><br>　##### 1.2 常用构造器<br>　　　　技巧01：利用无参构造器创建RestTemplate实例时，什么都是使用默认的【即：使用HttpMessageConverter来实现HTTTP messages 和 POJO 之间的转换、使用SimpleClientHttpRequestFactory and DefaultResponseErrorHandler 去创建HTTP连接和处理HTTP错误】<br>　　　　技巧02：利用 RestTemplate(ClientHttpRequestFactory requestFactory) 创建RestTemplate实例时使用自定义的requestFactory去创建HTTP连接<br>　　　　技巧03：利用 RestTemplate(java.util.List&lt;HttpMessageConverter&lt;?&gt;&gt; messageConverters)  创建RestTemplate实例时使用自定义的转换器列表实现HTTTP messages 和 POJO 之间的转换  </p>
<p><img src="/images/cnst.png" alt="upload successful"></p>
<h5 id="1-3-GET相关方法"><a href="#1-3-GET相关方法" class="headerlink" title="1.3 GET相关方法"></a>1.3 GET相关方法</h5><p>　　　　技巧01：本博文使用的是SpringBoot项目，利用了一个配置文件来将RestTemplate注入的容器中 </p>
<p> #######1.3.1 public <t> T getForObject(String url, Class<t> responseType, Object… uriVariables)<br>1》远程服务代码【不带请求参数的】</t></t></p>
<p><img src="/images/rm.png" alt="upload successful"><br>1》模拟客户端代码【不带请求参数的】</p>
<p><img src="/images/cl.png" alt="upload successful"><br>2》远程服务代码【带请求参数的】<br>　技巧01：HTTP请求中url路径？后面的参数就是请求参数格式以 key=value 的形式传递；后台需要用@RequestParam注解，如果前端的 key 和 后台方法的参数名称一致时可以不用@RequestParam注解【因为@RequestParam注解时默认的参数注解】<br>　技巧02：对于请求参数，最好在服务端利用@RequestParam注解设置该请求参数为非必传参数并设定默认值  </p>
<p><img src="/images/dc.png" alt="upload successful"><br>2》模拟客户端代码【带请求参数的】</p>
<p><img src="/images/mn.png" alt="upload successful"><br>3》远程服务代码【带路径参数的】<br>　技巧01：HTTP请求的路径可以成为路径参数，前提是服务端进行路径配置【即：需要配合@RequestMapping和@PathVariable一起使用】<br>　技巧02：由于路径参数不能设置默认是，所以在后台通过@PathVariable将路径参数设置成必传可以减少出错率<br>　技巧03：@PathVariable可以设置正则表达式【详情参见：<a href="https://www.cnblogs.com/NeverCtrl-C/p/8185576.html】" target="_blank" rel="noopener">https://www.cnblogs.com/NeverCtrl-C/p/8185576.html】</a>  </p>
<p><img src="/images/lj.png" alt="upload successful"><br>3》模拟客户端代码【带路径参数的】</p>
<p><img src="/images/lj2.png" alt="upload successful"><br>4》远程服务代码【带路径参数和请求参数的】<br>　技巧01： @PathVariable和@RequestParam都可以设定是否必传【默认必传】<br>　技巧02：@PathVariable不可以设定默认值，@RequestParam可以设定默认值【默认值就是不传入的时候代替的值】<br>　技巧03： @PathVariable如果设置必传为true，前端不传入时就会报错【技巧：开启必传】<br>　技巧04：@RequestParam如果设置必传为true，前端不传入还是也会报错【技巧：关闭必传，开启默认值】<br>　技巧05：@PathVariable可以设置正则表达式【详情参见：<a href="https://www.cnblogs.com/NeverCtrl-C/p/8185576.html】" target="_blank" rel="noopener">https://www.cnblogs.com/NeverCtrl-C/p/8185576.html】</a>  </p>
<p><img src="/images/dlhc.png" alt="upload successful"><br>4》模拟客户端代码【带路径参数和请求参数的】</p>
<p><img src="/images/lc.png" alt="upload successful">  </p>
<p>#######     1.3.2  public <t> T getForObject(String url, Class<t> responseType, Map&lt;String, ?&gt; uriVariables)<br> 　　　　　　1》远程服务代码【带请求参数的】</t></t></p>
<p><img src="/images/dqcs.png" alt="upload successful"><br>1》模拟客户端代码【带请求参数的】</p>
<p><img src="/images/kc.png" alt="upload successful"></p>
<p>#######　1.3.3 public <t> ResponseEntity<t> getForEntity(String url, Class<t> responseType, Object… uriVariables)<br>技巧01：getForObject 和 getForEntity 的区别：后者可以获取到更多的响应信息，前者这可以获取到响应体的数据<br>1》远程服务代码【不带请求参数的】</t></t></t></p>
<p><img src="/images/bdc.png" alt="upload successful"><br>　1》模拟客户端代码【不带请求参数的】</p>
<p><img src="/images/mncbd.png" alt="upload successful"><br>  2》远程服务代码【带请求参数的】</p>
<p><img src="/images/pasted-0.png" alt="filename already exists, renamed"><br>2》模拟客户端代码【带请求参数的】</p>
<p><img src="/images/pasted-1.png" alt="upload successful"><br>3》远程服务代码【带路径参数的】<br><img src="/images/pasted-2.png" alt="upload successful"><br>3》模拟客户端代码【带路径参数的】<br><img src="/images/pasted-3.png" alt="upload successful"><br>4》远程服务代码【带路径参数和请求参数的】<br><img src="/images/pasted-4.png" alt="upload successful"><br>4》模拟客户端代码【带路径参数和请求参数的】<br><img src="/images/pasted-5.png" alt="upload successful"></p>
<p>#######　　1.3.4 public <t> ResponseEntity<t> getForEntity(String url, Class<t> responseType, Map&lt;String, ?&gt; uriVariables)<br>1》远程服务代码【带请求参数的】  </t></t></t></p>
<p><img src="/images/pasted-6.png" alt="upload successful"><br> 1》模拟客户端代码【带请求参数的】</p>
<p><img src="/images/pasted-7.png" alt="upload successful"></p>
<p>#####　1.4 POST<br>服务端源代码：点击前往</p>
<p>#######　1.4.1 public <t> T postForObject(String url, @Nullable Object request, Class<t> responseType, Object… uriVariables)<br>　　　　　　参数解释：<br>　　　　　　　　url -&gt; String类型的请求路径<br>　　　　　　　　request -&gt; 请求体对象<br>　　　　　　　　responseType -&gt; 响应数据类型<br>　　　　　　　　uriVariables -&gt; 请求参数  </t></t></p>
<p>#######　　　　1.4.2 public <t> T postForObject(String url, @Nullable Object request, Class<t> responseType, Map&lt;String, ?&gt; uriVariables)<br>　　　　　　参数解释：<br>　　　　　　　　url -&gt; String类型的请求路径<br>　　　　　　　　request -&gt; 请求体对象<br>　　　　　　　　responseType -&gt; 响应数据类型<br>　　　　　　　　uriVariables -&gt; 请求参数  </t></t></p>
<p>#######　　　　1.4.3 public <t> T postForObject(URI url, @Nullable Object request, Class<t> responseType)<br>　　　　　　参数解释：<br>　　　　　　　　url -&gt; URI类型的请求路径<br>　　　　　　　　request -&gt; 请求体对象<br>　　　　　　　　responseType -&gt; 响应数据类型  </t></t></p>
<p>#######　　　　1.4.4 请求体对象说明<br>　技巧01：请求体对象（@Nullable Object request）可以直接传一个实体，服务端利用@RequestBody接收这个实体即可<br>　技巧02：请求体对象（@Nullable Object request）也可以传入一个  HttpEntity 的实例，服务端的代码不变；创建 HttpEntity 实例时可以设定请求体数据和请求头数据（详情请参见 HttpEntity 的相关构造函数）  </p>
<p><img src="/images/pasted-8.png" alt="upload successful"></p>
<h5 id="1-5-其他请求和GET、POST类似"><a href="#1-5-其他请求和GET、POST类似" class="headerlink" title="1.5 其他请求和GET、POST类似"></a>1.5 其他请求和GET、POST类似</h5><p>　　　　待更新……  </p>
<h3 id="2-WebClient"><a href="#2-WebClient" class="headerlink" title="2 WebClient"></a>2 WebClient</h3><p>　　WebClient 是一个非阻塞、响应式的HTTP客户端，它以响应式被压流的方式执行HTTP请求；WebClient默认使用 Reactor Netty 作为HTTP连接器，当然也可以通过 ClientHttpConnector修改其它的HTTP连接器。<br>　　技巧01：使用WebClient需要进入Spring5的相关依赖，如果使用的是SpringBoot项目的话直接引入下面的依赖就可以啦<br>  <figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p> WebClient源码<br>　　##### 2.1 创建WebClient实例的方式<br>　　　　技巧01：从WebClient的源码中可以看出，WebClient接口提供了三个静态方法来创建WebClient实例</p>
<p>@Bean注入</p>
<figure class="highlight haxe hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">   <span class="hljs-keyword">public</span> RestTemplate restTemplate()&#123;</span><br><span class="line">       RestTemplate restTemplate = <span class="hljs-keyword">new</span> <span class="hljs-type">RestTemplate</span>();;</span><br><span class="line">       restTemplate.setRequestFactory(<span class="hljs-keyword">new</span> <span class="hljs-type">HttpComponentsClientHttpRequestFactory</span>());</span><br><span class="line">       MappingJackson2HttpMessageConverter converter = <span class="hljs-keyword">new</span> <span class="hljs-type">MappingJackson2HttpMessageConverter</span>();</span><br><span class="line">       converter.setSupportedMediaTypes(Collections.singletonList(MediaType.ALL));</span><br><span class="line">       restTemplate.getMessageConverters().add(converter);</span><br><span class="line">       <span class="hljs-keyword">return</span> restTemplate;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<p> 使用：</p>
 <figure class="highlight processing hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> MultiValueMap&lt;<span class="hljs-keyword">String</span>, <span class="hljs-keyword">Object</span>&gt; headers = <span class="hljs-keyword">new</span> LinkedMultiValueMap&lt;<span class="hljs-keyword">String</span>, <span class="hljs-keyword">Object</span>&gt;();</span><br><span class="line">headers.<span class="hljs-built_in">add</span>(<span class="hljs-string">"Accept"</span>, <span class="hljs-string">"application/json"</span>);</span><br><span class="line">headers.<span class="hljs-built_in">add</span>(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>);</span><br><span class="line">HttpEntity request = <span class="hljs-keyword">new</span> HttpEntity(requestBody, headers);</span><br><span class="line"><span class="hljs-keyword">Object</span> sqlResult = restTemplate.postForObject(logConf.getAccessAddr() + <span class="hljs-string">"/_sql"</span>, request, <span class="hljs-keyword">Object</span>.class);</span><br></pre></td></tr></table></figure>


        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-17T22:31:00.000Z">2019-07-17</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    5 分钟 read (About 776 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/18/StringRedisTemplate/">StringRedisTemplate  &amp; redisTemplate</a>
            
        </h1>
        <div class="content">
            <h5 id="RedisTemplate和StringRedisTemplate的区别"><a href="#RedisTemplate和StringRedisTemplate的区别" class="headerlink" title="RedisTemplate和StringRedisTemplate的区别"></a>RedisTemplate和StringRedisTemplate的区别</h5><ol>
<li><p>两者的关系是StringRedisTemplate继承RedisTemplate。</p>
</li>
<li><p>两者的数据是<font color="red">不共通的</font>；也就是说StringRedisTemplate只能管理StringRedisTemplate里面的数据，RedisTemplate只能管理RedisTemplate中的数据。</p>
</li>
<li><p>SDR默认采用的序列化策略有两种，一种是String的序列化策略，一种是JDK的序列化策略。</p>
</li>
</ol>
<p>StringRedisTemplate默认采用的是String的序列化策略，保存的key和value都是采用此策略序列化保存的。</p>
<p>RedisTemplate默认采用的是JDK的序列化策略，保存的key和value都是采用此策略序列化保存的。</p>
<p>RedisTemplate使用的序列类在在操作数据的时候，比如说存入数据会将数据先序列化成字节数组然后在存入Redis数据库，这个时候打开Redis查看的时候，你会看到你的数据不是以可读的形式展现的，而是以字节数组显示，类似下面</p>
<p>当然从Redis获取数据的时候也会默认将数据当做字节数组转化，这样就会导致一个问题，当需要获取的数据不是以字节数组存在redis当中而是正常的可读的字符串的时候，比如说下面这种形式的数据</p>
<p>注：使用的软件是RedisDesktopManager</p>
<p>RedisTemplate就无法获取到数据，这个时候获取到的值就是NULL。这个时候StringRedisTempate就派上了用场。</p>
<p><strong>当Redis当中的数据值是以可读的形式显示出来的时候，只能使用StringRedisTemplate才能获取到里面的数据。</strong></p>
<p>所以当你使用RedisTemplate获取不到数据的时候请检查一下是不是Redis里面的数据是可读形式而非字节数组</p>
<p>另外我在测试的时候即使把StringRedisTemplate的序列化类修改成RedisTemplate的JdkSerializationRedisSerializer</p>
<p>最后还是无法获取被序列化的对象数据，即使是没有转化为对象的字节数组，代码如下</p>
<figure class="highlight arduino hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">@Test  </span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> testRedisSerializer()&#123;  </span><br><span class="line">    User u = <span class="hljs-keyword">new</span> User();  </span><br><span class="line">    u.setName(<span class="hljs-string">"java"</span>);  </span><br><span class="line">    u.setSex(<span class="hljs-string">"male"</span>);  </span><br><span class="line">    redisTemplate.opsForHash().<span class="hljs-built_in">put</span>(<span class="hljs-string">"user:"</span>,<span class="hljs-string">"1"</span>,u);  </span><br><span class="line">    <span class="hljs-comment">/*查看redisTemplate 的Serializer*/</span>  </span><br><span class="line">    System.out.<span class="hljs-built_in">println</span>(redisTemplate.getKeySerializer());  </span><br><span class="line">    System.out.<span class="hljs-built_in">println</span>(redisTemplate.getValueSerializer());  </span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment">/*查看StringRedisTemplate 的Serializer*/</span>  </span><br><span class="line">    System.out.<span class="hljs-built_in">println</span>(stringRedisTemplate.getValueSerializer());  </span><br><span class="line">    System.out.<span class="hljs-built_in">println</span>(stringRedisTemplate.getValueSerializer());  </span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment">/*将stringRedisTemplate序列化类设置成RedisTemplate的序列化类*/</span>  </span><br><span class="line">    stringRedisTemplate.setKeySerializer(<span class="hljs-keyword">new</span> JdkSerializationRedisSerializer());  </span><br><span class="line">    stringRedisTemplate.setValueSerializer(<span class="hljs-keyword">new</span> JdkSerializationRedisSerializer());  </span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment">/*即使在更换stringRedisTemplate的的Serializer和redisTemplate一致的 </span></span><br><span class="line"><span class="hljs-comment">    * JdkSerializationRedisSerializer </span></span><br><span class="line"><span class="hljs-comment">    * 最后还是无法从redis中获取序列化的数据 </span></span><br><span class="line"><span class="hljs-comment">    * */</span>  </span><br><span class="line">    System.out.<span class="hljs-built_in">println</span>(stringRedisTemplate.getValueSerializer());  </span><br><span class="line">    System.out.<span class="hljs-built_in">println</span>(stringRedisTemplate.getValueSerializer());  </span><br><span class="line">    </span><br><span class="line">    User user = (User)  redisTemplate.opsForHash().<span class="hljs-built_in">get</span>(<span class="hljs-string">"user:"</span>,<span class="hljs-string">"1"</span>);  </span><br><span class="line">    User  user2 = (User) stringRedisTemplate.opsForHash().<span class="hljs-built_in">get</span>(<span class="hljs-string">"user:"</span>,<span class="hljs-string">"1"</span>);  </span><br><span class="line">    System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"dsd"</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Debug结果</p>
<table><td>
总结：  

<p>当你的redis数据库里面本来存的是字符串数据或者你要存取的数据就是字符串类型数据的时候，那么你就使用StringRedisTemplate即可，但是如果你的数据是复杂的对象类型，而取出的时候又不想做任何的数据转换，直接从Redis里面取出一个对象，那么使用RedisTemplate是更好的选择。</p>
</td></table>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-17T21:12:00.000Z">2019-07-17</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    10 分钟 read (About 1556 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/18/registry/">registry center compare Eureka or ZooKeeper</a>
            
        </h1>
        <div class="content">
            <p>Eureka的工作原理以及它与ZooKeeper的区别<br>1、Eureka 简介：  </p>
<p>Eureka 是 Netflix 出品的用于实现服务注册和发现的工具。 Spring Cloud 集成了 Eureka，并提供了开箱即用的支持。其中， Eureka 又可细分为 Eureka Server 和 Eureka Client。  </p>
<p>1.基本原理<br>上图是来自eureka的官方架构图，这是基于集群配置的eureka；   </p>
<ul>
<li>处于不同节点的eureka通过Replicate进行数据同步   </li>
<li>Application Service为服务提供者   </li>
<li>Application Client为服务消费者   </li>
<li>Make Remote Call完成一次服务调用  </li>
</ul>
<p>服务启动后向Eureka注册，Eureka Server会将注册信息向其他Eureka Server进行同步，当服务消费者要调用服务提供者，则向服务注册中心获取服务提供者地址，然后会将服务提供者地址缓存在本地，下次再调用时，则直接从本地缓存中取，完成一次调用。  </p>
<p>当服务注册中心Eureka Server检测到服务提供者因为宕机、网络原因不可用时，则在服务注册中心将服务置为DOWN状态，并把当前服务提供者状态向订阅者发布，订阅过的服务消费者更新本地缓存。  </p>
<p>服务提供者在启动后，周期性（默认30秒）向Eureka Server发送心跳，以证明当前服务是可用状态。Eureka Server在一定的时间（默认90秒）未收到客户端的心跳，则认为服务宕机，注销该实例。  </p>
<p>2.Eureka的自我保护机制<br>在默认配置中，Eureka Server在默认90s没有得到客户端的心跳，则注销该实例，但是往往因为微服务跨进程调用，网络通信往往会面临着各种问题，比如微服务状态正常，但是因为网络分区故障时，Eureka Server注销服务实例则会让大部分微服务不可用，这很危险，因为服务明明没有问题。  </p>
<p>为了解决这个问题，Eureka 有自我保护机制，通过在Eureka Server配置如下参数，可启动保护机制  </p>
<p>eureka.server.enable-self-preservation=true<br>它的原理是，当Eureka Server节点在短时间内丢失过多的客户端时（可能发送了网络故障），那么这个节点将进入自我保护模式，不再注销任何微服务，当网络故障回复后，该节点会自动退出自我保护模式。  </p>
<p>自我保护模式的架构哲学是宁可放过一个，决不可错杀一千  </p>
<ol start="3">
<li>作为服务注册中心，Eureka比Zookeeper好在哪里<br>著名的CAP理论指出，一个分布式系统不可能同时满足C(一致性)、A(可用性)和P(分区容错性)。由于分区容错性在是分布式系统中必须要保证的，因此我们只能在A和C之间进行权衡。在此Zookeeper保证的是CP, 而Eureka则是AP。  </li>
</ol>
<p>3.1 Zookeeper保证CP<br>当向注册中心查询服务列表时，我们可以容忍注册中心返回的是几分钟以前的注册信息，但不能接受服务直接down掉不可用。也就是说，服务注册功能对可用性的要求要高于一致性。但是zk会出现这样一种情况，当master节点因为网络故障与其他节点失去联系时，剩余节点会重新进行leader选举。问题在于，选举leader的时间太长，30 ~ 120s, 且选举期间整个zk集群都是不可用的，这就导致在选举期间注册服务瘫痪。在云部署的环境下，因网络问题使得zk集群失去master节点是较大概率会发生的事，虽然服务能够最终恢复，但是漫长的选举时间导致的注册长期不可用是不能容忍的。  </p>
<p>3.2 Eureka保证AP<br>Eureka看明白了这一点，因此在设计时就优先保证可用性。Eureka各个节点都是平等的，几个节点挂掉不会影响正常节点的工作，剩余的节点依然可以提供注册和查询服务。而Eureka的客户端在向某个Eureka注册或时如果发现连接失败，则会自动切换至其它节点，只要有一台Eureka还在，就能保证注册服务可用(保证可用性)，只不过查到的信息可能不是最新的(不保证强一致性)。除此之外，Eureka还有一种自我保护机制，如果在15分钟内超过85%的节点都没有正常的心跳，那么Eureka就认为客户端与注册中心出现了网络故障，此时会出现以下几种情况：   </p>
<ol>
<li>Eureka不再从注册列表中移除因为长时间没收到心跳而应该过期的服务   </li>
<li>Eureka仍然能够接受新服务的注册和查询请求，但是不会被同步到其它节点上(即保证当前节点依然可用)   </li>
<li>当网络稳定时，当前实例新的注册信息会被同步到其它节点中  </li>
</ol>
<p>因此， Eureka可以很好的应对因网络故障导致部分节点失去联系的情况，而不会像zookeeper那样使整个注册服务瘫痪。  </p>
<ol start="4">
<li>总结<br>Eureka作为单纯的服务注册中心来说要比zookeeper更加“专业”，因为注册服务更重要的是可用性，我们可以接受短期内达不到一致性的状况。不过Eureka目前1.X版本的实现是基于servlet的Java web应用，它的极限性能肯定会受到影响。期待正在开发之中的2.X版本能够从servlet中独立出来成为单独可部署执行的服务。  </li>
</ol>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-17T19:34:00.000Z">2019-07-17</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    21 分钟 read (About 3166 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/18/OSI/">OSI</a>
            
        </h1>
        <div class="content">
            <p>计算机网络OSI</p>
<p>一、OSI参考模型<br>自下而上：物理层（物理介质，比特流）、数据链路层（网卡、交换机）、网络层（IP协议）、传输层（TCP/UDP协议）、会话层（创建/建立/断开连接）、表示层（翻译，编码，压缩，加密）、应用层（HTTP协议）<br>简化为TCP/IP模型：网络层（物理层、数据链路层、网络层）、传输层，会话层，应用层（表示层，应用层）<br>二、相应功能  </p>
<p>1.物理层<br>主要设备：中继器、集线器<br>物理层中双绞线的传输距离是有限的，信号会缩减，影响数据的传输。为了使传输的数据能够准确的传输，中继器是可以放大传输信号，保持原数据的准确。<br>双绞线 的传输距离是100m，而超过100m则信号会衰减    pc——–pc<br>中继器 在两台pc中间加一个中继器，则相当于两台pc到中继器的距离均为100m，有助于信号的增强。    pc—–中继器——-pc<br>集线器和中继器的区别是：中继器只有两个以太网接口，而集线器相当于多个端口的中继器。<br>注意：冲突域、广播域  </p>
<p>冲突域：当两个比特流在同一介质上同时传输就是产生冲突，冲突域是指发送数据给一个单一目标（单播）所影响的范围<br>广播域：发送数据给一个不明确的目标所影响的范围  </p>
<pre><code>集线器有一个冲突域和一个广播域  </code></pre><p>IP地址192.168.1.1ping1.2：  </p>
<blockquote>
<p>ping 192.168.1.2（ping命令所用的协议有ICMP/ARP协议）<br>返回数据说明两者是相通的，可以发送信息<br>当1.1想向1.2发送数据时，发送报文时，将包发送到集线器，集线器将包广播发送给所有连接在集线器上的其他端口，当1.3，1.4发现该包不是发送给他们的，就将拒绝接收，而1.2发现是发送给它时，就做出应答，返回一个应答包，应答包先发到集线器，集线器又进行广播，然后再发送到1.1上。<br>但是！！数据包向所有的端口发送，不安全，且所有的机器共享带宽，更容易产生拥塞，所以不能用于较大的网络<br>集线器是物理设备，是个智障，只会广播的发发发，不是智能的，所以不具备学习能力，故每次发送数据只能使用广播的方式。  </p>
</blockquote>
<p>2.数据链路层<br>功能：完成网络之间相邻结点的可靠传输，通过Mac地址负责主机之间的数据的可靠传输。<br>物理层传输的是比特流，而数据链路层传输的是帧。<br>主要设备：网卡、网桥、交换机<br>网卡：网络适配器，连接计算机与网络的硬件设备，整理计算机发往网线的数据，将数据分解成大小的数据包之后向网络上发送<br>Mac地址与IP地址的区别：<br>    最重要的区别：公司内部，学校机房等都是一个局域网，如果想在局域网混，必须要Mac地址！！！，这样交换机才能识别，之后交换机数据传到路由器，想要在外界大的网络中混，必须得要IP地址！！，这样路由器才能识别，进行相应功能！<br>    这就是为什么我们的电脑有ip地址和mac地址！<br>Mac地址：是厂商烧录在只读存储器上的，出厂厂商的唯一标识，且不可更改  </p>
<p>IP地址：网络地址，相当于门牌号<br>查看网卡的Mac地址(十六进制)命令：<br>    ipconfig /all<br>    Pysical Address :xx-xx-xx-xx-xx-xx  </p>
<p>网桥：将两个LAN链接在一起，变成一个LAN,并按Mac地址转发；分割冲突域；<br>例如：如何分割冲突域<br>每个PC机网卡的Mac地址：AA-AA-AA-AA-AA-AA、BB….  </p>
<p>网桥更具Mac地址学习能力，目标Mac地址转发<br>    IP地址192.168.1.1ping1.2：<br>    &gt;ping 192.168.1.2（ping命令所用的协议有ICMP/ARP地址解析协议）<br> 过程：<br>    1.1第一次发送ICMP数据包到集线器，集线器发给1.2和网桥，网桥接收到数据包后（工作原理是根据原Mac地址（1.1的Mac地址）学习，目标Mac地址（1.2Mac地址）进行转发，Eth0/1端口学到Mac地址），学到1.1Mac地址，网桥把包传输到下一个集线器，集线器会把包发给1.3,1.4，这两个会扔掉不属于它们的包，1.2接收到后会返回数据给集线器，集线器发送给网桥，这时网桥会学到1.2的Mac地址，由于网桥已经记录了1.1的Mac地址，则会直接发送给1.1而不会又进行广播发给1.3和1.4。<br>    通过第一次发送数据包和接受目标的应答，网桥的每个端口都将学到也就是记录到两个Mac地址，原Mac地址和目标的Mac地址。  </p>
<p>交换机：工作过程和网桥类似<br>交换机有三种转发方式：<br> （1）对已知单播帧只往对应端口进行转发<br> （2）对未知单播帧，即交换机还没有学习到的Mac进行广播转发，所有端口进行广播<br> （3）对广播帧或组播帧进行广播  </p>
<pre><code>IP地址192.168.1.1ping1.2：  
&gt;ping 192.168.1.2（ping命令所用的协议有ICMP/ARP地址解析协议）  </code></pre><p>工作过程：<br>    工作过程与网桥一致，交换机的端口通过原Mac地址发送数据学到Mac地址，接收应答的数据包学到目标Mac地址，最终每个端口都学到Mac地址记录在交换机Mac地址表中<br>    可以通过命令查找交换机的Mac地址表：<br>        show mac-address-tables<br>    交换机有几个端口就有几个冲突域，且只有一个广播域<br>交换机和网桥的区别：<br>    网桥只有两个端口，交换机至少有四个端口也有8个、16个等端口，网桥基于软件转发，交换机基于硬件转发，可以通过命令查看Mac地址表，而网桥不行。且交换机的造价比网桥低。<br>交换机分类：<br>（1）传统二层交换机<br>（2）VLAN交换机，有网管功能<br>（3）三层交换机：VLAN交换机+路由器，属于网络层的设备，而不是数据链路层的设备  </p>
<p>3.网络层<br>完成网络中主机间的报文传输（物理层比特流，数据链路层帧），网络层识别的地址是IP地址。<br>涉及的协议：IP/IPX<br>主要设备：路由器<br>路由器：通信中转站，例如快递的中转站，将不同网络和网段进行数据翻译，使其可以相互理解，构成一个大的网络。  </p>
<p>1.2与1.1属于同一个网段，可以接收数据和应答  </p>
<pre><code>IP地址192.168.1.1ping1.2：  
&gt;ping 192.168.1.2  </code></pre><p>1.1与2.2显示超时，没有返回任何数据，两者不属于同一个网段，不能通信<br>    IP地址192.168.1.1ping2.2：<br>    &gt;ping 192.168.2.2<br>如何使两者进行通信？有两种方法：<br>    （1）添加一个路由器：  </p>
<p>工作原理：<br>    路由器之所以可以翻译不同网段之间的通信是因为其本身具备丰富的协议，可以连接不同的网段和网络。路由器可以判断网络地址以及选择路径的功能。  </p>
<pre><code>（2）修改子网掩码，这点后面IP地址再补充  </code></pre><p>物理层、数据链路层、网络层之间的区别：  </p>
<p>4.传输层<br>    是整个网络关键的部分，是实现两个用户进程间端到端的可靠通信，处理数据包的错误等传输问题。是向下通信服务最高层，向上用户功能最底层。即向网络层提供服务，向会话层提供独立于网络层的传送服务和可靠的透明数据传输。<br>主要协议：TCP传输控制协议/UDP用户数据报协议，涉及服务使用的端口号，主机根据端口号识别服务，区分会话。<br>TCP协议：解决数据是否完整传输，是否正确<br>UDP协议：UDP协议实现了端口，从而使数据包传送到IP地址的基础上，还可以进一步将其送到具体的某一个端口上。<br>UDP传输与IP传输相似，但IP协议是ip地址之间的通信，但通信需要多个通信通道，将每个通道分配给每一个进程使用，UDP则是实现端口的通信。<br>服务与以及相对应的端口文件：C:\Windows\System32\drivers\etc\servies<br>例如：www服务端口号为80<br>5.会话层：<br>    主要功能是在两个结点间建立、维护和释放面向用户的连接，并对会话进行管理和控制，保证会话数据可靠传送。<br>例如：你通过秘书与对方建立联系，则你发出建立联系的请求相当于一个会话，秘书相当于传输层，然后秘书进行拨号联系对方，当对方接通对话，则会话的连接建立。<br>6.表示层：<br>    主要负责数据格式的转换，即翻译，压缩与解压缩，加密与解密。<br>例如：你想下午两点出发去上海，你对上海的朋友说下午两点过来，朋友的理解却是你下午两点到上海，两个人两种理解，而表示层则是进行格式转换和信息的表示。<br>7.应用层：<br>    应用层是网络体系中最高的一层，也是唯一面向用户的一层，也可视为为用户提供常用的应用程序，例如电子邮件，上网浏览等网络服务都是应用层程序。<br>对于这三层的定义还是不能理解，上网搜了以上比较通俗的解释。<br>应用层的主要协议：HTTP,HTTPS,FTP（上传，下载）,SMTP（邮件）<br>HTTP协议：超文本传输协议，包括url地址，域名，源地址，发送的数据方法（Get，Post等），浏览器信息等<br>OSI模型的总结<br>OSI模型上层（会话层，表示层，应用层）处理用户接口、数据格式、应用访问。<br>OSI模型下层（物理层，数据链路层，网络层，传输层）处理数据在网络介质中的传送。<br>三、数据封装过程<br>封装：<br>    应用层：发送数据———表示层：数据格式转换，加密，压缩等———-会话层：建立连接———–传输层：差错校验，流量控制，TCP/UDP传输，添加端口号信息（源端口，目标端口）+数据————网络层：分组，数据包（IP地址+数据）——–数据链路层：帧（帧头（帧头包含Mac地址）+帧数据）————物理层：比特流（0,1）<br>解封装：    J<br>    物理层：比特流（0,1）———数据链路层：帧（帧头（帧头包含Mac地址）+帧数据）——–网络层：分组，数据包（IP地址+数据）——-传输层：差错校验，流量控制等；UDP/TCP(传送和接收端口信息+数据)———会话层：建立连接———–表示层：数据格式转换，解密，解压缩等———–应用层：接收的数据</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-17T16:41:00.000Z">2019-07-17</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 分钟 read (About 300 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/18/command-num-of-file-for-linux/">command num of  file  for linux</a>
            
        </h1>
        <div class="content">
            <p>linux 下查看文件个数及大小<br>查看当前目录下的文件数量：</p>
<p>ls -l |grep “^-“|wc -l</p>
<p>或</p>
<p>find ./company -type f | wc -l</p>
<p>查看某文件夹下文件的个数，包括子文件夹里的。</p>
<p>ls -lR|grep “^-“|wc -l</p>
<p>查看某文件夹下文件夹的个数，包括子文件夹里的。</p>
<p>ls -lR|grep “^d”|wc -l</p>
<p>说明：</p>
<p>ls -l</p>
<p>长列表输出该目录下文件信息(注意这里的文件，不同于一般的文件，可能是目录、链接、设备文件等)</p>
<p>grep “^-“</p>
<p>这里将长列表输出信息过滤一部分，只保留一般文件，如果只保留目录就是 ^d</p>
<p>wc -l</p>
<p>统计输出信息的行数，因为已经过滤得只剩一般文件了，所以统计结果就是一般文件信息的行数，又由于</p>
<p>一行信息对应一个文件，所以也就是文件的个数。</p>
<p>linux查看文件大小：</p>
<p>du -sh 查看当前文件夹大小</p>
<p>du -sh * | sort -n 统计当前文件夹(目录)大小，并按文件大小排序</p>
<p>du -sk filename 查看指定文件大小</p>

        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous">
            <a class="is-flex-grow has-text-black-ter" href="/categories/IT/page/6/">Anterior</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/categories/IT/page/8/">Siguiente</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link has-text-black-ter" href="/categories/IT/">1</a></li>
            
            <li><span class="pagination-ellipsis has-text-black-ter">&hellip;</span></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/categories/IT/page/6/">6</a></li>
            
            <li><a class="pagination-link is-current" href="/categories/IT/page/7/">7</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/categories/IT/page/8/">8</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/categories/IT/page/9/">9</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/categories/IT/page/10/">10</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recientes
        </h3>
        
        <article class="media">
            
            <a href="/2020/05/29/@Select注解时使用in/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="文档标题">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-29T15:53:20.000Z">2020-05-29</time></div>
                    <a href="/2020/05/29/@Select注解时使用in/" class="title has-link-black-ter is-size-6 has-text-weight-normal">文档标题</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/JAVAEE/">JAVAEE</a> / <a class="has-link-grey -link" href="/categories/JAVAEE/MYBATIS/">MYBATIS</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/29/mysql共享锁和排它锁/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="mysql共享锁和排它锁">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-29T15:35:53.000Z">2020-05-29</time></div>
                    <a href="/2020/05/29/mysql共享锁和排它锁/" class="title has-link-black-ter is-size-6 has-text-weight-normal">mysql共享锁和排它锁</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/JAVAEE/">JAVAEE</a> / <a class="has-link-grey -link" href="/categories/JAVAEE/MYSQL/">MYSQL</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/10/ Git合并/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Git合并特定commits到另一个分支">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-09T18:41:45.000Z">2020-05-09</time></div>
                    <a href="/2020/05/10/ Git合并/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Git合并特定commits到另一个分支</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/GIT/">GIT</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/10/vim常用的操作/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="vim常用的操作">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-09T16:11:06.000Z">2020-05-09</time></div>
                    <a href="/2020/05/10/vim常用的操作/" class="title has-link-black-ter is-size-6 has-text-weight-normal">vim常用的操作</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/VIM/">VIM</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/09/ES分页查询最大数/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="ES分页查询最大数">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-09T11:30:31.000Z">2020-05-09</time></div>
                    <a href="/2020/05/09/ES分页查询最大数/" class="title has-link-black-ter is-size-6 has-text-weight-normal">ES分页查询最大数</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/ES/">ES</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/avatar.png" alt="Joe">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Joe
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Learning
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Your location</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Entradas
                    </p>
                    <p class="title has-text-weight-normal">
                        220
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categorias
                    </p>
                    <p class="title has-text-weight-normal">
                        15
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Etiquetas
                    </p>
                    <p class="title has-text-weight-normal">
                        100
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/ppoffice" target="_blank">
                SEGUIR</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Github" href="https://github.com/joeithub">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Facebook" href="https://facebook.com">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Twitter" href="https://twitter.com">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Dribbble" href="https://dribbble.com">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
        
            
        
            
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categorias
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/ES/">
            <span class="level-start">
                <span class="level-item">ES</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/GIT/">
            <span class="level-start">
                <span class="level-item">GIT</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/IT/">
            <span class="level-start">
                <span class="level-item">IT</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">194</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JAVAEE/">
            <span class="level-start">
                <span class="level-item">JAVAEE</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/JAVAEE/DESIGN-PATTERNS/">
            <span class="level-start">
                <span class="level-item">DESIGN PATTERNS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JAVAEE/MYBATIS/">
            <span class="level-start">
                <span class="level-item">MYBATIS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JAVAEE/MYSQL/">
            <span class="level-start">
                <span class="level-item">MYSQL</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/SPRINGBOOT/">
            <span class="level-start">
                <span class="level-item">SPRINGBOOT</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/SPRINGBOOT/SECURITY/">
            <span class="level-start">
                <span class="level-item">SECURITY</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/SYSTEM/">
            <span class="level-start">
                <span class="level-item">SYSTEM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/VIM/">
            <span class="level-start">
                <span class="level-item">VIM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/WORK/">
            <span class="level-start">
                <span class="level-item">WORK</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/office/">
            <span class="level-start">
                <span class="level-item">office</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/分类1/">
            <span class="level-start">
                <span class="level-item">分类1</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/电商/">
            <span class="level-start">
                <span class="level-item">电商</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Nube de etiquetas
        </h3>
        <a href="/tags/AOP/" style="font-size: 10px;">AOP</a> <a href="/tags/CI-CD/" style="font-size: 10px;">CI/CD</a> <a href="/tags/ELASTICSEARCH/" style="font-size: 10px;">ELASTICSEARCH</a> <a href="/tags/EXCEL/" style="font-size: 10px;">EXCEL</a> <a href="/tags/Eureka/" style="font-size: 10.91px;">Eureka</a> <a href="/tags/GO/" style="font-size: 10px;">GO</a> <a href="/tags/IDEA/" style="font-size: 10.91px;">IDEA</a> <a href="/tags/IT/" style="font-size: 14.55px;">IT</a> <a href="/tags/JAVAEE/" style="font-size: 20px;">JAVAEE</a> <a href="/tags/JAVASCRIPT/" style="font-size: 11.82px;">JAVASCRIPT</a> <a href="/tags/JAVASE/" style="font-size: 10.91px;">JAVASE</a> <a href="/tags/LINUX/" style="font-size: 10px;">LINUX</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/MAC/" style="font-size: 10px;">MAC</a> <a href="/tags/MQ/" style="font-size: 11.82px;">MQ</a> <a href="/tags/ONOS/" style="font-size: 15.45px;">ONOS</a> <a href="/tags/OSGI/" style="font-size: 14.55px;">OSGI</a> <a href="/tags/OSI/" style="font-size: 10px;">OSI</a> <a href="/tags/PROTOCAL/" style="font-size: 10px;">PROTOCAL</a> <a href="/tags/PYTHON/" style="font-size: 10.91px;">PYTHON</a> <a href="/tags/Quartz/" style="font-size: 10px;">Quartz</a> <a href="/tags/RPM/" style="font-size: 10px;">RPM</a> <a href="/tags/Ribbon/" style="font-size: 10px;">Ribbon</a> <a href="/tags/SECURITY/" style="font-size: 10px;">SECURITY</a> <a href="/tags/SPRING-BOOT/" style="font-size: 10px;">SPRING-BOOT</a> <a href="/tags/SQL/" style="font-size: 12.73px;">SQL</a> <a href="/tags/SQLAlert/" style="font-size: 18.18px;">SQLAlert</a> <a href="/tags/SSO/" style="font-size: 10px;">SSO</a> <a href="/tags/StringRedisTemplate/" style="font-size: 10px;">StringRedisTemplate</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/TK-MYBATIS/" style="font-size: 10px;">TK.MYBATIS</a> <a href="/tags/UDP/" style="font-size: 10px;">UDP</a> <a href="/tags/annotation/" style="font-size: 15.45px;">annotation</a> <a href="/tags/bazel/" style="font-size: 10px;">bazel</a> <a href="/tags/beanutils/" style="font-size: 10px;">beanutils</a> <a href="/tags/centos/" style="font-size: 10px;">centos</a> <a href="/tags/classloader/" style="font-size: 10px;">classloader</a> <a href="/tags/computer/" style="font-size: 10px;">computer</a> <a href="/tags/cron/" style="font-size: 10px;">cron</a> <a href="/tags/debug/" style="font-size: 10px;">debug</a> <a href="/tags/docker/" style="font-size: 12.73px;">docker</a> <a href="/tags/druid/" style="font-size: 10px;">druid</a> <a href="/tags/elasticsearch/" style="font-size: 13.64px;">elasticsearch</a> <a href="/tags/enlink/" style="font-size: 10.91px;">enlink</a> <a href="/tags/fastjson/" style="font-size: 10px;">fastjson</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/gitlab/" style="font-size: 10px;">gitlab</a> <a href="/tags/go/" style="font-size: 10px;">go</a> <a href="/tags/hexo/" style="font-size: 12.73px;">hexo</a> <a href="/tags/idea/" style="font-size: 10.91px;">idea</a> <a href="/tags/interceptor/" style="font-size: 11.82px;">interceptor</a> <a href="/tags/jetty/" style="font-size: 10px;">jetty</a> <a href="/tags/jpa/" style="font-size: 10.91px;">jpa</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/karaf/" style="font-size: 11.82px;">karaf</a> <a href="/tags/keepalived/" style="font-size: 10px;">keepalived</a> <a href="/tags/linux-shell/" style="font-size: 15.45px;">linux-shell</a> <a href="/tags/listener/" style="font-size: 10px;">listener</a> <a href="/tags/loadbalanced/" style="font-size: 10px;">loadbalanced</a> <a href="/tags/logback/" style="font-size: 10px;">logback</a> <a href="/tags/login/" style="font-size: 10.91px;">login</a> <a href="/tags/lombok/" style="font-size: 11.82px;">lombok</a> <a href="/tags/mac/" style="font-size: 15.45px;">mac</a> <a href="/tags/markdown/" style="font-size: 11.82px;">markdown</a> <a href="/tags/mybatis/" style="font-size: 17.27px;">mybatis</a> <a href="/tags/mycat/" style="font-size: 10.91px;">mycat</a> <a href="/tags/mysql/" style="font-size: 16.36px;">mysql</a> <a href="/tags/network/" style="font-size: 12.73px;">network</a> <a href="/tags/oauth2/" style="font-size: 10px;">oauth2</a> <a href="/tags/pagehelper/" style="font-size: 10px;">pagehelper</a> <a href="/tags/postman/" style="font-size: 10px;">postman</a> <a href="/tags/python/" style="font-size: 11.82px;">python</a> <a href="/tags/rabbitMq/" style="font-size: 11.82px;">rabbitMq</a> <a href="/tags/redis/" style="font-size: 11.82px;">redis</a> <a href="/tags/redisTemplate/" style="font-size: 10px;">redisTemplate</a> <a href="/tags/reflection/" style="font-size: 11.82px;">reflection</a> <a href="/tags/registry-center/" style="font-size: 10px;">registry center</a> <a href="/tags/restTemplate/" style="font-size: 10px;">restTemplate</a> <a href="/tags/ribbon/" style="font-size: 10px;">ribbon</a> <a href="/tags/serialVersionUID/" style="font-size: 10px;">serialVersionUID</a> <a href="/tags/servlet/" style="font-size: 10.91px;">servlet</a> <a href="/tags/session/" style="font-size: 10.91px;">session</a> <a href="/tags/spring/" style="font-size: 15.45px;">spring</a> <a href="/tags/spring-task/" style="font-size: 12.73px;">spring task</a> <a href="/tags/springboot/" style="font-size: 19.09px;">springboot</a> <a href="/tags/swagger/" style="font-size: 10px;">swagger</a> <a href="/tags/webClient/" style="font-size: 10px;">webClient</a> <a href="/tags/yaml/" style="font-size: 10.91px;">yaml</a> <a href="/tags/事物/" style="font-size: 10px;">事物</a> <a href="/tags/全局异常/" style="font-size: 10px;">全局异常</a> <a href="/tags/分布式/" style="font-size: 10px;">分布式</a> <a href="/tags/抖音/" style="font-size: 10px;">抖音</a> <a href="/tags/文件服务器/" style="font-size: 10.91px;">文件服务器</a> <a href="/tags/日志/" style="font-size: 10px;">日志</a> <a href="/tags/时间转化/" style="font-size: 10px;">时间转化</a> <a href="/tags/标签1/" style="font-size: 10px;">标签1</a> <a href="/tags/消息队列/" style="font-size: 10px;">消息队列</a> <a href="/tags/淘宝/" style="font-size: 10px;">淘宝</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a> <a href="/tags/高可用/" style="font-size: 10px;">高可用</a>
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archivos
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">五月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">四月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">三月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">二月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">一月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">14</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">十月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">28</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">九月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">40</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">八月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">13</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">七月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">66</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">六月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">22</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/1970/09/">
                <span class="level-start">
                    <span class="level-item">九月 1970</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Etiquetas
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/AOP/">
                        <span class="tag">AOP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/CI-CD/">
                        <span class="tag">CI/CD</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ELASTICSEARCH/">
                        <span class="tag">ELASTICSEARCH</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/EXCEL/">
                        <span class="tag">EXCEL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Eureka/">
                        <span class="tag">Eureka</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/GO/">
                        <span class="tag">GO</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/IDEA/">
                        <span class="tag">IDEA</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/IT/">
                        <span class="tag">IT</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JAVAEE/">
                        <span class="tag">JAVAEE</span>
                        <span class="tag is-grey">130</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JAVASCRIPT/">
                        <span class="tag">JAVASCRIPT</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JAVASE/">
                        <span class="tag">JAVASE</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/LINUX/">
                        <span class="tag">LINUX</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux/">
                        <span class="tag">Linux</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MAC/">
                        <span class="tag">MAC</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MQ/">
                        <span class="tag">MQ</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ONOS/">
                        <span class="tag">ONOS</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/OSGI/">
                        <span class="tag">OSGI</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/OSI/">
                        <span class="tag">OSI</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/PROTOCAL/">
                        <span class="tag">PROTOCAL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/PYTHON/">
                        <span class="tag">PYTHON</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Quartz/">
                        <span class="tag">Quartz</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/RPM/">
                        <span class="tag">RPM</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Ribbon/">
                        <span class="tag">Ribbon</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SECURITY/">
                        <span class="tag">SECURITY</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SPRING-BOOT/">
                        <span class="tag">SPRING-BOOT</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SQL/">
                        <span class="tag">SQL</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SQLAlert/">
                        <span class="tag">SQLAlert</span>
                        <span class="tag is-grey">13</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SSO/">
                        <span class="tag">SSO</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/StringRedisTemplate/">
                        <span class="tag">StringRedisTemplate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/TCP/">
                        <span class="tag">TCP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/TK-MYBATIS/">
                        <span class="tag">TK.MYBATIS</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/UDP/">
                        <span class="tag">UDP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/annotation/">
                        <span class="tag">annotation</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/bazel/">
                        <span class="tag">bazel</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/beanutils/">
                        <span class="tag">beanutils</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/centos/">
                        <span class="tag">centos</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/classloader/">
                        <span class="tag">classloader</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/computer/">
                        <span class="tag">computer</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/cron/">
                        <span class="tag">cron</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/debug/">
                        <span class="tag">debug</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/docker/">
                        <span class="tag">docker</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/druid/">
                        <span class="tag">druid</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/elasticsearch/">
                        <span class="tag">elasticsearch</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/enlink/">
                        <span class="tag">enlink</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/fastjson/">
                        <span class="tag">fastjson</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/git/">
                        <span class="tag">git</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/gitlab/">
                        <span class="tag">gitlab</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/go/">
                        <span class="tag">go</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/hexo/">
                        <span class="tag">hexo</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/idea/">
                        <span class="tag">idea</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/interceptor/">
                        <span class="tag">interceptor</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/jetty/">
                        <span class="tag">jetty</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/jpa/">
                        <span class="tag">jpa</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/json/">
                        <span class="tag">json</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/karaf/">
                        <span class="tag">karaf</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/keepalived/">
                        <span class="tag">keepalived</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/linux-shell/">
                        <span class="tag">linux-shell</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/listener/">
                        <span class="tag">listener</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/loadbalanced/">
                        <span class="tag">loadbalanced</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/logback/">
                        <span class="tag">logback</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/login/">
                        <span class="tag">login</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/lombok/">
                        <span class="tag">lombok</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mac/">
                        <span class="tag">mac</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/markdown/">
                        <span class="tag">markdown</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mybatis/">
                        <span class="tag">mybatis</span>
                        <span class="tag is-grey">11</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mycat/">
                        <span class="tag">mycat</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mysql/">
                        <span class="tag">mysql</span>
                        <span class="tag is-grey">9</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/network/">
                        <span class="tag">network</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/oauth2/">
                        <span class="tag">oauth2</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pagehelper/">
                        <span class="tag">pagehelper</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/postman/">
                        <span class="tag">postman</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/python/">
                        <span class="tag">python</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/rabbitMq/">
                        <span class="tag">rabbitMq</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/redis/">
                        <span class="tag">redis</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/redisTemplate/">
                        <span class="tag">redisTemplate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/reflection/">
                        <span class="tag">reflection</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/registry-center/">
                        <span class="tag">registry center</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/restTemplate/">
                        <span class="tag">restTemplate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ribbon/">
                        <span class="tag">ribbon</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/serialVersionUID/">
                        <span class="tag">serialVersionUID</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/servlet/">
                        <span class="tag">servlet</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/session/">
                        <span class="tag">session</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spring/">
                        <span class="tag">spring</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spring-task/">
                        <span class="tag">spring task</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/springboot/">
                        <span class="tag">springboot</span>
                        <span class="tag is-grey">43</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/swagger/">
                        <span class="tag">swagger</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/webClient/">
                        <span class="tag">webClient</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/yaml/">
                        <span class="tag">yaml</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/事物/">
                        <span class="tag">事物</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/全局异常/">
                        <span class="tag">全局异常</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分布式/">
                        <span class="tag">分布式</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/抖音/">
                        <span class="tag">抖音</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/文件服务器/">
                        <span class="tag">文件服务器</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/日志/">
                        <span class="tag">日志</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/时间转化/">
                        <span class="tag">时间转化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/标签1/">
                        <span class="tag">标签1</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/消息队列/">
                        <span class="tag">消息队列</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/淘宝/">
                        <span class="tag">淘宝</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/设计模式/">
                        <span class="tag">设计模式</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/高可用/">
                        <span class="tag">高可用</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/avatar.png" alt="Joe">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Joe
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Learning
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Your location</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Entradas
                    </p>
                    <p class="title has-text-weight-normal">
                        220
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categorias
                    </p>
                    <p class="title has-text-weight-normal">
                        15
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Etiquetas
                    </p>
                    <p class="title has-text-weight-normal">
                        100
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/ppoffice" target="_blank">
                SEGUIR</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Github" href="https://github.com/joeithub">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Facebook" href="https://facebook.com">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Twitter" href="https://twitter.com">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Dribbble" href="https://dribbble.com">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categorias
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/ES/">
            <span class="level-start">
                <span class="level-item">ES</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/GIT/">
            <span class="level-start">
                <span class="level-item">GIT</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/IT/">
            <span class="level-start">
                <span class="level-item">IT</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">194</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JAVAEE/">
            <span class="level-start">
                <span class="level-item">JAVAEE</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/JAVAEE/DESIGN-PATTERNS/">
            <span class="level-start">
                <span class="level-item">DESIGN PATTERNS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JAVAEE/MYBATIS/">
            <span class="level-start">
                <span class="level-item">MYBATIS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JAVAEE/MYSQL/">
            <span class="level-start">
                <span class="level-item">MYSQL</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/SPRINGBOOT/">
            <span class="level-start">
                <span class="level-item">SPRINGBOOT</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/SPRINGBOOT/SECURITY/">
            <span class="level-start">
                <span class="level-item">SECURITY</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/SYSTEM/">
            <span class="level-start">
                <span class="level-item">SYSTEM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/VIM/">
            <span class="level-start">
                <span class="level-item">VIM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/WORK/">
            <span class="level-start">
                <span class="level-item">WORK</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/office/">
            <span class="level-start">
                <span class="level-item">office</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/分类1/">
            <span class="level-start">
                <span class="level-item">分类1</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/电商/">
            <span class="level-start">
                <span class="level-item">电商</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Nube de etiquetas
        </h3>
        <a href="/tags/AOP/" style="font-size: 10px;">AOP</a> <a href="/tags/CI-CD/" style="font-size: 10px;">CI/CD</a> <a href="/tags/ELASTICSEARCH/" style="font-size: 10px;">ELASTICSEARCH</a> <a href="/tags/EXCEL/" style="font-size: 10px;">EXCEL</a> <a href="/tags/Eureka/" style="font-size: 10.91px;">Eureka</a> <a href="/tags/GO/" style="font-size: 10px;">GO</a> <a href="/tags/IDEA/" style="font-size: 10.91px;">IDEA</a> <a href="/tags/IT/" style="font-size: 14.55px;">IT</a> <a href="/tags/JAVAEE/" style="font-size: 20px;">JAVAEE</a> <a href="/tags/JAVASCRIPT/" style="font-size: 11.82px;">JAVASCRIPT</a> <a href="/tags/JAVASE/" style="font-size: 10.91px;">JAVASE</a> <a href="/tags/LINUX/" style="font-size: 10px;">LINUX</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/MAC/" style="font-size: 10px;">MAC</a> <a href="/tags/MQ/" style="font-size: 11.82px;">MQ</a> <a href="/tags/ONOS/" style="font-size: 15.45px;">ONOS</a> <a href="/tags/OSGI/" style="font-size: 14.55px;">OSGI</a> <a href="/tags/OSI/" style="font-size: 10px;">OSI</a> <a href="/tags/PROTOCAL/" style="font-size: 10px;">PROTOCAL</a> <a href="/tags/PYTHON/" style="font-size: 10.91px;">PYTHON</a> <a href="/tags/Quartz/" style="font-size: 10px;">Quartz</a> <a href="/tags/RPM/" style="font-size: 10px;">RPM</a> <a href="/tags/Ribbon/" style="font-size: 10px;">Ribbon</a> <a href="/tags/SECURITY/" style="font-size: 10px;">SECURITY</a> <a href="/tags/SPRING-BOOT/" style="font-size: 10px;">SPRING-BOOT</a> <a href="/tags/SQL/" style="font-size: 12.73px;">SQL</a> <a href="/tags/SQLAlert/" style="font-size: 18.18px;">SQLAlert</a> <a href="/tags/SSO/" style="font-size: 10px;">SSO</a> <a href="/tags/StringRedisTemplate/" style="font-size: 10px;">StringRedisTemplate</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/TK-MYBATIS/" style="font-size: 10px;">TK.MYBATIS</a> <a href="/tags/UDP/" style="font-size: 10px;">UDP</a> <a href="/tags/annotation/" style="font-size: 15.45px;">annotation</a> <a href="/tags/bazel/" style="font-size: 10px;">bazel</a> <a href="/tags/beanutils/" style="font-size: 10px;">beanutils</a> <a href="/tags/centos/" style="font-size: 10px;">centos</a> <a href="/tags/classloader/" style="font-size: 10px;">classloader</a> <a href="/tags/computer/" style="font-size: 10px;">computer</a> <a href="/tags/cron/" style="font-size: 10px;">cron</a> <a href="/tags/debug/" style="font-size: 10px;">debug</a> <a href="/tags/docker/" style="font-size: 12.73px;">docker</a> <a href="/tags/druid/" style="font-size: 10px;">druid</a> <a href="/tags/elasticsearch/" style="font-size: 13.64px;">elasticsearch</a> <a href="/tags/enlink/" style="font-size: 10.91px;">enlink</a> <a href="/tags/fastjson/" style="font-size: 10px;">fastjson</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/gitlab/" style="font-size: 10px;">gitlab</a> <a href="/tags/go/" style="font-size: 10px;">go</a> <a href="/tags/hexo/" style="font-size: 12.73px;">hexo</a> <a href="/tags/idea/" style="font-size: 10.91px;">idea</a> <a href="/tags/interceptor/" style="font-size: 11.82px;">interceptor</a> <a href="/tags/jetty/" style="font-size: 10px;">jetty</a> <a href="/tags/jpa/" style="font-size: 10.91px;">jpa</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/karaf/" style="font-size: 11.82px;">karaf</a> <a href="/tags/keepalived/" style="font-size: 10px;">keepalived</a> <a href="/tags/linux-shell/" style="font-size: 15.45px;">linux-shell</a> <a href="/tags/listener/" style="font-size: 10px;">listener</a> <a href="/tags/loadbalanced/" style="font-size: 10px;">loadbalanced</a> <a href="/tags/logback/" style="font-size: 10px;">logback</a> <a href="/tags/login/" style="font-size: 10.91px;">login</a> <a href="/tags/lombok/" style="font-size: 11.82px;">lombok</a> <a href="/tags/mac/" style="font-size: 15.45px;">mac</a> <a href="/tags/markdown/" style="font-size: 11.82px;">markdown</a> <a href="/tags/mybatis/" style="font-size: 17.27px;">mybatis</a> <a href="/tags/mycat/" style="font-size: 10.91px;">mycat</a> <a href="/tags/mysql/" style="font-size: 16.36px;">mysql</a> <a href="/tags/network/" style="font-size: 12.73px;">network</a> <a href="/tags/oauth2/" style="font-size: 10px;">oauth2</a> <a href="/tags/pagehelper/" style="font-size: 10px;">pagehelper</a> <a href="/tags/postman/" style="font-size: 10px;">postman</a> <a href="/tags/python/" style="font-size: 11.82px;">python</a> <a href="/tags/rabbitMq/" style="font-size: 11.82px;">rabbitMq</a> <a href="/tags/redis/" style="font-size: 11.82px;">redis</a> <a href="/tags/redisTemplate/" style="font-size: 10px;">redisTemplate</a> <a href="/tags/reflection/" style="font-size: 11.82px;">reflection</a> <a href="/tags/registry-center/" style="font-size: 10px;">registry center</a> <a href="/tags/restTemplate/" style="font-size: 10px;">restTemplate</a> <a href="/tags/ribbon/" style="font-size: 10px;">ribbon</a> <a href="/tags/serialVersionUID/" style="font-size: 10px;">serialVersionUID</a> <a href="/tags/servlet/" style="font-size: 10.91px;">servlet</a> <a href="/tags/session/" style="font-size: 10.91px;">session</a> <a href="/tags/spring/" style="font-size: 15.45px;">spring</a> <a href="/tags/spring-task/" style="font-size: 12.73px;">spring task</a> <a href="/tags/springboot/" style="font-size: 19.09px;">springboot</a> <a href="/tags/swagger/" style="font-size: 10px;">swagger</a> <a href="/tags/webClient/" style="font-size: 10px;">webClient</a> <a href="/tags/yaml/" style="font-size: 10.91px;">yaml</a> <a href="/tags/事物/" style="font-size: 10px;">事物</a> <a href="/tags/全局异常/" style="font-size: 10px;">全局异常</a> <a href="/tags/分布式/" style="font-size: 10px;">分布式</a> <a href="/tags/抖音/" style="font-size: 10px;">抖音</a> <a href="/tags/文件服务器/" style="font-size: 10.91px;">文件服务器</a> <a href="/tags/日志/" style="font-size: 10px;">日志</a> <a href="/tags/时间转化/" style="font-size: 10px;">时间转化</a> <a href="/tags/标签1/" style="font-size: 10px;">标签1</a> <a href="/tags/消息队列/" style="font-size: 10px;">消息队列</a> <a href="/tags/淘宝/" style="font-size: 10px;">淘宝</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a> <a href="/tags/高可用/" style="font-size: 10px;">高可用</a>
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archivos
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">五月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">四月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">三月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">二月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">一月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">14</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">十月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">28</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">九月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">40</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">八月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">13</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">七月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">66</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">六月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">22</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/1970/09/">
                <span class="level-start">
                    <span class="level-item">九月 1970</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Etiquetas
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/AOP/">
                        <span class="tag">AOP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/CI-CD/">
                        <span class="tag">CI/CD</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ELASTICSEARCH/">
                        <span class="tag">ELASTICSEARCH</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/EXCEL/">
                        <span class="tag">EXCEL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Eureka/">
                        <span class="tag">Eureka</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/GO/">
                        <span class="tag">GO</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/IDEA/">
                        <span class="tag">IDEA</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/IT/">
                        <span class="tag">IT</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JAVAEE/">
                        <span class="tag">JAVAEE</span>
                        <span class="tag is-grey">130</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JAVASCRIPT/">
                        <span class="tag">JAVASCRIPT</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JAVASE/">
                        <span class="tag">JAVASE</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/LINUX/">
                        <span class="tag">LINUX</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux/">
                        <span class="tag">Linux</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MAC/">
                        <span class="tag">MAC</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MQ/">
                        <span class="tag">MQ</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ONOS/">
                        <span class="tag">ONOS</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/OSGI/">
                        <span class="tag">OSGI</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/OSI/">
                        <span class="tag">OSI</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/PROTOCAL/">
                        <span class="tag">PROTOCAL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/PYTHON/">
                        <span class="tag">PYTHON</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Quartz/">
                        <span class="tag">Quartz</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/RPM/">
                        <span class="tag">RPM</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Ribbon/">
                        <span class="tag">Ribbon</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SECURITY/">
                        <span class="tag">SECURITY</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SPRING-BOOT/">
                        <span class="tag">SPRING-BOOT</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SQL/">
                        <span class="tag">SQL</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SQLAlert/">
                        <span class="tag">SQLAlert</span>
                        <span class="tag is-grey">13</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SSO/">
                        <span class="tag">SSO</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/StringRedisTemplate/">
                        <span class="tag">StringRedisTemplate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/TCP/">
                        <span class="tag">TCP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/TK-MYBATIS/">
                        <span class="tag">TK.MYBATIS</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/UDP/">
                        <span class="tag">UDP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/annotation/">
                        <span class="tag">annotation</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/bazel/">
                        <span class="tag">bazel</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/beanutils/">
                        <span class="tag">beanutils</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/centos/">
                        <span class="tag">centos</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/classloader/">
                        <span class="tag">classloader</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/computer/">
                        <span class="tag">computer</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/cron/">
                        <span class="tag">cron</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/debug/">
                        <span class="tag">debug</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/docker/">
                        <span class="tag">docker</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/druid/">
                        <span class="tag">druid</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/elasticsearch/">
                        <span class="tag">elasticsearch</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/enlink/">
                        <span class="tag">enlink</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/fastjson/">
                        <span class="tag">fastjson</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/git/">
                        <span class="tag">git</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/gitlab/">
                        <span class="tag">gitlab</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/go/">
                        <span class="tag">go</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/hexo/">
                        <span class="tag">hexo</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/idea/">
                        <span class="tag">idea</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/interceptor/">
                        <span class="tag">interceptor</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/jetty/">
                        <span class="tag">jetty</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/jpa/">
                        <span class="tag">jpa</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/json/">
                        <span class="tag">json</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/karaf/">
                        <span class="tag">karaf</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/keepalived/">
                        <span class="tag">keepalived</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/linux-shell/">
                        <span class="tag">linux-shell</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/listener/">
                        <span class="tag">listener</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/loadbalanced/">
                        <span class="tag">loadbalanced</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/logback/">
                        <span class="tag">logback</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/login/">
                        <span class="tag">login</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/lombok/">
                        <span class="tag">lombok</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mac/">
                        <span class="tag">mac</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/markdown/">
                        <span class="tag">markdown</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mybatis/">
                        <span class="tag">mybatis</span>
                        <span class="tag is-grey">11</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mycat/">
                        <span class="tag">mycat</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mysql/">
                        <span class="tag">mysql</span>
                        <span class="tag is-grey">9</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/network/">
                        <span class="tag">network</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/oauth2/">
                        <span class="tag">oauth2</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pagehelper/">
                        <span class="tag">pagehelper</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/postman/">
                        <span class="tag">postman</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/python/">
                        <span class="tag">python</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/rabbitMq/">
                        <span class="tag">rabbitMq</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/redis/">
                        <span class="tag">redis</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/redisTemplate/">
                        <span class="tag">redisTemplate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/reflection/">
                        <span class="tag">reflection</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/registry-center/">
                        <span class="tag">registry center</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/restTemplate/">
                        <span class="tag">restTemplate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ribbon/">
                        <span class="tag">ribbon</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/serialVersionUID/">
                        <span class="tag">serialVersionUID</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/servlet/">
                        <span class="tag">servlet</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/session/">
                        <span class="tag">session</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spring/">
                        <span class="tag">spring</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spring-task/">
                        <span class="tag">spring task</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/springboot/">
                        <span class="tag">springboot</span>
                        <span class="tag is-grey">43</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/swagger/">
                        <span class="tag">swagger</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/webClient/">
                        <span class="tag">webClient</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/yaml/">
                        <span class="tag">yaml</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/事物/">
                        <span class="tag">事物</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/全局异常/">
                        <span class="tag">全局异常</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分布式/">
                        <span class="tag">分布式</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/抖音/">
                        <span class="tag">抖音</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/文件服务器/">
                        <span class="tag">文件服务器</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/日志/">
                        <span class="tag">日志</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/时间转化/">
                        <span class="tag">时间转化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/标签1/">
                        <span class="tag">标签1</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/消息队列/">
                        <span class="tag">消息队列</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/淘宝/">
                        <span class="tag">淘宝</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/设计模式/">
                        <span class="tag">设计模式</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/高可用/">
                        <span class="tag">高可用</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="Learning" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 Joe Tong&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh_CN");</script>

<script>
var IcarusThemeSettings = {
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>



    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Entradas',
                PAGES: 'Pages',
                CATEGORIES: 'Categorias',
                TAGS: 'Etiquetas',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>