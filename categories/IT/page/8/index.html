<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 3.9.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>Categoria: IT - Learning</title>


    <meta name="description" content="private learning">
<meta property="og:type" content="website">
<meta property="og:title" content="Learning">
<meta property="og:url" content="http://yoursite.com/categories/IT/page/8/index.html">
<meta property="og:site_name" content="Learning">
<meta property="og:description" content="private learning">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/images/og_image.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Learning">
<meta name="twitter:description" content="private learning">
<meta name="twitter:image" content="http://yoursite.com/images/og_image.png">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="Learning" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
                <a class="navbar-item"
                href="/">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card">
    <div class="card-content">
        <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="/categories">Categorias</a></li>
            
            <li class="is-active"><a href="#" aria-current="page">IT</a></li>
        </ul>
        </nav>
    </div>
</div>

    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-17T14:45:00.000Z">2019-07-17</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 分钟 read (About 837 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/17/ribbon-client-load-balance/">ribbon client load balance</a>
            
        </h1>
        <div class="content">
            <p>微服务之Ribbon的基本使用</p>
<p>上篇文章已经将咱们的电影服务和用户服务注册到我们实现的Eureka Server上了。但是现在有几个问题需要我们去考虑。<br>第一个问题就是当有多个用户服务节点的时候，我们如何让电影服务调用用户服务实现负载均衡。<br>第二个问题就是我们如何让电影服务调用用户服务的时候去使用Eureka Server里面的信息，现在还是通过硬编码去调用的。<br>首先我们去解决第一个问题，大家应该都知道的一种实现负载均衡的方式，就是在用户服务前面去添加一个nginx，这是一种服务器端负载均衡的方式。</p>
<p>既然现在有服务器负载均衡，那就有另外一种实现方式就是客户端负载均衡,这里我就要引出Ribbon这个组件。<br>Ribbon是什么？<br>Ribbon是Netflix发布的开源项目，主要功能是提供客户端的软件负载均衡算法，将Netflix的中间层服务连接在一起。Ribbon客户端组件提供一系列完善的配置项如连接超时，重试等。简单的说，就是在配置文件中列出Load Balancer（简称LB）后面所有的机器，Ribbon会自动的帮助你基于某种规则（如简单轮询，随即连接等）去连接这些机器。我们也很容易使用Ribbon实现自定义的负载均衡算法。</p>
<p>Ribbon工作时分为两步,第一步先选择Eureka Server，它优先选择在同一个Zone且负载较少的Server。<br>第二部再根据用户指定的策略，再从Server取到的服务注册列表中选择一个地址。其中Ribbon提供了多种策略，例如轮询round robin，随机Random，根据相应时间加权等。<br>那么接下来我们就在项目中去引入Robbin。<br>第一步引入Robbin，但是我们不用再去重新添加jar了，在之前的spring-cloud-starter-eureka中就有了。</p>
<p>接下来我们怎么去使用Ribbon。很简单一个注解@LoadBalanced就可以搞定。</p>
<p>为了避免和move服务冲突我们改一下端口，改成8010，</p>
<p>启动服务。</p>
<p>可以去看到时可以正常请求到用户服务的。那么我们怎么去实现负载均衡了，我们的再去启动一个用户服务进行测试。我们再去启动一个用户服务，端口改成7901</p>
<p>我们查看当前服务注册信息，可以看到现在有两个用户服务</p>
<p>请求电影服务我可以看到两个用户服务的控制台都会有日志。<br>好了今天由于时间问题我就先写到这里，后面会持续分享，喜欢Spring cloud的朋友记得关注我，持续学习后面的知识，我的每篇文章都是连贯的，最好不要断开。我是磊哥，每天为你分享java知识。</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-17T13:47:00.000Z">2019-07-17</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    8 分钟 read (About 1125 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/17/ribbon-load-balance/">ribbon loadbalanced</a>
            
        </h1>
        <div class="content">
            <p>由springcloud ribbon的 @LoadBalanced注解的使用理解  </p>
<p>在使用springcloud ribbon客户端负载均衡的时候，可以给RestTemplate bean 加一个@LoadBalanced注解，就能让这个RestTemplate在请求时拥有客户端负载均衡的能力：</p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@Bean</span></span><br><span class="line">   <span class="hljs-variable">@LoadBalanced</span></span><br><span class="line">   RestTemplate restTemplate() &#123;</span><br><span class="line">       <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">RestTemplate</span>();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>是不是很神奇?打开@LoadBalanced的注解源码，并没有什么特殊的东东:</p>
<figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.cloud</span><span class="hljs-selector-class">.client</span><span class="hljs-selector-class">.loadbalancer</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.beans</span><span class="hljs-selector-class">.factory</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Qualifier</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Documented</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.ElementType</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Inherited</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Retention</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.RetentionPolicy</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Target</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Annotation to mark a RestTemplate bean to be configured to use a LoadBalancerClient</span></span><br><span class="line"><span class="hljs-comment"> * @author Spencer Gibb</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line">@<span class="hljs-keyword">Target</span>(&#123; <span class="hljs-selector-tag">ElementType</span><span class="hljs-selector-class">.FIELD</span>, <span class="hljs-selector-tag">ElementType</span><span class="hljs-selector-class">.PARAMETER</span>, <span class="hljs-selector-tag">ElementType</span><span class="hljs-selector-class">.METHOD</span> &#125;)</span><br><span class="line">@<span class="hljs-keyword">Retention</span>(<span class="hljs-keyword">RetentionPolicy</span>.<span class="hljs-keyword">RUNTIME</span>)</span><br><span class="line">@<span class="hljs-keyword">Documented</span></span><br><span class="line">@<span class="hljs-keyword">Inherited</span></span><br><span class="line">@<span class="hljs-keyword">Qualifier</span></span><br><span class="line"><span class="hljs-keyword">public</span> @interface LoadBalanced &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>唯一不同的地方就是多了一个@Qulifier注解.</p>
<p>搜索@LoadBalanced注解的使用地方，发现只有一处使用了,在LoadBalancerAutoConfiguration这个自动装配类中：</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@LoadBalanced</span></span><br><span class="line"><span class="hljs-meta">@Autowired</span>(required = <span class="hljs-keyword">false</span>)</span><br><span class="line"><span class="hljs-keyword">private</span> List&lt;RestTemplate&gt; restTemplates = Collections.emptyList();</span><br><span class="line"><span class="hljs-meta">@Bean</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> SmartInitializingSingleton <span class="hljs-title">loadBalancedRestTemplateInitializer</span><span class="hljs-params">(</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">      <span class="hljs-keyword">final</span> List&lt;RestTemplateCustomizer&gt; customizers)</span> </span>&#123;</span><br><span class="line">   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SmartInitializingSingleton() &#123;</span><br><span class="line">      <span class="hljs-meta">@Override</span></span><br><span class="line">      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterSingletonsInstantiated</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">         <span class="hljs-keyword">for</span> (RestTemplate restTemplate : LoadBalancerAutoConfiguration.<span class="hljs-keyword">this</span>.restTemplates) &#123;</span><br><span class="line">            <span class="hljs-keyword">for</span> (RestTemplateCustomizer customizer : customizers) &#123;</span><br><span class="line">               customizer.customize(restTemplate);</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-meta">@Autowired</span>(required = <span class="hljs-keyword">false</span>)</span><br><span class="line"><span class="hljs-keyword">private</span> List&lt;LoadBalancerRequestTransformer&gt; transformers = Collections.emptyList();</span><br><span class="line"><span class="hljs-meta">@Bean</span></span><br><span class="line"><span class="hljs-meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> LoadBalancerRequestFactory <span class="hljs-title">loadBalancerRequestFactory</span><span class="hljs-params">(</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">      LoadBalancerClient loadBalancerClient)</span> </span>&#123;</span><br><span class="line">   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LoadBalancerRequestFactory(loadBalancerClient, transformers);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-meta">@Configuration</span></span><br><span class="line"><span class="hljs-meta">@ConditionalOnMissingClass</span>(<span class="hljs-string">"org.springframework.retry.support.RetryTemplate"</span>)</span><br><span class="line"><span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoadBalancerInterceptorConfig</span> </span>&#123;</span><br><span class="line">   <span class="hljs-meta">@Bean</span></span><br><span class="line">   <span class="hljs-function"><span class="hljs-keyword">public</span> LoadBalancerInterceptor <span class="hljs-title">ribbonInterceptor</span><span class="hljs-params">(</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">         LoadBalancerClient loadBalancerClient,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">         LoadBalancerRequestFactory requestFactory)</span> </span>&#123;</span><br><span class="line">      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LoadBalancerInterceptor(loadBalancerClient, requestFactory);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="hljs-meta">@Bean</span></span><br><span class="line">   <span class="hljs-meta">@ConditionalOnMissingBean</span></span><br><span class="line">   <span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplateCustomizer <span class="hljs-title">restTemplateCustomizer</span><span class="hljs-params">(</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">         <span class="hljs-keyword">final</span> LoadBalancerInterceptor loadBalancerInterceptor)</span> </span>&#123;</span><br><span class="line">      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplateCustomizer() &#123;</span><br><span class="line">         <span class="hljs-meta">@Override</span></span><br><span class="line">         <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">customize</span><span class="hljs-params">(RestTemplate restTemplate)</span> </span>&#123;</span><br><span class="line">            List&lt;ClientHttpRequestInterceptor&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(</span><br><span class="line">                  restTemplate.getInterceptors());</span><br><span class="line">            list.add(loadBalancerInterceptor);</span><br><span class="line">            restTemplate.setInterceptors(list);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段自动装配的代码的含义不难理解，就是利用了RestTempllate的拦截器，使用RestTemplateCustomizer对所有标注了@LoadBalanced的RestTemplate Bean添加了一个LoadBalancerInterceptor拦截器，而这个拦截器的作用就是对请求的URI进行转换获取到具体应该请求哪个服务实例ServiceInstance。</p>
<p>那么为什么</p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@LoadBalanced</span></span><br><span class="line"><span class="hljs-variable">@Autowired</span>(required = false)</span><br><span class="line">private List&lt;RestTemplate&gt; restTemplates = Collections.emptyList();</span><br></pre></td></tr></table></figure>

<p>这个restTemplates能够将所有标注了@LoadBalanced的RestTemplate自动注入进来呢？<br>这就要说说@Autowired注解和@Qualifier这两个注解了。<br>大家日常使用很多都是用@Autowired来注入一个bean,其实@Autowired还可以注入List和Map,比如我定义两个Bean:</p>
<figure class="highlight aspectj hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Bean</span>(<span class="hljs-string">"user1"</span>)</span><br><span class="line"><span class="hljs-function">User <span class="hljs-title">user1</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> User(<span class="hljs-string">"1"</span>, <span class="hljs-string">"a"</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-meta">@Bean</span>(<span class="hljs-string">"user2"</span>))</span><br><span class="line"><span class="hljs-function">User <span class="hljs-title">user2</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> User(<span class="hljs-string">"2"</span>, <span class="hljs-string">"b"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我写一个Controller:</p>
<figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.demo</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.User</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.beans</span><span class="hljs-selector-class">.factory</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Autowired</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.RequestMapping</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.RestController</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.Collections</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.HashMap</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.List</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.Map</span>;</span><br><span class="line"> </span><br><span class="line">@<span class="hljs-keyword">RestController</span></span><br><span class="line"><span class="hljs-keyword">public</span> class MyController &#123;</span><br><span class="line"> </span><br><span class="line">    @<span class="hljs-keyword">Autowired</span>(<span class="hljs-keyword">required</span> = false)</span><br><span class="line">    private List&lt;User&gt; users = Collections.emptyList();</span><br><span class="line"> </span><br><span class="line">    @<span class="hljs-keyword">Autowired</span>(<span class="hljs-keyword">required</span> = false)</span><br><span class="line">    private Map&lt;String,User&gt; userMap = new HashMap&lt;&gt;();</span><br><span class="line"> </span><br><span class="line">    @<span class="hljs-keyword">RequestMapping</span>("/<span class="hljs-keyword">list</span>")</span><br><span class="line">    public Object listUsers() &#123;</span><br><span class="line">        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">users</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="hljs-keyword">RequestMapping</span>("/<span class="hljs-keyword">map</span>")</span><br><span class="line">    public Object mapUsers() &#123;</span><br><span class="line">        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">userMap</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在controller中通过:</p>
<figure class="highlight dart hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Autowired</span>(required = <span class="hljs-keyword">false</span>)</span><br><span class="line">private <span class="hljs-built_in">List</span>&lt;User&gt; users = Collections.emptyList();</span><br><span class="line"> </span><br><span class="line"><span class="hljs-meta">@Autowired</span>(required = <span class="hljs-keyword">false</span>)</span><br><span class="line">private <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>,User&gt; userMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();</span><br></pre></td></tr></table></figure>

<p>就可以自动将两个bean注入进来，当注入map的时候，map的key必须是String类型，然后bean name将作为map的key,本例，map中将有两个key分别为user1和user2,value分别为对应的User Bean实例。<br>访问<a href="http://localhost:8080/map" target="_blank" rel="noopener">http://localhost:8080/map</a>:</p>
<figure class="highlight json hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="hljs-attr">"user1"</span>: &#123;</span><br><span class="line">        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"1"</span>,</span><br><span class="line">        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"a"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="hljs-attr">"user2"</span>: &#123;</span><br><span class="line">        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"2"</span>,</span><br><span class="line">        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"b"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>访问<a href="http://localhost:8080/list" target="_blank" rel="noopener">http://localhost:8080/list</a>:</p>
<figure class="highlight json hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"1"</span>,</span><br><span class="line">        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"a"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"2"</span>,</span><br><span class="line">        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"b"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>然后我们给user1和user2分别打上@Qualifier修饰符:</p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@Bean</span>(<span class="hljs-string">"user1"</span>)</span><br><span class="line">   <span class="hljs-variable">@Qualifier</span>(<span class="hljs-string">"valid"</span>)</span><br><span class="line">   User user1() &#123;</span><br><span class="line">       <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">User</span>(<span class="hljs-string">"1"</span>, <span class="hljs-string">"a"</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   @<span class="hljs-selector-tag">Bean</span>(<span class="hljs-string">"user2"</span>)</span><br><span class="line">   @<span class="hljs-selector-tag">Qualifier</span>(<span class="hljs-string">"invalid"</span>)</span><br><span class="line">   <span class="hljs-selector-tag">User</span> <span class="hljs-selector-tag">user2</span>() &#123;</span><br><span class="line">       <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">User</span>(<span class="hljs-string">"2"</span>, <span class="hljs-string">"b"</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>然后将controller中的user list 和user map分别也打上@Qualifier修饰符:</p>
<figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.demo</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.User</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.beans</span><span class="hljs-selector-class">.factory</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Autowired</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.beans</span><span class="hljs-selector-class">.factory</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Qualifier</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.RequestMapping</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.RestController</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.Collections</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.HashMap</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.List</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.Map</span>;</span><br><span class="line"> </span><br><span class="line">@<span class="hljs-keyword">RestController</span></span><br><span class="line"><span class="hljs-keyword">public</span> class MyController &#123;</span><br><span class="line"> </span><br><span class="line">    @<span class="hljs-keyword">Autowired</span>(<span class="hljs-keyword">required</span> = false)</span><br><span class="line">    @Qualifier(<span class="hljs-string">"valid"</span>)</span><br><span class="line">    private List&lt;User&gt; users = Collections.emptyList();</span><br><span class="line"> </span><br><span class="line">    @<span class="hljs-keyword">Autowired</span>(<span class="hljs-keyword">required</span> = false)</span><br><span class="line">    @Qualifier(<span class="hljs-string">"invalid"</span>)</span><br><span class="line">    private Map&lt;String,User&gt; userMap = new HashMap&lt;&gt;();</span><br><span class="line"> </span><br><span class="line">    @<span class="hljs-keyword">RequestMapping</span>("/<span class="hljs-keyword">list</span>")</span><br><span class="line">    public Object listUsers() &#123;</span><br><span class="line">        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">users</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="hljs-keyword">RequestMapping</span>("/<span class="hljs-keyword">map</span>")</span><br><span class="line">    public Object mapUsers() &#123;</span><br><span class="line">        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">userMap</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么所有标注了@Qualifier(“valid”)的user bean都会自动注入到List<user> users中去(本例是user1)，所有标注了@Qualifier(“invalid”)的user bean都会自动注入到Map&lt;String,User&gt; userMap中去（本例是user2），我们再次访问上面两个url:</user></p>
<p>访问<a href="http://localhost:8080/list" target="_blank" rel="noopener">http://localhost:8080/list</a>:</p>
<figure class="highlight json hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"1"</span>,</span><br><span class="line">        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"a"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>访问<a href="http://localhost:8080/map" target="_blank" rel="noopener">http://localhost:8080/map</a>:</p>
<figure class="highlight json hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="hljs-attr">"user2"</span>: &#123;</span><br><span class="line">        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"2"</span>,</span><br><span class="line">        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"b"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看到这里我们可以理解@LoadBalanced的用处了，其实就是一个修饰符，和@Qualifier一样，比如我们给user1打上<br>@LoadBalanced:</p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@Bean</span>(<span class="hljs-string">"user1"</span>)</span><br><span class="line"><span class="hljs-variable">@LoadBalanced</span></span><br><span class="line">User user1() &#123;</span><br><span class="line">    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">User</span>(<span class="hljs-string">"1"</span>, <span class="hljs-string">"a"</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">@<span class="hljs-selector-tag">Bean</span>(<span class="hljs-string">"user2"</span>)</span><br><span class="line"><span class="hljs-selector-tag">User</span> <span class="hljs-selector-tag">user2</span>() &#123;</span><br><span class="line">    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">User</span>(<span class="hljs-string">"2"</span>, <span class="hljs-string">"b"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后controller中给List<user> users打上@LoadBalanced注解:</user></p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@Autowired</span>(required = false)</span><br><span class="line">   <span class="hljs-variable">@LoadBalanced</span></span><br><span class="line">   private List&lt;User&gt; users = Collections.emptyList();</span><br></pre></td></tr></table></figure>

<p>访问<a href="http://localhost:8080/list：" target="_blank" rel="noopener">http://localhost:8080/list：</a><br>[<br>    {<br>        “id”: “1”,<br>        “name”: “a”<br>    }<br>]</p>
<p>和@Qualifier注解效果一样，只有user1被注入进了List，user2没有修饰符，没有被注入进去。<br>另外当spring容器中有多个相同类型的bean的时候，可以通过@Qualifier来进行区分，以便在注入的时候明确表明你要注入具体的哪个bean,消除歧义。</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-17T10:55:00.000Z">2019-07-17</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    30 分钟 read (About 4469 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/17/computer-and-network/">computer and network</a>
            
        </h1>
        <div class="content">
            <p>计算机网络基本知识汇总  </p>
<p>概述<br>OSI分层（7层）<br>物理层、数据链路层、网络层、运输层、会话层、表示层、应用层<br>TCP/IP分层（4层）<br>网络接口层、网络层、运输层、应用层<br>五层协议（5层）<br>物理层、数据链路层、网络层、运输层、应用层<br>五层结构的概述<br>应用层：通过应用进程间的交互来完成特定网络应用<br>数据：报文<br>协议：HTTP, SMTP(邮件), FTP(文件传送)<br>运输层：向两个主机进程之间的通信提供通用的数据传输服务。<br>数据：TCP:报文段，UDP:用户数据报<br>协议：TCP, UDP<br>网络层：为分组交换网上的不同主机提供通信服务<br>数据：包或IP数据报<br>协议：IP<br>数据链路层：<br>数据：帧<br>物理层：<br>数据：比特<br>ARP地址解析协议:用来获取目标IP地址所对应的MAC地址的<br>各层协议<br>应用层<br>域名系统DNS<br>例：某用户通过主机A浏览西安交大的主页 <a href="http://www.xjtu.edu.cn" target="_blank" rel="noopener">www.xjtu.edu.cn</a>   </p>
<ol>
<li>A向本地域名服务器DNS查询   </li>
<li>如果DNS上有<a href="http://www.xjtu.edu.cn的记录，就立即返回IP地址给主机A" target="_blank" rel="noopener">www.xjtu.edu.cn的记录，就立即返回IP地址给主机A</a>   </li>
<li>如果DNS上没有该域名记录，则DNS向根域名服务器发出查询请求   </li>
<li>根域名服务器把负责cn域的顶级域名服务器B的IP地址告诉DNS   </li>
<li>DNS向B查询获得二级域名服务器C的IP地址，最终迭代查询到<a href="http://www.xjtu.edu.cn的ip直接返回DNS" target="_blank" rel="noopener">www.xjtu.edu.cn的ip直接返回DNS</a><br>HTTP<br>请求报文  </li>
</ol>
<p>常用的 HTTP 请求方法有GET、POST、HEAD、PUT、DELETE、OPTIONS、TRACE、CONNECT;<br>GET：当客户端要从服务器中读取某个资源时，使用GET 方法。GET 方法要求服务器将URL 定位的资源放在响应报文的部分，回送给客户端，即向服务器请求某个资源。使用GET 方法时，请求参数和对应的值附加在 URL 后面，利用一个问号(“?”)代表URL 的结尾与请求参数的开始，传递参数长度受限制。例如，/index.jsp?id=100&amp;op=bind。<br>POST：当客户端给服务器提供信息较多时可以使用POST 方法，POST 方法向服务器提交数据，比如完成表单数据的提交，将数据提交给服务器处理。GET 一般用于获取/查询资源信息，POST 会附带用户数据，一般用于更新资源信息。POST 方法将请求参数封装在HTTP 请求数据中，以名称/值的形式出现，可以传输大量数据;<br>请求头部：请求头部由关键字/值对组成，每行一对，关键字和值用英文冒号“:”分隔。请求头部通知服务器有关于客户端请求的信息，典型的请求头有：<br>User-Agent：产生请求的浏览器类型;<br>Accept：客户端可识别的响应内容类型列表;星号 “ * ” 用于按范围将类型分组，用 “ / ” 指示可接受全部类型，用“ type/* ”指示可接受 type 类型的所有子类型;<br>Accept-Language：客户端可接受的自然语言;<br>Accept-Encoding：客户端可接受的编码压缩格式;<br>Accept-Charset：可接受的应答的字符集;<br>Host：请求的主机名，允许多个域名同处一个IP 地址，即虚拟主机;<br>connection：连接方式(close 或 keepalive);<br>Cookie：存储于客户端扩展字段，向同一域名的服务端发送属于该域的cookie;<br>GET /search?hl=zh-CN&amp;source=hp&amp;q=domety&amp;aq=f&amp;oq= HTTP/1.1<br>Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/vnd.ms-excel, application/vnd.ms-powerpoint,<br>application/msword, application/x-silverlight, application/x-shockwave-flash, <em>/</em><br>Referer: <a href="http://www.google.cn/" target="_blank" rel="noopener">http://www.google.cn/</a><br>Accept-Language: zh-cn<br>Accept-Encoding: gzip, deflate<br>User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 2.0.50727; TheWorld)<br>Host: <a href="http://www.google.cn" target="_blank" rel="noopener">www.google.cn</a><br>Connection: Keep-Alive<br>Cookie: PREF=ID=80a06da87be9ae3c:U=f7167333e2c3b714:NW=1:TM=1261551909:LM=1261551917:S=ybYcq2wpfefs4V9g;<br>NID=31=ojj8d-IygaEtSxLgaJmqSjVhCspkviJrB6omjamNrSm8lZhKy_yMfO2M4QMRKcH1g0iQv9u-2hfBW7bUFwVh7pGaRUb0RnHcJU37y-<br>FxlRugatx63JLv7CWMD6UB_O_r  </p>
<p>响应报文  </p>
<p>状态码由三位数字组成，第一位数字表示响应的类型，常用的状态码有五大类如下所示：<br>1xx：表示服务器已接收了客户端请求，客户端可继续发送请求;<br>2xx：表示服务器已成功接收到请求并进行处理;<br>3xx：表示服务器要求客户端重定向;<br>4xx：表示客户端的请求有非法内容;<br>5xx：表示服务器未能正常处理客户端的请求而出现意外错误;<br>200 OK：表示客户端请求成功;<br>400 Bad Request：表示客户端请求有语法错误，不能被服务器所理解;<br>401 Unauthonzed：表示请求未经授权，该状态代码必须与 WWW-Authenticate 报头域一起使用;<br>403 Forbidden：表示服务器收到请求，但是拒绝提供服务，通常会在响应正文中给出不提供服务的原因;<br>404 Not Found：请求的资源不存在，例如，输入了错误的URL;<br>500 Internal Server<br>Error：表示服务器发生不可预期的错误，导致无法完成客户端的请求;<br>503 Service Unavailable：表示服务器当前不能够处理客户端的请求，在一段时间之后，服务器可能会恢复正常;<br>响应头部：响应头可能包括：   </p>
<ul>
<li>Location：Location响应报头域用于重定向接受者到一个新的位置。例如：客户端所请求的页面已不存在原先的位置，为了让客户端重定向到这个页面新的位置，服务器端可以发回Location响应报头后使用重定向语句，让客户端去访问新的域名所对应的服务器上的资源; </li>
<li>Server：Server 响应报头域包含了服务器用来处理请求的软件信息及其版本。它和 User-Agent 请求报头域是相对应的，前者发送服务器端软件的信息，后者发送客户端软件(浏览器)和操作系统的信息。   </li>
<li>Vary：指示不可缓存的请求头列表;   </li>
<li>Connection：连接方式;<br>对于请求来说：close(告诉WEB 服务器或者代理服务器，在完成本次请求的响应后，断开连接，不等待本次连接的后续请求了)。keepalive(告诉WEB服务器或者代理服务器，在完成本次请求的响应后，保持连接，等待本次连接的后续请求);<br>对于响应来说：close(连接已经关闭); keepalive(连接保持着，在等待本次连接的后续请求); Keep-Alive：如果浏览器请求保持连接，则该头部表明希望WEB 服务器保持连接多长时间(秒);例如：Keep-Alive：300;<br>WWW-Authenticate：WWW-Authenticate响应报头域必须被包含在401 (未授权的)响应消息中，这个报头域和前面讲到的Authorization 请求报头域是相关的，当客户端收到 401 响应消息，就要决定是否请求服务器对其进行验证。如果要求服务器对其进行验证，就可以发送一个包含了Authorization 报头域的请求;<br>问题：   </li>
</ul>
<ol>
<li>Http1.1与Http1.0的区别<br>http1.0使用非持久连接（短连接），而http1.1默认是持久连接（长连接），当然也可以配置成非持久连接。<br>Cookie和Session的作用和工作原理<br>FTP文件传送协议<br>运输层<br>使用UDP和TCP协议的各种应用和应用层协议<br>应用<br>应用层协议<br>运输层协议<br>名字转换<br>DNS(域名系统)<br>UDP<br>文件传送<br>TFTP(简单文件传送协议)<br>UDP<br>路由器选择协议<br>RIP(路由信息协议)<br>UDP<br>IP地址配置<br>DHCP(动态主机配置协议)<br>UDP<br>网络管理<br>SNMP(简单网络管理协议)<br>UDP<br>远程服务器<br>NFS(网络文件系统)<br>UDP<br>多播<br>IGMP(网际组管理协议)<br>UDP<br>电子邮件<br>SMTP(简单邮件传送协议)<br>TCP<br>远程终端<br>TELNET(远程终端协议)<br>TCP<br>万维网<br>HTTP(超文本传送协议)<br>TCP<br>文件传送<br>FTP(文件传送协议)<br>TCP  </li>
</ol>
<ul>
<li>端口<br>TCP和UDP都需要有源端口和目的端口<br>（端口：用16位来表示,即一个主机共有65536个端口.序号小于256的端口称为通用端口,如FTP是21端口,WWW是80端口等.端口用来标识一个服务或应用.一台主机可以同时提供多个服务和建立多个连接.端口(port)就是传输层的应用程序接口.应用层的各个进程是通过相应的端口才能与运输实体进行交互.服务器一般都是通过人们所熟知的端口号来识别的）<br>服务端<br>常用的熟知端口<br>应用程序<br>FTP<br>TELNET<br>SMTP<br>DNS<br>TFTP<br>HTTP<br>SNMP<br>SNMP(trap)<br>熟知端口  </li>
</ul>
<p>登记端口 1024<del>49151<br>客户端<br>端口号由客户进程动态选择。数值范围 49152</del>65535<br>UDP<br>特点<br>无连接的（发送数据之前不需要建立连接，因此减少了开销和发送数据之前的时延）<br>尽最大努力交付（不保证可靠支付，因此主机不需要维持复杂的连接状态表）<br>面向报文的（UDP对应用层交下来的报文，添加完首部后就直接交付IP层。如果太长就会分 片）<br>UDP没有拥塞控制<br>UDP支持一对一、一对多、多对一和多对多的交互通信<br>UDP的首部开销小（只有8个字节，TCP有20个字节）<br>UDP报文  </p>
<ul>
<li>源端口：2字节 = 16bit = 0 ~ 65535   </li>
<li>目的端口：2字节   </li>
<li>长度：2字节   </li>
<li>检验和：2字节<br>如果接受方UDP发现收到的报文中的目的端口号不正确（不存在对应端口号的应用进程），就会丢弃报文，并有网际控制报文协议ICMP（ping某个地址就是用的ICMP）发送“端口不可达”差错报文给发送方。<br>UDP用户数据报首部检验和计算时会在UDP用户数据报前增加12个字节的伪首部。  </li>
</ul>
<p>TCP<br>特点<br>面向连接的运输层协议。<br>点对点（一对一）通信。<br>可靠交付。<br>全双工通信（TCP连接的两端都设有发送缓存和接收缓存，用来临时存放双向通信的数据）。<br>面向字节流。<br>TCP与UDP在发送报文时所采用的方式完全不同。TCP具体发送的报文由接收方给出的窗口值和当前网络拥塞的程度来决定一个报文段包含多少字节。而UDP发送的报文长度由应用进程给出。<br>TCP可靠传输工作原理<br>TCP连接的端点叫做套接字(socket)或插口。套接字socket = (IP地址：端口号)<br>停止等待协议  </p>
<p>每发送完一个分组就设置一个超时计时器。   </p>
<ul>
<li>注意：   </li>
</ul>
<ol>
<li>必须暂时保存已发送的分组的副本   </li>
<li>分组和确认分组都必须编号   </li>
<li>超市计时器设置的重传时间比数据在分组传输的平均时间更长一些<br>确认丢失和确认迟到</li>
</ol>
<p>如果接收方接收到数据发送确认没有被发送方接收到，那么发送方超时后会重新发送分组，并且接收方收到重复的分组会丢弃并重传确认。<br>如果接收方收到的确认是已经接受过的，那么会无视这个确认。<br>缺点<br>停止等待协议（自动重传ARQ）虽然简单，但是信道利用率低。  </p>
<p>信道利用率U = TD / (TD + RTT + TA)<br>连续ARQ协议和滑动窗口协议  </p>
<p>TCP报文格式</p>
<p>源端口和目的端口 各占2字节<br>序号 4字节<br>确认号 4字节期望收到对方下一个报文的第一个数据字节的序号<br>数据偏移 4位<br>保留 6字节<br>紧急URG 当URG=1表示紧急指针有效<br>确认ACK<br>推送PSH<br>复位RST 当RST = 1时，释放连接并重新建立连接<br>同步SYN 当SYN = 1 ACK = 0时，表明这是一个连接请求报文段。<br>终止FIN FIN = 1，请求释放连接。<br>窗口<br>检验和<br>紧急指针<br>选项<br>TCP的三次握手  </p>
<p>客户端TCP向服务端TCP发送一个特殊的TCP报文段，不包含应用层数据，报文中SYN=1，设置一个初始号client_isn,记录在报文段的序列号seq中。<br>SYN报文段到达服务器后，为该TCP链接分配缓存和变量，并向客户端发送允许链接的报文段。其中，SYN = 1， ACK = client_isn+1，seq = server_isn;<br>客户端收到允许连接的报文后，客户端也给连接分配缓存和变量，客户端向服务端发送一个报文段，其中ACK = server_isn+1，SYN = 0，并且由于连接已经建立所以现在可以携带应用层数据。<br>TCP四次挥手  </p>
<ol>
<li>客户端发送连接释放报文段，报文中FIN = 1, seq = u;   </li>
<li>服务端接收到连接释放报文后发出确认报文，其中ACK = 1; seq = v; ack = u + 1;   </li>
<li>服务端在发送完数据后，发送连接释放报文FIN = 1, seq = w, ack = u + 1;并停止向客户端发送数据。   </li>
<li>客户端收到连接释放报文后，发送确认报文， ACK = 1; seq = u + 1; ack = w + 1;并且进入等待2MSL，防止服务端没有接收到确认报文，重传报文。并且使连接产生的报文都消失。<br>TCP协议的连接是全双工连接，一个TCP连接存在双向的读写通道。<br>简单说来是 “先关读，后关写”，一共需要四个阶段。以客户机发起关闭连接为例：   </li>
<li>服务器读通道关闭   </li>
<li>客户机写通道关闭   </li>
<li>客户机读通道关闭   </li>
<li>服务器写通道关闭<br>TCP拥塞控制<br>拥塞控制和流量控制的区别<br>流量控制针对的是点对点之间的（发送方和接收方）之间的速度匹配服务，因为接收方的应用程序读取的速度不一定很迅速，而接收方的缓存是有限的，就需要避免发送的速度过快而导致的问题。拥塞控制是由于网络中的路由和链路传输速度限制，要避免网络的过载和进行的控制。<br>拥塞控制算法<br>拥塞控制算法主要包含了三个部分：慢启动、拥塞避免和快速回复  </li>
</ol>
<p>慢启动<br>慢开始算法的思路就是，不要一开始就发送大量的数据，先探测一下网络的拥塞程度，也就是说由小到大逐渐增加拥塞窗口的大小。一般一开始为1个MSS，之后翻倍这样来增加，呈指数增长。其中1、慢启动过程有一个阈值ssthresh，一旦到达阈值就进入拥塞避免模式。这是第一种离开结束慢启动的方式2、如果收到了一个丢包提示，就将cwnd设为1并且重新开始慢启动过程，这时要把阈值ssthresh设为当前cwnd值的一半。3、如果收到了三次冗余的ACK，就执行一次快速重传并且进入快速恢复状态，这是最后一种结束慢启动的过程。<br>拥塞避免<br>进入拥塞避免说明cwnd值大约是上一次遇到拥塞是的一半，这时候不能翻倍，而是将cwnd的值每次增加一个MSS。结束的过程有两种可能：1、当出现超时时，将cwnd值设为1个MSS，并且将ssthresh阈值设为当前cwnd值的一半。2、当收到三个冗余ACK时，将ssthresh阈值设为当前cwnd值的一半，并且将cwnd值设为当前cwnd值的一半加3，即ssthresh阈值加3，并且进入快速恢复状态。<br>快速恢复<br>快速恢复就是指进入快速恢复前的一系列操作，即将ssthresh阈值设为当前cwnd值的一半，并且将cwnd值设为当前cwnd值的一半加3，即ssthresh阈值加3，之后进入拥塞避免状态，即每次cwnd的值加1个MSS。<br>网络层<br>协议<br>地址解析协议 ARP<br>网际控制报文协议 ICMP<br>网际组管理协议 IGMP<br>IP<br>IP地址分类：<br>A类:1.0.0.0<del>126.255.255.255,默认子网掩码/8,即255.0.0.0 (其中127.0.0.0</del>127.255.255.255为环回地址,用于本地环回测试等用途)；<br>B类:128.0.0.0<del>191.255.255.255,默认子网掩码/16,即255.255.0.0；<br>C类:192.0.0.0</del>223.255.255.255,默认子网掩码/24,即255.255.255.0；<br>D类:224.0.0.0<del>239.255.255.255,一般于用组播<br>E类:240.0.0.0</del>255.255.255.255(其中255.255.255.255为全网广播地址),E类地址一般用于研究用途  </p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-17T06:12:00.000Z">2019-07-17</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 分钟 read (About 1089 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/17/scheduled/">@scheduled </a>
            
        </h1>
        <div class="content">
            <p>@Scheduled cron表达式<br>一、Cron详解：<br>Cron表达式是一个字符串，字符串以5或6个空格隔开，分为6或7个域，每一个域代表一个含义，Cron有如下两种语法格式：<br>1.Seconds Minutes Hours DayofMonth Month DayofWeek Year<br>2.Seconds Minutes Hours DayofMonth Month DayofWeek<br>每一个域可出现的字符如下：<br>Seconds: 可出现”, - * /“四个字符，有效范围为0-59的整数<br>Minutes: 可出现”, - * /“四个字符，有效范围为0-59的整数<br>Hours: 可出现”, - * /“四个字符，有效范围为0-23的整数<br>DayofMonth :可出现”, - * / ? L W C”八个字符，有效范围为0-31的整数<br>Month: 可出现”, - * /“四个字符，有效范围为1-12的整数或JAN-DEc<br>DayofWeek: 可出现”, - * / ? L C #”四个字符，有效范围为1-7的整数或SUN-SAT两个范围。  1表示星期天，2表示星期一， 依次类推<br>Year: 可出现”, - * /“四个字符，有效范围为1970-2099年  </p>
<p>每一个域都使用数字，但还可以出现如下特殊字符，它们的含义是：<br>(1) <em>：表示匹配该域的任意值，假如在Minutes域使用</em>, 即表示每分钟都会触发事件。<br>(2) ?：只能用在DayofMonth和DayofWeek两个域。它也匹配域的任意值，但实际不会。因为DayofMonth和 DayofWeek会相互影响。例如想在每月的20日触发调度，不管20日到底是星期几，则只能使用如下写法： 13 13 15 20 * ?, 其中最后一位只能用？，而不能使用<em>，如果使用</em>表示不管星期几都会触发，实际上并不是这样。<br>(3) -：表示范围，例如在Minutes域使用5-20，表示从5分到20分钟每分钟触发一次<br>(4) /：表示起始时间开始触发，然后每隔固定时间触发一次，例如在Minutes域使用5/20,则意味着5分钟触发一次，而25，45等分别触发一次.<br>(5) ,：表示列出枚举值值。例如：在Minutes域使用5,20，则意味着在5和20分每分钟触发一次。<br>(6) L：表示最后，只能出现在DayofWeek和DayofMonth域，如果在DayofWeek域使用5L,意味着在最后的一个星期四触发。<br>(7) W：表示有效工作日(周一到周五),只能出现在DayofMonth域，系统将在离指定日期的最近的有效工作日触发事件。例如：在 DayofMonth使用5W，如果5日是星期六，则将在最近的工作日：星期五，即4日触发。如果5日是星期天，则在6日(周一)触发；如果5日在星期一 到星期五中的一天，则就在5日触发。另外一点，W的最近寻找不会跨过月份。<br>(8) LW：这两个字符可以连用，表示在某个月最后一个工作日，即最后一个星期五。<br>(9) #：用于确定每个月第几个星期几，只能出现在DayofMonth域。例如在4#2，表示某月的第二个星期三。   </p>
<p>举几个例子:<br>每隔5秒执行一次：”*/5 * * * * ?”<br>每隔1分钟执行一次：”0 */1 * * * ?”<br>每天23点执行一次：”0 0 23 * * ?”<br>每天凌晨1点执行一次：”0 0 1 * * ?”<br>每月1号凌晨1点执行一次：”0 0 1 1 * ?”<br>每月最后一天23点执行一次：”0 0 23 L * ?”<br>每周星期天凌晨1点实行一次：”0 0 1 ? * L”<br>在26分、29分、33分执行一次：”0 26,29,33 * * * ?”<br>每天的0点、13点、18点、21点都执行一次：”0 0 0,13,18,21 * * ?”<br>表示在每月的1日的凌晨2点调度任务：”0 0 2 1 * ? *”<br>表示周一到周五每天上午10：15执行作业：”0 15 10 ? * MON-FRI”<br>表示2002-2006年的每个月的最后一个星期五上午10:15执行：”0 15 10 ? 6L 2002-2006”  </p>
<p>注意：由于”月份中的日期”和”星期中的日期”这两个元素互斥的,必须要对其中一个设置?<br>二、启动服务时执行任务<br>通过@Scheduled cron可以执行定时任务，而想要在服务启动时就先执行一次代码<br>可以通过 implements InitializingBean 重写 afterPropertiesSet 方法来调用一遍定时任务的方法来达到启动服务时执行一遍工作的效果  </p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FuncReportScheduled</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">InitializingBean</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 每月月初执行一次</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-meta">@Scheduled</span>(cron=<span class="hljs-string">"0 0 0 1 * ?"</span>)</span><br><span class="line">    <span class="hljs-meta">@Transactional</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">funcReportInit</span><span class="hljs-params">()</span></span>&#123;</span><br><span class="line">        log.info(<span class="hljs-string">"---------------- 定时任务 ----------------"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterPropertiesSet</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.funcReportInit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-17T03:00:00.000Z">2019-07-17</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    31 分钟 read (About 4608 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/17/springboot-quarz/">springboot Quartz</a>
            
        </h1>
        <div class="content">
            <p>SpringBoot整合Quartz作为调度中心完整实用例子 </p>
<p>因为想要做一个类似于调度中心的东西，定时执行一些Job(通常是一些自定义程序或者可执行的jar包)，搭了一个例子，总结了前辈们的相关经验和自己的一些理解，如有雷同或不当之处，望各位大佬见谅和帮忙指正。<br>由于之前有许多小伙伴问过我如何写个定时任务，里面写上逻辑自己的逻辑,我另做了一个SpringBoot完全整合Quartz的简单例子<br>可以作为Quartz的入门参考 : <a href="https://github.com/EalenXie/springboot-quartz-simple" target="_blank" rel="noopener">https://github.com/EalenXie/springboot-quartz-simple</a></p>
<p>本例子是整合Quartz作为调度中心使用的。<br>1.首先新建项目SpringBoot-Quartz ,选用的技术栈为 SpringBoot + Quartz + Spring Data Jpa。完整代码可见(本文已非最新代码,最新见Github) : <a href="https://github.com/EalenXie/SpringBoot-Quartz" target="_blank" rel="noopener">https://github.com/EalenXie/SpringBoot-Quartz</a><br>pom.xml依赖 : </p>
<figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>name.ealenxie<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>SpringBoot-Quartz<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.1.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <span class="hljs-comment">&lt;!--quartz依赖--&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.quartz-scheduler<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>quartz<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context-support<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.quartz-scheduler<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>quartz-jobs<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>2.你需要在数据库中建立Quartz的相关系统表，所以你需要在数据库中执行如下来自Quartz官方的脚本。</p>
<figure class="highlight sql hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">-- in your Quartz properties file, you'll need to set org.quartz.jobStore.driverDelegateClass = org.quartz.impl.jdbcjobstore.StdJDBCDelegate</span></span><br><span class="line"><span class="hljs-comment">-- 你需要在你的quartz.properties文件中设置org.quartz.jobStore.driverDelegateClass = org.quartz.impl.jdbcjobstore.StdJDBCDelegate</span></span><br><span class="line"><span class="hljs-comment">-- StdJDBCDelegate说明支持集群，所有的任务信息都会保存到数据库中，可以控制事物，还有就是如果应用服务器关闭或者重启，任务信息都不会丢失，并且可以恢复因服务器关闭或者重启而导致执行失败的任务</span></span><br><span class="line"><span class="hljs-comment">-- This is the script from Quartz to create the tables in a MySQL database, modified to use INNODB instead of MYISAM</span></span><br><span class="line"><span class="hljs-comment">-- 这是来自quartz的脚本，在MySQL数据库中创建以下的表，修改为使用INNODB而不是MYISAM</span></span><br><span class="line"><span class="hljs-comment">-- 你需要在数据库中执行以下的sql脚本</span></span><br><span class="line"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> QRTZ_FIRED_TRIGGERS;</span><br><span class="line"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> QRTZ_PAUSED_TRIGGER_GRPS;</span><br><span class="line"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> QRTZ_SCHEDULER_STATE;</span><br><span class="line"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> QRTZ_LOCKS;</span><br><span class="line"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> QRTZ_SIMPLE_TRIGGERS;</span><br><span class="line"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> QRTZ_SIMPROP_TRIGGERS;</span><br><span class="line"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> QRTZ_CRON_TRIGGERS;</span><br><span class="line"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> QRTZ_BLOB_TRIGGERS;</span><br><span class="line"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> QRTZ_TRIGGERS;</span><br><span class="line"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> QRTZ_JOB_DETAILS;</span><br><span class="line"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> QRTZ_CALENDARS;</span><br><span class="line"><span class="hljs-comment">-- 存储每一个已配置的Job的详细信息</span></span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> QRTZ_JOB_DETAILS(</span><br><span class="line">SCHED_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">120</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">JOB_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">JOB_GROUP <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">DESCRIPTION <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">250</span>) <span class="hljs-literal">NULL</span>,</span><br><span class="line">JOB_CLASS_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">250</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">IS_DURABLE <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">IS_NONCONCURRENT <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">IS_UPDATE_DATA <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">REQUESTS_RECOVERY <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">JOB_DATA <span class="hljs-built_in">BLOB</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="hljs-keyword">KEY</span> (SCHED_NAME,JOB_NAME,JOB_GROUP))</span><br><span class="line"><span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span>;</span><br><span class="line"><span class="hljs-comment">-- 存储已配置的Trigger的信息</span></span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> QRTZ_TRIGGERS (</span><br><span class="line">SCHED_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">120</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">TRIGGER_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">TRIGGER_GROUP <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">JOB_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">JOB_GROUP <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">DESCRIPTION <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">250</span>) <span class="hljs-literal">NULL</span>,</span><br><span class="line">NEXT_FIRE_TIME <span class="hljs-built_in">BIGINT</span>(<span class="hljs-number">13</span>) <span class="hljs-literal">NULL</span>,</span><br><span class="line">PREV_FIRE_TIME <span class="hljs-built_in">BIGINT</span>(<span class="hljs-number">13</span>) <span class="hljs-literal">NULL</span>,</span><br><span class="line"><span class="hljs-keyword">PRIORITY</span> <span class="hljs-built_in">INTEGER</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">TRIGGER_STATE <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">TRIGGER_TYPE <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">8</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">START_TIME <span class="hljs-built_in">BIGINT</span>(<span class="hljs-number">13</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">END_TIME <span class="hljs-built_in">BIGINT</span>(<span class="hljs-number">13</span>) <span class="hljs-literal">NULL</span>,</span><br><span class="line">CALENDAR_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-literal">NULL</span>,</span><br><span class="line">MISFIRE_INSTR <span class="hljs-built_in">SMALLINT</span>(<span class="hljs-number">2</span>) <span class="hljs-literal">NULL</span>,</span><br><span class="line">JOB_DATA <span class="hljs-built_in">BLOB</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="hljs-keyword">KEY</span> (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</span><br><span class="line"><span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (SCHED_NAME,JOB_NAME,JOB_GROUP)</span><br><span class="line"><span class="hljs-keyword">REFERENCES</span> QRTZ_JOB_DETAILS(SCHED_NAME,JOB_NAME,JOB_GROUP))</span><br><span class="line"><span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span>;</span><br><span class="line"><span class="hljs-comment">-- 存储已配置的Simple Trigger的信息</span></span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> QRTZ_SIMPLE_TRIGGERS (</span><br><span class="line">SCHED_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">120</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">TRIGGER_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">TRIGGER_GROUP <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">REPEAT_COUNT <span class="hljs-built_in">BIGINT</span>(<span class="hljs-number">7</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">REPEAT_INTERVAL <span class="hljs-built_in">BIGINT</span>(<span class="hljs-number">12</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">TIMES_TRIGGERED <span class="hljs-built_in">BIGINT</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="hljs-keyword">KEY</span> (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</span><br><span class="line"><span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP)</span><br><span class="line"><span class="hljs-keyword">REFERENCES</span> QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP))</span><br><span class="line"><span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span>;</span><br><span class="line"><span class="hljs-comment">-- 存储Cron Trigger，包括Cron表达式和时区信息</span></span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> QRTZ_CRON_TRIGGERS (</span><br><span class="line">SCHED_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">120</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">TRIGGER_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">TRIGGER_GROUP <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">CRON_EXPRESSION <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">120</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">TIME_ZONE_ID <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">80</span>),</span><br><span class="line">PRIMARY <span class="hljs-keyword">KEY</span> (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</span><br><span class="line"><span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP)</span><br><span class="line"><span class="hljs-keyword">REFERENCES</span> QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP))</span><br><span class="line"><span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span>;</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> QRTZ_SIMPROP_TRIGGERS</span><br><span class="line">  (</span><br><span class="line">    SCHED_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">120</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">    TRIGGER_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">    TRIGGER_GROUP <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">    STR_PROP_1 <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">512</span>) <span class="hljs-literal">NULL</span>,</span><br><span class="line">    STR_PROP_2 <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">512</span>) <span class="hljs-literal">NULL</span>,</span><br><span class="line">    STR_PROP_3 <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">512</span>) <span class="hljs-literal">NULL</span>,</span><br><span class="line">    INT_PROP_1 <span class="hljs-built_in">INT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">    INT_PROP_2 <span class="hljs-built_in">INT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">    LONG_PROP_1 <span class="hljs-built_in">BIGINT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">    LONG_PROP_2 <span class="hljs-built_in">BIGINT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">    DEC_PROP_1 <span class="hljs-built_in">NUMERIC</span>(<span class="hljs-number">13</span>,<span class="hljs-number">4</span>) <span class="hljs-literal">NULL</span>,</span><br><span class="line">    DEC_PROP_2 <span class="hljs-built_in">NUMERIC</span>(<span class="hljs-number">13</span>,<span class="hljs-number">4</span>) <span class="hljs-literal">NULL</span>,</span><br><span class="line">    BOOL_PROP_1 <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">1</span>) <span class="hljs-literal">NULL</span>,</span><br><span class="line">    BOOL_PROP_2 <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">1</span>) <span class="hljs-literal">NULL</span>,</span><br><span class="line">    PRIMARY <span class="hljs-keyword">KEY</span> (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</span><br><span class="line">    <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP)</span><br><span class="line">    <span class="hljs-keyword">REFERENCES</span> QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP))</span><br><span class="line"><span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span>;</span><br><span class="line"><span class="hljs-comment">--  Trigger作为Blob类型存储(用于Quartz用户用JDBC创建他们自己定制的Trigger类型，JobStore并不知道如何存储实例的时候)</span></span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> QRTZ_BLOB_TRIGGERS (</span><br><span class="line">SCHED_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">120</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">TRIGGER_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">TRIGGER_GROUP <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">BLOB_DATA <span class="hljs-built_in">BLOB</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="hljs-keyword">KEY</span> (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</span><br><span class="line"><span class="hljs-keyword">INDEX</span> (SCHED_NAME,TRIGGER_NAME, TRIGGER_GROUP),</span><br><span class="line"><span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP)</span><br><span class="line"><span class="hljs-keyword">REFERENCES</span> QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP))</span><br><span class="line"><span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span>;</span><br><span class="line"><span class="hljs-comment">-- 以Blob类型存储Quartz的Calendar日历信息,quartz可配置一个日历来指定一个时间范围</span></span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> QRTZ_CALENDARS (</span><br><span class="line">SCHED_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">120</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">CALENDAR_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">CALENDAR <span class="hljs-built_in">BLOB</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="hljs-keyword">KEY</span> (SCHED_NAME,CALENDAR_NAME))</span><br><span class="line"><span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span>;</span><br><span class="line"><span class="hljs-comment">-- 存储已暂停的Trigger组的信息</span></span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> QRTZ_PAUSED_TRIGGER_GRPS (</span><br><span class="line">SCHED_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">120</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">TRIGGER_GROUP <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="hljs-keyword">KEY</span> (SCHED_NAME,TRIGGER_GROUP))</span><br><span class="line"><span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span>;</span><br><span class="line"><span class="hljs-comment">-- 存储与已触发的Trigger相关的状态信息，以及相联Job的执行信息</span></span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> QRTZ_FIRED_TRIGGERS (</span><br><span class="line">SCHED_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">120</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">ENTRY_ID <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">95</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">TRIGGER_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">TRIGGER_GROUP <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">INSTANCE_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">FIRED_TIME <span class="hljs-built_in">BIGINT</span>(<span class="hljs-number">13</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">SCHED_TIME <span class="hljs-built_in">BIGINT</span>(<span class="hljs-number">13</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line"><span class="hljs-keyword">PRIORITY</span> <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">STATE <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">JOB_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-literal">NULL</span>,</span><br><span class="line">JOB_GROUP <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-literal">NULL</span>,</span><br><span class="line">IS_NONCONCURRENT <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">1</span>) <span class="hljs-literal">NULL</span>,</span><br><span class="line">REQUESTS_RECOVERY <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">1</span>) <span class="hljs-literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="hljs-keyword">KEY</span> (SCHED_NAME,ENTRY_ID))</span><br><span class="line"><span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span>;</span><br><span class="line"><span class="hljs-comment">-- 存储少量的有关 Scheduler的状态信息，和别的 Scheduler 实例(假如是用于一个集群中)</span></span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> QRTZ_SCHEDULER_STATE (</span><br><span class="line">SCHED_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">120</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">INSTANCE_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">LAST_CHECKIN_TIME <span class="hljs-built_in">BIGINT</span>(<span class="hljs-number">13</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">CHECKIN_INTERVAL <span class="hljs-built_in">BIGINT</span>(<span class="hljs-number">13</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="hljs-keyword">KEY</span> (SCHED_NAME,INSTANCE_NAME))</span><br><span class="line"><span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span>;</span><br><span class="line"><span class="hljs-comment">-- 存储程序的非观锁的信息(假如使用了悲观锁)</span></span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> QRTZ_LOCKS (</span><br><span class="line">SCHED_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">120</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">LOCK_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">40</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="hljs-keyword">KEY</span> (SCHED_NAME,LOCK_NAME))</span><br><span class="line"><span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span>;</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_J_REQ_RECOVERY <span class="hljs-keyword">ON</span> QRTZ_JOB_DETAILS(SCHED_NAME,REQUESTS_RECOVERY);</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_J_GRP <span class="hljs-keyword">ON</span> QRTZ_JOB_DETAILS(SCHED_NAME,JOB_GROUP);</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_T_J <span class="hljs-keyword">ON</span> QRTZ_TRIGGERS(SCHED_NAME,JOB_NAME,JOB_GROUP);</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_T_JG <span class="hljs-keyword">ON</span> QRTZ_TRIGGERS(SCHED_NAME,JOB_GROUP);</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_T_C <span class="hljs-keyword">ON</span> QRTZ_TRIGGERS(SCHED_NAME,CALENDAR_NAME);</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_T_G <span class="hljs-keyword">ON</span> QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_GROUP);</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_T_STATE <span class="hljs-keyword">ON</span> QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_STATE);</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_T_N_STATE <span class="hljs-keyword">ON</span> QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP,TRIGGER_STATE);</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_T_N_G_STATE <span class="hljs-keyword">ON</span> QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_GROUP,TRIGGER_STATE);</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_T_NEXT_FIRE_TIME <span class="hljs-keyword">ON</span> QRTZ_TRIGGERS(SCHED_NAME,NEXT_FIRE_TIME);</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_T_NFT_ST <span class="hljs-keyword">ON</span> QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_STATE,NEXT_FIRE_TIME);</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_T_NFT_MISFIRE <span class="hljs-keyword">ON</span> QRTZ_TRIGGERS(SCHED_NAME,MISFIRE_INSTR,NEXT_FIRE_TIME);</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_T_NFT_ST_MISFIRE <span class="hljs-keyword">ON</span> QRTZ_TRIGGERS(SCHED_NAME,MISFIRE_INSTR,NEXT_FIRE_TIME,TRIGGER_STATE);</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_T_NFT_ST_MISFIRE_GRP <span class="hljs-keyword">ON</span> QRTZ_TRIGGERS(SCHED_NAME,MISFIRE_INSTR,NEXT_FIRE_TIME,TRIGGER_GROUP,TRIGGER_STATE);</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_FT_TRIG_INST_NAME <span class="hljs-keyword">ON</span> QRTZ_FIRED_TRIGGERS(SCHED_NAME,INSTANCE_NAME);</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_FT_INST_JOB_REQ_RCVRY <span class="hljs-keyword">ON</span> QRTZ_FIRED_TRIGGERS(SCHED_NAME,INSTANCE_NAME,REQUESTS_RECOVERY);</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_FT_J_G <span class="hljs-keyword">ON</span> QRTZ_FIRED_TRIGGERS(SCHED_NAME,JOB_NAME,JOB_GROUP);</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_FT_JG <span class="hljs-keyword">ON</span> QRTZ_FIRED_TRIGGERS(SCHED_NAME,JOB_GROUP);</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_FT_T_G <span class="hljs-keyword">ON</span> QRTZ_FIRED_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP);</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> IDX_QRTZ_FT_TG <span class="hljs-keyword">ON</span> QRTZ_FIRED_TRIGGERS(SCHED_NAME,TRIGGER_GROUP);</span><br><span class="line"><span class="hljs-keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<p>3.新建完Quartz系统表之后,你需要做SpringBoot和Quartz的相关配置<br>application.yml</p>
<figure class="highlight yaml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-attr">quartz:</span></span><br><span class="line"><span class="hljs-attr">  enabled:</span> <span class="hljs-literal">true</span></span><br><span class="line"><span class="hljs-attr">server:</span></span><br><span class="line"><span class="hljs-attr">  port:</span> <span class="hljs-number">9090</span></span><br><span class="line"><span class="hljs-attr">spring:</span></span><br><span class="line"><span class="hljs-attr">  datasource:</span></span><br><span class="line"><span class="hljs-attr">    url:</span> <span class="hljs-attr">jdbc:mysql://localhost:3306/spring_quartz</span></span><br><span class="line"><span class="hljs-attr">    username:</span> <span class="hljs-string">yourname</span></span><br><span class="line"><span class="hljs-attr">    password:</span> <span class="hljs-string">yourpassword</span></span><br><span class="line"><span class="hljs-attr">    tomcat:</span></span><br><span class="line"><span class="hljs-attr">      initialSize:</span> <span class="hljs-number">20</span></span><br><span class="line"><span class="hljs-attr">      maxActive:</span> <span class="hljs-number">100</span></span><br><span class="line"><span class="hljs-attr">      maxIdle:</span> <span class="hljs-number">100</span></span><br><span class="line"><span class="hljs-attr">      minIdle:</span> <span class="hljs-number">20</span></span><br><span class="line"><span class="hljs-attr">      maxWait:</span> <span class="hljs-number">10000</span></span><br><span class="line"><span class="hljs-attr">      testWhileIdle:</span> <span class="hljs-literal">true</span></span><br><span class="line"><span class="hljs-attr">      testOnBorrow:</span> <span class="hljs-literal">false</span></span><br><span class="line"><span class="hljs-attr">      testOnReturn:</span> <span class="hljs-literal">false</span></span><br></pre></td></tr></table></figure>


<p> 4.需要调度数据库中的Job实例定义。<br>JobEntity.class</p>
<figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line">package com.ealen.entity;</span><br><span class="line"><span class="hljs-keyword">import</span> javax.persistence.*;</span><br><span class="line"><span class="hljs-keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Created by EalenXie on 2018/6/4 14:09</span></span><br><span class="line"><span class="hljs-comment"> * 这里个人示例,可自定义相关属性</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-meta">@Entity</span></span><br><span class="line"><span class="hljs-meta">@Table</span>(name = <span class="hljs-string">"JOB_ENTITY"</span>)</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> JobEntity <span class="hljs-keyword">implements</span> Serializable &#123;</span><br><span class="line">    <span class="hljs-meta">@Id</span></span><br><span class="line">    <span class="hljs-meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="hljs-keyword">private</span> Integer id;</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> name;          <span class="hljs-comment">//job名称</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> group;         <span class="hljs-comment">//job组名</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> cron;          <span class="hljs-comment">//执行的cron</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> parameter;     <span class="hljs-comment">//job的参数</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> description;   <span class="hljs-comment">//job描述信息</span></span><br><span class="line">    <span class="hljs-meta">@Column</span>(name = <span class="hljs-string">"vm_param"</span>)</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> vmParam;       <span class="hljs-comment">//vm参数</span></span><br><span class="line">    <span class="hljs-meta">@Column</span>(name = <span class="hljs-string">"jar_path"</span>)</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> jarPath;       <span class="hljs-comment">//job的jar路径,在这里我选择的是定时执行一些可执行的jar包</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> status;        <span class="hljs-comment">//job的执行状态,这里我设置为OPEN/CLOSE且只有该值为OPEN才会执行该Job</span></span><br><span class="line">    <span class="hljs-keyword">public</span> JobEntity() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">public</span> Integer getId() &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> setId(Integer id) &#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> getName() &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> setName(<span class="hljs-built_in">String</span> name) &#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> getGroup() &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> group;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> setGroup(<span class="hljs-built_in">String</span> group) &#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.group = group;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> getCron() &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> cron;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> setCron(<span class="hljs-built_in">String</span> cron) &#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.cron = cron;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> getParameter() &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> parameter;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> setParameter(<span class="hljs-built_in">String</span> parameter) &#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.parameter = parameter;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> getDescription() &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> description;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> setDescription(<span class="hljs-built_in">String</span> description) &#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.description = description;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> getVmParam() &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> vmParam;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> setVmParam(<span class="hljs-built_in">String</span> vmParam) &#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.vmParam = vmParam;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> getJarPath() &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> jarPath;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> setJarPath(<span class="hljs-built_in">String</span> jarPath) &#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.jarPath = jarPath;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> getStatus() &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> setStatus(<span class="hljs-built_in">String</span> status) &#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> toString() &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-string">"JobEntity&#123;"</span> +</span><br><span class="line">                <span class="hljs-string">"id="</span> + id +</span><br><span class="line">                <span class="hljs-string">", name='"</span> + name + <span class="hljs-string">'\''</span> +</span><br><span class="line">                <span class="hljs-string">", group='"</span> + group + <span class="hljs-string">'\''</span> +</span><br><span class="line">                <span class="hljs-string">", cron='"</span> + cron + <span class="hljs-string">'\''</span> +</span><br><span class="line">                <span class="hljs-string">", parameter='"</span> + parameter + <span class="hljs-string">'\''</span> +</span><br><span class="line">                <span class="hljs-string">", description='"</span> + description + <span class="hljs-string">'\''</span> +</span><br><span class="line">                <span class="hljs-string">", vmParam='"</span> + vmParam + <span class="hljs-string">'\''</span> +</span><br><span class="line">                <span class="hljs-string">", jarPath='"</span> + jarPath + <span class="hljs-string">'\''</span> +</span><br><span class="line">                <span class="hljs-string">", status='"</span> + status + <span class="hljs-string">'\''</span> +</span><br><span class="line">                <span class="hljs-string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">//新增Builder模式,可选,选择设置任意属性初始化对象</span></span><br><span class="line">    <span class="hljs-keyword">public</span> JobEntity(Builder builder) &#123;</span><br><span class="line">        id = builder.id;</span><br><span class="line">        name = builder.name;</span><br><span class="line">        group = builder.group;</span><br><span class="line">        cron = builder.cron;</span><br><span class="line">        parameter = builder.parameter;</span><br><span class="line">        description = builder.description;</span><br><span class="line">        vmParam = builder.vmParam;</span><br><span class="line">        jarPath = builder.jarPath;</span><br><span class="line">        status = builder.status;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> Builder &#123;</span><br><span class="line">        <span class="hljs-keyword">private</span> Integer id;</span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> name = <span class="hljs-string">""</span>;          <span class="hljs-comment">//job名称</span></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> group = <span class="hljs-string">""</span>;         <span class="hljs-comment">//job组名</span></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> cron = <span class="hljs-string">""</span>;          <span class="hljs-comment">//执行的cron</span></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> parameter = <span class="hljs-string">""</span>;     <span class="hljs-comment">//job的参数</span></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> description = <span class="hljs-string">""</span>;   <span class="hljs-comment">//job描述信息</span></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> vmParam = <span class="hljs-string">""</span>;       <span class="hljs-comment">//vm参数</span></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> jarPath = <span class="hljs-string">""</span>;       <span class="hljs-comment">//job的jar路径</span></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-built_in">String</span> status = <span class="hljs-string">""</span>;        <span class="hljs-comment">//job的执行状态,只有该值为OPEN才会执行该Job</span></span><br><span class="line">        <span class="hljs-keyword">public</span> Builder withId(Integer i) &#123;</span><br><span class="line">            id = i;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">public</span> Builder withName(<span class="hljs-built_in">String</span> n) &#123;</span><br><span class="line">            name = n;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">public</span> Builder withGroup(<span class="hljs-built_in">String</span> g) &#123;</span><br><span class="line">            group = g;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">public</span> Builder withCron(<span class="hljs-built_in">String</span> c) &#123;</span><br><span class="line">            cron = c;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">public</span> Builder withParameter(<span class="hljs-built_in">String</span> p) &#123;</span><br><span class="line">            parameter = p;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">public</span> Builder withDescription(<span class="hljs-built_in">String</span> d) &#123;</span><br><span class="line">            description = d;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">public</span> Builder withVMParameter(<span class="hljs-built_in">String</span> vm) &#123;</span><br><span class="line">            vmParam = vm;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">public</span> Builder withJarPath(<span class="hljs-built_in">String</span> jar) &#123;</span><br><span class="line">            jarPath = jar;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">public</span> Builder withStatus(<span class="hljs-built_in">String</span> s) &#123;</span><br><span class="line">            status = s;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">public</span> JobEntity newJobEntity() &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> JobEntity(<span class="hljs-keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了方便测试,设计好表之后先插入几条记录,job_entity.sql,相关sql语句如下: </p>
<figure class="highlight sql hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">SET</span> FOREIGN_KEY_CHECKS=<span class="hljs-number">0</span>;</span><br><span class="line"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">`job_entity`</span>;</span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`job_entity`</span> (</span><br><span class="line">  <span class="hljs-string">`id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="hljs-string">`name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">  <span class="hljs-string">`group`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">  <span class="hljs-string">`cron`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">  <span class="hljs-string">`parameter`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">  <span class="hljs-string">`description`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">  <span class="hljs-string">`vm_param`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">  <span class="hljs-string">`jar_path`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">  <span class="hljs-string">`status`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>)</span><br><span class="line">) <span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span> AUTO_INCREMENT=<span class="hljs-number">7</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CHARSET</span>=utf8;</span><br><span class="line"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`job_entity`</span> <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'1'</span>,  <span class="hljs-string">'first'</span>, <span class="hljs-string">'helloworld'</span>, <span class="hljs-string">'0/2 * * * * ? '</span>, <span class="hljs-string">'1'</span>, <span class="hljs-string">'第一个'</span>, <span class="hljs-string">''</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'OPEN'</span>);</span><br><span class="line"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`job_entity`</span> <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'2'</span>,  <span class="hljs-string">'second'</span>, <span class="hljs-string">'helloworld'</span>, <span class="hljs-string">'0/5 * * * * ? '</span>, <span class="hljs-string">'2'</span>, <span class="hljs-string">'第二个'</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'OPEN'</span>);</span><br><span class="line"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`job_entity`</span> <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'3'</span>,  <span class="hljs-string">'third'</span>, <span class="hljs-string">'helloworld'</span>, <span class="hljs-string">'0/15 * * * * ? '</span>, <span class="hljs-string">'3'</span>, <span class="hljs-string">'第三个'</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'OPEN'</span>);</span><br><span class="line"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`job_entity`</span> <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'4'</span>,  <span class="hljs-string">'four'</span>, <span class="hljs-string">'helloworld'</span>, <span class="hljs-string">'0 0/1 * * * ? *'</span>, <span class="hljs-string">'4'</span>, <span class="hljs-string">'第四个'</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'CLOSE'</span>);</span><br><span class="line"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`job_entity`</span> <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'5'</span>,  <span class="hljs-string">'OLAY Job'</span>, <span class="hljs-string">'Nomal'</span>, <span class="hljs-string">'0 0/2 * * * ?'</span>, <span class="hljs-string">'5'</span>, <span class="hljs-string">'第五个'</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'C:\\EalenXie\\Download\\JDE-Order-1.0-SNAPSHOT.jar'</span>, <span class="hljs-string">'CLOSE'</span>);</span><br></pre></td></tr></table></figure>

<p>Quartz的核心配置类 : ConfigureQuartz.class</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> com.ealen.config;</span><br><span class="line"><span class="hljs-keyword">import</span> org.quartz.spi.JobFactory;</span><br><span class="line"><span class="hljs-keyword">import</span> org.quartz.spi.TriggerFiredBundle;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.beans.factory.config.AutowireCapableBeanFactory;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.beans.factory.config.PropertiesFactoryBean;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.context.ApplicationContextAware;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.core.io.ClassPathResource;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.scheduling.quartz.SchedulerFactoryBean;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.scheduling.quartz.SpringBeanJobFactory;</span><br><span class="line"><span class="hljs-keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="hljs-keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Created by EalenXie on 2018/6/4 11:02</span></span><br><span class="line"><span class="hljs-comment"> * Quartz的核心配置类</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-meta">@Configuration</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConfigureQuartz</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">//配置JobFactory</span></span><br><span class="line">    <span class="hljs-meta">@Bean</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> JobFactory <span class="hljs-title">jobFactory</span><span class="hljs-params">(ApplicationContext applicationContext)</span> </span>&#123;</span><br><span class="line">        AutowiringSpringBeanJobFactory jobFactory = <span class="hljs-keyword">new</span> AutowiringSpringBeanJobFactory();</span><br><span class="line">        jobFactory.setApplicationContext(applicationContext);</span><br><span class="line">        <span class="hljs-keyword">return</span> jobFactory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * SchedulerFactoryBean这个类的真正作用提供了对org.quartz.Scheduler的创建与配置，并且会管理它的生命周期与Spring同步。</span></span><br><span class="line"><span class="hljs-comment">     * org.quartz.Scheduler: 调度器。所有的调度都是由它控制。</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> dataSource 为SchedulerFactory配置数据源</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> jobFactory 为SchedulerFactory配置JobFactory</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-meta">@Bean</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> SchedulerFactoryBean <span class="hljs-title">schedulerFactoryBean</span><span class="hljs-params">(DataSource dataSource, JobFactory jobFactory)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        SchedulerFactoryBean factory = <span class="hljs-keyword">new</span> SchedulerFactoryBean();</span><br><span class="line">        <span class="hljs-comment">//可选,QuartzScheduler启动时更新己存在的Job,这样就不用每次修改targetObject后删除qrtz_job_details表对应记录</span></span><br><span class="line">        factory.setOverwriteExistingJobs(<span class="hljs-keyword">true</span>);</span><br><span class="line">        factory.setAutoStartup(<span class="hljs-keyword">true</span>); <span class="hljs-comment">//设置自行启动</span></span><br><span class="line">        factory.setDataSource(dataSource);</span><br><span class="line">        factory.setJobFactory(jobFactory);</span><br><span class="line">        factory.setQuartzProperties(quartzProperties());</span><br><span class="line">        <span class="hljs-keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">//从quartz.properties文件中读取Quartz配置属性</span></span><br><span class="line">    <span class="hljs-meta">@Bean</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> Properties <span class="hljs-title">quartzProperties</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        PropertiesFactoryBean propertiesFactoryBean = <span class="hljs-keyword">new</span> PropertiesFactoryBean();</span><br><span class="line">        propertiesFactoryBean.setLocation(<span class="hljs-keyword">new</span> ClassPathResource(<span class="hljs-string">"/quartz.properties"</span>));</span><br><span class="line">        propertiesFactoryBean.afterPropertiesSet();</span><br><span class="line">        <span class="hljs-keyword">return</span> propertiesFactoryBean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">//配置JobFactory,为quartz作业添加自动连接支持</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AutowiringSpringBeanJobFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SpringBeanJobFactory</span> <span class="hljs-keyword">implements</span></span></span><br><span class="line"><span class="hljs-class">            <span class="hljs-title">ApplicationContextAware</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> AutowireCapableBeanFactory beanFactory;</span><br><span class="line">        <span class="hljs-meta">@Override</span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setApplicationContext</span><span class="hljs-params">(<span class="hljs-keyword">final</span> ApplicationContext context)</span> </span>&#123;</span><br><span class="line">            beanFactory = context.getAutowireCapableBeanFactory();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-meta">@Override</span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">protected</span> Object <span class="hljs-title">createJobInstance</span><span class="hljs-params">(<span class="hljs-keyword">final</span> TriggerFiredBundle bundle)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">final</span> Object job = <span class="hljs-keyword">super</span>.createJobInstance(bundle);</span><br><span class="line">            beanFactory.autowireBean(job);</span><br><span class="line">            <span class="hljs-keyword">return</span> job;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>写一个dao访问数据库，JobEntityRepository.class</p>
<figure class="highlight haxe hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> com.ealen.dao;</span><br><span class="line"><span class="hljs-keyword">import</span> com.ealen.entity.JobEntity;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.data.repository.CrudRepository;</span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Created by EalenXie on 2018/6/4 14:27</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">JobEntityRepository</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span> <span class="hljs-type">CrudRepository</span></span>&lt;<span class="hljs-title">JobEntity</span>, <span class="hljs-title">Long</span>&gt; </span>&#123;</span><br><span class="line">    JobEntity getById(Integer id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5.定义调度中心执行逻辑的Job,这个Job的作用就是按照数据库中的Job的逻辑,规则去执行数据库中的Job。<br>这里使用了一个自定义的枚举工具类StringUtils , StringUtils.class : </p>
<figure class="highlight processing hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> com.ealen.util;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.List;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.Map;</span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Created by EalenXie on 2018/6/4 14:20</span></span><br><span class="line"><span class="hljs-comment"> * 自定义枚举单例对象 StringUtil</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> StringUtils &#123;</span><br><span class="line">    getStringUtil;</span><br><span class="line">    <span class="hljs-comment">//是否为空</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> isEmpty(<span class="hljs-keyword">String</span> <span class="hljs-built_in">str</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">str</span> == <span class="hljs-keyword">null</span>) || (<span class="hljs-built_in">str</span>.length() == <span class="hljs-number">0</span>) || (<span class="hljs-built_in">str</span>.equals(<span class="hljs-string">""</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">//去空格</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">String</span> <span class="hljs-built_in">trim</span>(<span class="hljs-keyword">String</span> <span class="hljs-built_in">str</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span> == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : <span class="hljs-built_in">str</span>.<span class="hljs-built_in">trim</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">//获取Map参数值</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">String</span> getMapString(Map&lt;<span class="hljs-keyword">String</span>, <span class="hljs-keyword">String</span>&gt; <span class="hljs-built_in">map</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">String</span> result = <span class="hljs-string">""</span>;</span><br><span class="line">        <span class="hljs-keyword">for</span> (Map.Entry entry : <span class="hljs-built_in">map</span>.entrySet()) &#123;</span><br><span class="line">            result += entry.getValue() + <span class="hljs-string">" "</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">//获取List参数值</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">String</span> getListString(List&lt;<span class="hljs-keyword">String</span>&gt; list) &#123;</span><br><span class="line">        <span class="hljs-keyword">String</span> result = <span class="hljs-string">""</span>;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">String</span> s : list) &#123;</span><br><span class="line">            result += s + <span class="hljs-string">" "</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调度中心执行逻辑的Job。DynamicJob.class :  </p>
<figure class="highlight processing hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> com.ealen.job;</span><br><span class="line"><span class="hljs-keyword">import</span> com.ealen.util.StringUtils;</span><br><span class="line"><span class="hljs-keyword">import</span> org.quartz.*;</span><br><span class="line"><span class="hljs-keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="hljs-keyword">import</span> java.io.*;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.List;</span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Created by EalenXie on 2018/6/4 14:29</span></span><br><span class="line"><span class="hljs-comment"> * :@DisallowConcurrentExecution : 此标记用在实现Job的类上面,意思是不允许并发执行.</span></span><br><span class="line"><span class="hljs-comment"> * :注意org.quartz.threadPool.threadCount线程池中线程的数量至少要多个,否则@DisallowConcurrentExecution不生效</span></span><br><span class="line"><span class="hljs-comment"> * :假如Job的设置时间间隔为3秒,但Job执行时间是5秒,设置@DisallowConcurrentExecution以后程序会等任务执行完毕以后再去执行,否则会在3秒时再启用新的线程执行</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line">@DisallowConcurrentExecution</span><br><span class="line">@Component</span><br><span class="line"><span class="hljs-keyword">public</span> class DynamicJob implements Job &#123;</span><br><span class="line">    <span class="hljs-keyword">private</span> Logger logger = LoggerFactory.getLogger(DynamicJob.class);</span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 核心方法,Quartz Job真正的执行逻辑.</span></span><br><span class="line"><span class="hljs-comment">     * @param executorContext executorContext JobExecutionContext中封装有Quartz运行所需要的所有信息</span></span><br><span class="line"><span class="hljs-comment">     * @throws JobExecutionException execute()方法只允许抛出JobExecutionException异常</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    @Override</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> execute(JobExecutionContext executorContext) <span class="hljs-keyword">throws</span> JobExecutionException &#123;</span><br><span class="line">        <span class="hljs-comment">//JobDetail中的JobDataMap是共用的,从getMergedJobDataMap获取的JobDataMap是全新的对象</span></span><br><span class="line">        JobDataMap <span class="hljs-built_in">map</span> = executorContext.getMergedJobDataMap();</span><br><span class="line">        <span class="hljs-keyword">String</span> jarPath = <span class="hljs-built_in">map</span>.getString(<span class="hljs-string">"jarPath"</span>);</span><br><span class="line">        <span class="hljs-keyword">String</span> parameter = <span class="hljs-built_in">map</span>.getString(<span class="hljs-string">"parameter"</span>);</span><br><span class="line">        <span class="hljs-keyword">String</span> vmParam = <span class="hljs-built_in">map</span>.getString(<span class="hljs-string">"vmParam"</span>);</span><br><span class="line">        logger.info(<span class="hljs-string">"Running Job name : &#123;&#125; "</span>, <span class="hljs-built_in">map</span>.getString(<span class="hljs-string">"name"</span>));</span><br><span class="line">        logger.info(<span class="hljs-string">"Running Job description : "</span> + <span class="hljs-built_in">map</span>.getString(<span class="hljs-string">"JobDescription"</span>));</span><br><span class="line">        logger.info(<span class="hljs-string">"Running Job group: &#123;&#125; "</span>, <span class="hljs-built_in">map</span>.getString(<span class="hljs-string">"group"</span>));</span><br><span class="line">        logger.info(<span class="hljs-string">"Running Job cron : "</span> + <span class="hljs-built_in">map</span>.getString(<span class="hljs-string">"cronExpression"</span>));</span><br><span class="line">        logger.info(<span class="hljs-string">"Running Job jar path : &#123;&#125; "</span>, jarPath);</span><br><span class="line">        logger.info(<span class="hljs-string">"Running Job parameter : &#123;&#125; "</span>, parameter);</span><br><span class="line">        logger.info(<span class="hljs-string">"Running Job vmParam : &#123;&#125; "</span>, vmParam);</span><br><span class="line">        <span class="hljs-keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">        <span class="hljs-keyword">if</span> (!StringUtils.getStringUtil.isEmpty(jarPath)) &#123;</span><br><span class="line">            File jar = <span class="hljs-keyword">new</span> File(jarPath);</span><br><span class="line">            <span class="hljs-keyword">if</span> (jar.exists()) &#123;</span><br><span class="line">                ProcessBuilder processBuilder = <span class="hljs-keyword">new</span> ProcessBuilder();</span><br><span class="line">                processBuilder.directory(jar.getParentFile());</span><br><span class="line">                List&lt;<span class="hljs-keyword">String</span>&gt; commands = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                commands.<span class="hljs-built_in">add</span>(<span class="hljs-string">"java"</span>);</span><br><span class="line">                <span class="hljs-keyword">if</span> (!StringUtils.getStringUtil.isEmpty(vmParam)) commands.<span class="hljs-built_in">add</span>(vmParam);</span><br><span class="line">                commands.<span class="hljs-built_in">add</span>(<span class="hljs-string">"-jar"</span>);</span><br><span class="line">                commands.<span class="hljs-built_in">add</span>(jarPath);</span><br><span class="line">                <span class="hljs-keyword">if</span> (!StringUtils.getStringUtil.isEmpty(parameter)) commands.<span class="hljs-built_in">add</span>(parameter);</span><br><span class="line">                processBuilder.command(commands);</span><br><span class="line">                logger.info(<span class="hljs-string">"Running Job details as follows &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;: "</span>);</span><br><span class="line">                logger.info(<span class="hljs-string">"Running Job commands : &#123;&#125;  "</span>, StringUtils.getStringUtil.getListString(commands));</span><br><span class="line">                <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                    Process process = processBuilder.start();</span><br><span class="line">                    logProcess(process.getInputStream(), process.getErrorStream());</span><br><span class="line">                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> JobExecutionException(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> JobExecutionException(<span class="hljs-string">"Job Jar not found &gt;&gt;  "</span> + jarPath);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">long</span> endTime = System.currentTimeMillis();</span><br><span class="line">        logger.info(<span class="hljs-string">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Running Job has been completed , cost time :  "</span> + (endTime - startTime) + <span class="hljs-string">"ms\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">//打印Job执行内容的日志</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> logProcess(InputStream inputStream, InputStream errorStream) <span class="hljs-keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="hljs-keyword">String</span> inputLine;</span><br><span class="line">        <span class="hljs-keyword">String</span> errorLine;</span><br><span class="line">        <span class="hljs-keyword">BufferedReader</span> inputReader = <span class="hljs-keyword">new</span> <span class="hljs-keyword">BufferedReader</span>(<span class="hljs-keyword">new</span> InputStreamReader(inputStream));</span><br><span class="line">        <span class="hljs-keyword">BufferedReader</span> errorReader = <span class="hljs-keyword">new</span> <span class="hljs-keyword">BufferedReader</span>(<span class="hljs-keyword">new</span> InputStreamReader(errorStream));</span><br><span class="line">        <span class="hljs-keyword">while</span> ((inputLine = inputReader.readLine()) != <span class="hljs-keyword">null</span>) logger.info(inputLine);</span><br><span class="line">        <span class="hljs-keyword">while</span> ((errorLine = errorReader.readLine()) != <span class="hljs-keyword">null</span>) logger.error(errorLine);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6.为了方便控制Job的运行，为调度中心添加相关的业务逻辑 :<br>DynamicJobService.class  :</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">package com.ealen.service;</span><br><span class="line"><span class="hljs-keyword">import</span> com.ealen.dao.JobEntityRepository;</span><br><span class="line"><span class="hljs-keyword">import</span> com.ealen.entity.JobEntity;</span><br><span class="line"><span class="hljs-keyword">import</span> com.ealen.job.DynamicJob;</span><br><span class="line"><span class="hljs-keyword">import</span> org.quartz.*;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.List;</span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Created by EalenXie on 2018/6/4 14:25</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line">@Service</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DynamicJobService</span> &#123;</span></span><br><span class="line">    @Autowired</span><br><span class="line">    <span class="hljs-keyword">private</span> JobEntityRepository repository;</span><br><span class="line">    <span class="hljs-comment">//通过Id获取Job</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> JobEntity <span class="hljs-title">getJobEntityById</span><span class="hljs-params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> repository.getById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">//从数据库中加载获取到所有Job</span></span><br><span class="line">    <span class="hljs-keyword">public</span> List&lt;JobEntity&gt; loadJobs() &#123;</span><br><span class="line">        List&lt;JobEntity&gt; <span class="hljs-built_in">list</span> = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        repository.findAll().forEach(<span class="hljs-built_in">list</span>::add);</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">//获取JobDataMap.(Job参数对象)</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> JobDataMap <span class="hljs-title">getJobDataMap</span><span class="hljs-params">(JobEntity job)</span> </span>&#123;</span><br><span class="line">        JobDataMap <span class="hljs-built_in">map</span> = <span class="hljs-keyword">new</span> JobDataMap();</span><br><span class="line">        <span class="hljs-built_in">map</span>.put(<span class="hljs-string">"name"</span>, job.getName());</span><br><span class="line">        <span class="hljs-built_in">map</span>.put(<span class="hljs-string">"group"</span>, job.getGroup());</span><br><span class="line">        <span class="hljs-built_in">map</span>.put(<span class="hljs-string">"cronExpression"</span>, job.getCron());</span><br><span class="line">        <span class="hljs-built_in">map</span>.put(<span class="hljs-string">"parameter"</span>, job.getParameter());</span><br><span class="line">        <span class="hljs-built_in">map</span>.put(<span class="hljs-string">"JobDescription"</span>, job.getDescription());</span><br><span class="line">        <span class="hljs-built_in">map</span>.put(<span class="hljs-string">"vmParam"</span>, job.getVmParam());</span><br><span class="line">        <span class="hljs-built_in">map</span>.put(<span class="hljs-string">"jarPath"</span>, job.getJarPath());</span><br><span class="line">        <span class="hljs-built_in">map</span>.put(<span class="hljs-string">"status"</span>, job.getStatus());</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-built_in">map</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">//获取JobDetail,JobDetail是任务的定义,而Job是任务的执行逻辑,JobDetail里会引用一个Job Class来定义</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> JobDetail <span class="hljs-title">geJobDetail</span><span class="hljs-params">(JobKey jobKey, String description, JobDataMap <span class="hljs-built_in">map</span>)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> JobBuilder.newJob(DynamicJob.class)</span><br><span class="line">                .withIdentity(jobKey)</span><br><span class="line">                .withDescription(description)</span><br><span class="line">                .setJobData(<span class="hljs-built_in">map</span>)</span><br><span class="line">                .storeDurably()</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">//获取Trigger (Job的触发器,执行规则)</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> Trigger <span class="hljs-title">getTrigger</span><span class="hljs-params">(JobEntity job)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> TriggerBuilder.newTrigger()</span><br><span class="line">                .withIdentity(job.getName(), job.getGroup())</span><br><span class="line">                .withSchedule(CronScheduleBuilder.cronSchedule(job.getCron()))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">//获取JobKey,包含Name和Group</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> JobKey <span class="hljs-title">getJobKey</span><span class="hljs-params">(JobEntity job)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> JobKey.jobKey(job.getName(), job.getGroup());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JobController.class :</p>
<figure class="highlight swift hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">package com.ealen.web;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> com.ealen.entity.JobEntity;</span><br><span class="line"><span class="hljs-keyword">import</span> com.ealen.service.DynamicJobService;</span><br><span class="line"><span class="hljs-keyword">import</span> org.quartz.*;</span><br><span class="line"><span class="hljs-keyword">import</span> org.quartz.impl.matchers.GroupMatcher;</span><br><span class="line"><span class="hljs-keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.scheduling.quartz.SchedulerFactoryBean;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Created by EalenXie on 2018/6/4 16:12</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line">@<span class="hljs-type">RestController</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JobController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> logger = <span class="hljs-type">LoggerFactory</span>.getLogger(<span class="hljs-type">JobController</span>.<span class="hljs-keyword">class</span>);</span><br><span class="line">    @<span class="hljs-type">Autowired</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-type">SchedulerFactoryBean</span> schedulerFactoryBean;</span><br><span class="line">    @<span class="hljs-type">Autowired</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-type">DynamicJobService</span> jobService;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//初始化启动所有的Job</span></span><br><span class="line">    @<span class="hljs-type">PostConstruct</span></span><br><span class="line">    <span class="hljs-keyword">public</span> void initialize() &#123;</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            reStartAllJobs();</span><br><span class="line">            logger.info(<span class="hljs-string">"INIT SUCCESS"</span>);</span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-type">SchedulerException</span> e) &#123;</span><br><span class="line">            logger.info(<span class="hljs-string">"INIT EXCEPTION : "</span> + e.getMessage());</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//根据ID重启某个Job</span></span><br><span class="line">    @<span class="hljs-type">RequestMapping</span>(<span class="hljs-string">"/refresh/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-type">String</span> refresh(@<span class="hljs-type">PathVariable</span> <span class="hljs-type">Integer</span> id) <span class="hljs-keyword">throws</span> <span class="hljs-type">SchedulerException</span> &#123;</span><br><span class="line">        <span class="hljs-type">String</span> result;</span><br><span class="line">        <span class="hljs-type">JobEntity</span> entity = jobService.getJobEntityById(id);</span><br><span class="line">        <span class="hljs-keyword">if</span> (entity == null) <span class="hljs-keyword">return</span> <span class="hljs-string">"error: id is not exist "</span>;</span><br><span class="line">        synchronized (logger) &#123;</span><br><span class="line">            <span class="hljs-type">JobKey</span> jobKey = jobService.getJobKey(entity);</span><br><span class="line">            <span class="hljs-type">Scheduler</span> scheduler = schedulerFactoryBean.getScheduler();</span><br><span class="line">            scheduler.pauseJob(jobKey);</span><br><span class="line">            scheduler.unscheduleJob(<span class="hljs-type">TriggerKey</span>.triggerKey(jobKey.getName(), jobKey.getGroup()));</span><br><span class="line">            scheduler.deleteJob(jobKey);</span><br><span class="line">            <span class="hljs-type">JobDataMap</span> <span class="hljs-built_in">map</span> = jobService.getJobDataMap(entity);</span><br><span class="line">            <span class="hljs-type">JobDetail</span> jobDetail = jobService.geJobDetail(jobKey, entity.getDescription(), <span class="hljs-built_in">map</span>);</span><br><span class="line">            <span class="hljs-keyword">if</span> (entity.getStatus().equals(<span class="hljs-string">"OPEN"</span>)) &#123;</span><br><span class="line">                scheduler.scheduleJob(jobDetail, jobService.getTrigger(entity));</span><br><span class="line">                result = <span class="hljs-string">"Refresh Job : "</span> + entity.getName() + <span class="hljs-string">"\t jarPath: "</span> + entity.getJarPath() + <span class="hljs-string">" success !"</span>;</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                result = <span class="hljs-string">"Refresh Job : "</span> + entity.getName() + <span class="hljs-string">"\t jarPath: "</span> + entity.getJarPath() + <span class="hljs-string">" failed ! , "</span> +</span><br><span class="line">                        <span class="hljs-string">"Because the Job status is "</span> + entity.getStatus();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//重启数据库中所有的Job</span></span><br><span class="line">    @<span class="hljs-type">RequestMapping</span>(<span class="hljs-string">"/refresh/all"</span>)</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-type">String</span> refreshAll() &#123;</span><br><span class="line">        <span class="hljs-type">String</span> result;</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            reStartAllJobs();</span><br><span class="line">            result = <span class="hljs-string">"SUCCESS"</span>;</span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-type">SchedulerException</span> e) &#123;</span><br><span class="line">            result = <span class="hljs-string">"EXCEPTION : "</span> + e.getMessage();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-string">"refresh all jobs : "</span> + result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 重新启动所有的job</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">private</span> void reStartAllJobs() <span class="hljs-keyword">throws</span> <span class="hljs-type">SchedulerException</span> &#123;</span><br><span class="line">        synchronized (logger) &#123;                                                         <span class="hljs-comment">//只允许一个线程进入操作</span></span><br><span class="line">            <span class="hljs-type">Scheduler</span> scheduler = schedulerFactoryBean.getScheduler();</span><br><span class="line">            <span class="hljs-type">Set</span>&lt;<span class="hljs-type">JobKey</span>&gt; <span class="hljs-keyword">set</span> = scheduler.getJobKeys(<span class="hljs-type">GroupMatcher</span>.anyGroup());</span><br><span class="line">            scheduler.pauseJobs(<span class="hljs-type">GroupMatcher</span>.anyGroup());                               <span class="hljs-comment">//暂停所有JOB</span></span><br><span class="line">            <span class="hljs-keyword">for</span> (<span class="hljs-type">JobKey</span> jobKey : <span class="hljs-keyword">set</span>) &#123;                                                 <span class="hljs-comment">//删除从数据库中注册的所有JOB</span></span><br><span class="line">                scheduler.unscheduleJob(<span class="hljs-type">TriggerKey</span>.triggerKey(jobKey.getName(), jobKey.getGroup()));</span><br><span class="line">                scheduler.deleteJob(jobKey);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">for</span> (<span class="hljs-type">JobEntity</span> job : jobService.loadJobs()) &#123;                               <span class="hljs-comment">//从数据库中注册的所有JOB</span></span><br><span class="line">                logger.info(<span class="hljs-string">"Job register name : &#123;&#125; , group : &#123;&#125; , cron : &#123;&#125;"</span>, job.getName(), job.getGroup(), job.getCron());</span><br><span class="line">                <span class="hljs-type">JobDataMap</span> <span class="hljs-built_in">map</span> = jobService.getJobDataMap(job);</span><br><span class="line">                <span class="hljs-type">JobKey</span> jobKey = jobService.getJobKey(job);</span><br><span class="line">                <span class="hljs-type">JobDetail</span> jobDetail = jobService.geJobDetail(jobKey, job.getDescription(), <span class="hljs-built_in">map</span>);</span><br><span class="line">                <span class="hljs-keyword">if</span> (job.getStatus().equals(<span class="hljs-string">"OPEN"</span>)) scheduler.scheduleJob(jobDetail, jobService.getTrigger(job));</span><br><span class="line">                <span class="hljs-keyword">else</span></span><br><span class="line">                    logger.info(<span class="hljs-string">"Job jump name : &#123;&#125; , Because &#123;&#125; status is &#123;&#125;"</span>, job.getName(), job.getName(), job.getStatus());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>7.现在已经完事具备,只欠东风了,写一个启动类,跑一下看看效果。</p>
<figure class="highlight d hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> com.ealen;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Created by EalenXie on 2018/6/4 11:00</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-keyword">@SpringBootApplication</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> QuartzApplication &#123;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(QuartzApplication.<span class="hljs-keyword">class</span>, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果如下 : </p>
<p>　看到这里，那么恭喜你，Quartz集群已经搭建成功了。如果部署该项目应用到多个服务器上面，Job会在多个服务器上面执行，但同一个Job只会在某个服务器上面执行，即如果服务器A在某个时间执行了某个Job,则其他服务器如B,C,D在此时间均不会执行此Job。即不会造成该Job被多次执行。</p>
<p>这里可以看到数据库中的Job已经在Quartz注册并初始化成功了。</p>
<p>这里可看到Scheduler已经在工作了，Job也已经按照cron在定时执行了。<br>执行一个包含jar的Job，看一下效果，图下已经看到JOB在正常运行了  :<br>看到Job执行完成了。</p>
<p>此时如果在数据库中手动修改某个Job的执行cron，并不会马上生效，则可以调用上面写到的业务方法，/refresh/all，则可刷新所有的Job，或/refresh/{id},刷新某个Job。</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-17T00:40:00.000Z">2019-07-17</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 分钟 read (About 911 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/17/SessionAttribute/">@SessionAttribute与@SessionAttributes</a>
            
        </h1>
        <div class="content">
            <p>@SessionAttribute与@SessionAttributes</p>
<p>@SessionAttributes<br>@SessionAttributes作用于处理器类上，用于在多个请求之间传递参数，类似于Session的Attribute，但不完全一样，一般来说@SessionAttributes设置的参数只用于暂时的传递，而不是长期的保存，长期保存的数据还是要放到Session中。<br>通过@SessionAttributes注解设置的参数有3类用法：<br>（1）在视图中通过request.getAttribute或session.getAttribute获取<br>（2）在后面请求返回的视图中通过session.getAttribute或者从model中获取<br>（3）自动将参数设置到后面请求所对应处理器的Model类型参数或者有  @ModelAttribute注释的参数里面。<br>将一个参数设置到SessionAttributes中需要满足两个条件：<br>（1）在@SessionAttributes注解中设置了参数的名字或者类型<br>（2）在处理器中将参数设置到了model中。<br>@SessionAttributes用户后可以调用SessionStatus.setComplete来清除，这个方法只是清除SessionAttribute里的参数，而不会应用Session中的参数。<br>示例如下：注解@SessionAttribute中设置book、description和  types={Double}，这样值会被放到@SessionAttributes中，但Redirect跳转时就可以重新获得这些数据了，接下来操作sessionStatus.setComplete()，则会清除掉所有的数据，这样再次跳转时就无法获取数据了。  </p>
<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Controller</span>  </span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">@RequestMapping(<span class="hljs-meta-string">"/book"</span>)</span>  </span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">@SessionAttributes(value =&#123;<span class="hljs-meta-string">"book"</span>,<span class="hljs-meta-string">"description"</span>&#125;,types=&#123;Double.class&#125;)</span>  </span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedirectController</span> </span>&#123;  </span><br><span class="line"></span><br><span class="line">	<span class="hljs-meta">@RequestMapping(<span class="hljs-meta-string">"/index"</span>)</span>  </span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">public</span> String index(Model model)&#123;  </span><br><span class="line"></span><br><span class="line">		model.addAttribute(<span class="hljs-string">"book"</span>, <span class="hljs-string">"金刚经"</span>);  </span><br><span class="line"></span><br><span class="line">		model.addAttribute(<span class="hljs-string">"description"</span>,<span class="hljs-string">"不擦擦擦擦擦擦擦车"</span>);  </span><br><span class="line"></span><br><span class="line">		model.addAttribute(<span class="hljs-string">"price"</span>, new <span class="hljs-built_in">Double</span>(<span class="hljs-string">"1000.00"</span>));  </span><br><span class="line"></span><br><span class="line">		<span class="hljs-comment">//跳转之前将数据保存到book、description和price中，因为注解@SessionAttribute中有这几个参数</span></span><br><span class="line"></span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:get.action"</span>;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">	<span class="hljs-meta">@RequestMapping(<span class="hljs-meta-string">"/get"</span>)</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">public</span> String <span class="hljs-keyword">get</span>(<span class="hljs-meta">@ModelAttribute</span> (<span class="hljs-string">"book"</span>) String book,ModelMap model,</span><br><span class="line"></span><br><span class="line">			SessionStatus sessionStatus)&#123;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">		<span class="hljs-comment">//可以获得book、description和price的参数</span></span><br><span class="line"></span><br><span class="line">		        System.<span class="hljs-keyword">out</span>.println(model.<span class="hljs-keyword">get</span>(<span class="hljs-string">"book"</span>)+<span class="hljs-string">";"</span>+model.<span class="hljs-keyword">get</span>(<span class="hljs-string">"description"</span>)+<span class="hljs-string">";"</span>+model.<span class="hljs-keyword">get</span>(<span class="hljs-string">"price"</span>));</span><br><span class="line"></span><br><span class="line">		sessionStatus.setComplete();</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:complete.action"</span>;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-meta">@RequestMapping(<span class="hljs-meta-string">"/complete"</span>)</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">public</span> String complete(ModelMap modelMap)&#123;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">		<span class="hljs-comment">//已经被清除，无法获取book的值</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">		System.<span class="hljs-keyword">out</span>.println(modelMap.<span class="hljs-keyword">get</span>(<span class="hljs-string">"book"</span>));</span><br><span class="line"></span><br><span class="line">		modelMap.addAttribute(<span class="hljs-string">"book"</span>, <span class="hljs-string">"妹纸"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-string">"sessionAttribute"</span>;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@SessionAttribute<br>① 使用@SessionAttribute来访问预先存在的全局会话属性<br>  如果你需要访问预先存在的、以全局方式管理的会话属性的话，比如在控制器之外（比如通过过滤器）可能或不可能存在在一个方法参数上使用注解<br>  <figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">  <span class="hljs-meta">@SessionAttribute</span>：  </span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">     * 在处理请求 /helloWorld/jump 的时候，会在会话中添加一个 sessionStr 属性。</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">     * &lt;p/&gt;</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">     * 这里可以通过<span class="hljs-doctag">@SessionAttribute</span> 获取到</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@RequestMapping(<span class="hljs-meta-string">"/sesAttr"</span>)</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">public</span> String handleSessionAttr(<span class="hljs-meta">@SessionAttribute(value = <span class="hljs-meta-string">"sessionStr"</span>)</span> String sessionStr, Model model)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"--&gt; sessionStr : "</span> + sessionStr);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="hljs-string">"sth"</span>, sessionStr);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-string">"/examples/targets/test1"</span>;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>为了使用这些需要添加或移除会话属性的情况，考虑注入org.springframework.web.context.request.WebRequest或javax.servlet.http.HttpSession到一个控制器方法中。<br>  对于暂存在会话中的用作控制器工作流一部分的模型属性，要像“使用 @SessionAttributes 存储模型属性到请求共享的HTTP会话”一节中描述的那样使用SessionAttributes。<br>@RequestAttribute<br>② 使用@RequestAttribute访问请求属性<br>就像@SessionAttribute一样，注解@RequestAttribute可以被用于访问由过滤器或拦截器创建的、预先存在的请求属性：</p>
<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@RequestMapping(<span class="hljs-meta-string">"/reqAttr"</span>)</span></span><br><span class="line"></span><br><span class="line">   <span class="hljs-keyword">public</span> String handle(<span class="hljs-meta">@RequestAttribute(<span class="hljs-meta-string">"reqStr"</span>)</span> String str, Model model)</span><br><span class="line"></span><br><span class="line">   &#123;</span><br><span class="line"></span><br><span class="line">       System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"--&gt; reqStr : "</span> + str);</span><br><span class="line"></span><br><span class="line">       model.addAttribute(<span class="hljs-string">"sth"</span>, str);</span><br><span class="line"></span><br><span class="line">       <span class="hljs-keyword">return</span> <span class="hljs-string">"/examples/targets/test1"</span>;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>可以使用下面的过滤器进行测试：</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@WebFilter</span>(filterName = <span class="hljs-string">"myFilter"</span>, description = <span class="hljs-string">"测试过滤器"</span>, urlPatterns = &#123; <span class="hljs-string">"/*"</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Filter</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException</span></span><br><span class="line"><span class="hljs-function"></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException</span></span><br><span class="line"><span class="hljs-function"></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="hljs-string">"--&gt; MyFilter Do."</span>);</span><br><span class="line"></span><br><span class="line">        request.setAttribute(<span class="hljs-string">"reqStr"</span>, <span class="hljs-string">"万万没想到，啦啦啦啦啦！"</span>);        </span><br><span class="line"></span><br><span class="line">        chain.doFilter(request, response);        </span><br><span class="line"></span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> </span>&#123;&#125;    </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-16T23:07:00.000Z">2019-07-16</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    1 分钟 read (About 146 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/17/annotation-ParameterizedTpye/">annotation ParameterizedTpye</a>
            
        </h1>
        <div class="content">
            <figure class="highlight typescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;<span class="hljs-built_in">String</span>,Mapper&gt; loadMapperAnnotation(<span class="hljs-built_in">String</span> daoClassPath)&#123;</span><br><span class="line">    <span class="hljs-comment">//得到dao接口的字节码对象</span></span><br><span class="line">    Class daoClass = Class.forName(daoClassPath);</span><br><span class="line">    <span class="hljs-comment">//得到dao接口中的方法数组</span></span><br><span class="line">    Method[] methods = daoClass.getMethods();</span><br><span class="line">    <span class="hljs-keyword">for</span>(Method method : methods)&#123;</span><br><span class="line">    <span class="hljs-comment">//取出注解的属性值  </span></span><br><span class="line">    Select xxxAnno = method.getAnnotation(xxx.class);  </span><br><span class="line">    <span class="hljs-built_in">String</span> queryString = xxxAnno.value();  </span><br><span class="line">    mapper.setQueryString(queryString);  </span><br><span class="line">    <span class="hljs-comment">//获取返回值的泛型类型  </span></span><br><span class="line">    Type <span class="hljs-keyword">type</span> = method.getGenericReturnType();  </span><br><span class="line">    <span class="hljs-comment">//判断type是不是参数化的类型  </span></span><br><span class="line">    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">type</span> <span class="hljs-keyword">instanceof</span> ParamerizedType)&#123;  </span><br><span class="line">       <span class="hljs-comment">//强转  </span></span><br><span class="line">       ParamerizedType ptype = (ParamerizedType)<span class="hljs-keyword">type</span>;  </span><br><span class="line">       <span class="hljs-comment">//参数化类型获取真实类型  </span></span><br><span class="line">       Type[] types = ptype.getActualTypeArguments();  </span><br><span class="line">       <span class="hljs-comment">//取出第一个  </span></span><br><span class="line">       Class domainClass = (Class)types[<span class="hljs-number">0</span>];  </span><br><span class="line">       <span class="hljs-built_in">String</span> resultType = domainClass.getName();  </span><br><span class="line">       mapper.setResultType(resultType);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="hljs-built_in">String</span> methodName = method.getName();  </span><br><span class="line">    <span class="hljs-built_in">String</span> ClassName = method.getDeclaringClass().getName();  </span><br><span class="line">    <span class="hljs-built_in">String</span> key = className + <span class="hljs-string">"."</span> + methodName;  </span><br><span class="line">    mappers.put(key,mapper);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-16T18:50:00.000Z">2019-07-16</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    13 分钟 read (About 1981 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/17/spring-task-scheduled/">spring task @scheduled</a>
            
        </h1>
        <div class="content">
            <p>Spring 4.x Task 和 Schedule 概述<br>摘要<br>在很多业务场景中，系统都需要用到任务调度系统。例如定期地清理Redis 缓存，周期性地检索某一条件并更新系统的资源等。在现代的应用系统中，快速地响应用户的请求，是用户体验最主要的因素之一。因此在Web 系统中异步地执行任务，也会在很多场景中经常涉及到。本文对任务调度和异步执行的Java 实现进行了总结，主要讲述一下内容：<br>Java 对异步执行和任务调度的支持<br>Spring 4.X 的异步执行和任务调度实现<br>Java 对异步执行和任务调度的支持<br>异步执行和任务调度底层的语言支撑都是Java 的多线程技术。线程是系统进行独立运行和调度的基本单位。拥有了多线程，系统就拥有了同时处理多项任务的能力。<br>Java 实现异步调用<br>在Java 中要实现多线程有实现Runnable 接口和扩展Thread 类两种方式。只要将需要异步执行的任务放在run() 方法中，在主线程中启动要执行任务的子线程就可以实现任务的异步执行。如果需要实现基于时间点触发的任务调度，就需要在子线程中循环的检查系统当前的时间跟触发条件是否一致，然后触发任务的执行。该内容属于Java 多线程的基础知识，此处略过不讲。<br>Java Timer 和 TimeTask 实现任务调度<br>为了便于开发者快速地实现任务调度，Java JDK 对任务调度的功能进行了封装，实现了Timer 和TimerTask 两个工具类。<br>TimerTask 类<br>由上图，我们可以看出TimeTask 抽象类在实现Runnable 接口的基础上增加了任务cancel() 和任务scheduledExecuttionTime() 两个方法。<br>Timer 类<br>上图为调度类Timer 的实现。从Timer类的源码，可以看到其采用TaskQueue 来实现对多个TimeTask 的管理。TimerThread 集成自Thread 类，其mainLoop() 用来对任务进行调度。而Timer 类提供了四种重载的schedule() 方法和重载了两种sheduleAtFixedRate() 方法来实现几种基本的任务调度类型。下面的代码是采用Timer 实现的定时系统时间打印程序。</p>
<figure class="highlight scala hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PrintTimeTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">TimerTask</span> </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">        public void run() &#123;</span><br><span class="line">            <span class="hljs-type">System</span>.out.println(<span class="hljs-keyword">new</span> <span class="hljs-type">Date</span>().toString());</span><br><span class="line">        &#125;</span><br><span class="line">                    </span><br><span class="line">    public static void main(<span class="hljs-type">String</span>[] args) &#123;</span><br><span class="line">        <span class="hljs-type">Timer</span> timer = <span class="hljs-keyword">new</span> <span class="hljs-type">Timer</span>(<span class="hljs-string">"hello"</span>);</span><br><span class="line">        timer.schedule(<span class="hljs-keyword">new</span> <span class="hljs-type">PrintTimeTask</span>(), <span class="hljs-number">1000</span>L, <span class="hljs-number">2000</span>L);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring 4.x 中的异步执行和任务调度<br>Spring 4.x 中的异步执行<br>Spring 作为一站式框架，为开发者提供了异步执行和任务调度的抽象接口TaskExecutor 和TaskScheduler。Spring 对这些接口的实现类支持线程池(Thread Pool) 和代理。<br>Spring 提供了对JDK 中Timer和开源的流行任务调度框架Quartz的支持。Spring 通过将关联的Schedule 转化为FactoryBean 来实现。通过Spring 调度框架，开发者可以快速地通过MethodInvokingFactoryBean 来实现将POJO 类的方法转化为任务。<br>Spring TaskExecutor<br>TaskExecutor 接口扩展自java.util.concurrent.Executor 接口。TaskExecutor 被创建来为其他组件提供线程池调用的抽象。<br>ThreadPoolTaskExecutor 是TaskExecutor 的最主要实现类之一。该类的核心继承关系如下图所示。<br>ThreadPooltaskexecutor 类<br>ThreadPoolTaskExecutor 接口扩展了重多的接口，让其具备了更多的能力。要实现异步需要标注@Async 注解：<br>AsyncTaskExecutor 增加了返回结果为Future 的submit() 方法，该方法的参数为Callable 接口。相比Runnable 接口，多了将执行结果返回的功能。<br>AsyncListenableTaskExecutor 接口允许返回拥有回调功能的ListenableFuture 接口，这样在结果执行完毕是，能够直接回调处理。  </p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ListenableTask</span> </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@Async</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> ListenableFuture&lt;Integer&gt; <span class="hljs-title">compute</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> sum = <span class="hljs-number">0</span>;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            sum += i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AsyncResult&lt;&gt;(sum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CallBackImpl</span> <span class="hljs-keyword">implements</span> </span></span><br><span class="line"><span class="hljs-class">        <span class="hljs-title">ListenableFutureCallback</span>&lt;<span class="hljs-title">Integer</span>&gt; </span>&#123;</span><br><span class="line">        <span class="hljs-meta">@Override</span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onFailure</span><span class="hljs-params">(Throwable ex)</span> </span>&#123;</span><br><span class="line">            System.out.println(ex.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-meta">@Override</span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(Integer result)</span> </span>&#123;</span><br><span class="line">            System.out.println(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ListenableTask listenableTask = <span class="hljs-keyword">new</span> ListenableTask();</span><br><span class="line">        ListenableFuture&lt;Integer&gt; listenableFuture = </span><br><span class="line">            listenableTask.compute(<span class="hljs-number">10</span>);</span><br><span class="line">        listenableFuture.addCallback(<span class="hljs-keyword">new</span> CallBackImpl());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ThreadFactory 定义了创建线程的工厂方法，可以扩展该方法实现对Thread 的改造。<br>基于Java Config<br>基于注解 当采用基于Java Config 注解配置时，只需要在主配置添加@EnableAsync 注解，Spring 会自动的创建基于ThreadPoolTaskExecutor 实例注入到上下文中。</p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@Configuration</span></span><br><span class="line"><span class="hljs-variable">@EnableAsync</span></span><br><span class="line">public class AppConfig &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>基于AsyncConfigurer接口自定义 开发者可以自定义Executor 的类型，并且注册异常处理器。</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Configuration</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AsyncConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> Executor <span class="hljs-title">getAsyncExecutor</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        ThreadPoolTaskExecutor executor = <span class="hljs-keyword">new</span> ThreadPoolTaskExecutor();</span><br><span class="line">        executor.setMaxPoolSize(<span class="hljs-number">100</span>);</span><br><span class="line">        executor.setCorePoolSize(<span class="hljs-number">10</span>);</span><br><span class="line">        <span class="hljs-keyword">return</span> executor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> AsyncUncaughtExceptionHandler <span class="hljs-title">getAsyncUncaughtExceptionHandler</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AsyncUncaughtExceptionHandler() &#123;</span><br><span class="line">            <span class="hljs-meta">@Override</span></span><br><span class="line">            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleUncaughtException</span><span class="hljs-params">(Throwable ex, </span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                                                Method method, Object... params)</span> </span>&#123;</span><br><span class="line">                System.out.println(ex.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>基于XML Config<br>基于传统XML的配置 基于XML 的形式，采用传统的Java Bean的形式配置ThreadPoolTaskExecutor。然后采用自动注入(autowire, resource,name)的可以直接在Spring Component 中注入Executor。以编程的形式实现异步任务。</p>
<figure class="highlight applescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean <span class="hljs-built_in">id</span>=<span class="hljs-string">"taskExecutor"</span> <span class="hljs-built_in">class</span>=<span class="hljs-string">"org.springframework.scheduling.concurrent.</span></span><br><span class="line"><span class="hljs-string">    ThreadPoolTaskExecutor"</span>&gt;</span><br><span class="line">    &lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">"corePoolSize"</span> value=<span class="hljs-string">"5"</span> /&gt;</span><br><span class="line">    &lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">"maxPoolSize"</span> value=<span class="hljs-string">"10"</span> /&gt;</span><br><span class="line">    &lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">"queueCapacity"</span> value=<span class="hljs-string">"25"</span> /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>基于task 命名空间的配置 Spring 为任务的执行提供了便利的task 命名空间。当采用基于XML 配置时Spring 会自动地为开发者创建Executor。同时可以在annotation-driven 标签上注册实现了AsyncUncaughtExceptionHandler 接口的异常处理器。</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--<span class="hljs-built_in"> config </span>exception handler  --&gt;</span><br><span class="line">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">"taskAsyncExceptionHandler"</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">"org.zzy.spring4.application.schedulie.TaskAsyncExceptionHandler"</span>/&gt;</span><br><span class="line">&lt;task:annotation-driven <span class="hljs-attribute">exception-handler</span>=<span class="hljs-string">"taskAsyncExceptionHandler"</span> <span class="hljs-attribute">scheduler</span>=<span class="hljs-string">"scheduler"</span> <span class="hljs-attribute">executor</span>=<span class="hljs-string">"executor"</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>异步执行的异常处理<br>除了上文提到的两种异常处理方式，Spring 还提供了基于SimpleApplicationEventMulticaster 类的异常处理方式。</p>
<figure class="highlight aspectj hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Bean</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-function">SimpleApplicationEventMulticaster <span class="hljs-title">eventMulticaster</span><span class="hljs-params">(TaskExecutor taskExecutor)</span> </span>&#123;</span><br><span class="line">    SimpleApplicationEventMulticaster eventMulticaster = <span class="hljs-keyword">new</span> SimpleApplicationEventMulticaster();</span><br><span class="line">    eventMulticaster.setTaskExecutor(taskExecutor);</span><br><span class="line">    eventMulticaster.setErrorHandler(<span class="hljs-keyword">new</span> ErrorHandler() &#123;</span><br><span class="line">        <span class="hljs-meta">@Override</span></span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">handleError</span><span class="hljs-params">(Throwable t)</span> </span>&#123;</span><br><span class="line">            System.out.println(t.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="hljs-keyword">return</span> eventMulticaster;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring 4.x 中任务调度实现<br>Spring 的任务调度主要基于TaskScheduler 接口。ThreadPoolTaskScheduler 是Spring 任务调度的核心实现类。该类提供了大量的重载方法进行任务调度。Trigger 定义了任务被执行的触发条件。Spring 提供了基于Corn 表达式的CornTrigger实现。TaskScheduler 如下图所示。</p>
<p>ThreadPoolTaskExecutor 类<br>实现TaskScheduler 接口的ThreadPoolTaskExecutor 继承关系。</p>
<p>ThreadPoolTaskExecutor 类<br>基于Java Config<br>基于注解的配置 当采用基于Java Config 注解配置时，只需要在主配置添加@EnableScheduling 注解，Spring 会自动的创建基于ThreadPoolTaskExecutor 实例注入到上下文中。</p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@Configuration</span></span><br><span class="line"><span class="hljs-variable">@EnableScheduling</span></span><br><span class="line">public class AppConfig &#123;</span><br><span class="line">&#125;</span><br><span class="line">基于SchedulingConfigurer接口自定义</span><br><span class="line"><span class="hljs-variable">@Configuration</span></span><br><span class="line">public class ScheduleConfig implements SchedulingConfigurer &#123;</span><br><span class="line">    <span class="hljs-variable">@Override</span></span><br><span class="line">    public void configureTasks(ScheduledTaskRegistrar taskRegistrar) &#123;</span><br><span class="line">        <span class="hljs-selector-tag">taskRegistrar</span><span class="hljs-selector-class">.setTaskScheduler</span>(new ThreadPoolTaskScheduler());</span><br><span class="line">        <span class="hljs-selector-tag">taskRegistrar</span><span class="hljs-selector-class">.getScheduler</span>()<span class="hljs-selector-class">.schedule</span>(new Runnable() &#123;</span><br><span class="line">            <span class="hljs-variable">@Override</span></span><br><span class="line">            public void run() &#123;</span><br><span class="line">                <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(<span class="hljs-string">"hello"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">CronTrigger</span>(<span class="hljs-string">"0 15 9-17 * * MON-FRI"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>基于XML Config<br>&lt;task:annotation-driven scheduler=”myScheduler”/&gt;<br>&lt;task:scheduler id=”myScheduler” pool-size=”10”/&gt;<br>@Scheduled 注解的使用<br>当某个Bean 由Spring 管理生命周期时，就可以方便的使用@Shcheduled 注解将该Bean 的方法准换为基于任务调度的策略。</p>
<figure class="highlight smali hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Scheduled(initialDelay=1000, fixedRate=5000)</span><br><span class="line">public void doSomething() &#123;</span><br><span class="line">    // something that should<span class="hljs-built_in"> execute </span>periodically</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Scheduled(cron=<span class="hljs-string">"*/5 * * * * MON-FRI"</span>)</span><br><span class="line">public void doSomething() &#123;</span><br><span class="line">    // something that should<span class="hljs-built_in"> execute </span>on weekdays only</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>task 命名空间中的task:scheduled-tasks<br>该元素能够实现快速地将一个普通Bean 的方法转换为Scheduled 任务的途径。具体如下：</p>
<figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="hljs-keyword">task</span>:scheduled-tasks scheduler=<span class="hljs-string">"myScheduler"</span>&gt;</span><br><span class="line">    &lt;<span class="hljs-keyword">task</span>:scheduled <span class="hljs-keyword">ref</span>=<span class="hljs-string">"beanA"</span> method=<span class="hljs-string">"methodA"</span> fixed-delay=<span class="hljs-string">"5000"</span> <span class="hljs-keyword">initial</span>-delay=<span class="hljs-string">"1000"</span>/&gt;</span><br><span class="line">    &lt;<span class="hljs-keyword">task</span>:scheduled <span class="hljs-keyword">ref</span>=<span class="hljs-string">"beanB"</span> method=<span class="hljs-string">"methodB"</span> fixed-rate=<span class="hljs-string">"5000"</span>/&gt;</span><br><span class="line">    &lt;<span class="hljs-keyword">task</span>:scheduled <span class="hljs-keyword">ref</span>=<span class="hljs-string">"beanC"</span> method=<span class="hljs-string">"methodC"</span> cron=<span class="hljs-string">"*/5 * * * * MON-FRI"</span>/&gt;</span><br><span class="line">&lt;/<span class="hljs-keyword">task</span>:scheduled-tasks&gt;</span><br><span class="line">&lt;<span class="hljs-keyword">task</span>:scheduler id=<span class="hljs-string">"myScheduler"</span> pool-size=<span class="hljs-string">"10"</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>总结<br>本文着重介绍了JDK 为任务调度提供的基础类Timer。并在此基础上详细介绍了Spring 4.x 的异步执行和任务调度的底层接口设计。并针对常用的模式进行了讲解，并附带了源代码。第三方开源的Quartz 实现了更为强大的任务调度系统，Spring 也对集成Quartz 提供了转换。之后会择机再详细的介绍Quartz 的应用和设计原理。同时，Servlet 3.x 为Web 的异步调用提供了AsyncContext，对基于Web 的异步调用提供了原生的支持，后续的文章也会对此有相应的介绍。</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-16T18:39:00.000Z">2019-07-16</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    4 分钟 read (About 663 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/17/spring-task/">spring task</a>
            
        </h1>
        <div class="content">
            <p>基于Spring Task的定时任务调度器实现<br>在很多时候，我们会需要执行一些定时任务 ，Spring团队提供了Spring Task模块对定时任务的调度提供了支持，基于注解式的任务使用也非常方便。<br>只要跟需要定时执行的方法加上类似 @Scheduled(cron = “0 1 * *  *  *”) 的注解就可以实现方法的定时执行。<br>cron 是一种周期的表达式，六位从右至左分别对应的是年、月、日、时、分、秒，数字配合各种通配符可以表达种类丰富的定时执行周期。  </p>
<figure class="highlight dart hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"><span class="hljs-markdown">/**</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">* </span>Cron Example patterns:</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">* </span><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span></span>"0 0 <span class="hljs-bullet">* *</span> <span class="hljs-bullet">* *</span>" = </span>the<span class="hljs-markdown"> top of every hour of every day.<span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span></span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">* </span><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span></span>"0 0 8-10 <span class="hljs-bullet">* *</span> *" = 8, 9 and 10 o'clock of every day.<span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span></span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">* </span><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span></span>"0 0/30 8-10 <span class="hljs-bullet">* *</span> *" = 8:00, 8:30, 9:00, 9:30 and 10 o'clock every day.<span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span></span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">* </span><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span></span>"0 0 9-17 <span class="hljs-bullet">* *</span> MON-FRI" = on </span>the<span class="hljs-markdown"> hour nine-to-five weekdays<span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span></span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">* </span><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span></span>"0 0 0 25 12 ?" = every Christmas Day at midnight<span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span></span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown">*/</span></span></span><br><span class="line">基于注解的使用案列：</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.stereotype.Component; </span><br><span class="line">   </span><br><span class="line"><span class="hljs-meta">@Component</span>(“task”) </span><br><span class="line">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Task</span> </span>&#123; </span><br><span class="line">    <span class="hljs-meta">@Scheduled</span>(cron = <span class="hljs-string">"0 1 * * * *"</span>)  <span class="hljs-comment">// 每分钟执行一次</span></span><br><span class="line">    public <span class="hljs-keyword">void</span> job1() &#123; </span><br><span class="line">        System.out.println(“任务进行中。。。”); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>基于注解方式的定时任务，启动会依赖于系统的启动。如果需要通过代码或前台操作触发定时任务，就需要进行包装了。<br>下面是一个可以直接提供业务代码调用的定时任务调度器。调用 schedule(Runnable task, String cron) 传入要执行的任务<br>task和定时周期cron就可以了。注：基于注解方式需要在注解扫描范围内。</p>
<figure class="highlight dart hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">package com.louis.merak.schedule;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.beans.<span class="hljs-keyword">factory</span>.annotation.Autowired;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.scheduling.support.CronTrigger;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-meta">@Component</span></span><br><span class="line">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MerakTaskScheduler</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="hljs-meta">@Autowired</span></span><br><span class="line">    private ThreadPoolTaskScheduler threadPoolTaskScheduler;</span><br><span class="line">     </span><br><span class="line">    <span class="hljs-meta">@Bean</span></span><br><span class="line">    public ThreadPoolTaskScheduler threadPoolTaskScheduler()&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ThreadPoolTaskScheduler();</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="hljs-comment"><span class="hljs-markdown">/**</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">     * </span>Cron Example patterns:</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">     * </span><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span></span>"0 0 <span class="hljs-bullet">* *</span> <span class="hljs-bullet">* *</span>" = </span>the<span class="hljs-markdown"> top of every hour of every day.<span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span></span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">     * </span><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span></span>"0 0 8-10 <span class="hljs-bullet">* *</span> *" = 8, 9 and 10 o'clock of every day.<span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span></span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">     * </span><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span></span>"0 0/30 8-10 <span class="hljs-bullet">* *</span> *" = 8:00, 8:30, 9:00, 9:30 and 10 o'clock every day.<span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span></span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">     * </span><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span></span>"0 0 9-17 <span class="hljs-bullet">* *</span> MON-FRI" = on </span>the<span class="hljs-markdown"> hour nine-to-five weekdays<span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span></span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">     * </span><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span></span>"0 0 0 25 12 ?" = every Christmas Day at midnight<span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span></span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-code">     */</span></span></span></span><br><span class="line">    public <span class="hljs-keyword">void</span> schedule(Runnable task, <span class="hljs-built_in">String</span> cron)&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span>(cron == <span class="hljs-keyword">null</span> || <span class="hljs-string">""</span>.equals(cron)) &#123;</span><br><span class="line">            cron = <span class="hljs-string">"0 * * * * *"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        threadPoolTaskScheduler.schedule(task, <span class="hljs-keyword">new</span> CronTrigger(cron));</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="hljs-comment"><span class="hljs-markdown">/**</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">     * </span>shutdown and init</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">     * </span>@param task</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">     * </span>@param cron</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-code">     */</span></span></span></span><br><span class="line">    public <span class="hljs-keyword">void</span> reset()&#123;</span><br><span class="line">        threadPoolTaskScheduler.shutdown();</span><br><span class="line">        threadPoolTaskScheduler.initialize();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment"><span class="hljs-markdown">/**</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">     * </span>shutdown before </span>a<span class="hljs-markdown"> new schedule operation</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">     * </span>@param task</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">     * </span>@param cron</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-code">     */</span></span></span></span><br><span class="line">    public <span class="hljs-keyword">void</span> resetSchedule(Runnable task, <span class="hljs-built_in">String</span> cron)&#123;</span><br><span class="line">        shutdown();</span><br><span class="line">        threadPoolTaskScheduler.initialize();</span><br><span class="line">        schedule(task, cron);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment"><span class="hljs-markdown">/**</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet">     * </span>shutdown</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-code">     */</span></span></span></span><br><span class="line">    public <span class="hljs-keyword">void</span> shutdown()&#123;</span><br><span class="line">        threadPoolTaskScheduler.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>如果是需要通过前台操作调用RESTful执行定时任务的调度，使用以下Controller即可。</p>
<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> com.louis.merak.common.schedule;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Autowired;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RequestMapping;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RequestParam;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">@RestController</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MerakTaskSchedulerController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-meta">@Autowired</span></span><br><span class="line">    MerakTaskScheduler taskScheduler;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-meta">@RequestMapping(<span class="hljs-meta-string">"/schedule"</span>)</span></span><br><span class="line">    <span class="hljs-keyword">public</span> String schedule(<span class="hljs-meta">@RequestParam</span> String cron) &#123;</span><br><span class="line">　　　　 <span class="hljs-keyword">if</span>(cron == <span class="hljs-literal">null</span>) &#123;</span><br><span class="line">　　　　　　 cron = <span class="hljs-string">"0/5 * * * * *"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Runnable runnable = new Runnable() &#123;</span><br><span class="line">            <span class="hljs-keyword">public</span> void run() &#123;</span><br><span class="line">                String time = new SimpleDateFormat(<span class="hljs-string">"yy-MM-dd HH:mm:ss"</span>).format(new Date());</span><br><span class="line">                System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Test GETaskScheduler Success at "</span>  + time);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        taskScheduler.schedule(runnable, cron);</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-string">"Test TaskScheduler Interface."</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-16T18:22:00.000Z">2019-07-16</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    1 分钟 read (About 148 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/17/push-existing-folder-to-git/">push existing folder to git</a>
            
        </h1>
        <div class="content">
            <p>Command line instructions    </p>
<p>You can also upload existing files from your computer using the instructions below.</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Git global setup  </span><br><span class="line">git<span class="hljs-built_in"> config </span>--global user.name <span class="hljs-string">"Tong"</span>  </span><br><span class="line">git<span class="hljs-built_in"> config </span>--global user.email <span class="hljs-string">"joetonghao@126.com"</span></span><br></pre></td></tr></table></figure>

<p>Create a new repository  </p>
<figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git clone http:<span class="hljs-comment">//tong.lab.com/Joe/springboot-login.git  </span></span><br><span class="line">cd springboot-login  </span><br><span class="line">touch README<span class="hljs-selector-class">.md</span>  </span><br><span class="line">git add README<span class="hljs-selector-class">.md</span>  </span><br><span class="line">git commit -m <span class="hljs-string">"add README"</span>  </span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>

<p>Push an existing folder </p>
<figure class="highlight dockerfile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd existing_folder  </span><br><span class="line">git init  </span><br><span class="line">git remote <span class="hljs-keyword">add</span><span class="hljs-bash"> origin http://tong.lab.com/Joe/springboot-login.git  </span></span><br><span class="line">git <span class="hljs-keyword">add</span><span class="hljs-bash"> .</span></span><br><span class="line">git commit -m <span class="hljs-string">"Initial commit"</span>  </span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>

<p>Push an existing Git repository  </p>
<figure class="highlight maxima hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd existing_repo  </span><br><span class="line">git remote <span class="hljs-built_in">rename</span> <span class="hljs-built_in">origin</span> old-<span class="hljs-built_in">origin</span>  </span><br><span class="line">git remote add <span class="hljs-built_in">origin</span> http://tong.lab.com/Joe/springboot-login.git  </span><br><span class="line">git <span class="hljs-built_in">push</span> -u <span class="hljs-built_in">origin</span> --all  </span><br><span class="line">git <span class="hljs-built_in">push</span> -u <span class="hljs-built_in">origin</span> --tags</span><br></pre></td></tr></table></figure>

<p>git - 查看远程仓库信息</p>
<p><code>git remote show origin</code></p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-16T17:54:00.000Z">2019-07-16</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    13 分钟 read (About 1995 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/17/docker-gitlab/">docker gitlab</a>
            
        </h1>
        <div class="content">
            <p>使用docker搭建gitlab初体验+数据备份</p>
<p>一. 背景<br>作为程序员，像GitHub这种好工具是必须得十分了解的，但是有时GitHub并不能满足我们所有的需求，就如作者所在的公司，我们的代码都是商业性的产品，不可能放到GitHub的开放仓库中的，而申请GitHub私人仓库需要钱。这就陷入了尴尬的局面，那有没有一种既能具有GitHub一样的功能，又能保护隐私免费的管理工具呢？答案是肯定的，感谢程序员伟大的开源精神，我们有了GitLab!!!今天笔者在这里就跟大家分享一下自己使用docker搭建GitLab的过程吧，这其中踩了一些坑，希望看过这篇文章的人不用在踩我踩过的坑了！<br>二. 环境介绍<br>服务器信息：<br>CPU : 2<br>DISK : 30G<br>RAM : 4G<br>OS : Linux centos7-0 3.10.0-229.el7.x86_64<br>这里笔者使用的是自己公司的服务器，也可以使用虚拟机进行搭建<br>三. 搭建过程  </p>
<ol>
<li>安装docker<br>因为我们是使用docker搭建的，所以需要先安装docker，docker支持不同的OS，具体的安装信息这里不做详细介绍，可以自己的操作系统，参考官方的安装指南进行安装。  <a href="http://www.docker.io" target="_blank" rel="noopener">http://www.docker.io</a>  </li>
<li>安装GitLab及相关组件<br>GitLab需要用到数据库来存储相关数据，所以需要在安装GitLab的同时安装数据库，这里使用的是postgresql和redis。我在查找相关的镜像，之后发现有很多现成的镜像，这里我使用的sameersbn镜像。但是有一点我认为不是很好的是：这个镜像没有把redis、postgresql集成到gitlab的容器里面，需要先单独pull这两个镜像run一下，然后再pull gitlab的镜像进行安装。<br>使用如下命令分别拉取最新的镜像：<br>docker pull sameersbn/redis<br>docker pull sameersbn/postgresql<br>docker pull sameersbn/gitlab<br>这里有第一个坑：因为我们默认都是从docker的官方仓库中拉去镜像，但是由于国内访问国外的网站有墙，而且速度也是十分的慢，所以需要代理。这里推荐Daocloud加速器 <a href="https://www.daocloud.io/" target="_blank" rel="noopener">https://www.daocloud.io/</a> 免费使用，但是需要先注册，登录成功后，找到加速器执行相关命令即可。笔者亲测速度明显快很多！<br>使用如下命令运行postgresql镜像：  <figure class="highlight crystal hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run --name postgresql -d \  </span><br><span class="line">-e <span class="hljs-string">'DB_NAME=gitlabhq_production'</span> \  </span><br><span class="line">-e <span class="hljs-string">'DB_USER=gitlab'</span> \</span><br><span class="line">-e <span class="hljs-string">'DB_PASS=password'</span> \  </span><br><span class="line">-e <span class="hljs-string">'DB_EXTENSION=pg_trgm'</span> \  </span><br><span class="line">-v /home/root/opt/postgresql/<span class="hljs-symbol">data:</span>/var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">postgresql</span> \  </span></span><br><span class="line">sameersbn/postgresql</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>这里需要解释的是：<br>(1). 以上是一条命令，反斜杠是为了在命令内换行方便阅读，如果不喜欢，也可以写在一行。<br>(2). -e后面跟的都是容器的环境参数，都是在制作镜像的时候指定好的，所以不要去改动。<br>(3). -v后面是添加数据卷，这样在容器退出的时候数据就不会丢失，其中 /home/root/opt/postgresql/data是作者自己创建的文件夹，读者可以自己自定义，后面的部分是容器内的文件路径，需要保持不变。<br>(4). 命令执行成功之后会在控制台显示一串容器的编号，可以使用命令docker ps查看刚刚启动的容器。  </p>
<p>使用如下命令运行redis镜像：  </p>
<figure class="highlight crystal hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run --name redis -d \  </span><br><span class="line">-v /home/root/opt/redis/<span class="hljs-symbol">data:</span>/var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">redis</span> \  </span></span><br><span class="line">sameersbn/redis</span><br></pre></td></tr></table></figure>

<p>这里跟启动postgresql一样。<br>使用如下命令运行GitLab镜像：</p>
<figure class="highlight livescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">docker run --name gitlab -d <span class="hljs-string">\</span></span><br><span class="line">--link postgresql:postgresql --link redis:redisio <span class="hljs-string">\</span></span><br><span class="line">-p <span class="hljs-number">10022</span>:<span class="hljs-number">22</span> -p <span class="hljs-number">10080</span>:<span class="hljs-number">80</span> <span class="hljs-string">\</span></span><br><span class="line">-e <span class="hljs-string">'GITLAB_PORT=10080'</span> <span class="hljs-string">\</span></span><br><span class="line">-e <span class="hljs-string">'GITLAB_SSH_PORT=10022'</span> <span class="hljs-string">\</span></span><br><span class="line">-e <span class="hljs-string">'GITLAB_SECRETS_DB_KEY_BASE=long-and-random-alpha-numeric-string'</span><span class="hljs-string">\</span></span><br><span class="line">-e <span class="hljs-string">'GITLAB_SECRETS_SECRET_KEY_BASE=long-and-random-alpha-numeric-string'</span> <span class="hljs-string">\</span></span><br><span class="line">-e <span class="hljs-string">'GITLAB_SECRETS_OTP_KEY_BASE=long-and-random-alpha-numeric-string'</span><span class="hljs-string">\</span></span><br><span class="line">-e <span class="hljs-string">'GITLAB_HOST=服务器地址'</span> <span class="hljs-string">\</span></span><br><span class="line">-e <span class="hljs-string">'GITLAB_EMAIL=邮箱地址'</span> <span class="hljs-string">\</span></span><br><span class="line">-e <span class="hljs-string">'SMTP_ENABLED=true'</span> <span class="hljs-string">\</span></span><br><span class="line">-e <span class="hljs-string">'SMTP_DOMAIN=www.sina.com'</span> <span class="hljs-string">\</span></span><br><span class="line">-e <span class="hljs-string">'SMTP_HOST=smtp.sina.com'</span> <span class="hljs-string">\</span> </span><br><span class="line">-e <span class="hljs-string">'SMTP_STARTTLS=false'</span>  <span class="hljs-string">\</span></span><br><span class="line">-e <span class="hljs-string">'SMTP_USER=邮箱地址'</span> <span class="hljs-string">\</span></span><br><span class="line">-e <span class="hljs-string">'SMTP_PASS=邮箱密码'</span> <span class="hljs-string">\</span></span><br><span class="line">-e <span class="hljs-string">'SMTP_AUTHENTICATION=login'</span> <span class="hljs-string">\</span></span><br><span class="line">-e <span class="hljs-string">'GITLAB_BACKUP_SCHEDULE=daily'</span> <span class="hljs-string">\</span></span><br><span class="line">-e <span class="hljs-string">'GITLAB_BACKUP_TIME=10:30'</span> <span class="hljs-string">\</span></span><br><span class="line">-v /home/root/opt/gitlab/data:/home/git/data <span class="hljs-string">\</span></span><br><span class="line">sameersbn/gitlab</span><br></pre></td></tr></table></figure>

<p>这里需要解释的是：<br>(1). 网上又很多教程讲关于使用docker安装GitLab，但是讲的不全面，至少我按照他们的方法安装时不能正常运行，这里是第三个坑：一定要加上如下环境参数：</p>
<figure class="highlight maxima hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-e 'GITLAB_SECRETS_DB_KEY_BASE=long-<span class="hljs-keyword">and</span>-<span class="hljs-built_in">random</span>-alpha-numeric-<span class="hljs-built_in">string</span>'\</span><br><span class="line">-e 'GITLAB_SECRETS_SECRET_KEY_BASE=long-<span class="hljs-keyword">and</span>-<span class="hljs-built_in">random</span>-alpha-numeric-<span class="hljs-built_in">string</span>' \</span><br><span class="line">-e 'GITLAB_SECRETS_OTP_KEY_BASE=long-<span class="hljs-keyword">and</span>-<span class="hljs-built_in">random</span>-alpha-numeric-<span class="hljs-built_in">string</span>'\</span><br></pre></td></tr></table></figure>

<p>有关于这三个环境参数的含义：</p>
<p>官方的解释 </p>
<p>我个人的理解是用来进行加密的key。<br>(2). 上面有关SMTP的环境参数是配置邮箱的，需要填上对应的邮箱信息，我使用的是新浪邮箱，读者可以根据自己的邮箱进行填写。<br>(3). 使用GitLab需要两个端口，一个是web端口，一个是SSH端口用于push代码的所以一下代码进行端口映射和指定：</p>
<p>-p 10022:22 -p 10080:80 <br>-e ‘GITLAB_PORT=10080’ <br>-e ‘GITLAB_SSH_PORT=10022’ <br>(4). GitLab有自带的备份，这里可以通过如下进行配置：<br>-e ‘GITLAB_BACKUP_SCHEDULE=daily’ <br>-e ‘GITLAB_BACKUP_TIME=10:30’ <br>指定的是每天10:30进行备份。<br>说到这里基本上GitLab就搭建好了，这里还有一个小坑就是：运行这些容器的时候可以把代码写进shell脚本中，然后通过脚本进行运行，不然直接在终端打的话很麻烦。<br>一下就是笔者安装完后的截图，直接访问：http://服务器地址:10080 即可，首次访问可能会出现错误页面，刷新几下页面就可以了然后在修改密码默认用户名：root 之后就可以正常使用。</p>
<p>登录界面 </p>
<p>group </p>
<p>admin area<br>四. 备份<br>我们可以使用GitLab自带的备份功能，在启动容器的时候就进行设置，然后再使用GitLab的 app:rake gitlab:backup:restore命令进行恢复，这里网上的教程都有说明可以参考以下网站：<br>sameersbn的GitHub wiki：<br><a href="https://github.com/sameersbn/docker-gitlab#automated-backups" target="_blank" rel="noopener">https://github.com/sameersbn/docker-gitlab#automated-backups</a><br>这个是官方的所以比较全面，里面还有关于各种环境参数的介绍。<br>这里作者使用的是如下的备份方法：<br>因为我们在运行postgresql、redis和GitLab的时候都使用了本地的文件夹进行了数据的持久化，而且我们实际需要备份的数据都在本地了，那么其实就可以直接使用rsync命令备份本地的这些卷（刚刚的文件夹）即可，无需再去深入到GitLab内部。如果搭建的GitLab崩溃了，或者服务器崩溃了，直接再使用docker再搭一个，在把刚刚的卷跟对应的postgresql、redis和GitLab内的数据文件夹进行映射即可。这是也不需要修改之前的启动命令，十分的方便而且作者自己测试过，发现能够达到要求，原先的仓库、用户的SSH信息等都在。</p>
<p>修改100.230 /data/gitlab_875/config/gitlab.rb (docker gitlab875 /etc/gitlab/gitlab.rb)<br>增加:  </p>
<figure class="highlight prolog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">gitlab_rails[<span class="hljs-string">'smtp_enable'</span>] = true</span><br><span class="line">#gitlab_rails[<span class="hljs-string">'smtp_address'</span>] = <span class="hljs-string">"smtp.domain.cn"</span></span><br><span class="line">gitlab_rails[<span class="hljs-string">'smtp_address'</span>] = <span class="hljs-string">"12.34.56.78"</span></span><br><span class="line">gitlab_rails[<span class="hljs-string">'smtp_port'</span>] = <span class="hljs-number">25</span></span><br><span class="line">gitlab_rails[<span class="hljs-string">'smtp_user_name'</span>] = <span class="hljs-string">"gitlabadmin@domain.cn"</span></span><br><span class="line">gitlab_rails[<span class="hljs-string">'smtp_password'</span>] = <span class="hljs-string">"yourpassword"</span></span><br><span class="line">gitlab_rails[<span class="hljs-string">'smtp_domain'</span>] = <span class="hljs-string">"smtp.domain.cn"</span></span><br><span class="line">gitlab_rails[<span class="hljs-string">'smtp_authentication'</span>] = <span class="hljs-string">"login"</span></span><br><span class="line">gitlab_rails[<span class="hljs-string">'smtp_enable_starttls_auto'</span>] = true</span><br><span class="line">gitlab_rails[<span class="hljs-string">'smtp_tls'</span>] = false</span><br><span class="line">gitlab_rails[<span class="hljs-string">'smtp_openssl_verify_mode'</span>] = <span class="hljs-string">'none'</span></span><br><span class="line"></span><br><span class="line">gitlab_rails[<span class="hljs-string">'gitlab_email_enabled'</span>] = true</span><br><span class="line">gitlab_rails[<span class="hljs-string">'gitlab_email_from'</span>] = <span class="hljs-string">'gitlabadmin@domain.cn'</span></span><br><span class="line">gitlab_rails[<span class="hljs-string">'gitlab_email_display_name'</span>] = <span class="hljs-string">'gitlabadmin'</span></span><br><span class="line">gitlab_rails[<span class="hljs-string">'gitlab_email_reply_to'</span>] = <span class="hljs-string">'gitlabadmin@domain.cn'</span></span><br><span class="line">gitlab_rails[<span class="hljs-string">'gitlab_email_subject_suffix'</span>] = <span class="hljs-string">''</span></span><br></pre></td></tr></table></figure>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-16T16:27:00.000Z">2019-07-16</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    9 分钟 read (About 1319 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/17/springboot-login/">springboot login</a>
            
        </h1>
        <div class="content">
            <p>springboot系列（一）：初次使用与登录验证实现</p>
<p>听说过很多springboot如何流行，以及如何简化了我们的应用开发，却没有真正使用过springboot，现在终于要动手了！打算自己动手的这个项目，结果不会是促成某个真正的项目，学习为主，把学习过程分享出来。开篇探索以以下两个方面为主：<br>1、从mvc经典框架到springboot<br>2、最原始的方式实现登录验证<br>一、建一个使用springboot的项目<br>springboot是建立在的spring生态的基础上的，以前看spring的时候，有两大概念是纠结了很久的，IOC（控制反转）以及AOP（面向切面的编程）。其实控制反转就是依赖注入，spring提供了一个IOC容器来初始化对象，解决对象间依赖管理和对象的使用，如@Bean、@Autowired等可以实现依赖注入，AOP目前理解是在一些日志框架场景中用到。<br>平时我们常见的web项目开发，使用的mvc框架、maven管理在springboot依然使用到，springboot最明显的好处是简化了新建一个项目时的各种配置过程，就连tomcat都不用配置了。可以看到我新建一个maven项目大目录结构是这样的</p>
<p>跟着上图目录结构，我们来看看springboot是如何完成一个普通的web项目所需要做的事的<br>a.web容器：springboot内嵌了Tomcat,我们不需要手动配置tomcat以及以war包形式部署项目，启动入口为目录中App.java中的main函数，直接运行即可。</p>
<p>@SpringBootApplication<br>public class App {<br>public static void main(String[] args) {<br>SpringApplication.run(App.class,args);<br>}
}</p>
<p>b.依赖管理:spring提供了一系列的starter pom来简化Maven的依赖加载，如一个web项目pom.xm部分配置如下：</p>
<figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span></span><br><span class="line">     <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">     <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.3.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="line"> <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span></span><br><span class="line">     <span class="hljs-comment">&lt;!--Spring Boot的核心启动器，包含了自动配置、日志和YAML--&gt;</span></span><br><span class="line">     <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="hljs-comment">&lt;!--支持全栈式Web开发，包括Tomcat和spring-webmvc--&gt;</span></span><br><span class="line">     <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">         <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">         <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>c.配置管理：目录中src/main/resource/application.properties为配置文件，springboot可以自动读取，或者使用java配置可以看到没有web.xml，没有spring相关的配置文件，整个项目看起来非常的简洁。</p>
<p>#数据库配置<br>spring.datasource.url=jdbc:mysql://localhost:3306/world?characterEncoding=UTF-8&amp;useUnicode=true<br>spring.datasource.username=darren<br>spring.datasource.password=darren123<br>spring.datasource.driver-class-name=com.mysql.jdbc.Driver<br>spring.jpa.properties.hibernate.hbm2ddl.auto=update<br>一个springboot web项目大概就包含这些 </p>
<p>二、原始方式实现登录验证<br>流程为：登录页面发起请求–&gt;拦截器拦截匹配的url判断session–&gt;后台验证/设置session–&gt;返回<br>a、这里主要通过自定义拦截器的方式，继承WebMvcConfigurerAdapter和HandlerInterceptorAdapter来实现拦截器对登录请求进行拦截和session的判断，我这里都写在WebSecurityConfig.java中<br>其中WebMvcConfigurerAdapter是Spring提供的基础类，可以通过重写 addInterceptors 方法添加注册拦截器来组成一个拦截链，以及用于添加拦截规则和排除不用的拦截，如下：</p>
<figure class="highlight abnf hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public void  addInterceptors(InterceptorRegistry registry)&#123;</span><br><span class="line">    InterceptorRegistration addInterceptor = registry.addInterceptor(getSecurityInterceptor())<span class="hljs-comment">;</span></span><br><span class="line"></span><br><span class="line">    addInterceptor.excludePathPatterns(<span class="hljs-string">"/error"</span>)<span class="hljs-comment">;</span></span><br><span class="line">    addInterceptor.excludePathPatterns(<span class="hljs-string">"/login**"</span>)<span class="hljs-comment">;</span></span><br><span class="line"></span><br><span class="line">    addInterceptor.addPathPatterns(<span class="hljs-string">"/**"</span>)<span class="hljs-comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中HandlerInterceptorAdapter是spring mvc提供的适配器，继承此类，可以非常方便的实现自己的拦截器，它有三个方法：preHandle、postHandle、afterCompletion。preHandle在业务处理器处理请求之前被调用。预处理，可以进行编码、安全控制等处理；postHandle在业务处理器处理请求执行完成后，生成视图之前执行。afterCompletion在DispatcherServlet完全处理完请求后被调用，可用于清理资源等。我项目中只重写了preHandle,对请求进行session判断和跳转到自定义的页面，如下：</p>
<figure class="highlight scala hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HandlerInterceptorAdapter</span></span>&#123;</span><br><span class="line">        <span class="hljs-meta">@Override</span></span><br><span class="line">        public boolean preHandle(<span class="hljs-type">HttpServletRequest</span> request, <span class="hljs-type">HttpServletResponse</span> response,<span class="hljs-type">Object</span> handler) <span class="hljs-keyword">throws</span> <span class="hljs-type">IOException</span> &#123;</span><br><span class="line">            <span class="hljs-type">HttpSession</span> session = request.getSession();</span><br><span class="line">            </span><br><span class="line"><span class="hljs-comment">//            判断是否已有该用户登录的session</span></span><br><span class="line">            <span class="hljs-keyword">if</span>(session.getAttribute(<span class="hljs-type">SESSION_KEY</span>) != <span class="hljs-literal">null</span>)&#123;</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//            跳转到登录页</span></span><br><span class="line">            <span class="hljs-type">String</span> url = <span class="hljs-string">"/login"</span>;</span><br><span class="line">            response.sendRedirect(url);</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>b.controller中对登录请求进行验证以及页面的跳转，如下 </p>
<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Controller</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Autowired</span></span><br><span class="line">    <span class="hljs-keyword">private</span> LoginService loginService;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@GetMapping(<span class="hljs-meta-string">"/"</span>)</span></span><br><span class="line">    <span class="hljs-keyword">public</span> String index(<span class="hljs-meta">@SessionAttribute(WebSecurityConfig.SESSION_KEY)</span>String account,Model model)&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-string">"index"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@GetMapping(<span class="hljs-meta-string">"/login"</span>)</span></span><br><span class="line">    <span class="hljs-keyword">public</span> String login()&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-string">"login"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@PostMapping(<span class="hljs-meta-string">"/loginVerify"</span>)</span></span><br><span class="line">    <span class="hljs-keyword">public</span> String loginVerify(String username,String password,HttpSession session)&#123;</span><br><span class="line">        User user = new User();</span><br><span class="line">        user.setUsername(username);</span><br><span class="line">        user.setPassword(password);</span><br><span class="line"></span><br><span class="line">        boolean verify = loginService.verifyLogin(user);</span><br><span class="line">        <span class="hljs-keyword">if</span> (verify) &#123;</span><br><span class="line">            session.setAttribute(WebSecurityConfig.SESSION_KEY, username);</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-string">"index"</span>;</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/login"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@GetMapping(<span class="hljs-meta-string">"/logout"</span>)</span></span><br><span class="line">    <span class="hljs-keyword">public</span> String logout(HttpSession session)&#123;</span><br><span class="line">        session.removeAttribute(WebSecurityConfig.SESSION_KEY);</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/login"</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>controller代码解释：loginVerify是对登录请求到数据库中进行验证用户名和密码，验证通过以后设置session，否则跳转到登录页面。@GetMapping是一个组合注解，是@RequestMapping(method = RequestMethod.GET)的缩写,@PostMapping同理。 </p>
<p>ps:实际项目登录验证会使用登录验证框架：spring security 、shiro等，以及登录过程密码加密传输保存等，这里仅仅用于了解。</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-16T02:30:00.000Z">2019-07-16</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    几秒 read (About 73 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/16/idea-springboot-autowired-show-redunderline/">idea springboot autowired hide red underline</a>
            
        </h1>
        <div class="content">
            <p>SpringBoot：Dao层mapper注入报红问题</p>
<p>在mapper接口上加上</p>
<p>@Component注解<br>例如:</p>
<pre><code>import com.example.sptingboot_mybatis.model.User;
import org.apache.ibatis.annotations.Mapper;
import org.springframework.stereotype.Component;

import java.util.List;

@Mapper
@Component(&quot;IUser&quot;)
public interface IUser {
   List&lt;User&gt; findAll();
}</code></pre><p>就可以解决问题</p>
<p>原文链接：<a href="https://blog.csdn.net/Sir_He/article/details/81879854" target="_blank" rel="noopener">https://blog.csdn.net/Sir_He/article/details/81879854</a> </p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-16T01:44:00.000Z">2019-07-16</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    24 分钟 read (About 3597 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/16/auto/">@Autowired @Resource @Qualifier的区别</a>
            
        </h1>
        <div class="content">
            <p>@Autowired @Resource @Qualifier的区别<br>spring不但支持自己定义的@Autowired注解，还支持几个由JSR-250规范定义的注解，它们分别是@Resource、@PostConstruct以及@PreDestroy。  </p>
<p>@Resource的作用相当于@Autowired，只不过@Autowired按byType自动注入，而@Resource默认按 byName自动注入罢了。@Resource有两个属性是比较重要的，分是name和type，Spring将@Resource注解的name属性解析为bean的名字，而type属性则解析为bean的类型。所以如果使用name属性，则使用byName的自动注入策略，而使用type属性时则使用byType自动注入策略。如果既不指定name也不指定type属性，这时将通过反射机制使用byName自动注入策略。  </p>
<p>@Resource装配顺序<br>　　1. 如果同时指定了name和type，则从Spring上下文中找到唯一匹配的bean进行装配，找不到则抛出异常<br>　　2. 如果指定了name，则从上下文中查找名称（id）匹配的bean进行装配，找不到则抛出异常<br>　　3. 如果指定了type，则从上下文中找到类型匹配的唯一bean进行装配，找不到或者找到多个，都会抛出异常<br>　　4. 如果既没有指定name，又没有指定type，则自动按照byName方式进行装配；如果没有匹配，则回退为一个原始类型进行匹配，如果匹配则自动装配；  </p>
<p>@Autowired 与@Resource的区别：  </p>
<ul>
<li><p>1、 @Autowired与@Resource都可以用来装配bean. 都可以写在字段上,或写在setter方法上。</p>
</li>
<li><p>2、 @Autowired默认按类型装配（这个注解是属业spring的），默认情况下必须要求依赖对象必须存在，如果要允许null值，可以设置它的required属性为false，如：@Autowired(required=false) ，如果我们想使用名称装配可以结合@Qualifier注解进行使用，如下：</p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@Autowired</span>()</span><br><span class="line"><span class="hljs-variable">@Qualifier</span>(<span class="hljs-string">"baseDao"</span>)</span><br><span class="line">privateBaseDao baseDao;</span><br></pre></td></tr></table></figure>
</li>
<li><p>3、@Resource（这个注解属于J2EE的），默认按照名称进行装配，名称可以通过name属性进行指定，如果没有指定name属性，当注解写在字段上时，默认取字段名进行安装名称查找，如果注解写在setter方法上默认取属性名进行装配。当找不到与名称匹配的bean时才按照类型进行装配。但是需要注意的是，如果name属性一旦指定，就只会按照名称进行装配。</p>
<figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@<span class="hljs-keyword">Resource</span>(<span class="hljs-keyword">name</span>="<span class="hljs-keyword">baseDao</span>")</span><br><span class="line"><span class="hljs-keyword">privateBaseDao</span> baseDao;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>推荐使用：@Resource注解在字段上，这样就不用写setter方法了，并且这个注解是属于J2EE的，减少了与spring的耦合。这样代码看起就比较优雅。</p>
<p>spring @Qualifier注解</p>
<p>@Autowired是根据类型进行自动装配的。如果当Spring上下文中存在不止一个UserDao类型的bean时，就会抛出BeanCreationException异常;如果Spring上下文中不存在UserDao类型的bean，也会抛出BeanCreationException异常。我们可以使用@Qualifier配合@Autowired来解决这些问题。如下：<br>①可能存在多个UserDao实例<br> <figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@Autowired</span>   </span><br><span class="line"><span class="hljs-variable">@Qualifier</span>(<span class="hljs-string">"userServiceImpl"</span>)   </span><br><span class="line">public IUserService userService;</span><br></pre></td></tr></table></figure></p>
<p>或者</p>
 <figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Autowired</span>   </span><br><span class="line"><span class="hljs-keyword">public</span> void setUserDao(<span class="hljs-meta">@Qualifier(<span class="hljs-meta-string">"userDao"</span>)</span> UserDao userDao) &#123;   </span><br><span class="line">    <span class="hljs-keyword">this</span>.userDao = userDao;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样Spring会找到id为userServiceImpl和userDao的bean进行装配。</p>
<p>②可能不存在UserDao实例<br>  <figure class="highlight aspectj hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Autowired</span>(required = <span class="hljs-keyword">false</span>)   </span><br><span class="line"><span class="hljs-keyword">public</span> IUserService userService</span><br></pre></td></tr></table></figure></p>
<table>
<thead>
<tr>
<th align="left">个人总结：</th>
</tr>
</thead>
<tbody><tr>
<td align="left">@Autowired//默认按type注入</td>
</tr>
<tr>
<td align="left">@Qualifier(“cusInfoService”)//一般作为@Autowired()的修饰用</td>
</tr>
<tr>
<td align="left">@Resource(name=”cusInfoService”)//默认按name注入，可以通过name和type属性进行选择性注入不属于spring</td>
</tr>
<tr>
<td align="left">一般@Autowired和@Qualifier一起用，@Resource单独用。</td>
</tr>
<tr>
<td align="left">当然没有冲突的话@Autowired也可以单独用</td>
</tr>
</tbody></table>
<h5 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h5><p>–定义Bean的注解</p>
<p>@Controller<br>@Controller(“Bean的名称”)<br>定义控制层Bean,如Action  </p>
<p>@Service<br>@Service(“Bean的名称”)<br>定义业务层Bean  </p>
<p>@Repository<br>@Repository(“Bean的名称”)<br>定义DAO层Bean  </p>
<p>@Component<br>定义Bean, 不好归类时使用.  </p>
<p>–自动装配Bean （选用一种注解就可以）<br>@Autowired  (Srping提供的)<br>默认按类型匹配,自动装配(Srping提供的)，可以写在成员属性上,或写在setter方法上  </p>
<p>@Autowired(required=true)<br>一定要找到匹配的Bean，否则抛异常。 默认值就是true   </p>
<p>@Autowired<br>@Qualifier(“bean的名字”)<br>按名称装配Bean,与@Autowired组合使用，解决按类型匹配找到多个Bean问题。  </p>
<p>@Resource   JSR-250提供的<br>默认按名称装配,当找不到名称匹配的bean再按类型装配.<br>可以写在成员属性上,或写在setter方法上<br>可以通过@Resource(name=”beanName”) 指定被注入的bean的名称, 要是未指定name属性, 默认使用成员属性的变量名,一般不用写name属性.<br>@Resource(name=”beanName”)指定了name属性,按名称注入但没找到bean, 就不会再按类型装配了.  </p>
<p>@Inject   是JSR-330提供的<br>按类型装配，功能比@Autowired少，没有使用的必要。  </p>
<p>–定义Bean的作用域和生命过程<br>@Scope(“prototype”)<br>值有:singleton,prototype,session,request,session,globalSession  </p>
<p>@PostConstruct<br>相当于init-method,使用在方法上，当Bean初始化时执行。  </p>
<p>@PreDestroy<br>相当于destory-method，使用在方法上，当Bean销毁时执行。  </p>
<p>–声明式事务<br>@Transactional<br>@Autowired @Resource @Qualifier的区别<br>实用理解：@Autowired @Resource 二选其一，看中哪个就用哪个。  </p>
<p>简单理解：<br>@Autowired 根据类型注入，<br>@Resource 默认根据名字注入，其次按照类型搜索<br>@Autowired @Qualifie(“userService”) 两个结合起来可以根据名字和类型注入  </p>
<p>复杂理解：<br>比如你有这么一个Bean<br>@Service(“UserService”)<br>public Class UserServiceImpl implements UserService｛｝;<br>现在你想在UserController 里面使用这个UserServiceImpl<br>public Class UserController ｛<br>@AutoWired   //当使用这个注入的时候上面的 UserServiceImpl 只需要这样写 @Service，这样就会自动找到UserService这个类型以及他的子类型。UserServiceImpl 实现了UserService，所以能够找到它。不过这样有一个缺点，就是当UserService实现类有两个以上的时候，这个时候会找哪一个呢，这就造成了冲突，所以要用@AutoWire注入的时候要确保UserService只有一个实现类。<br>@Resource 默认情况下是按照名称进行匹配，如果没有找到相同名称的Bean，则会按照类型进行匹配，有人可能会想了，这下好了，用这个是万能的了，不用管名字了，也不用管类型了，但这里还是有缺点。首先，根据这个注解的匹配效果可以看出，它进行了两次匹配，也就是说，如果你在UserService这个类上面这样写注解，@Service,它会怎么找呢，首先是找相同名字的，如果没有找到，再找相同类型的，而这里的@Service没有写名字，这个时候就进行了两次搜索，显然，速度就下降了许多。也许你还会问，这里的@Service本来就没有名字，肯定是直接进行类型搜索啊。其实不是这样的，UserServiceImpl 上面如果有@Service默认的名字 是这个userServiceImpl，注意看，就是把类名前面的大写变成小写，就是默认的Bean的名字了。 @Resource根据名字搜索是这样写@Resource(“userService”)，如果你写了这个名字叫userService，那么UserServiceImpl上面必须也是这个名字，不然还是会报错。  </p>
<p>@Autowired @Qualifie(“userService”) 是直接按照名字进行搜索，也就是说，对于UserServiceImpl 上面@Service注解必须写名字，不写就会报错，而且名字必须是@Autowired @Qualifie(“userService”) 保持一致。如果@Service上面写了名字，而@Autowired @Qualifie() ，一样会报错。</p>
<p>private UserService userService;</p>
<p>｝  
说了这么多，可能你有些说晕了，那么怎么用这三个呢，要实际的工作是根据实际情况来使用的，通常使用AutoWire和@Resource多一些，bean的名字不用写，而UserServiceImpl上面能会这样写 @Service(“userService”)。这里的实际工作情况，到底是什么情况呢？说白了就是整个项目设计时候考虑的情况，<br>如果你的架构设计师考虑的比较精细，要求比较严格，要求项目上线后的访问速度比较好，通常是考虑速度了。这个时候@AutoWire没有@Resource好用，因为@Resource可以根据名字来搜索，是这样写的@Resource(“userService”)。这个@Autowired @Qualifie(“userService”) 也可以用名字啊，为什么不用呢，原因很简单，这个有点长，不喜欢，增加工作量。因为根据名字搜索是最快的，就好像查数据库一样，根据Id查找最快。因为这里的名字与数据库里面的ID是一样的作用。这个时候，就要求你多写几个名字，工作量自然就增加了。而如果你不用注解，用xml文件的时候，对于注入Bean的时候要求写一个Id，xml文件时候的id就相当于这里的名字。</p>
<p>说了那么多没用，你能做的就是简单直接，什么最方便就用什么，<br>你就直接用@Resource得了，如果你喜欢用@AutoWired也行，不用写名字。</p>
<p>通常情况一个Bean的注解写错了，会报下面这些错误，最为常见，<br>No bean named ‘user’ is defined，这个表示没有找到被命名为user的Bean，通俗的说，就是名字为user的类型，以及它的子类型，出现这个错误的原因就是注入时候的类型名字为user，而搜索的时候找不到，也就是说可能那个搜索的类型，并没有命令为user，解决办法就是找到这个类型，去命令为user，</p>
<p>下面这个错误也常见，<br>No qualifying bean of type [com.service.UserService] found for dependency:<br>这个错误的原因就是类型上面没有加@Service这个注入，不仅仅是@Service，如果是其他层也会出现这个错误，这里我是以Service为例子说明，如果是DAO层就是没有加@Repository，Controller层，则是没有加@Controller。<br>还有，如果你还是想再简单点，无论是DAO,Controller，Service三个层，都可以用这个注解，@Component，这个注解通用所有的Bean，这个时候你可能会说了，有通常的为什么用的人少呢，那是因为MVC这个分层的设计原则，用@Repository,@Service，@Controller，这个可以区别MVC原则中的DAO,Service，Controller。便于识别。</p>
<p>博客2：<br>springautowiredqualifierbytypebyname<br>　在使用Spring框架中@Autowired标签时默认情况下使用<br>Java代码<br>@Autowired<br> @Autowired<br>注释进行自动注入时，Spring 容器中匹配的候选 Bean 数目必须有且仅有一个。当找不到一个匹配的 Bean 时，Spring 容器将抛出 BeanCreationException 异常，并指出必须至少拥有一个匹配的 Bean。<br>@Autowired 默认是按照byType进行注入的，如果发现找到多个bean，则，又按照byName方式比对，如果还有多个，则报出异常。<br>例子：<br>@Autowired<br>private ExamUserMapper examUserMapper;  - ExamUserMapper是一个接口</p>
<ol>
<li>spring先找类型为ExamUserMapper的bean</li>
<li>如果存在且唯一，则OK；</li>
<li>如果不唯一，在结果集里，寻找name为examUserMapper的bean。因为bean的name有唯一性，所以，到这里应该能确定是否存在满足要求的bean了</li>
</ol>
<p>@Autowired也可以手动指定按照byName方式注入，使用@Qualifier标签，例如：<br>@Autowired () @Qualifier ( “baseDao” )</p>
<p>　　Spring 允许我们通过<br>Java代码<br>@Qualifier<br>@Qualifier<br>注释指定注入 Bean 的名称，这样歧义就消除了，可以通过下面的方法解决异常。 </p>
<p>　　<br>Java代码<br>@Qualifier(“XXX”)<br>@Qualifier(“XXX”)<br>中的 XX是 Bean 的名称，所以 @Autowired 和 @Qualifier 结合使用时，自动注入的策略就从 byType 转变成 byName 了。 </p>
<p>　　@Autowired 可以对成员变量、方法以及构造函数进行注释，而 @Qualifier 的标注对象是成员变量、方法入参、构造函数入参。 </p>
<pre><code>Spring不但支持自己定义的@Autowired注解，还支持几个由JSR-250规范定义的注解，它们分别是@Resource、@PostConstruct以及@PreDestroy。 </code></pre><p>　　<br>Java代码<br>@Resource<br>@Resource<br>的作用相当于@Autowired，只不过@Autowired按byType自动注入，而@Resource默认按 byName自动注入罢了。@Resource有两个属性是比较重要的，分是name和type，Spring将@Resource注解的name属性解析为bean的名字，而type属性则解析为bean的类型。所以如果使用name属性，则使用byName的自动注入策略，而使用type属性时则使用byType自动注入策略。如果既不指定name也不指定type属性，这时将通过反射机制使用byName自动注入策略。 </p>
<p>　　@Resource装配顺序<br>　　1. 如果同时指定了name和type，则从Spring上下文中找到唯一匹配的bean进行装配，找不到则抛出异常<br>　　2. 如果指定了name，则从上下文中查找名称（id）匹配的bean进行装配，找不到则抛出异常<br>　　3. 如果指定了type，则从上下文中找到类型匹配的唯一bean进行装配，找不到或者找到多个，都会抛出异常<br>　　4. 如果既没有指定name，又没有指定type，则自动按照byName方式进行装配；如果没有匹配，则回退为一个原始类型进行匹配，如果匹配则自动装配 </p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-16T00:39:00.000Z">2019-07-16</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 分钟 read (About 364 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/16/hexo-show-imgs/">hexo show imgs</a>
            
        </h1>
        <div class="content">
            <p>Hexo快速发布博文及插入图片  </p>
<p>md文件放在hexo网站所在位置下的source_posts目录，这个目录下存储了很多个md文件，每个文件对应着一篇博客。<br>在博客站点文件夹输入：hexo g，生成静态页面，<br>再输入：hexo server，到localhost:4000预览博客效果，<br>最后输入：hexo d，部署；<br>第四步可简单输入命令：hexo d -g<br>解决利用csdn发布博客图片不显示的问题<br>1、 将主页配置文件_config.yml 里的post_asset_folder:这个选项设置为true；<br>2、在hexo目录下执行npm install hexo-asset-image –save，这是下载安装一个可以上传本地图片的插件；<br>3、稍等片刻，再运行hexo n “xxxx”来生成md博文时，/source/_posts文件夹内除了xxxx.md文件还有一个同名的文件夹<br>4、 在xxxx.md中想引入图片时，先把图片复制到xxxx这个文件夹中，然后只需要在xxxx.md中按照markdown的格式引入图片：<br><code>![这里输入图片描述](/xxxx/图片名.jpg)</code></p>
<p><strong>注意： 此处xxxx代表的是新建博文md文件的名字，也是同名文件夹的名字</strong>  </p>
<p><img src="/images/sf.png" alt><br>如下图：<br>具体引入路径如下：<br>/Hexo快速发布博文及插入图片/图片显示问题.png</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-15T23:37:00.000Z">2019-07-15</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    25 分钟 read (About 3712 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/16/custom-annotation/">custom annotation</a>
            
        </h1>
        <div class="content">
            <p>自定义注解详细介绍  </p>
<p>1 注解的概念<br>1.1 注解的官方定义 </p>
<p>首先看看官方对注解的描述： </p>
<p>An annotation is a form of metadata, that can be added to Java source code. Classes, methods, variables, parameters and packages may be annotated. Annotations have no direct effect on the operation of the code they annotate.</p>
<p>翻译：  </p>
<p>注解是一种能被添加到java代码中的元数据，类、方法、变量、参数和包都可以用注解来修饰。注解对于它所修饰的代码并没有直接的影响。</p>
<p>通过官方描述得出以下结论：</p>
<p>注解是一种元数据形式。即注解是属于java的一种数据类型，和类、接口、数组、枚举类似。<br>注解用来修饰，类、方法、变量、参数、包。<br>注解不会对所修饰的代码产生直接的影响。</p>
<p>1.2 注解的使用范围<br>继续看看官方对它的使用范围的描述：</p>
<p>Annotations have a number of uses, among them:Information for the complier - Annotations can be used by the compiler to detect errors or suppress warnings.Compiler-time and deployment-time processing - Software tools can process annotation information to generate code, XML files, and so forth.Runtime processing - Some annotations are available to be examined at runtime.</p>
<p>翻译：</p>
<p>注解又许多用法，其中有：为编译器提供信息 - 注解能被编译器检测到错误或抑制警告。编译时和部署时的处理 - 软件工具能处理注解信息从而生成代码，XML文件等等。运行时的处理 - 有些注解在运行时能被检测到。</p>
<p>2 如何自定义注解<br>基于上一节，已对注解有了一个基本的认识：注解其实就是一种标记，可以在程序代码中的关键节点（类、方法、变量、参数、包）上打上这些标记，然后程序在编译时或运行时可以检测到这些标记从而执行一些特殊操作。因此可以得出自定义注解使用的基本流程：</p>
<p>第一步，定义注解——相当于定义标记；<br>第二步，配置注解——把标记打在需要用到的程序代码中；<br>第三步，解析注解——在编译期或运行时检测到标记，并进行特殊操作。  </p>
<p>2.1 基本语法<br>注解类型的声明部分：<br>注解在Java中，与类、接口、枚举类似，因此其声明语法基本一致，只是所使用的关键字有所不同@interface。在底层实现上，所有定义的注解都会自动继承  </p>
<figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Annotation</span>接口。</span><br><span class="line"><span class="hljs-selector-tag">public</span> @<span class="hljs-keyword">interface</span> CherryAnnotation &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注解类型的实现部分：<br>根据我们在自定义类的经验，在类的实现部分无非就是书写构造、属性或方法。但是，在自定义注解中，其实现部分只能定义一个东西：注解类型元素（annotation type element）。咱们来看看其语法：</p>
<figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> @<span class="hljs-keyword">interface</span> <span class="hljs-title">CherryAnnotation</span> &#123;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">name</span>(<span class="hljs-params"></span>)</span>;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">age</span>(<span class="hljs-params"></span>)</span>;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">int</span>[] <span class="hljs-title">array</span>(<span class="hljs-params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也许你会认为这不就是接口中定义抽象方法的语法嘛？别着急，咱们看看下面这个：</p>
<figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> @<span class="hljs-keyword">interface</span> <span class="hljs-title">CherryAnnotation</span> &#123;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">name</span>(<span class="hljs-params"></span>)</span>;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">age</span>(<span class="hljs-params"></span>) <span class="hljs-keyword">default</span> 18</span>;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">int</span>[] <span class="hljs-title">array</span>(<span class="hljs-params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看到关键字default了吗？还觉得是抽象方法吗？<br>注解里面定义的是：注解类型元素！<br>定义注解类型元素时需要注意如下几点：</p>
<p>访问修饰符必须为public，不写默认为public；<br>该元素的类型只能是基本数据类型、String、Class、枚举类型、注解类型（体现了注解的嵌套效果）以及上述类型的一位数组；<br>该元素的名称一般定义为名词，如果注解中只有一个元素，请把名字起为value（后面使用会带来便利操作）；<br>()不是定义方法参数的地方，也不能在括号中定义任何参数，仅仅只是一个特殊的语法；<br>default代表默认值，值必须和第2点定义的类型一致；<br>如果没有默认值，代表后续使用注解时必须给该类型元素赋值。  </p>
<p>可以看出，注解类型元素的语法非常奇怪，即又有属性的特征（可以赋值）,又有方法的特征（打上了一对括号）。但是这么设计是有道理的，我们在后面的章节中可以看到：注解在定义好了以后，使用的时候操作元素类型像在操作属性，解析的时候操作元素类型像在操作方法。<br>2.2 常用的元注解<br>一个最最基本的注解定义就只包括了上面的两部分内容：1、注解的名字；2、注解包含的类型元素。但是，我们在使用JDK自带注解的时候发现，有些注解只能写在方法上面（比如@Override）；有些却可以写在类的上面（比如@Deprecated）。当然除此以外还有很多细节性的定义，那么这些定义该如何做呢？接下来就该元注解出场了！<br>元注解：专门修饰注解的注解。它们都是为了更好的设计自定义注解的细节而专门设计的。我们为大家一个个来做介绍。<br>2.2.1 @Target<br>@Target注解，是专门用来限定某个自定义注解能够被应用在哪些Java元素上面的。它使用一个枚举类型定义如下：  </p>
<figure class="highlight crystal hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">ElementType</span> &#123;</span></span><br><span class="line">    /** 类，接口（包括注解类型）或枚举的声明 *<span class="hljs-regexp">/</span></span><br><span class="line"><span class="hljs-regexp">    TYPE,</span></span><br><span class="line"><span class="hljs-regexp"></span></span><br><span class="line"><span class="hljs-regexp">    /</span>** 属性的声明 *<span class="hljs-regexp">/</span></span><br><span class="line"><span class="hljs-regexp">    FIELD,</span></span><br><span class="line"><span class="hljs-regexp"></span></span><br><span class="line"><span class="hljs-regexp">    /</span>** 方法的声明 *<span class="hljs-regexp">/</span></span><br><span class="line"><span class="hljs-regexp">    METHOD,</span></span><br><span class="line"><span class="hljs-regexp"></span></span><br><span class="line"><span class="hljs-regexp">    /</span>** 方法形式参数声明 *<span class="hljs-regexp">/</span></span><br><span class="line"><span class="hljs-regexp">    PARAMETER,</span></span><br><span class="line"><span class="hljs-regexp"></span></span><br><span class="line"><span class="hljs-regexp">    /</span>** 构造方法的声明 *<span class="hljs-regexp">/</span></span><br><span class="line"><span class="hljs-regexp">    CONSTRUCTOR,</span></span><br><span class="line"><span class="hljs-regexp"></span></span><br><span class="line"><span class="hljs-regexp">    /</span>** 局部变量声明 *<span class="hljs-regexp">/</span></span><br><span class="line"><span class="hljs-regexp">    LOCAL_VARIABLE,</span></span><br><span class="line"><span class="hljs-regexp"></span></span><br><span class="line"><span class="hljs-regexp">    /</span>** 注解类型声明 *<span class="hljs-regexp">/</span></span><br><span class="line"><span class="hljs-regexp">    ANNOTATION_TYPE,</span></span><br><span class="line"><span class="hljs-regexp"></span></span><br><span class="line"><span class="hljs-regexp">    /</span>** 包的声明 *<span class="hljs-regexp">/</span></span><br><span class="line"><span class="hljs-regexp">    PACKAGE</span></span><br><span class="line"><span class="hljs-regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//@CherryAnnotation被限定只能使用在类、接口或方法上面</span></span><br><span class="line"><span class="hljs-variable">@Target</span>(value = &#123;ElementType.TYPE,ElementType.METHOD&#125;)</span><br><span class="line">public <span class="hljs-variable">@interface</span> CherryAnnotation &#123;</span><br><span class="line">    <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">name</span>();</span><br><span class="line">    <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">age</span>() <span class="hljs-selector-tag">default</span> <span class="hljs-selector-tag">18</span>;</span><br><span class="line">    <span class="hljs-selector-tag">int</span><span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">array</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.2.2 @Retention<br>@Retention注解，翻译为持久力、保持力。即用来修饰自定义注解的生命力。<br>注解的生命周期有三个阶段：1、Java源文件阶段；2、编译到class文件阶段；3、运行期阶段。同样使用了RetentionPolicy枚举类型定义了三个阶段：  </p>
<figure class="highlight applescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public enum RetentionPolicy &#123;</span><br><span class="line">    /**</span><br><span class="line">     * Annotations are <span class="hljs-keyword">to</span> be discarded <span class="hljs-keyword">by</span> <span class="hljs-keyword">the</span> compiler.</span><br><span class="line">     * （注解将被编译器忽略掉）</span><br><span class="line">     */</span><br><span class="line">    SOURCE,</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Annotations are <span class="hljs-keyword">to</span> be recorded <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">class</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">the</span> compiler</span><br><span class="line">     * <span class="hljs-keyword">but</span> need <span class="hljs-keyword">not</span> be retained <span class="hljs-keyword">by</span> <span class="hljs-keyword">the</span> VM <span class="hljs-keyword">at</span> <span class="hljs-built_in">run</span> <span class="hljs-built_in">time</span>.  This <span class="hljs-keyword">is</span> <span class="hljs-keyword">the</span> default</span><br><span class="line">     * behavior.</span><br><span class="line">     * （注解将被编译器记录在<span class="hljs-built_in">class</span>文件中，但在运行时不会被虚拟机保留，这是一个默认的行为）</span><br><span class="line">     */</span><br><span class="line">    CLASS,</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Annotations are <span class="hljs-keyword">to</span> be recorded <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">class</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">the</span> compiler <span class="hljs-keyword">and</span></span><br><span class="line">     * retained <span class="hljs-keyword">by</span> <span class="hljs-keyword">the</span> VM <span class="hljs-keyword">at</span> <span class="hljs-built_in">run</span> <span class="hljs-built_in">time</span>, so they may be <span class="hljs-built_in">read</span> reflectively.</span><br><span class="line">     * （注解将被编译器记录在<span class="hljs-built_in">class</span>文件中，而且在运行时会被虚拟机保留，因此它们能通过反射被读取到）</span><br><span class="line">     * @see java.lang.reflect.AnnotatedElement</span><br><span class="line">     */</span><br><span class="line">    RUNTIME</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们再详解一下：  </p>
<p>如果一个注解被定义为RetentionPolicy.SOURCE，则它将被限定在Java源文件中，那么这个注解即不会参与编译也不会在运行期起任何作用，这个注解就和一个注释是一样的效果，只能被阅读Java文件的人看到；<br>如果一个注解被定义为RetentionPolicy.CLASS，则它将被编译到Class文件中，那么编译器可以在编译时根据注解做一些处理动作，但是运行时JVM（Java虚拟机）会忽略它，我们在运行期也不能读取到；<br>如果一个注解被定义为RetentionPolicy.RUNTIME，那么这个注解可以在运行期的加载阶段被加载到Class对象中。那么在程序运行阶段，我们可以通过反射得到这个注解，并通过判断是否有这个注解或这个注解中属性的值，从而执行不同的程序代码段。我们实际开发中的自定义注解几乎都是使用的RetentionPolicy.RUNTIME；<br>在默认的情况下，自定义注解是使用的RetentionPolicy.CLASS。  </p>
<p>2.2.3 @Documented<br>@Documented注解，是被用来指定自定义注解是否能随着被定义的java文件生成到JavaDoc文档当中。<br>2.2.4 @Inherited<br>@Inherited注解，是指定某个自定义注解如果写在了父类的声明部分，那么子类的声明部分也能自动拥有该注解。@Inherited注解只对那些@Target被定义为ElementType.TYPE的自定义注解起作用。<br>3 自定义注解的配置使用<br>回顾一下注解的使用流程：</p>
<p>第一步，定义注解——相当于定义标记；<br>第二步，配置注解——把标记打在需要用到的程序代码中；<br>第三步，解析注解——在编译期或运行时检测到标记，并进行特殊操作。    </p>
<p>到目前为止我们只是完成了第一步，接下来我们就来学习第二步，配置注解，如何在另一个类当中配置它。<br>3.1 在具体的Java类上使用注解<br>首先，定义一个注解、和一个供注解修饰的简单Java类   </p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="hljs-variable">@Target</span>(value = &#123;ElementType.METHOD&#125;)</span><br><span class="line"><span class="hljs-variable">@Documented</span></span><br><span class="line">public <span class="hljs-variable">@interface</span> CherryAnnotation &#123;</span><br><span class="line">    <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">name</span>();</span><br><span class="line">    <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">age</span>() <span class="hljs-selector-tag">default</span> <span class="hljs-selector-tag">18</span>;</span><br><span class="line">    <span class="hljs-selector-tag">int</span><span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">score</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-selector-tag">12345678</span></span><br><span class="line"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">Student</span>&#123;</span><br><span class="line">    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">study</span>(int times)&#123;</span><br><span class="line">        <span class="hljs-selector-tag">for</span>(int i = <span class="hljs-number">0</span>; i &lt; times; i++)&#123;</span><br><span class="line">            <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(<span class="hljs-string">"Good Good Study, Day Day Up!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简单分析下：  </p>
<p>CherryAnnotation的@Target定义为ElementType.METHOD，那么它书写的位置应该在方法定义的上方，即：public void study(int times)之上；<br>由于我们在CherryAnnotation中定义的有注解类型元素，而且有些元素是没有默认值的，这要求我们在使用的时候必须在标记名后面打上()，并且在()内以“元素名=元素值“的形式挨个填上所有没有默认值的注解类型元素（有默认值的也可以填上重新赋值），中间用“,”号分割；  </p>
<p>所以最终书写形式如下：  </p>
<figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> &#123;</span><br><span class="line">    @CherryAnnotation(name = <span class="hljs-string">"cherry-peng"</span>,age = <span class="hljs-number">23</span>,score = &#123;<span class="hljs-number">99</span>,<span class="hljs-number">66</span>,<span class="hljs-number">77</span>&#125;)</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">study</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> times</span>)</span>&#123;</span><br><span class="line">        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; times; i++)&#123;</span><br><span class="line">            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Good Good Study, Day Day Up!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.2 特殊语法<br>特殊语法一：<br>如果注解本身没有注解类型元素，那么在使用注解的时候可以省略()，直接写为：@注解名，它和标准语法@注解名()等效！  </p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="hljs-variable">@Target</span>(value = &#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="hljs-variable">@Documented</span></span><br><span class="line">public <span class="hljs-variable">@interface</span> FirstAnnotation &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-number">12345</span></span><br><span class="line"><span class="hljs-comment">//等效于@FirstAnnotation()</span></span><br><span class="line"><span class="hljs-variable">@FirstAnnotation</span></span><br><span class="line">public class JavaBean&#123;</span><br><span class="line">	<span class="hljs-comment">//省略实现部分</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>特殊语法二：<br>如果注解本本身只有一个注解类型元素，而且命名为value，那么在使用注解的时候可以直接使用：@注解名(注解值)，其等效于：@注解名(value = 注解值)  </p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="hljs-variable">@Target</span>(value = &#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="hljs-variable">@Documented</span></span><br><span class="line">public <span class="hljs-variable">@interface</span> SecondAnnotation &#123;</span><br><span class="line">	<span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">value</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//等效于@ SecondAnnotation(value = "this is second annotation")</span></span><br><span class="line"><span class="hljs-meta">@SecondAnnotation(<span class="hljs-meta-string">"this is annotation"</span>)</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JavaBean</span></span>&#123;</span><br><span class="line">	<span class="hljs-comment">//省略实现部分</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>特殊用法三：<br>如果注解中的某个注解类型元素是一个数组类型，在使用时又出现只需要填入一个值的情况，那么在使用注解时可以直接写为：@注解名(类型名 = 类型值)，它和标准写法：@注解名(类型名 = {类型值})等效！  </p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="hljs-variable">@Target</span>(value = &#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="hljs-variable">@Documented</span></span><br><span class="line">public <span class="hljs-variable">@interface</span> ThirdAnnotation &#123;</span><br><span class="line">	<span class="hljs-selector-tag">String</span><span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">name</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight actionscript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//等效于@ ThirdAnnotation(name = &#123;"this is third annotation"&#125;)</span></span><br><span class="line">@ ThirdAnnotation(name = <span class="hljs-string">"this is third annotation"</span>)</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JavaBean</span></span>&#123;</span><br><span class="line">	<span class="hljs-comment">//省略实现部分</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>特殊用法四：<br>如果一个注解的@Target是定义为Element.PACKAGE，那么这个注解是配置在package-info.java中的，而不能直接在某个类的package代码上面配置。<br>4 自定义注解的运行时解析<br>这一章是使用注解的核心，读完此章即可明白，如何在程序运行时检测到注解，并进行一系列特殊操作！<br>4.1 回顾注解的保持力<br>首先回顾一下，之前自定义的注解@CherryAnnotation，并把它配置在了类Student上，代码如下：  </p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="hljs-variable">@Target</span>(value = &#123;ElementType.METHOD&#125;)</span><br><span class="line"><span class="hljs-variable">@Documented</span></span><br><span class="line">public <span class="hljs-variable">@interface</span> CherryAnnotation &#123;</span><br><span class="line">    <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">name</span>();</span><br><span class="line">    <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">age</span>() <span class="hljs-selector-tag">default</span> <span class="hljs-selector-tag">18</span>;</span><br><span class="line">    <span class="hljs-selector-tag">int</span><span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">score</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight gradle hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> pojos;</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> Student &#123;</span><br><span class="line">    @CherryAnnotation(name = <span class="hljs-string">"cherry-peng"</span>,age = <span class="hljs-number">23</span>,score = &#123;<span class="hljs-number">99</span>,<span class="hljs-number">66</span>,<span class="hljs-number">77</span>&#125;)</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> study(<span class="hljs-keyword">int</span> <span class="hljs-keyword">times</span>)&#123;</span><br><span class="line">        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">times</span>; i++)&#123;</span><br><span class="line">            System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">"Good Good Study, Day Day Up!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注解保持力的三个阶段：  </p>
<p>Java源文件阶段；<br>编译到class文件阶段；<br>运行期阶段。  </p>
<p>只有当注解的保持力处于运行阶段，即使用@Retention(RetentionPolicy.RUNTIME)修饰注解时，才能在JVM运行时，检测到注解，并进行一系列特殊操作。<br>4.2 反射操作获取注解<br>因此，明确我们的目标：在运行期探究和使用编译期的内容（编译期配置的注解），要用到Java中的灵魂技术——反射！  </p>
<figure class="highlight gradle hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> TestAnnotation &#123;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> main(String[] args)&#123;</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            <span class="hljs-comment">//获取Student的Class对象</span></span><br><span class="line">            <span class="hljs-keyword">Class</span> stuClass = <span class="hljs-keyword">Class</span>.forName(<span class="hljs-string">"pojos.Student"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment">//说明一下，这里形参不能写成Integer.class，应写为int.class</span></span><br><span class="line">            Method stuMethod = stuClass.getMethod(<span class="hljs-string">"study"</span>,<span class="hljs-keyword">int</span>.<span class="hljs-keyword">class</span>);</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">if</span>(stuMethod.isAnnotationPresent(CherryAnnotation.<span class="hljs-keyword">class</span>))&#123;</span><br><span class="line">                System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">"Student类上配置了CherryAnnotation注解！"</span>);</span><br><span class="line">                <span class="hljs-comment">//获取该元素上指定类型的注解</span></span><br><span class="line">                CherryAnnotation cherryAnnotation = stuMethod.getAnnotation(CherryAnnotation.<span class="hljs-keyword">class</span>);</span><br><span class="line">                System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">"name: "</span> + cherryAnnotation.name() + <span class="hljs-string">", age: "</span> + cherryAnnotation.age()</span><br><span class="line">                    + <span class="hljs-string">", score: "</span> + cherryAnnotation.score()[<span class="hljs-number">0</span>]);</span><br><span class="line">            &#125;<span class="hljs-keyword">else</span>&#123;</span><br><span class="line">                System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">"Student类上没有配置CherryAnnotation注解！"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解释一下：  </p>
<p>如果我们要获得的注解是配置在方法上的，那么我们要从Method对象上获取；如果是配置在属性上，就需要从该属性对应的Field对象上去获取，如果是配置在类型上，需要从Class对象上去获取。总之在谁身上，就从谁身上去获取！<br>isAnnotationPresent(Class&lt;? extends Annotation&gt; annotationClass)方法是专门判断该元素上是否配置有某个指定的注解；<br>getAnnotation(Class<a> annotationClass)方法是获取该元素上指定的注解。之后再调用该注解的注解类型元素方法就可以获得配置时的值数据；<br>反射对象上还有一个方法getAnnotations()，该方法可以获得该对象身上配置的所有的注解。它会返回给我们一个注解数组，需要注意的是该数组的类型是Annotation类型，这个Annotation是一个来自于java.lang.annotation包的接口。  </a></p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-15T18:46:00.000Z">2019-07-15</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 分钟 read (About 1090 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/16/redis-share-session/">redis share session</a>
            
        </h1>
        <div class="content">
            <p>redis解决session共享问题<br>@EnableRedisHttpSession<br>pom.xml  </p>
<figure class="highlight dust hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>            </span></span><br><span class="line"><span class="hljs-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            </span></span><br><span class="line"><span class="hljs-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> </span></span><br><span class="line"><span class="hljs-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.5.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        </span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>  	</span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>	    </span></span><br><span class="line"><span class="hljs-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>	        </span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>	        </span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>	       </span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-comment">&lt;!--  &lt;version&gt;$</span></span><span class="hljs-template-variable">&#123;spring_versin&#125;</span><span class="hljs-xml"><span class="hljs-comment">&lt;/version&gt; --&gt;</span> 	        </span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>                </span></span><br><span class="line"><span class="hljs-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> </span></span><br><span class="line"><span class="hljs-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>            </span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>  	    </span></span><br><span class="line"><span class="hljs-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>	    </span></span><br><span class="line"><span class="hljs-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        	</span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>       	 	</span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>       	    </span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-comment">&lt;!-- &lt;version&gt;$</span></span><span class="hljs-template-variable">&#123;spring_versin&#125;</span><span class="hljs-xml"><span class="hljs-comment">&lt;/version&gt; --&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>		</span></span><br><span class="line"><span class="hljs-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>			</span></span><br><span class="line"><span class="hljs-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    		</span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    		</span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    	 	<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.6.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>		</span></span><br><span class="line"><span class="hljs-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>		       </span></span><br><span class="line"><span class="hljs-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    	</span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.session<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    	</span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-session-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    		</span></span><br><span class="line"><span class="hljs-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> 		</span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>application.yml的配置</p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-attribute">logging</span>:</span><br><span class="line">  <span class="hljs-attribute">config</span>: <span class="hljs-attribute">classpath</span>:logback.xml</span><br><span class="line">  <span class="hljs-attribute">path</span>: <span class="hljs-attribute">d</span>:/logs</span><br><span class="line"><span class="hljs-attribute">server</span>:</span><br><span class="line">  <span class="hljs-attribute">port</span>: <span class="hljs-number">8080</span></span><br><span class="line">  <span class="hljs-attribute">session-timeout</span>: <span class="hljs-number">60</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-attribute">spring</span>:</span><br><span class="line">    <span class="hljs-attribute">redis</span>:</span><br><span class="line">       <span class="hljs-attribute">database</span>: <span class="hljs-number">0</span></span><br><span class="line">       <span class="hljs-attribute">host</span>: <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span></span><br><span class="line">       <span class="hljs-attribute">port</span>: <span class="hljs-number">6379</span></span><br><span class="line">       <span class="hljs-attribute">password</span>:</span><br><span class="line">       <span class="hljs-attribute">timeout</span>: <span class="hljs-number">0</span></span><br><span class="line">       <span class="hljs-attribute">pool</span>:</span><br><span class="line">           <span class="hljs-attribute">max-active</span>: <span class="hljs-number">8</span></span><br><span class="line">           <span class="hljs-attribute">max-wait</span>: -<span class="hljs-number">1</span></span><br><span class="line">           <span class="hljs-attribute">max-idle</span>: <span class="hljs-number">8</span></span><br><span class="line">           <span class="hljs-attribute">min-idle</span>: <span class="hljs-number">0</span></span><br><span class="line">    <span class="hljs-attribute">session</span>:</span><br><span class="line">      <span class="hljs-attribute">store-type</span>: none</span><br></pre></td></tr></table></figure>

<p>RedisSessionConfig.java<br>package com.fei.springboot.config;<br>import org.springframework.context.annotation.Configuration;<br>import  org.springframework.session.data.redis.config.annotation.web.http.EnableRedisHttpSession;</p>
<figure class="highlight coffeescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@Configuration<span class="hljs-regexp">//m</span>axInactiveIntervalInSeconds 默认是<span class="hljs-number">1800</span>秒过期，这里测试修改为<span class="hljs-number">60</span>秒@EnableRedisHttpSession(maxInactiveIntervalInSeconds=<span class="hljs-number">60</span>)public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisSessionConfig</span>&#123; &#125;</span></span><br></pre></td></tr></table></figure>

<p> 如果不需要做特殊处理，只需直接使用注解<br> @EnableRedisHttpSession即可，打开@EnableRedisHttpSession源码，发现maxInactiveIntervalInSeconds  session的过期时间默认是1800秒即30分钟，如果需要修改，注解时进行修改即可。如果想对redisSession做一些特殊处理。看@EnableRedisHttpSession源码，头部的注释，也给出了一些方案。</p>
<p>注解@interface EnableRedisHttpSession的源码</p>
<figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* * Copyright 2014-2016 the original author or authors. * * Licensed under the Apache License, Version 2.0 (the "License"); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * *      http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.session</span><span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.redis</span><span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.http</span>; </span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Documented</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Retention</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Target</span>; </span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.context</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Configuration</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.context</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Import</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.redis</span><span class="hljs-selector-class">.connection</span><span class="hljs-selector-class">.RedisConnectionFactory</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.session</span><span class="hljs-selector-class">.SessionRepository</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.session</span><span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.http</span><span class="hljs-selector-class">.EnableSpringHttpSession</span>;</span><br><span class="line"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.session</span><span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.redis</span><span class="hljs-selector-class">.RedisFlushMode</span>;</span><br><span class="line"><span class="hljs-comment">/** * Add this annotation to an &#123;@code @Configuration&#125; class to expose the * SessionRepositoryFilter as a bean named "springSessionRepositoryFilter" and backed by * Redis. In order to leverage the annotation, a single &#123;@link RedisConnectionFactory&#125; * must be provided. For example: &lt;pre&gt; * &lt;code&gt; * &#123;@literal @Configuration&#125; * &#123;@literal @EnableRedisHttpSession&#125; * public class RedisHttpSessionConfig &#123; * *     &#123;@literal @Bean&#125; *     public JedisConnectionFactory connectionFactory() throws Exception &#123; *         return new JedisConnectionFactory(); *     &#125; * * &#125; * &lt;/code&gt; &lt;/pre&gt; * * More advanced configurations can extend &#123;@link RedisHttpSessionConfiguration&#125; instead. * * @author Rob Winch * @since 1.0 * @see EnableSpringHttpSession */</span></span><br><span class="line">@<span class="hljs-keyword">Retention</span>(<span class="hljs-keyword">java</span>.<span class="hljs-keyword">lang</span>.<span class="hljs-keyword">annotation</span>.<span class="hljs-keyword">RetentionPolicy</span>.<span class="hljs-keyword">RUNTIME</span>)</span><br><span class="line">@<span class="hljs-keyword">Target</span>(&#123; <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.ElementType</span><span class="hljs-selector-class">.TYPE</span> &#125;)</span><br><span class="line">@<span class="hljs-keyword">Documented</span></span><br><span class="line">@<span class="hljs-keyword">Import</span>(<span class="hljs-keyword">RedisHttpSessionConfiguration</span>.<span class="hljs-keyword">class</span>)</span><br><span class="line">@<span class="hljs-keyword">Configurationpublic</span> </span><br><span class="line">@interface EnableRedisHttpSession &#123;	</span><br><span class="line">   <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">maxInactiveIntervalInSeconds</span>() <span class="hljs-selector-tag">default</span> 1800; 	</span><br><span class="line">       <span class="hljs-comment">/**	</span></span><br><span class="line"><span class="hljs-comment">       * &lt;p&gt;	</span></span><br><span class="line"><span class="hljs-comment">         * Defines a unique namespace for keys. The value is used to isolate sessions by	 </span></span><br><span class="line"><span class="hljs-comment">         * changing the prefix from "spring:session:" to	 </span></span><br><span class="line"><span class="hljs-comment">         * "spring:session:&lt;redisNamespace&gt;:". The default is "" such that all Redis	    * keys begin with "spring:session".	 </span></span><br><span class="line"><span class="hljs-comment">       * &lt;/p&gt;	 *	 </span></span><br><span class="line"><span class="hljs-comment">       * &lt;p&gt;	 </span></span><br><span class="line"><span class="hljs-comment">         * For example, if you had an application named "Application A" that needed to keep	 </span></span><br><span class="line"><span class="hljs-comment">         * the sessions isolated from "Application B" you could set two different values for	 </span></span><br><span class="line"><span class="hljs-comment">         * the applications and they could function within the same Redis instance.	 </span></span><br><span class="line"><span class="hljs-comment">       * &lt;/p&gt;	 </span></span><br><span class="line"><span class="hljs-comment">       *	 </span></span><br><span class="line"><span class="hljs-comment">       * @return the unique namespace for keys	 </span></span><br><span class="line"><span class="hljs-comment">       */</span>	</span><br><span class="line">   <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">redisNamespace</span>() <span class="hljs-selector-tag">default</span> ""; 	</span><br><span class="line">       <span class="hljs-comment">/**	 </span></span><br><span class="line"><span class="hljs-comment">       * &lt;p&gt;	 </span></span><br><span class="line"><span class="hljs-comment">         * Sets the flush mode for the Redis sessions. The default is ON_SAVE which only	 </span></span><br><span class="line"><span class="hljs-comment">         * updates the backing Redis when	 </span></span><br><span class="line"><span class="hljs-comment">         * &#123;@link SessionRepository#save(org.springframework.session.Session)&#125; is invoked. In	 </span></span><br><span class="line"><span class="hljs-comment">         * a web environment this happens just before the HTTP response is committed.	</span></span><br><span class="line"><span class="hljs-comment">       * &lt;/p&gt;	 </span></span><br><span class="line"><span class="hljs-comment">       * &lt;p&gt;	 </span></span><br><span class="line"><span class="hljs-comment">         * Setting the value to IMMEDIATE will ensure that the any updates to the Session are	 </span></span><br><span class="line"><span class="hljs-comment">         * immediately written to the Redis instance.	</span></span><br><span class="line"><span class="hljs-comment">       * &lt;/p&gt;	 *	 </span></span><br><span class="line"><span class="hljs-comment">       * @return the &#123;@link RedisFlushMode&#125; to use	 </span></span><br><span class="line"><span class="hljs-comment">       * @since 1.1	 </span></span><br><span class="line"><span class="hljs-comment">       */</span></span><br><span class="line">   <span class="hljs-selector-tag">RedisFlushMode</span> <span class="hljs-selector-tag">redisFlushMode</span>() <span class="hljs-selector-tag">default</span> <span class="hljs-selector-tag">RedisFlushMode</span><span class="hljs-selector-class">.ON_SAVE</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>spring boot中的session redis配置就如此简单。</p>
<p>写个controller测试下</p>
<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> com.fei.springboot.controller; </span><br><span class="line"><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;  </span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller; </span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RequestMapping; </span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">@Controller</span></span><br><span class="line"><span class="hljs-meta">@RequestMapping(<span class="hljs-meta-string">"/"</span>)</span> </span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestController</span> </span>&#123; 	</span><br><span class="line">    <span class="hljs-meta">@RequestMapping(value=<span class="hljs-meta-string">"/getSessionId"</span>)</span> 	</span><br><span class="line">    <span class="hljs-meta">@ResponseBody</span>	</span><br><span class="line">    <span class="hljs-keyword">public</span> String getSessionId(HttpServletRequest request)&#123; 				</span><br><span class="line">          Object o = request.getSession().getAttribute(<span class="hljs-string">"springboot"</span>); </span><br><span class="line">          <span class="hljs-keyword">if</span>(o == <span class="hljs-literal">null</span>)&#123;			</span><br><span class="line">            o = <span class="hljs-string">"spring boot 牛逼了!!!有端口"</span>+request.getLocalPort()+<span class="hljs-string">"生成"</span>;  			   request.getSession().setAttribute(<span class="hljs-string">"springboot"</span>, o);		</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="hljs-keyword">return</span> <span class="hljs-string">"端口="</span> + request.getLocalPort() +  <span class="hljs-string">" sessionId="</span> + request.getSession().getId() +<span class="hljs-string">"&lt;br/&gt;"</span>+o;</span><br><span class="line">          &#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写个启动类</p>
<figure class="highlight scala hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> com.fei.springboot;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.boot.<span class="hljs-type">SpringApplication</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.<span class="hljs-type">EnableAutoConfiguration</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.<span class="hljs-type">SpringBootApplication</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.boot.builder.<span class="hljs-type">SpringApplicationBuilder</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.boot.context.embedded.<span class="hljs-type">ConfigurableEmbeddedServletContainer</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.boot.context.embedded.<span class="hljs-type">EmbeddedServletContainerCustomizer</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.boot.web.support.<span class="hljs-type">SpringBootServletInitializer</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.context.annotation.<span class="hljs-type">ComponentScan</span>; </span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.fei.springboot"</span>&#125;)</span><br><span class="line"><span class="hljs-meta">@SpringBootApplicationpublic</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SpringBootServletInitializer</span> <span class="hljs-title">implements</span> <span class="hljs-title">EmbeddedServletContainerCustomizer</span></span>&#123;  </span><br><span class="line">    <span class="hljs-meta">@Override</span>     </span><br><span class="line">    <span class="hljs-keyword">protected</span> <span class="hljs-type">SpringApplicationBuilder</span> configure(<span class="hljs-type">SpringApplicationBuilder</span> application) &#123;          </span><br><span class="line">    <span class="hljs-keyword">return</span> application.sources(<span class="hljs-type">Application</span>.<span class="hljs-keyword">class</span>);     </span><br><span class="line">    &#125;   	 	 </span><br><span class="line">    public static void main(<span class="hljs-type">String</span>[] args) <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> &#123;	        <span class="hljs-type">SpringApplication</span>.run(<span class="hljs-type">Application</span>.<span class="hljs-keyword">class</span>, args);	   </span><br><span class="line">    &#125; 	</span><br><span class="line">    public void customize(<span class="hljs-type">ConfigurableEmbeddedServletContainer</span> configurableEmbeddedServletContainer) &#123;	<span class="hljs-comment">//	configurableEmbeddedServletContainer.setPort(9090);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改application.yml中的server.port的端口为80,执行启动类，然后修改为8080，再次执行启动类。</p>
<p>浏览器测试<br><a href="http://127.0.0.1/getSessionId" target="_blank" rel="noopener">http://127.0.0.1/getSessionId</a><br>得得的结果是</p>
<p>端口=80 sessionId=3312d8db-a8dc-4df3-bc3a-628c311c0b4a<br>spring boot 牛逼了!!!有端口80生成</p>
<p><a href="http://127.0.0.1:8080/getSessionId" target="_blank" rel="noopener">http://127.0.0.1:8080/getSessionId</a><br>得到的结果是</p>
<p>端口=8080 sessionId=3312d8db-a8dc-4df3-bc3a-628c311c0b4a<br>spring boot 牛逼了!!!有端口80生成<br>使用redis-client,查看</p>
<p>注意事项：<br>如果启动时发现报错：<br>ERR Unsupported CONFIG parameter: notify-keyspace-events; nested exception is redis.clients.jedis.exceptions.JedisDataException</p>
<p>这是因为redis服务器版本和jar包版本不一致造成的。</p>
<p>比如说，我这用的spring-session-data-redis版本是1.3.0，到maven 仓库中查询<a href="http://mvnrepository.com/" target="_blank" rel="noopener">http://mvnrepository.com/</a></p>
<p>发现redis是2.8.1，看了下我用的服务器是2.6的，我立刻下载了个最新版的3.x，我是本地测试的，用window的。更换redis服务器后，不再报错了。</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-15T14:24:00.000Z">2019-07-15</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    几秒 read (About 70 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/15/casb-server/">casb server</a>
            
        </h1>
        <div class="content">
            <h5 id="CASB-后台管理（管理端）"><a href="#CASB-后台管理（管理端）" class="headerlink" title="CASB 后台管理（管理端）"></a>CASB 后台管理（管理端）</h5><p>Java项目结构</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">-src</span><br><span class="line"> - java</span><br><span class="line">   - com</span><br><span class="line">     - enlink</span><br><span class="line">       - admin</span><br><span class="line">         - aop</span><br><span class="line">         - config</span><br><span class="line">           - druid</span><br><span class="line">         - constraint</span><br><span class="line">         - core</span><br><span class="line">           - dao</span><br><span class="line">           - feature</span><br><span class="line">           - pojos</span><br><span class="line">           - service</span><br><span class="line">           - timer</span><br><span class="line">         - util</span><br><span class="line">           - excel</span><br><span class="line">         - web</span><br><span class="line">           - controller</span><br><span class="line">             - apps</span><br><span class="line">             - auditmanage</span><br><span class="line">             - auth</span><br><span class="line">             - chargingsystem</span><br><span class="line">             - external</span><br><span class="line">             - firewall</span><br><span class="line">             - ipsec</span><br><span class="line">             - netconfig</span><br><span class="line">             - rule</span><br><span class="line">             - s2s</span><br><span class="line">             - signaturemanage</span><br><span class="line">             - sms</span><br><span class="line">             - sysconfig</span><br><span class="line">             - usermanager</span><br><span class="line">             - BaseController</span><br><span class="line">           - filter</span><br><span class="line">         - ElinkAdminBackApplication </span><br><span class="line"> -libs</span><br><span class="line">   - cn</span><br><span class="line">   - com</span><br><span class="line">   - org</span><br><span class="line"> -resources</span><br><span class="line">  - backup</span><br><span class="line">  - mapper</span><br><span class="line">  - sql </span><br><span class="line">  - application.properties</span><br><span class="line">  - generatorConfig.xml</span><br><span class="line">  - logback-spring.xml</span><br><span class="line">  - mybatis-generator.xml</span><br></pre></td></tr></table></figure>


        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-15T13:32:00.000Z">2019-07-15</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    30 分钟 read (About 4499 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/15/springboot-aop/">springboot aop</a>
            
        </h1>
        <div class="content">
            <p>【SpringBoot】SpingBoot整合AOP<br>Spring的AOP是通过JDK的动态代理和CGLIB实现的。  </p>
<p>说起spring，我们知道其最核心的两个功能就是AOP（面向切面）和IOC（控制反转），这边文章来总结一下SpringBoot如何整合使用AOP。</p>
<p>一、AOP的术语：<br>aop 有一堆术语，非常难以理解，简单说一下  </p>
<p>通知(有的地方叫增强)(Advice)<br>需要完成的工作叫做通知，就是你写的业务逻辑中需要比如事务、日志等先定义好，然后需要的地方再去用  </p>
<p>连接点(Join point)<br>就是spring中允许使用通知的地方，基本上每个方法前后抛异常时都可以是连接点  </p>
<p>切点(Poincut)<br>其实就是筛选出的连接点，一个类中的所有方法都是连接点，但又不全需要，会筛选出某些作为连接点做为切点。如果说通知定义了切面的动作或者执行时机的话，切点则定义了执行的地点  </p>
<p>切面(Aspect)<br>其实就是通知和切点的结合，通知和切点共同定义了切面的全部内容，它是干什么的，什么时候在哪执行<br>引入(Introduction)<br>在不改变一个现有类代码的情况下，为该类添加属性和方法,可以在无需修改现有类的前提下，让它们具有新的行为和状态。其实就是把切面（也就是新方法属性：通知定义的）用到目标类中去  </p>
<p>目标(target)<br>被通知的对象。也就是需要加入额外代码的对象，也就是真正的业务逻辑被组织织入切面。  </p>
<p>织入(Weaving)<br>把切面加入程序代码的过程。切面在指定的连接点被织入到目标对象中，在目标对象的生命周期里有多个点可以进行织入：  </p>
<p>编译期：切面在目标类编译时被织入，这种方式需要特殊的编译器<br>类加载期：切面在目标类加载到JVM时被织入，这种方式需要特殊的类加载器，它可以在目标类被引入应用之前增强该目标类的字节码<br>运行期：切面在应用运行的某个时刻被织入，一般情况下，在织入切面时，AOP容器会为目标对象动态创建一个代理对象，Spring AOP就是以这种方式织入切面的。 </p>
<p>例：</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span>&#123;</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="hljs-function">List <span class="hljs-title">list</span><span class="hljs-params">()</span></span>&#123;&#125;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在UserService中的save()方法前需要开启事务，在方法后关闭事务，在抛异常时回滚事务。<br>那么,UserService中的所有方法都是连接点(JoinPoint),save()方法就是切点(Poincut)。需要在save()方法前后执行的方法就是通知(Advice)，切点和通知合起来就是一个切面(Aspect)。save()方法就是目标(target)。把想要执行的代码动态的加入到save()方法前后就是织入(Weaving)。<br>有的地方把通知称作增强是有道理的，在业务方法前后加上其它方法，其实就是对该方法的增强。</p>
<p>二、常用AOP通知(增强)类型  </p>
<p>before(前置通知)：  在方法开始执行前执行<br>after(后置通知)：  在方法执行后执行<br>afterReturning(返回后通知)：   在方法返回后执行<br>afterThrowing(异常通知)： 在抛出异常时执行<br>around(环绕通知)：  在方法执行前和执行后都会执行  </p>
<p>三、执行顺序<br>around &gt; before &gt; around &gt; after &gt; afterReturning</p>
<p>四、先说一下SpringAop非常霸道又用的非常少的功能 –引入(Introduction)  </p>
<p>配置类:</p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@Aspect</span></span><br><span class="line"><span class="hljs-variable">@Component</span></span><br><span class="line">public class IntroductionAop &#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-variable">@DeclareParents</span>(value = <span class="hljs-string">"com.jiuxian..service..*"</span>, defaultImpl = DoSthServiceImpl.class)</span><br><span class="line">    public DoSthService doSthService;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service代码:</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DoSthService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">doSth</span><span class="hljs-params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">@Service</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DoSthServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">DoSthService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doSth</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="hljs-string">"do sth ...."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testIntroduction</span><span class="hljs-params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">@Service</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testIntroduction</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="hljs-string">"do testIntroduction"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试代码  </p>
<figure class="highlight aspectj hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Test</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testIntroduction</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    userService.testIntroduction();</span><br><span class="line">    <span class="hljs-comment">//Aop 让UserService方法拥有 DoSthService的方法</span></span><br><span class="line">    DoSthService doSthService = (DoSthService) userService;</span><br><span class="line">    doSthService.doSth();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果</p>
<figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">do</span> testIntroduction</span><br><span class="line"><span class="hljs-keyword">do</span> sth <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span></span><br></pre></td></tr></table></figure>

<p>五、五种通知（增强）代码实现  </p>
<p>配置类<br>(1) 对方法</p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@Aspect</span></span><br><span class="line"><span class="hljs-variable">@Component</span></span><br><span class="line">public class TransactionAop &#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-variable">@Pointcut</span>(<span class="hljs-string">"execution(* com.jiuxian..service.*.*(..))"</span>)</span><br><span class="line">    public void pointcut() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-variable">@Before</span>(<span class="hljs-string">"pointcut()"</span>)</span><br><span class="line">    public void beginTransaction() &#123;</span><br><span class="line">        <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(<span class="hljs-string">"before beginTransaction"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="hljs-selector-tag">After</span>(<span class="hljs-string">"pointcut()"</span>)</span><br><span class="line">    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">commit</span>() &#123;</span><br><span class="line">        <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(<span class="hljs-string">"after commit"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="hljs-selector-tag">AfterReturning</span>(<span class="hljs-string">"pointcut()"</span>, returning = <span class="hljs-string">"returnObject"</span>)</span><br><span class="line">    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">afterReturning</span>(JoinPoint joinPoint, Object returnObject) &#123;</span><br><span class="line">        <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(<span class="hljs-string">"afterReturning"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="hljs-selector-tag">AfterThrowing</span>(<span class="hljs-string">"pointcut()"</span>)</span><br><span class="line">    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">afterThrowing</span>() &#123;</span><br><span class="line">        <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(<span class="hljs-string">"afterThrowing afterThrowing  rollback"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="hljs-selector-tag">Around</span>(<span class="hljs-string">"pointcut()"</span>)</span><br><span class="line">    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Object</span> <span class="hljs-selector-tag">around</span>(ProceedingJoinPoint joinPoint) <span class="hljs-selector-tag">throws</span> <span class="hljs-selector-tag">Throwable</span> &#123;</span><br><span class="line">        <span class="hljs-selector-tag">try</span> &#123;</span><br><span class="line">            <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(<span class="hljs-string">"around"</span>);</span><br><span class="line">            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">joinPoint</span><span class="hljs-selector-class">.proceed</span>();</span><br><span class="line">        &#125; <span class="hljs-selector-tag">catch</span> (Throwable e) &#123;</span><br><span class="line">            <span class="hljs-selector-tag">e</span><span class="hljs-selector-class">.printStackTrace</span>();</span><br><span class="line">            <span class="hljs-selector-tag">throw</span> <span class="hljs-selector-tag">e</span>;</span><br><span class="line">        &#125; <span class="hljs-selector-tag">finally</span> &#123;</span><br><span class="line">            <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(<span class="hljs-string">"around"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(2) 对注解</p>
<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="hljs-meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Log &#123;</span><br><span class="line">    String value() <span class="hljs-keyword">default</span> <span class="hljs-string">""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Aspect</span></span><br><span class="line"><span class="hljs-meta">@Component</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnnotationAop</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Pointcut(value = <span class="hljs-meta-string">"@annotation(log)"</span>, argNames = <span class="hljs-meta-string">"log"</span>)</span></span><br><span class="line">    <span class="hljs-keyword">public</span> void pointcut(Log log) &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Around(value = <span class="hljs-meta-string">"pointcut(log)"</span>, argNames = <span class="hljs-meta-string">"joinPoint,log"</span>)</span></span><br><span class="line">    <span class="hljs-keyword">public</span> Object around(ProceedingJoinPoint joinPoint, Log log) throws Throwable &#123;</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            System.<span class="hljs-keyword">out</span>.println(log.value());</span><br><span class="line">            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"around"</span>);</span><br><span class="line">            <span class="hljs-keyword">return</span> joinPoint.proceed();</span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            <span class="hljs-keyword">throw</span> throwable;</span><br><span class="line">        &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"around"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-meta">@Before(<span class="hljs-meta-string">"@annotation(com.jiuxian.annotation.Log)"</span>)</span></span><br><span class="line">    <span class="hljs-keyword">public</span> void before(JoinPoint joinPoint) &#123;</span><br><span class="line">        MethodSignature signature = (MethodSignature) joinPoint.getSignature();</span><br><span class="line">        Method method = signature.getMethod();</span><br><span class="line">        Log log = method.getAnnotation(Log.<span class="hljs-keyword">class</span>);</span><br><span class="line">        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"注解式拦截 "</span> + log.value());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>service 方法实现</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function">String <span class="hljs-title">save</span><span class="hljs-params">(String user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testAnnotationAop</span><span class="hljs-params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">@Service</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">save</span><span class="hljs-params">(String user)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="hljs-string">"保存用户信息"</span>);</span><br><span class="line">        <span class="hljs-keyword">if</span> (<span class="hljs-string">"a"</span>.equals(user)) &#123;</span><br><span class="line">            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Log</span>(value = <span class="hljs-string">"test"</span>)</span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testAnnotationAop</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="hljs-string">"testAnnotationAop"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试类</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="hljs-meta">@SpringBootTest</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringbootAopApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Resource</span></span><br><span class="line">    <span class="hljs-keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Test</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testAop1</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        userService.save(<span class="hljs-string">"张三"</span>);</span><br><span class="line">        Assert.assertTrue(<span class="hljs-keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Test</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testAop2</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        userService.save(<span class="hljs-string">"a"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-meta">@Test</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testAop3</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        userService.testAnnotationAop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果<br>执行testAop1时</p>
<figure class="highlight applescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">around</span></span><br><span class="line"><span class="hljs-keyword">before</span> beginTransaction</span><br><span class="line">保存用户信息</span><br><span class="line"><span class="hljs-keyword">around</span></span><br><span class="line"><span class="hljs-keyword">after</span> commit</span><br><span class="line">afterReturning :: 张三</span><br></pre></td></tr></table></figure>

<p>执行testAop2时</p>
<figure class="highlight applescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">around</span></span><br><span class="line"><span class="hljs-keyword">before</span> beginTransaction</span><br><span class="line">保存用户信息</span><br><span class="line"><span class="hljs-keyword">around</span></span><br><span class="line"><span class="hljs-keyword">after</span> commit</span><br><span class="line">afterThrowing  rollback</span><br></pre></td></tr></table></figure>

<p>执行testAop3时</p>
<figure class="highlight subunit hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">test</span><br><span class="line">around</span><br><span class="line">testAnnotationAop</span><br><span class="line">around</span><br></pre></td></tr></table></figure>

<p>pom文件</p>
<figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>六、最常用的execution解释  </p>
<p><code>例: execution(* com.jiuxian..service.*.*(..))</code></p>
<p>execution 表达式的主体<br>第一个* 代表任意的返回值<br>com.jiuxian aop所横切的包名<br>包后面.. 表示当前包及其子包<br>第二个* 表示类名，代表所有类<br>.*(..) 表示任何方法,括号代表参数 .. 表示任意参数  </p>
<p>例:<code>execution(* com.jiuxian..service.*Service.add*(String))</code>   </p>
<p>表示： com.jiuxian 包及其子包下的service包下，类名以Service结尾，方法以add开头，参数类型为String的方法的切点。</p>
<p>七、特别的用法  </p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">@Pointcut</span>(<span class="hljs-string">"execution(public * *(..))"</span>)</span><br><span class="line">private void anyPublicOperation() &#123;&#125; </span><br><span class="line"></span><br><span class="line"><span class="hljs-variable">@Pointcut</span>(<span class="hljs-string">"within(com.xyz.someapp.trading..*)"</span>)</span><br><span class="line">private void inTrading() &#123;&#125; </span><br><span class="line"></span><br><span class="line"><span class="hljs-variable">@Pointcut</span>(<span class="hljs-string">"anyPublicOperation() &amp;&amp; inTrading()"</span>)</span><br><span class="line">private void tradingOperation() &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>可以使用 &amp;&amp;, ||, ! 运算符来定义切点</p>
<p>八、更多详细介绍请参阅官网<br><a href="https://link.juejin.im/?target=https%3A%2F%2Fdocs.spring.io%2Fspring%2Fdocs%2Fcurrent%2Fspring-framework-reference%2Fcore.html%23aop-pointcuts" target="_blank" rel="noopener">springAOP官网地址</a></p>
<p>一、示例应用场景：对所有的web请求做切面来记录日志。</p>
<ul>
<li>1、pom中引入SpringBoot的web模块和使用AOP相关的依赖： <figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.aspectj<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aspectjrt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.6.11<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.aspectj<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aspectjweaver<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.6.11<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cglib<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>cglib<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>其中：<br>cglib包是用来动态代理用的,基于类的代理；<br>aspectjrt和aspectjweaver是与aspectj相关的包,用来支持切面编程的；<br>aspectjrt包是aspectj的runtime包；<br>aspectjweaver是aspectj的织入包；  </p>
<ul>
<li>2、实现一个简单的web请求入口（实现传入name参数，返回“hello xxx”的功能）： </li>
</ul>
<p>注意：在完成了引入AOP依赖包后，一般来说并不需要去做其他配置。使用过Spring注解配置方式的人会问是否需要在程序主类中增加@EnableAspectJAutoProxy来启用，实际并不需要。<br>因为在AOP的默认配置属性中，spring.aop.auto属性默认是开启的，也就是说只要引入了AOP依赖后，默认已经增加了@EnableAspectJAutoProxy。  </p>
<ul>
<li>3、定义切面类，实现web层的日志切面   </li>
</ul>
<p>** 要想把一个类变成切面类，需要两步 **  </p>
<p>① 在类上使用 @Component 注解 把切面类加入到IOC容器中<br>② 在类上使用 @Aspect 注解 使之成为切面类  </p>
<figure class="highlight swift hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">package com.example.aop;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="hljs-keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="hljs-keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line"><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="hljs-keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Created by lmb on 2018/9/5.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line">@<span class="hljs-type">Aspect</span></span><br><span class="line">@<span class="hljs-type">Component</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebLogAcpect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> logger = <span class="hljs-type">LoggerFactory</span>.getLogger(<span class="hljs-type">WebLogAcpect</span>.<span class="hljs-keyword">class</span>);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 定义切入点，切入点为com.example.aop下的所有函数</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    @<span class="hljs-type">Pointcut</span>(<span class="hljs-string">"execution(public * com.example.aop..*.*(..))"</span>)</span><br><span class="line">    <span class="hljs-keyword">public</span> void webLog()&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 前置通知：在连接点之前执行的通知</span></span><br><span class="line"><span class="hljs-comment">     * @param joinPoint</span></span><br><span class="line"><span class="hljs-comment">     * @throws Throwable</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    @<span class="hljs-type">Before</span>(<span class="hljs-string">"webLog()"</span>)</span><br><span class="line">    <span class="hljs-keyword">public</span> void doBefore(<span class="hljs-type">JoinPoint</span> joinPoint) <span class="hljs-keyword">throws</span> <span class="hljs-type">Throwable</span> &#123;</span><br><span class="line">        <span class="hljs-comment">// 接收到请求，记录请求内容</span></span><br><span class="line">        <span class="hljs-type">ServletRequestAttributes</span> attributes = (<span class="hljs-type">ServletRequestAttributes</span>) <span class="hljs-type">RequestContextHolder</span>.getRequestAttributes();</span><br><span class="line">        <span class="hljs-type">HttpServletRequest</span> request = attributes.getRequest();</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">// 记录下请求内容</span></span><br><span class="line">        logger.info(<span class="hljs-string">"URL : "</span> + request.getRequestURL().<span class="hljs-built_in">toString</span>());</span><br><span class="line">        logger.info(<span class="hljs-string">"HTTP_METHOD : "</span> + request.getMethod());</span><br><span class="line">        logger.info(<span class="hljs-string">"IP : "</span> + request.getRemoteAddr());</span><br><span class="line">        logger.info(<span class="hljs-string">"CLASS_METHOD : "</span> + joinPoint.getSignature().getDeclaringTypeName() + <span class="hljs-string">"."</span> + joinPoint.getSignature().getName());</span><br><span class="line">        logger.info(<span class="hljs-string">"ARGS : "</span> + <span class="hljs-type">Arrays</span>.<span class="hljs-built_in">toString</span>(joinPoint.getArgs()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="hljs-type">AfterReturning</span>(returning = <span class="hljs-string">"ret"</span>,pointcut = <span class="hljs-string">"webLog()"</span>)</span><br><span class="line">    <span class="hljs-keyword">public</span> void doAfterReturning(<span class="hljs-type">Object</span> ret) <span class="hljs-keyword">throws</span> <span class="hljs-type">Throwable</span> &#123;</span><br><span class="line">        <span class="hljs-comment">// 处理完请求，返回内容</span></span><br><span class="line">        logger.info(<span class="hljs-string">"RESPONSE : "</span> + ret);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上的切面类通过 @Pointcut定义的切入点为com.example.aop包下的所有函数做切入，通过 @Before实现切入点的前置通知，通过 @AfterReturning记录请求返回的对象。<br>访问<a href="http://localhost:8004/hello?name=lmb得到控制台输出如下：" target="_blank" rel="noopener">http://localhost:8004/hello?name=lmb得到控制台输出如下：</a> </p>
<p><a href="https://github.com/LiuMengBing/demo-web/tree/master/src/main/java/com/example/aop" target="_blank" rel="noopener">https://github.com/LiuMengBing/demo-web/tree/master/src/main/java/com/example/aop</a><br>二、AOP支持的通知   </p>
<ul>
<li>1、前置通知@Before：在某连接点之前执行的通知，除非抛出一个异常，否则这个通知不能阻止连接点之前的执行流程。  </li>
</ul>
<figure class="highlight qml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/** </span></span><br><span class="line"><span class="hljs-comment"> * 前置通知，方法调用前被调用 </span></span><br><span class="line"><span class="hljs-comment"> * @param joinPoint/null</span></span><br><span class="line"><span class="hljs-comment"> */</span>  </span><br><span class="line">@Before(value = POINT_CUT)</span><br><span class="line">public <span class="hljs-keyword">void</span> before(JoinPoint joinPoint)&#123;</span><br><span class="line">    logger.info(<span class="hljs-string">"前置通知"</span>);</span><br><span class="line">    <span class="hljs-comment">//获取目标方法的参数信息  </span></span><br><span class="line">    <span class="hljs-built_in">Object</span>[] obj = joinPoint.getArgs();  </span><br><span class="line">    <span class="hljs-comment">//AOP代理类的信息  </span></span><br><span class="line">    joinPoint.getThis();  </span><br><span class="line">    <span class="hljs-comment">//代理的目标对象  </span></span><br><span class="line">    joinPoint.getTarget();  </span><br><span class="line">    <span class="hljs-comment">//用的最多 通知的签名  </span></span><br><span class="line">    Signature signature = joinPoint.getSignature();  </span><br><span class="line">    <span class="hljs-comment">//代理的是哪一个方法  </span></span><br><span class="line">    logger.info(<span class="hljs-string">"代理的是哪一个方法"</span>+signature.getName());  </span><br><span class="line">    <span class="hljs-comment">//AOP代理类的名字  </span></span><br><span class="line">    logger.info(<span class="hljs-string">"AOP代理类的名字"</span>+signature.getDeclaringTypeName());  </span><br><span class="line">    <span class="hljs-comment">//AOP代理类的类（class）信息  </span></span><br><span class="line">    signature.getDeclaringType();  </span><br><span class="line">    <span class="hljs-comment">//获取RequestAttributes  </span></span><br><span class="line">    RequestAttributes requestAttributes = RequestContextHolder.getRequestAttributes();  </span><br><span class="line">    <span class="hljs-comment">//从获取RequestAttributes中获取HttpServletRequest的信息  </span></span><br><span class="line">    HttpServletRequest request = (HttpServletRequest) requestAttributes.resolveReference(RequestAttributes.REFERENCE_REQUEST);  </span><br><span class="line">    <span class="hljs-comment">//如果要获取Session信息的话，可以这样写：  </span></span><br><span class="line">    <span class="hljs-comment">//HttpSession session = (HttpSession) requestAttributes.resolveReference(RequestAttributes.REFERENCE_SESSION);  </span></span><br><span class="line">    <span class="hljs-comment">//获取请求参数</span></span><br><span class="line">    Enumeration&lt;<span class="hljs-built_in">String</span>&gt; <span class="hljs-built_in">enumeration</span> = request.getParameterNames();  </span><br><span class="line">    <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>,<span class="hljs-built_in">String</span>&gt; parameterMap = Maps.newHashMap();  </span><br><span class="line">    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">enumeration</span>.hasMoreElements())&#123;  </span><br><span class="line">        <span class="hljs-built_in">String</span> parameter = <span class="hljs-built_in">enumeration</span>.nextElement();  </span><br><span class="line">        parameterMap.put(parameter,request.getParameter(parameter));  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="hljs-built_in">String</span> str = <span class="hljs-built_in">JSON</span>.toJSONString(parameterMap);  </span><br><span class="line">    <span class="hljs-keyword">if</span>(obj.length &gt; <span class="hljs-number">0</span>) &#123;  </span><br><span class="line">        logger.info(<span class="hljs-string">"请求的参数信息为："</span>+str);</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：这里用到了JoinPoint和RequestContextHolder。<br>1）通过JoinPoint可以获得通知的签名信息，如目标方法名、目标方法参数信息等；<br>2）通过RequestContextHolder来获取请求信息，Session信息；</p>
<ul>
<li>2、后置通知@AfterReturning：在某连接点之后执行的通知，通常在一个匹配的方法返回的时候执行（可以在后置通知中绑定返回值）。</li>
</ul>
<figure class="highlight dart hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"><span class="hljs-markdown">/** </span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet"> * </span>后置返回通知 </span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet"> * </span>这里需要注意的是: </span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet"> *      </span>如果参数中的第一个参数为JoinPoint，则第二个参数为返回值的信息 </span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet"> *      </span>如果参数中的第一个参数不为JoinPoint，则第一个参数为returning中对应的参数 </span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet"> *       </span>returning：限定了只有目标方法返回值与通知方法相应参数类型时才能执行后置返回通知，否则不执行，</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet"> *       </span>对于returning对应的通知方法参数为Object类型将匹配任何目标返回值 </span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet"> * </span>@param joinPoint </span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet"> * </span>@param keys </span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"> */</span></span>  </span><br><span class="line"><span class="hljs-meta">@AfterReturning</span>(value = POINT_CUT,returning = <span class="hljs-string">"keys"</span>)  </span><br><span class="line">public <span class="hljs-keyword">void</span> doAfterReturningAdvice1(JoinPoint joinPoint,<span class="hljs-built_in">Object</span> keys)&#123;  </span><br><span class="line">    logger.info(<span class="hljs-string">"第一个后置返回通知的返回值："</span>+keys);  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">@AfterReturning</span>(value = POINT_CUT,returning = <span class="hljs-string">"keys"</span>,argNames = <span class="hljs-string">"keys"</span>)  </span><br><span class="line">public <span class="hljs-keyword">void</span> doAfterReturningAdvice2(<span class="hljs-built_in">String</span> keys)&#123;  </span><br><span class="line">    logger.info(<span class="hljs-string">"第二个后置返回通知的返回值："</span>+keys);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>3、后置异常通知@AfterThrowing：在方法抛出异常退出时执行的通知。</li>
</ul>
<figure class="highlight dart hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"><span class="hljs-markdown">/** </span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet"> * </span>后置异常通知 </span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet"> *  </span>定义一个名字，该名字用于匹配通知实现方法的一个参数名，当目标方法抛出异常返回后，将把目标方法抛出的异常传给通知方法； </span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet"> *  </span>throwing:限定了只有目标方法抛出的异常与通知方法相应参数异常类型时才能执行后置异常通知，否则不执行， </span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet"> *           </span>对于throwing对应的通知方法参数为Throwable类型将匹配任何异常。 </span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet"> * </span>@param joinPoint </span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet"> * </span>@param exception </span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"> */</span></span>  </span><br><span class="line"><span class="hljs-meta">@AfterThrowing</span>(value = POINT_CUT,throwing = <span class="hljs-string">"exception"</span>)  </span><br><span class="line">public <span class="hljs-keyword">void</span> doAfterThrowingAdvice(JoinPoint joinPoint,Throwable exception)&#123;  </span><br><span class="line">    <span class="hljs-comment">//目标方法名：  </span></span><br><span class="line">    logger.info(joinPoint.getSignature().getName());  </span><br><span class="line">    <span class="hljs-keyword">if</span>(exception instanceof NullPointerException)&#123;  </span><br><span class="line">        logger.info(<span class="hljs-string">"发生了空指针异常!!!!!"</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>4、后置最终通知@After：当某连接点退出时执行的通知（不论是正常返回还是异常退出）。</p>
<figure class="highlight aspectj hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/** </span></span><br><span class="line"><span class="hljs-comment"> * 后置最终通知（目标方法只要执行完了就会执行后置通知方法） </span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> joinPoint </span></span><br><span class="line"><span class="hljs-comment"> */</span>  </span><br><span class="line"><span class="hljs-meta">@After</span>(value = POINT_CUT)  </span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">doAfterAdvice</span><span class="hljs-params">(JoinPoint joinPoint)</span></span>&#123; </span><br><span class="line">    logger.info(<span class="hljs-string">"后置最终通知执行了!!!!"</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>5、环绕通知@Around：包围一个连接点的通知，如方法调用等。这是最强大的一种通知类型。环绕通知可以在方法调用前后完成自定义的行为，它也会选择是否继续执行连接点或者直接返回它自己的返回值或抛出异常来结束执行。</p>
</li>
</ul>
<p>环绕通知最强大，也最麻烦，是一个对方法的环绕，具体方法会通过代理传递到切面中去，切面中可选择执行方法与否，执行几次方法等。环绕通知使用一个代理ProceedingJoinPoint类型的对象来管理目标对象，所以此通知的第一个参数必须是ProceedingJoinPoint类型。在通知体内调用ProceedingJoinPoint的proceed()方法会导致后台的连接点方法执行。proceed()方法也可能会被调用并且传入一个<code>Object[]</code>对象，该数组中的值将被作为方法执行时的入参。</p>
<figure class="highlight dart hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"><span class="hljs-markdown">/** </span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet"> * </span>环绕通知： </span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet"> *   </span>环绕通知非常强大，可以决定目标方法是否执行，什么时候执行，执行时是否需要替换方法参数，执行完毕是否需要替换返回值。 </span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"><span class="hljs-bullet"> *   </span>环绕通知第一个参数必须是org.aspectj.lang.ProceedingJoinPoint类型 </span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-markdown"> */</span></span>  </span><br><span class="line"><span class="hljs-meta">@Around</span>(value = POINT_CUT)  </span><br><span class="line">public <span class="hljs-built_in">Object</span> doAroundAdvice(ProceedingJoinPoint proceedingJoinPoint)&#123;  </span><br><span class="line">    logger.info(<span class="hljs-string">"环绕通知的目标方法名："</span>+proceedingJoinPoint.getSignature().getName());  </span><br><span class="line">    <span class="hljs-keyword">try</span> &#123;  </span><br><span class="line">        <span class="hljs-built_in">Object</span> obj = proceedingJoinPoint.proceed();  </span><br><span class="line">        <span class="hljs-keyword">return</span> obj;  </span><br><span class="line">    &#125; <span class="hljs-keyword">catch</span> (Throwable throwable) &#123;  </span><br><span class="line">        throwable.printStackTrace();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>6、有时候我们定义切面的时候，切面中需要使用到目标对象的某个参数，如何使切面能得到目标对象的参数呢？可以使用args来绑定。如果在一个args表达式中应该使用类型名字的地方使用一个参数名字，那么当通知执行的时候对象的参数值将会被传递进来。</li>
</ul>
<figure class="highlight aspectj hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Before</span>(<span class="hljs-string">"execution(* findById*(..)) &amp;&amp;"</span> + <span class="hljs-string">"args(id,..)"</span>)</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">twiceAsOld1</span><span class="hljs-params">(Long id)</span></span>&#123;</span><br><span class="line">        System.err.println (<span class="hljs-string">"切面before执行了。。。。id=="</span> + id);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<p>** 注意：任何通知方法都可以将第一个参数定义为org.aspectj.lang.JoinPoint类型（环绕通知需要定义第一个参数为ProceedingJoinPoint类型，它是 JoinPoint 的一个子类）。 **  
JoinPoint接口提供了一系列有用的方法，比如: </p>
<ul>
<li>[] getArgs()（返回方法参数）、</li>
<li>[] getThis()（返回代理对象）、</li>
<li>[] getTarget()（返回目标）、</li>
<li>[] getSignature()（返回正在被通知的方法相关信息）和 </li>
<li>[] toString()（打印出正在被通知的方法的有用信息）。</li>
</ul>
<p>三、切入点表达式<br>定义切入点的时候需要一个包含名字和任意参数的签名，还有一个切入点表达式，如:  execution(public * com.example.aop…(..))<br>** 切入点表达式的格式：execution([可见性]返回类型[声明类型].方法名(参数)[异常]) **   
其中<code>[]</code>内的是可选的，其它的还支持通配符的使用：   </p>
<p>1) *：匹配所有字符<br>2) ..：一般用于匹配多个包，多个参数<br>3) +：表示类及其子类<br>4)运算符有：&amp;&amp;,||,!  </p>
<p>切入点表达式关键词用例： </p>
<figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">1</span>）<span class="hljs-selector-tag">execution</span>：用于匹配子表达式。 </span><br><span class="line"><span class="hljs-comment">//匹配com.cjm.model包及其子包中所有类中的所有方法，返回类型任意，方法参数任意 </span></span><br><span class="line">@<span class="hljs-selector-tag">Pointcut</span>(“execution(* com.cjm.model...(..))”) </span><br><span class="line"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">before</span>()&#123;&#125;</span><br><span class="line"><span class="hljs-selector-tag">2</span>）<span class="hljs-selector-tag">within</span>：用于匹配连接点所在的<span class="hljs-selector-tag">Java</span>类或者包。 </span><br><span class="line"><span class="hljs-comment">//匹配Person类中的所有方法 </span></span><br><span class="line">@<span class="hljs-selector-tag">Pointcut</span>(“within(com.cjm.model.Person)”) </span><br><span class="line"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">before</span>()&#123;&#125; </span><br><span class="line"><span class="hljs-comment">//匹配com.cjm包及其子包中所有类中的所有方法 </span></span><br><span class="line"><span class="hljs-variable">@Pointcut</span>(“within(com.cjm..*)”) </span><br><span class="line">public void before()&#123;&#125;</span><br><span class="line"><span class="hljs-number">3</span>） this：用于向通知方法中传入代理对象的引用。 </span><br><span class="line"><span class="hljs-variable">@Before</span>(“before() &amp;&amp; this(proxy)”) </span><br><span class="line">public void beforeAdvide(JoinPoint point, Object proxy)&#123; </span><br><span class="line"><span class="hljs-comment">//处理逻辑 </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-number">4</span>）target：用于向通知方法中传入目标对象的引用。 </span><br><span class="line"><span class="hljs-variable">@Before</span>(“before() &amp;&amp; target(target) </span><br><span class="line">public void beforeAdvide(JoinPoint point, Object proxy)&#123; </span><br><span class="line"><span class="hljs-comment">//处理逻辑 </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-number">5</span>）args：用于将参数传入到通知方法中。 </span><br><span class="line"><span class="hljs-variable">@Before</span>(“before() &amp;&amp; args(age,username)”) </span><br><span class="line">public void beforeAdvide(JoinPoint point, int age, String username)&#123; </span><br><span class="line"><span class="hljs-comment">//处理逻辑 </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-number">6</span>）<span class="hljs-variable">@within</span> ：用于匹配在类一级使用了参数确定的注解的类，其所有方法都将被匹配。 </span><br><span class="line"><span class="hljs-variable">@Pointcut</span>(“<span class="hljs-variable">@within</span>(com.cjm.annotation.AdviceAnnotation)”) </span><br><span class="line">－ 所有被<span class="hljs-variable">@AdviceAnnotation</span>标注的类都将匹配 </span><br><span class="line">public void before()&#123;&#125;</span><br><span class="line"><span class="hljs-number">7</span>）<span class="hljs-variable">@target</span> ：和<span class="hljs-variable">@within</span>的功能类似，但必须要指定注解接口的保留策略为RUNTIME。 </span><br><span class="line"><span class="hljs-variable">@Pointcut</span>(“<span class="hljs-variable">@target</span>(com.cjm.annotation.AdviceAnnotation)”) </span><br><span class="line">public void before()&#123;&#125;</span><br><span class="line"><span class="hljs-number">8</span>）<span class="hljs-variable">@args</span> ：传入连接点的对象对应的Java类必须被<span class="hljs-variable">@args</span>指定的Annotation注解标注。 </span><br><span class="line"><span class="hljs-variable">@Before</span>(“<span class="hljs-variable">@args</span>(com.cjm.annotation.AdviceAnnotation)”) </span><br><span class="line">public void beforeAdvide(JoinPoint point)&#123; </span><br><span class="line"><span class="hljs-comment">//处理逻辑 </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-number">9</span>）<span class="hljs-variable">@annotation</span> ：匹配连接点被它参数指定的Annotation注解的方法。也就是说，所有被指定注解标注的方法都将匹配。 </span><br><span class="line"><span class="hljs-variable">@Pointcut</span>(“<span class="hljs-variable">@annotation</span>(com.cjm.annotation.AdviceAnnotation)”) </span><br><span class="line">public void before()&#123;&#125;</span><br><span class="line"><span class="hljs-number">10</span>）bean：通过受管Bean的名字来限定连接点所在的Bean。该关键词是Spring2.<span class="hljs-number">5</span>新增的。 </span><br><span class="line"><span class="hljs-variable">@Pointcut</span>(“bean(person)”) </span><br><span class="line">public void before()&#123;&#125;</span><br></pre></td></tr></table></figure>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-15T11:33:00.000Z">2019-07-15</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/IT/">IT</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    5 分钟 read (About 763 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/15/handleintercepertor/">HandlerInterceptor</a>
            
        </h1>
        <div class="content">
            <p>Spring Boot使用处理器拦截器HandlerInterceptor</p>
<p>首先我们说说什么是处理器拦截器，SpringWebMVC的处理器拦截器，类似于Servlet开发中的过滤器Filter，用于处理器进行预处理和后处理。</p>
<table>
<thead>
<tr>
<th align="left">使用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1、日志记录：记录请求信息的日志，以便进行信息监控、信息统计、计算PV（Page View）等.</td>
</tr>
<tr>
<td align="left">2、权限检查：如登录检测，进入处理器检测检测是否登录，如果没有直接返回到登录页面；</td>
</tr>
<tr>
<td align="left">3、性能监控：有时候系统在某段时间莫名其妙的慢，可以通过拦截器在进入处理器之前记录开始时间，在处理完后记录结束时间，从而得到该请求的处理时间（如果有反向代理，如apache可以自动记录）；</td>
</tr>
<tr>
<td align="left">4、通用行为：读取cookie得到用户信息并将用户对象放入请求，从而方便后续流程使用，还有如提取Locale、Theme信息等，只要是多个处理器都需要的即可使用拦截器实现。</td>
</tr>
<tr>
<td align="left">5、OpenSessionInView：如Hibernate，在进入处理器打开Session，在完成后关闭Session。…………本质也是AOP（面向切面编程），也就是说符合横切关注点的所有功能都可以放入拦截器实现。</td>
</tr>
</tbody></table>
<p>实现方式  </p>
<ul>
<li><p>1、引入spring-boot-starter-web<br>在pom.xml 中引入spring-boot-starter-web包。</p>
<figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>2、建立拦截器<br>preHandle ：在DispatcherServlet之前执行。<br>postHandle：在controller执行之后的DispatcherServlet之后执行。<br>afterCompletion：在页面渲染完成返回给客户端之前执行。</p>
<figure class="highlight aspectj hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PiceaInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     *在DispatcherServlet之前执行</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> handler</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object <span class="hljs-keyword">handler</span>)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="hljs-string">"我是在DispatcherServlet之前执行的方法"</span>);</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 在controller执行之后的DispatcherServlet之后执行</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> handler</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> modelAndView</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">postHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object <span class="hljs-keyword">handler</span>, ModelAndView modelAndView)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="hljs-string">"在controller执行之后的DispatcherServlet之后执行"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 在页面渲染完成返回给客户端之前执行</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> handler</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ex</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object <span class="hljs-keyword">handler</span>, Exception ex)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="hljs-string">"在页面渲染完成返回给客户端之前执行"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>3、建立WebAppConfigurer类<br>这个类的主要作用是注册上我们配置的拦截器。</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Configuration</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PiceaWebAppConfigurer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor(authenticationInterceptor())<span class="hljs-comment">//增加过滤的方法类</span></span><br><span class="line">                .addPathPatterns(<span class="hljs-string">"/**"</span>);<span class="hljs-comment">//定义过滤的范围</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Bean</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> PiceaInterceptor <span class="hljs-title">authenticationInterceptor</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PiceaInterceptor();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>4、建立Contoller类<br>这个类比较简单，不做特别说明</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@RestController</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PiceaContoller</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/query"</span>)</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">asyncTask</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="hljs-string">"我是控制类里面的方法，我正在思考..............."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>5、测试结果<br>在浏览中输入：<a href="http://localhost:2001/query" target="_blank" rel="noopener">http://localhost:2001/query</a><br>这个时候控制台的输入为如下图片。</p>
</li>
</ul>
<p>Spring-boot-fi-interceptor.png</p>

        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous">
            <a class="is-flex-grow has-text-black-ter" href="/categories/IT/page/7/">Anterior</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/categories/IT/page/9/">Siguiente</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link has-text-black-ter" href="/categories/IT/">1</a></li>
            
            <li><span class="pagination-ellipsis has-text-black-ter">&hellip;</span></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/categories/IT/page/7/">7</a></li>
            
            <li><a class="pagination-link is-current" href="/categories/IT/page/8/">8</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/categories/IT/page/9/">9</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/categories/IT/page/10/">10</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recientes
        </h3>
        
        <article class="media">
            
            <a href="/2020/05/29/@Select注解时使用in/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="文档标题">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-29T15:53:20.000Z">2020-05-29</time></div>
                    <a href="/2020/05/29/@Select注解时使用in/" class="title has-link-black-ter is-size-6 has-text-weight-normal">文档标题</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/JAVAEE/">JAVAEE</a> / <a class="has-link-grey -link" href="/categories/JAVAEE/MYBATIS/">MYBATIS</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/29/mysql共享锁和排它锁/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="mysql共享锁和排它锁">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-29T15:35:53.000Z">2020-05-29</time></div>
                    <a href="/2020/05/29/mysql共享锁和排它锁/" class="title has-link-black-ter is-size-6 has-text-weight-normal">mysql共享锁和排它锁</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/JAVAEE/">JAVAEE</a> / <a class="has-link-grey -link" href="/categories/JAVAEE/MYSQL/">MYSQL</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/10/ Git合并/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Git合并特定commits到另一个分支">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-09T18:41:45.000Z">2020-05-09</time></div>
                    <a href="/2020/05/10/ Git合并/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Git合并特定commits到另一个分支</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/GIT/">GIT</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/10/vim常用的操作/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="vim常用的操作">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-09T16:11:06.000Z">2020-05-09</time></div>
                    <a href="/2020/05/10/vim常用的操作/" class="title has-link-black-ter is-size-6 has-text-weight-normal">vim常用的操作</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/VIM/">VIM</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/09/ES分页查询最大数/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="ES分页查询最大数">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-09T11:30:31.000Z">2020-05-09</time></div>
                    <a href="/2020/05/09/ES分页查询最大数/" class="title has-link-black-ter is-size-6 has-text-weight-normal">ES分页查询最大数</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/ES/">ES</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/avatar.png" alt="Joe">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Joe
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Learning
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Your location</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Entradas
                    </p>
                    <p class="title has-text-weight-normal">
                        220
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categorias
                    </p>
                    <p class="title has-text-weight-normal">
                        15
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Etiquetas
                    </p>
                    <p class="title has-text-weight-normal">
                        100
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/ppoffice" target="_blank">
                SEGUIR</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Github" href="https://github.com/joeithub">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Facebook" href="https://facebook.com">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Twitter" href="https://twitter.com">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Dribbble" href="https://dribbble.com">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
        
            
        
            
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categorias
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/ES/">
            <span class="level-start">
                <span class="level-item">ES</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/GIT/">
            <span class="level-start">
                <span class="level-item">GIT</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/IT/">
            <span class="level-start">
                <span class="level-item">IT</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">194</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JAVAEE/">
            <span class="level-start">
                <span class="level-item">JAVAEE</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/JAVAEE/DESIGN-PATTERNS/">
            <span class="level-start">
                <span class="level-item">DESIGN PATTERNS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JAVAEE/MYBATIS/">
            <span class="level-start">
                <span class="level-item">MYBATIS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JAVAEE/MYSQL/">
            <span class="level-start">
                <span class="level-item">MYSQL</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/SPRINGBOOT/">
            <span class="level-start">
                <span class="level-item">SPRINGBOOT</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/SPRINGBOOT/SECURITY/">
            <span class="level-start">
                <span class="level-item">SECURITY</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/SYSTEM/">
            <span class="level-start">
                <span class="level-item">SYSTEM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/VIM/">
            <span class="level-start">
                <span class="level-item">VIM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/WORK/">
            <span class="level-start">
                <span class="level-item">WORK</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/office/">
            <span class="level-start">
                <span class="level-item">office</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/分类1/">
            <span class="level-start">
                <span class="level-item">分类1</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/电商/">
            <span class="level-start">
                <span class="level-item">电商</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Nube de etiquetas
        </h3>
        <a href="/tags/AOP/" style="font-size: 10px;">AOP</a> <a href="/tags/CI-CD/" style="font-size: 10px;">CI/CD</a> <a href="/tags/ELASTICSEARCH/" style="font-size: 10px;">ELASTICSEARCH</a> <a href="/tags/EXCEL/" style="font-size: 10px;">EXCEL</a> <a href="/tags/Eureka/" style="font-size: 10.91px;">Eureka</a> <a href="/tags/GO/" style="font-size: 10px;">GO</a> <a href="/tags/IDEA/" style="font-size: 10.91px;">IDEA</a> <a href="/tags/IT/" style="font-size: 14.55px;">IT</a> <a href="/tags/JAVAEE/" style="font-size: 20px;">JAVAEE</a> <a href="/tags/JAVASCRIPT/" style="font-size: 11.82px;">JAVASCRIPT</a> <a href="/tags/JAVASE/" style="font-size: 10.91px;">JAVASE</a> <a href="/tags/LINUX/" style="font-size: 10px;">LINUX</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/MAC/" style="font-size: 10px;">MAC</a> <a href="/tags/MQ/" style="font-size: 11.82px;">MQ</a> <a href="/tags/ONOS/" style="font-size: 15.45px;">ONOS</a> <a href="/tags/OSGI/" style="font-size: 14.55px;">OSGI</a> <a href="/tags/OSI/" style="font-size: 10px;">OSI</a> <a href="/tags/PROTOCAL/" style="font-size: 10px;">PROTOCAL</a> <a href="/tags/PYTHON/" style="font-size: 10.91px;">PYTHON</a> <a href="/tags/Quartz/" style="font-size: 10px;">Quartz</a> <a href="/tags/RPM/" style="font-size: 10px;">RPM</a> <a href="/tags/Ribbon/" style="font-size: 10px;">Ribbon</a> <a href="/tags/SECURITY/" style="font-size: 10px;">SECURITY</a> <a href="/tags/SPRING-BOOT/" style="font-size: 10px;">SPRING-BOOT</a> <a href="/tags/SQL/" style="font-size: 12.73px;">SQL</a> <a href="/tags/SQLAlert/" style="font-size: 18.18px;">SQLAlert</a> <a href="/tags/SSO/" style="font-size: 10px;">SSO</a> <a href="/tags/StringRedisTemplate/" style="font-size: 10px;">StringRedisTemplate</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/TK-MYBATIS/" style="font-size: 10px;">TK.MYBATIS</a> <a href="/tags/UDP/" style="font-size: 10px;">UDP</a> <a href="/tags/annotation/" style="font-size: 15.45px;">annotation</a> <a href="/tags/bazel/" style="font-size: 10px;">bazel</a> <a href="/tags/beanutils/" style="font-size: 10px;">beanutils</a> <a href="/tags/centos/" style="font-size: 10px;">centos</a> <a href="/tags/classloader/" style="font-size: 10px;">classloader</a> <a href="/tags/computer/" style="font-size: 10px;">computer</a> <a href="/tags/cron/" style="font-size: 10px;">cron</a> <a href="/tags/debug/" style="font-size: 10px;">debug</a> <a href="/tags/docker/" style="font-size: 12.73px;">docker</a> <a href="/tags/druid/" style="font-size: 10px;">druid</a> <a href="/tags/elasticsearch/" style="font-size: 13.64px;">elasticsearch</a> <a href="/tags/enlink/" style="font-size: 10.91px;">enlink</a> <a href="/tags/fastjson/" style="font-size: 10px;">fastjson</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/gitlab/" style="font-size: 10px;">gitlab</a> <a href="/tags/go/" style="font-size: 10px;">go</a> <a href="/tags/hexo/" style="font-size: 12.73px;">hexo</a> <a href="/tags/idea/" style="font-size: 10.91px;">idea</a> <a href="/tags/interceptor/" style="font-size: 11.82px;">interceptor</a> <a href="/tags/jetty/" style="font-size: 10px;">jetty</a> <a href="/tags/jpa/" style="font-size: 10.91px;">jpa</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/karaf/" style="font-size: 11.82px;">karaf</a> <a href="/tags/keepalived/" style="font-size: 10px;">keepalived</a> <a href="/tags/linux-shell/" style="font-size: 15.45px;">linux-shell</a> <a href="/tags/listener/" style="font-size: 10px;">listener</a> <a href="/tags/loadbalanced/" style="font-size: 10px;">loadbalanced</a> <a href="/tags/logback/" style="font-size: 10px;">logback</a> <a href="/tags/login/" style="font-size: 10.91px;">login</a> <a href="/tags/lombok/" style="font-size: 11.82px;">lombok</a> <a href="/tags/mac/" style="font-size: 15.45px;">mac</a> <a href="/tags/markdown/" style="font-size: 11.82px;">markdown</a> <a href="/tags/mybatis/" style="font-size: 17.27px;">mybatis</a> <a href="/tags/mycat/" style="font-size: 10.91px;">mycat</a> <a href="/tags/mysql/" style="font-size: 16.36px;">mysql</a> <a href="/tags/network/" style="font-size: 12.73px;">network</a> <a href="/tags/oauth2/" style="font-size: 10px;">oauth2</a> <a href="/tags/pagehelper/" style="font-size: 10px;">pagehelper</a> <a href="/tags/postman/" style="font-size: 10px;">postman</a> <a href="/tags/python/" style="font-size: 11.82px;">python</a> <a href="/tags/rabbitMq/" style="font-size: 11.82px;">rabbitMq</a> <a href="/tags/redis/" style="font-size: 11.82px;">redis</a> <a href="/tags/redisTemplate/" style="font-size: 10px;">redisTemplate</a> <a href="/tags/reflection/" style="font-size: 11.82px;">reflection</a> <a href="/tags/registry-center/" style="font-size: 10px;">registry center</a> <a href="/tags/restTemplate/" style="font-size: 10px;">restTemplate</a> <a href="/tags/ribbon/" style="font-size: 10px;">ribbon</a> <a href="/tags/serialVersionUID/" style="font-size: 10px;">serialVersionUID</a> <a href="/tags/servlet/" style="font-size: 10.91px;">servlet</a> <a href="/tags/session/" style="font-size: 10.91px;">session</a> <a href="/tags/spring/" style="font-size: 15.45px;">spring</a> <a href="/tags/spring-task/" style="font-size: 12.73px;">spring task</a> <a href="/tags/springboot/" style="font-size: 19.09px;">springboot</a> <a href="/tags/swagger/" style="font-size: 10px;">swagger</a> <a href="/tags/webClient/" style="font-size: 10px;">webClient</a> <a href="/tags/yaml/" style="font-size: 10.91px;">yaml</a> <a href="/tags/事物/" style="font-size: 10px;">事物</a> <a href="/tags/全局异常/" style="font-size: 10px;">全局异常</a> <a href="/tags/分布式/" style="font-size: 10px;">分布式</a> <a href="/tags/抖音/" style="font-size: 10px;">抖音</a> <a href="/tags/文件服务器/" style="font-size: 10.91px;">文件服务器</a> <a href="/tags/日志/" style="font-size: 10px;">日志</a> <a href="/tags/时间转化/" style="font-size: 10px;">时间转化</a> <a href="/tags/标签1/" style="font-size: 10px;">标签1</a> <a href="/tags/消息队列/" style="font-size: 10px;">消息队列</a> <a href="/tags/淘宝/" style="font-size: 10px;">淘宝</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a> <a href="/tags/高可用/" style="font-size: 10px;">高可用</a>
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archivos
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">五月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">四月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">三月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">二月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">一月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">14</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">十月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">28</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">九月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">40</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">八月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">13</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">七月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">66</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">六月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">22</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/1970/09/">
                <span class="level-start">
                    <span class="level-item">九月 1970</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Etiquetas
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/AOP/">
                        <span class="tag">AOP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/CI-CD/">
                        <span class="tag">CI/CD</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ELASTICSEARCH/">
                        <span class="tag">ELASTICSEARCH</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/EXCEL/">
                        <span class="tag">EXCEL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Eureka/">
                        <span class="tag">Eureka</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/GO/">
                        <span class="tag">GO</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/IDEA/">
                        <span class="tag">IDEA</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/IT/">
                        <span class="tag">IT</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JAVAEE/">
                        <span class="tag">JAVAEE</span>
                        <span class="tag is-grey">130</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JAVASCRIPT/">
                        <span class="tag">JAVASCRIPT</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JAVASE/">
                        <span class="tag">JAVASE</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/LINUX/">
                        <span class="tag">LINUX</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux/">
                        <span class="tag">Linux</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MAC/">
                        <span class="tag">MAC</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MQ/">
                        <span class="tag">MQ</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ONOS/">
                        <span class="tag">ONOS</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/OSGI/">
                        <span class="tag">OSGI</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/OSI/">
                        <span class="tag">OSI</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/PROTOCAL/">
                        <span class="tag">PROTOCAL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/PYTHON/">
                        <span class="tag">PYTHON</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Quartz/">
                        <span class="tag">Quartz</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/RPM/">
                        <span class="tag">RPM</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Ribbon/">
                        <span class="tag">Ribbon</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SECURITY/">
                        <span class="tag">SECURITY</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SPRING-BOOT/">
                        <span class="tag">SPRING-BOOT</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SQL/">
                        <span class="tag">SQL</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SQLAlert/">
                        <span class="tag">SQLAlert</span>
                        <span class="tag is-grey">13</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SSO/">
                        <span class="tag">SSO</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/StringRedisTemplate/">
                        <span class="tag">StringRedisTemplate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/TCP/">
                        <span class="tag">TCP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/TK-MYBATIS/">
                        <span class="tag">TK.MYBATIS</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/UDP/">
                        <span class="tag">UDP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/annotation/">
                        <span class="tag">annotation</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/bazel/">
                        <span class="tag">bazel</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/beanutils/">
                        <span class="tag">beanutils</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/centos/">
                        <span class="tag">centos</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/classloader/">
                        <span class="tag">classloader</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/computer/">
                        <span class="tag">computer</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/cron/">
                        <span class="tag">cron</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/debug/">
                        <span class="tag">debug</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/docker/">
                        <span class="tag">docker</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/druid/">
                        <span class="tag">druid</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/elasticsearch/">
                        <span class="tag">elasticsearch</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/enlink/">
                        <span class="tag">enlink</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/fastjson/">
                        <span class="tag">fastjson</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/git/">
                        <span class="tag">git</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/gitlab/">
                        <span class="tag">gitlab</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/go/">
                        <span class="tag">go</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/hexo/">
                        <span class="tag">hexo</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/idea/">
                        <span class="tag">idea</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/interceptor/">
                        <span class="tag">interceptor</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/jetty/">
                        <span class="tag">jetty</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/jpa/">
                        <span class="tag">jpa</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/json/">
                        <span class="tag">json</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/karaf/">
                        <span class="tag">karaf</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/keepalived/">
                        <span class="tag">keepalived</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/linux-shell/">
                        <span class="tag">linux-shell</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/listener/">
                        <span class="tag">listener</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/loadbalanced/">
                        <span class="tag">loadbalanced</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/logback/">
                        <span class="tag">logback</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/login/">
                        <span class="tag">login</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/lombok/">
                        <span class="tag">lombok</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mac/">
                        <span class="tag">mac</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/markdown/">
                        <span class="tag">markdown</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mybatis/">
                        <span class="tag">mybatis</span>
                        <span class="tag is-grey">11</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mycat/">
                        <span class="tag">mycat</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mysql/">
                        <span class="tag">mysql</span>
                        <span class="tag is-grey">9</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/network/">
                        <span class="tag">network</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/oauth2/">
                        <span class="tag">oauth2</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pagehelper/">
                        <span class="tag">pagehelper</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/postman/">
                        <span class="tag">postman</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/python/">
                        <span class="tag">python</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/rabbitMq/">
                        <span class="tag">rabbitMq</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/redis/">
                        <span class="tag">redis</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/redisTemplate/">
                        <span class="tag">redisTemplate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/reflection/">
                        <span class="tag">reflection</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/registry-center/">
                        <span class="tag">registry center</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/restTemplate/">
                        <span class="tag">restTemplate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ribbon/">
                        <span class="tag">ribbon</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/serialVersionUID/">
                        <span class="tag">serialVersionUID</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/servlet/">
                        <span class="tag">servlet</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/session/">
                        <span class="tag">session</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spring/">
                        <span class="tag">spring</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spring-task/">
                        <span class="tag">spring task</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/springboot/">
                        <span class="tag">springboot</span>
                        <span class="tag is-grey">43</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/swagger/">
                        <span class="tag">swagger</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/webClient/">
                        <span class="tag">webClient</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/yaml/">
                        <span class="tag">yaml</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/事物/">
                        <span class="tag">事物</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/全局异常/">
                        <span class="tag">全局异常</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分布式/">
                        <span class="tag">分布式</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/抖音/">
                        <span class="tag">抖音</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/文件服务器/">
                        <span class="tag">文件服务器</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/日志/">
                        <span class="tag">日志</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/时间转化/">
                        <span class="tag">时间转化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/标签1/">
                        <span class="tag">标签1</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/消息队列/">
                        <span class="tag">消息队列</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/淘宝/">
                        <span class="tag">淘宝</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/设计模式/">
                        <span class="tag">设计模式</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/高可用/">
                        <span class="tag">高可用</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/avatar.png" alt="Joe">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Joe
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Learning
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Your location</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Entradas
                    </p>
                    <p class="title has-text-weight-normal">
                        220
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categorias
                    </p>
                    <p class="title has-text-weight-normal">
                        15
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Etiquetas
                    </p>
                    <p class="title has-text-weight-normal">
                        100
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/ppoffice" target="_blank">
                SEGUIR</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Github" href="https://github.com/joeithub">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Facebook" href="https://facebook.com">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Twitter" href="https://twitter.com">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Dribbble" href="https://dribbble.com">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categorias
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/ES/">
            <span class="level-start">
                <span class="level-item">ES</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/GIT/">
            <span class="level-start">
                <span class="level-item">GIT</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/IT/">
            <span class="level-start">
                <span class="level-item">IT</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">194</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JAVAEE/">
            <span class="level-start">
                <span class="level-item">JAVAEE</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/JAVAEE/DESIGN-PATTERNS/">
            <span class="level-start">
                <span class="level-item">DESIGN PATTERNS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JAVAEE/MYBATIS/">
            <span class="level-start">
                <span class="level-item">MYBATIS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JAVAEE/MYSQL/">
            <span class="level-start">
                <span class="level-item">MYSQL</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/SPRINGBOOT/">
            <span class="level-start">
                <span class="level-item">SPRINGBOOT</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/SPRINGBOOT/SECURITY/">
            <span class="level-start">
                <span class="level-item">SECURITY</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/SYSTEM/">
            <span class="level-start">
                <span class="level-item">SYSTEM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/VIM/">
            <span class="level-start">
                <span class="level-item">VIM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/WORK/">
            <span class="level-start">
                <span class="level-item">WORK</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/office/">
            <span class="level-start">
                <span class="level-item">office</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/分类1/">
            <span class="level-start">
                <span class="level-item">分类1</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/电商/">
            <span class="level-start">
                <span class="level-item">电商</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Nube de etiquetas
        </h3>
        <a href="/tags/AOP/" style="font-size: 10px;">AOP</a> <a href="/tags/CI-CD/" style="font-size: 10px;">CI/CD</a> <a href="/tags/ELASTICSEARCH/" style="font-size: 10px;">ELASTICSEARCH</a> <a href="/tags/EXCEL/" style="font-size: 10px;">EXCEL</a> <a href="/tags/Eureka/" style="font-size: 10.91px;">Eureka</a> <a href="/tags/GO/" style="font-size: 10px;">GO</a> <a href="/tags/IDEA/" style="font-size: 10.91px;">IDEA</a> <a href="/tags/IT/" style="font-size: 14.55px;">IT</a> <a href="/tags/JAVAEE/" style="font-size: 20px;">JAVAEE</a> <a href="/tags/JAVASCRIPT/" style="font-size: 11.82px;">JAVASCRIPT</a> <a href="/tags/JAVASE/" style="font-size: 10.91px;">JAVASE</a> <a href="/tags/LINUX/" style="font-size: 10px;">LINUX</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/MAC/" style="font-size: 10px;">MAC</a> <a href="/tags/MQ/" style="font-size: 11.82px;">MQ</a> <a href="/tags/ONOS/" style="font-size: 15.45px;">ONOS</a> <a href="/tags/OSGI/" style="font-size: 14.55px;">OSGI</a> <a href="/tags/OSI/" style="font-size: 10px;">OSI</a> <a href="/tags/PROTOCAL/" style="font-size: 10px;">PROTOCAL</a> <a href="/tags/PYTHON/" style="font-size: 10.91px;">PYTHON</a> <a href="/tags/Quartz/" style="font-size: 10px;">Quartz</a> <a href="/tags/RPM/" style="font-size: 10px;">RPM</a> <a href="/tags/Ribbon/" style="font-size: 10px;">Ribbon</a> <a href="/tags/SECURITY/" style="font-size: 10px;">SECURITY</a> <a href="/tags/SPRING-BOOT/" style="font-size: 10px;">SPRING-BOOT</a> <a href="/tags/SQL/" style="font-size: 12.73px;">SQL</a> <a href="/tags/SQLAlert/" style="font-size: 18.18px;">SQLAlert</a> <a href="/tags/SSO/" style="font-size: 10px;">SSO</a> <a href="/tags/StringRedisTemplate/" style="font-size: 10px;">StringRedisTemplate</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/TK-MYBATIS/" style="font-size: 10px;">TK.MYBATIS</a> <a href="/tags/UDP/" style="font-size: 10px;">UDP</a> <a href="/tags/annotation/" style="font-size: 15.45px;">annotation</a> <a href="/tags/bazel/" style="font-size: 10px;">bazel</a> <a href="/tags/beanutils/" style="font-size: 10px;">beanutils</a> <a href="/tags/centos/" style="font-size: 10px;">centos</a> <a href="/tags/classloader/" style="font-size: 10px;">classloader</a> <a href="/tags/computer/" style="font-size: 10px;">computer</a> <a href="/tags/cron/" style="font-size: 10px;">cron</a> <a href="/tags/debug/" style="font-size: 10px;">debug</a> <a href="/tags/docker/" style="font-size: 12.73px;">docker</a> <a href="/tags/druid/" style="font-size: 10px;">druid</a> <a href="/tags/elasticsearch/" style="font-size: 13.64px;">elasticsearch</a> <a href="/tags/enlink/" style="font-size: 10.91px;">enlink</a> <a href="/tags/fastjson/" style="font-size: 10px;">fastjson</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/gitlab/" style="font-size: 10px;">gitlab</a> <a href="/tags/go/" style="font-size: 10px;">go</a> <a href="/tags/hexo/" style="font-size: 12.73px;">hexo</a> <a href="/tags/idea/" style="font-size: 10.91px;">idea</a> <a href="/tags/interceptor/" style="font-size: 11.82px;">interceptor</a> <a href="/tags/jetty/" style="font-size: 10px;">jetty</a> <a href="/tags/jpa/" style="font-size: 10.91px;">jpa</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/karaf/" style="font-size: 11.82px;">karaf</a> <a href="/tags/keepalived/" style="font-size: 10px;">keepalived</a> <a href="/tags/linux-shell/" style="font-size: 15.45px;">linux-shell</a> <a href="/tags/listener/" style="font-size: 10px;">listener</a> <a href="/tags/loadbalanced/" style="font-size: 10px;">loadbalanced</a> <a href="/tags/logback/" style="font-size: 10px;">logback</a> <a href="/tags/login/" style="font-size: 10.91px;">login</a> <a href="/tags/lombok/" style="font-size: 11.82px;">lombok</a> <a href="/tags/mac/" style="font-size: 15.45px;">mac</a> <a href="/tags/markdown/" style="font-size: 11.82px;">markdown</a> <a href="/tags/mybatis/" style="font-size: 17.27px;">mybatis</a> <a href="/tags/mycat/" style="font-size: 10.91px;">mycat</a> <a href="/tags/mysql/" style="font-size: 16.36px;">mysql</a> <a href="/tags/network/" style="font-size: 12.73px;">network</a> <a href="/tags/oauth2/" style="font-size: 10px;">oauth2</a> <a href="/tags/pagehelper/" style="font-size: 10px;">pagehelper</a> <a href="/tags/postman/" style="font-size: 10px;">postman</a> <a href="/tags/python/" style="font-size: 11.82px;">python</a> <a href="/tags/rabbitMq/" style="font-size: 11.82px;">rabbitMq</a> <a href="/tags/redis/" style="font-size: 11.82px;">redis</a> <a href="/tags/redisTemplate/" style="font-size: 10px;">redisTemplate</a> <a href="/tags/reflection/" style="font-size: 11.82px;">reflection</a> <a href="/tags/registry-center/" style="font-size: 10px;">registry center</a> <a href="/tags/restTemplate/" style="font-size: 10px;">restTemplate</a> <a href="/tags/ribbon/" style="font-size: 10px;">ribbon</a> <a href="/tags/serialVersionUID/" style="font-size: 10px;">serialVersionUID</a> <a href="/tags/servlet/" style="font-size: 10.91px;">servlet</a> <a href="/tags/session/" style="font-size: 10.91px;">session</a> <a href="/tags/spring/" style="font-size: 15.45px;">spring</a> <a href="/tags/spring-task/" style="font-size: 12.73px;">spring task</a> <a href="/tags/springboot/" style="font-size: 19.09px;">springboot</a> <a href="/tags/swagger/" style="font-size: 10px;">swagger</a> <a href="/tags/webClient/" style="font-size: 10px;">webClient</a> <a href="/tags/yaml/" style="font-size: 10.91px;">yaml</a> <a href="/tags/事物/" style="font-size: 10px;">事物</a> <a href="/tags/全局异常/" style="font-size: 10px;">全局异常</a> <a href="/tags/分布式/" style="font-size: 10px;">分布式</a> <a href="/tags/抖音/" style="font-size: 10px;">抖音</a> <a href="/tags/文件服务器/" style="font-size: 10.91px;">文件服务器</a> <a href="/tags/日志/" style="font-size: 10px;">日志</a> <a href="/tags/时间转化/" style="font-size: 10px;">时间转化</a> <a href="/tags/标签1/" style="font-size: 10px;">标签1</a> <a href="/tags/消息队列/" style="font-size: 10px;">消息队列</a> <a href="/tags/淘宝/" style="font-size: 10px;">淘宝</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a> <a href="/tags/高可用/" style="font-size: 10px;">高可用</a>
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archivos
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">五月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">四月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">三月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">二月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">一月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">14</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">十月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">28</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">九月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">40</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">八月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">13</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">七月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">66</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">六月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">22</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/1970/09/">
                <span class="level-start">
                    <span class="level-item">九月 1970</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Etiquetas
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/AOP/">
                        <span class="tag">AOP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/CI-CD/">
                        <span class="tag">CI/CD</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ELASTICSEARCH/">
                        <span class="tag">ELASTICSEARCH</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/EXCEL/">
                        <span class="tag">EXCEL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Eureka/">
                        <span class="tag">Eureka</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/GO/">
                        <span class="tag">GO</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/IDEA/">
                        <span class="tag">IDEA</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/IT/">
                        <span class="tag">IT</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JAVAEE/">
                        <span class="tag">JAVAEE</span>
                        <span class="tag is-grey">130</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JAVASCRIPT/">
                        <span class="tag">JAVASCRIPT</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JAVASE/">
                        <span class="tag">JAVASE</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/LINUX/">
                        <span class="tag">LINUX</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux/">
                        <span class="tag">Linux</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MAC/">
                        <span class="tag">MAC</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MQ/">
                        <span class="tag">MQ</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ONOS/">
                        <span class="tag">ONOS</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/OSGI/">
                        <span class="tag">OSGI</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/OSI/">
                        <span class="tag">OSI</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/PROTOCAL/">
                        <span class="tag">PROTOCAL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/PYTHON/">
                        <span class="tag">PYTHON</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Quartz/">
                        <span class="tag">Quartz</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/RPM/">
                        <span class="tag">RPM</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Ribbon/">
                        <span class="tag">Ribbon</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SECURITY/">
                        <span class="tag">SECURITY</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SPRING-BOOT/">
                        <span class="tag">SPRING-BOOT</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SQL/">
                        <span class="tag">SQL</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SQLAlert/">
                        <span class="tag">SQLAlert</span>
                        <span class="tag is-grey">13</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SSO/">
                        <span class="tag">SSO</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/StringRedisTemplate/">
                        <span class="tag">StringRedisTemplate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/TCP/">
                        <span class="tag">TCP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/TK-MYBATIS/">
                        <span class="tag">TK.MYBATIS</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/UDP/">
                        <span class="tag">UDP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/annotation/">
                        <span class="tag">annotation</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/bazel/">
                        <span class="tag">bazel</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/beanutils/">
                        <span class="tag">beanutils</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/centos/">
                        <span class="tag">centos</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/classloader/">
                        <span class="tag">classloader</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/computer/">
                        <span class="tag">computer</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/cron/">
                        <span class="tag">cron</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/debug/">
                        <span class="tag">debug</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/docker/">
                        <span class="tag">docker</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/druid/">
                        <span class="tag">druid</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/elasticsearch/">
                        <span class="tag">elasticsearch</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/enlink/">
                        <span class="tag">enlink</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/fastjson/">
                        <span class="tag">fastjson</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/git/">
                        <span class="tag">git</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/gitlab/">
                        <span class="tag">gitlab</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/go/">
                        <span class="tag">go</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/hexo/">
                        <span class="tag">hexo</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/idea/">
                        <span class="tag">idea</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/interceptor/">
                        <span class="tag">interceptor</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/jetty/">
                        <span class="tag">jetty</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/jpa/">
                        <span class="tag">jpa</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/json/">
                        <span class="tag">json</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/karaf/">
                        <span class="tag">karaf</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/keepalived/">
                        <span class="tag">keepalived</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/linux-shell/">
                        <span class="tag">linux-shell</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/listener/">
                        <span class="tag">listener</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/loadbalanced/">
                        <span class="tag">loadbalanced</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/logback/">
                        <span class="tag">logback</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/login/">
                        <span class="tag">login</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/lombok/">
                        <span class="tag">lombok</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mac/">
                        <span class="tag">mac</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/markdown/">
                        <span class="tag">markdown</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mybatis/">
                        <span class="tag">mybatis</span>
                        <span class="tag is-grey">11</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mycat/">
                        <span class="tag">mycat</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mysql/">
                        <span class="tag">mysql</span>
                        <span class="tag is-grey">9</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/network/">
                        <span class="tag">network</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/oauth2/">
                        <span class="tag">oauth2</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pagehelper/">
                        <span class="tag">pagehelper</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/postman/">
                        <span class="tag">postman</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/python/">
                        <span class="tag">python</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/rabbitMq/">
                        <span class="tag">rabbitMq</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/redis/">
                        <span class="tag">redis</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/redisTemplate/">
                        <span class="tag">redisTemplate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/reflection/">
                        <span class="tag">reflection</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/registry-center/">
                        <span class="tag">registry center</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/restTemplate/">
                        <span class="tag">restTemplate</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ribbon/">
                        <span class="tag">ribbon</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/serialVersionUID/">
                        <span class="tag">serialVersionUID</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/servlet/">
                        <span class="tag">servlet</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/session/">
                        <span class="tag">session</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spring/">
                        <span class="tag">spring</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spring-task/">
                        <span class="tag">spring task</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/springboot/">
                        <span class="tag">springboot</span>
                        <span class="tag is-grey">43</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/swagger/">
                        <span class="tag">swagger</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/webClient/">
                        <span class="tag">webClient</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/yaml/">
                        <span class="tag">yaml</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/事物/">
                        <span class="tag">事物</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/全局异常/">
                        <span class="tag">全局异常</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分布式/">
                        <span class="tag">分布式</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/抖音/">
                        <span class="tag">抖音</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/文件服务器/">
                        <span class="tag">文件服务器</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/日志/">
                        <span class="tag">日志</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/时间转化/">
                        <span class="tag">时间转化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/标签1/">
                        <span class="tag">标签1</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/消息队列/">
                        <span class="tag">消息队列</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/淘宝/">
                        <span class="tag">淘宝</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/设计模式/">
                        <span class="tag">设计模式</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/高可用/">
                        <span class="tag">高可用</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="Learning" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 Joe Tong&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh_CN");</script>

<script>
var IcarusThemeSettings = {
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>



    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Entradas',
                PAGES: 'Pages',
                CATEGORIES: 'Categorias',
                TAGS: 'Etiquetas',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>