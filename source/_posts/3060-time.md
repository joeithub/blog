title: SQLAlert 时间函数
tags:
  - SQLAlert
categories:
  - IT
author: Joe Tong
date: 2019-06-21 23:17:00
---
## 时间函数
本小节介绍 RDL 中字典相关的操作函数。

### time(sep)
本函数获取当前时间戳，并格式化成字符串。如果脚本中配置了全局变量 \__now\__，则该函数返回 \__now\__ 所表示的时间戳。函数接收 1 个参数：

- sep: 字符串类型，日期与时间之间的分隔符。

该函数代码示例如下：

> ~~~ {.id .cs .numberLines}
> print(time());
> print(time("T"));
> 
> __now__ = "2015-03-02 08:10:00.234";
> print(time());
> ~~~

示例代码的输出内容如下：

> ~~~ {.id .cs}
> 2018-02-07 11:04:25.824+08:00
> 2018-02-07T11:04:25.824+08:00
> 2015-03-02 08:10:00.234+08:00
> ~~~

### sys_time(sep)
本函数获取当前时间戳，并格式化成字符串。函数返回的数值不受全局变量 \__now\__ 的影响。函数接收 1 个参数：

- sep: 字符串类型，日期与时间之间的分隔符。

该函数代码示例如下：

> ~~~ {.id .cs .numberLines}
> print(time());
> print(sys_time());
> 
> __now__ = "2015-03-02 08:10:00.234";
> print(time());
> print(sys_time());
> ~~~

示例代码的输出内容如下：

> ~~~ {.id .cs}
> 2018-02-07 11:08:27.865+08:00
> 2018-02-07 11:08:27.865+08:00
> 2015-03-02 08:10:00.234+08:00
> 2018-02-07 11:08:27.865+08:00
> ~~~

### now(sep)
本函数获取当前时间戳整数值，精确到毫秒。如果脚本中配置了全局变量 \__now\__，则该函数返回 \__now\__ 所表示的时间戳，函数不接收任何个参数。

该函数代码示例如下：

> ~~~ {.id .cs .numberLines}
> print(now());
> 
> __now__ = "2015-03-02 08:10:00.234";
> print(now());
> ~~~

示例代码的输出内容如下：

> ~~~ {.id .cs}
> 1517972720018
> 1425255000234
> ~~~

### sys_now(sep)
本函数获取当前时间戳整数值，精确到毫秒。函数返回的数值不受全局变量 \__now\__ 的影响，函数不接收任何个参数。

该函数代码示例如下：

> ~~~ {.id .cs .numberLines}
> print(now());
> print(sys_now());
> 
> __now__ = "2015-03-02 08:10:00.234";
> print(now());
> print(sys_now());
> ~~~

示例代码的输出内容如下：

> ~~~ {.id .cs}
> 1517972986212
> 1517972986213
> 1425255000234
> 1517972986213
> ~~~

### check_datetime(list)
本函数检测当前日期和时间是否被配置成 on 状态，如果是则返回 true，否则返回 false。如果日期及时间未配置，则返回 true 表示默认为 on 状态。与 on 状态相反的状态为 off 状态，可以通过如下格式对日期和时间进行配置：

> ~~~ {.id .cs .numberLines}
> [
>     { "type": "on",  "months": "1 TO 12", "week_days": "1 to 5", "hours": "9 to 18" },
>     { "type": "off", "months": 10,        "month_days": 1 },
>     { "type": "off", "datetime": "2017-11-02 09" }
> ]
> ~~~

日期和时间配置说明：

- 数组中每一项为一个配置，通过 type 域指定功能 on 或者 off；
- 支持对 months, month_days, week_days, hours, minutes 进行配置，如果不配置则不进行检测；
- 支持使用 datetime 来配置具体的时间段；
- 所有配置支持三种格式：（1）单个整数；（2）整数的数组；（3）字符串 "m to n" 的格式，其中 m 和 n 为整数，mounths 的范围为 1 到 12，month_days 的范围为 1 到 31，week_days 的范围为 1 到 7， hours 的范围从 0 到 23， minutes 的范围从 0 到 59；
- 对于第一个配置项，如果 type 为 on 则其中不在当前配置项中的其他时间段均被置成 off，后续所有配置只影响对应的配置时间段，不会影响到其他时间段；
- 可以重复地 on 或者 off 某时间段，以最后一个配置项作为最终结果。

函数接收 1 个参数：

- list: 数组类型，list 内的元素必需为上述日期和时间配置格式。如果不指定配置，默认搜索全局变量 \__workdays\__ 作为配置。

该函数代码示例如下：

> ~~~ {.id .cs .numberLines}
> list = [
>     { "type": "on",  "months": "1 TO 12", "week_days": "1 to 5", "hours": "9 to 18" },
>     { "type": "off", "months": 10,        "month_days": 1 },
>     { "type": "off", "datetime": "2017-11-02 09" }
> ];
> print(time(), "is on ?", check_datetime(list));
> 
> __now__ = "2017-11-02 09:00:00";
> print(time(), "is on ?", check_datetime(list));
> 
> __now__ = "2017-10-01 08:00:00";
> print(time(), "is on ?", check_datetime(list));
> ~~~

示例代码的输出内容如下：

> ~~~ {.id .cs}
> 2018-02-07 11:40:21.919+08:00 is on ? true
> 2017-11-02 09:00:00+08:00 is on ? false
> 2017-10-01 08:00:00+08:00 is on ? false
> ~~~

需要注意，如果没有配置日期与时间或者配置的时期与时间非法，则该函数返回 true 表示默认为 on 状态。

