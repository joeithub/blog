title: ribbon client load balance
author: Joe Tong
tags:
  - JAVAEE
  - RIBBON
  - SPRINGBOOT
categories:
  - IT
date: 2019-07-17 14:45:00
---
微服务之Ribbon的基本使用


上篇文章已经将咱们的电影服务和用户服务注册到我们实现的Eureka Server上了。但是现在有几个问题需要我们去考虑。
第一个问题就是当有多个用户服务节点的时候，我们如何让电影服务调用用户服务实现负载均衡。
第二个问题就是我们如何让电影服务调用用户服务的时候去使用Eureka Server里面的信息，现在还是通过硬编码去调用的。
首先我们去解决第一个问题，大家应该都知道的一种实现负载均衡的方式，就是在用户服务前面去添加一个nginx，这是一种服务器端负载均衡的方式。

既然现在有服务器负载均衡，那就有另外一种实现方式就是客户端负载均衡,这里我就要引出Ribbon这个组件。
Ribbon是什么？
Ribbon是Netflix发布的开源项目，主要功能是提供客户端的软件负载均衡算法，将Netflix的中间层服务连接在一起。Ribbon客户端组件提供一系列完善的配置项如连接超时，重试等。简单的说，就是在配置文件中列出Load Balancer（简称LB）后面所有的机器，Ribbon会自动的帮助你基于某种规则（如简单轮询，随即连接等）去连接这些机器。我们也很容易使用Ribbon实现自定义的负载均衡算法。

Ribbon工作时分为两步,第一步先选择Eureka Server，它优先选择在同一个Zone且负载较少的Server。
第二部再根据用户指定的策略，再从Server取到的服务注册列表中选择一个地址。其中Ribbon提供了多种策略，例如轮询round robin，随机Random，根据相应时间加权等。
那么接下来我们就在项目中去引入Robbin。
第一步引入Robbin，但是我们不用再去重新添加jar了，在之前的spring-cloud-starter-eureka中就有了。

接下来我们怎么去使用Ribbon。很简单一个注解@LoadBalanced就可以搞定。

为了避免和move服务冲突我们改一下端口，改成8010，

启动服务。

可以去看到时可以正常请求到用户服务的。那么我们怎么去实现负载均衡了，我们的再去启动一个用户服务进行测试。我们再去启动一个用户服务，端口改成7901

我们查看当前服务注册信息，可以看到现在有两个用户服务

请求电影服务我可以看到两个用户服务的控制台都会有日志。
好了今天由于时间问题我就先写到这里，后面会持续分享，喜欢Spring cloud的朋友记得关注我，持续学习后面的知识，我的每篇文章都是连贯的，最好不要断开。我是磊哥，每天为你分享java知识。
